<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description" content="Use the SpectroDraw web app to draw, visualize, and sculpt sound directly on the spectrogram. Free, browser-based sound design.">
  <meta property="og:title" content="SpectroDraw Web App - Interactive Spectrogram Editor">
  <meta property="og:description" content="Draw directly on audio with the SpectroDraw web app. Visual sound editing, real-time playback, and more â€” all in your browser.">
  <link rel="canonical" href="https://spectrodraw.com/app">
  <title>SpectroDraw - Interactive spectrogram editor</title>

<script>
/*
  Manifest-driven loader.
  - Place this at the top of <head> (before any <img>, <link>, <script src>, etc.)
  - manifestUrl should point to the manifest JSON published to KV/site (see sample manifest above)
  - Elements may also be annotated with data-manifest="<logical-name>" to override the detected name.
  - For safety you can set loaderTimeoutMs to a small value to not block page too long.
*/
(async function () {
  try {
    if (window.parent && window.parent.location.host === "127.0.0.1:5500") {
      return;
    }
  } catch (e) {}
  const manifestUrl = 'https://api.spectrodraw.com/spectrodraw-pro/manifest.json'; // adjust if needed
  const loaderTimeoutMs = 3000;

  function isAbsolute(u) {
    return /^[a-zA-Z][a-zA-Z0-9+.-]*:\/\//.test(u) || u.startsWith('//');
  }

  // Utility: canonicalize path used as key into manifest
  function normalizeKey(ref) {
    if (!ref) return null;
    // remove leading ./ or /
    return ref.replace(/^[.\/]+/, '');
  }

  // Fetch manifest (with timeout)
  const manifestPromise = (async () => {
    try {
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), loaderTimeoutMs);
      const r = await fetch(manifestUrl, { method: 'GET',cache: 'no-cache', signal: controller.signal });
      clearTimeout(id);
      if (!r.ok) throw new Error('manifest fetch failed');
      return await r.json();
    } catch (e) {
      console.warn('Manifest load failed:', e);
      return null;
    }
  })();

  const manifest = await manifestPromise;
  if (!manifest) return; // fallback to regular behavior (existing src/href will load)

  // Convert manifest keys to normalized form for lookup
  const map = {};
  for (const k of Object.keys(manifest)) map[normalizeKey(k)] = manifest[k];
  //console.log(map);

  // Helper to map a logical ref -> actual served path
  function resolveManifestUrl(ref) {
    if (!ref) return null;
    if (isAbsolute(ref)) return null; // skip external URLs
    const key = normalizeKey(ref);
    const hashed = map[key];
    if (!hashed) return null;
    // Adjust prefix if your assets live under a different base path:
    return 'https://api.spectrodraw.com/spectrodraw-pro/' + hashed;
  }

  // --- Rewrite logic for many element types ---

  // 1) Replace src/href attributes for common elements (img, script, audio, video, source, track, iframe)
  const selectors = [
    'img[src]',
    'script[src]',
    'link[rel="stylesheet"][href]',
    'audio[src]',
    'video[src]',
    'source[src]',
    'track[src]',
    'iframe[src]',
    'img[data-src]',         // also support data-src usage
    'script[data-src]',
    'link[data-href]',
    '[data-manifest]'        // any element with data-manifest attribute
  ];
  const elems = Array.from(document.querySelectorAll(selectors.join(',')));

  // For scripts we need to preserve execution order. Collect scripts and handle separately.
  const scriptsToLoad = [];

  for (const el of elems) {
    // Determine original reference: data-manifest > data-src/data-href > src/href
    const manifestName = el.getAttribute('data-href') ||
                         el.getAttribute('data-src') ||
                         el.getAttribute('data-manifest') ||
                         el.getAttribute('src') ||
                         el.getAttribute('href');
    let ref = manifestName;

    if (!ref) continue;
    // if absolute URL, skip
    if (isAbsolute(ref)) continue;

    const resolved = resolveManifestUrl(ref);
    if (!resolved) {
      // no mapping: don't modify, let the browser try original path (may 404)
      continue;
    }

    // special handling for different element types
    const tag = el.tagName && el.tagName.toLowerCase();
    if (tag === 'script') {
      // prevent the browser from immediately loading original src by removing attribute if present
      el.removeAttribute('src');
      scriptsToLoad.push({
        original: el,
        src: resolved,
        async: el.hasAttribute('async'),
        defer: el.hasAttribute('defer'),
        type: el.getAttribute('type') || 'text/javascript',
        module: el.getAttribute('type') === 'module'
      });
    } else if (tag === 'link') {
      // set href to resolved
      el.setAttribute('href', resolved);
    } else if (tag === 'img' || tag === 'iframe' || tag === 'video' || tag === 'audio' || tag.tagName === undefined) {
      // for img/iframe/video/audio/source/track just set src (or data-src -> src)
      if (el.hasAttribute('src') || el.hasAttribute('data-src')) {
        el.setAttribute('src', resolved);
      } else if (el.hasAttribute('href') || el.hasAttribute('data-href')) {
        el.setAttribute('href', resolved);
      } else {
        // fallback
        try { el.src = resolved; } catch (e) {}
      }
    } else if (tag === 'source' || tag === 'track') {
      el.setAttribute('src', resolved);
    } else {
      // apply to generic elements with background-image inline style
      const bg = el.style && (el.style.backgroundImage || el.style.background);
      if (bg && bg.indexOf('url(') !== -1) {
        el.style.cssText = el.style.cssText.replace(/url\((['"]?)([^)'"]+)\1\)/g, (m, q, u) => {
          const r = resolveManifestUrl(u);
          return r ? `url('${r}')` : m;
        });
      }
    }
  }

  // 2) Rewrite CSS url(...) inside <style> elements and in document.styleSheets where accessible
  // Note: cross-origin stylesheets may be inaccessible (skip those).
  const styleEls = Array.from(document.querySelectorAll('style'));
  for (const s of styleEls) {
    let text = s.textContent;
    if (!text) continue;
    text = text.replace(/url\((['"]?)([^)'"]+)\1\)/g, (m, q, u) => {
      if (isAbsolute(u)) return m;
      const r = resolveManifestUrl(u);
      return r ? `url('${r}')` : m;
    });
    s.textContent = text;
  }

  // Try to patch accessible stylesheet rules (may throw on CORS'd sheets)
  for (const sheet of Array.from(document.styleSheets)) {
    try {
      const rules = sheet.cssRules || [];
      for (let i = 0; i < rules.length; i++) {
        const rule = rules[i];
        if (!rule || !rule.cssText) continue;
        const newText = rule.cssText.replace(/url\((['"]?)([^)'"]+)\1\)/g, (m, q, u) => {
          if (isAbsolute(u)) return m;
          const r = resolveManifestUrl(u);
          return r ? `url('${r}')` : m;
        });
        if (newText !== rule.cssText) {
          // replace the whole rule
          sheet.deleteRule(i);
          sheet.insertRule(newText, i);
        }
      }
    } catch (e) {
      // ignore CORS / read-only stylesheets
    }
  }

  // 3) Load scripts sequentially to preserve order. We replaced original script src attributes earlier.
  // scriptsToLoad is in document order.
  async function loadScriptsSequentially(items) {
    for (const it of items) {
      const original = it.original;
      const newScript = document.createElement('script');
      if (it.module) newScript.type = 'module'; else newScript.type = it.type;
      if (it.async) newScript.async = true;
      if (it.defer) newScript.defer = true;
      // copy other common attributes
      if (original.getAttribute('nonce')) newScript.setAttribute('nonce', original.getAttribute('nonce'));
      if (original.id) newScript.id = original.id;

      await new Promise((resolve, reject) => {
        newScript.onload = () => resolve();
        newScript.onerror = (e) => {
          console.warn('Failed to load managed script', it.src, e);
          resolve(); // don't break the chain; continue gracefully
        };
        newScript.src = it.src;
        // replace original with new script node so DOM order is maintained
        original.parentNode && original.parentNode.replaceChild(newScript, original);
        // If async, the onload may fire out-of-order; we still await resolve for sequential guarantee
        if (it.async) {
          // async scripts run independently; resolve immediately (so chain doesn't block)
          resolve();
        }
      });
    }
  }

  // Start loading scripts (but don't block the rest of the page)
  loadScriptsSequentially(scriptsToLoad).catch(e => console.warn('Script loader error', e));

})();
</script>


  <link rel="stylesheet" type="text/css" data-href="style.css">
  <link rel="icon" type="image/x-icon" data-href="favicon.ico">
  
</head>
<body>
<div class="app">
  <header class="top-bar">
    <a href="https://spectrodraw.com" id="home" title="Home" style="margin-left:10px;"><img data-manifest="BannerLogo2.png" style="background:transparent; height: 32px;"></a>
    <button id="playPause" title="Play (space)" style="margin-left: 20px">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#333" viewBox="9 8 16 16"><path d="M16 0 M14 22V10l8 6z"/></svg>
    </button>
    <button id="stop" title="Stop">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#333" viewBox="0 0 20 20">
        <rect x="0" y="0" width="18" height="18" rx="2" ry="2"/>
      </svg>
    </button>
    <button id="downloadWav" title="Download audio (ctrl + s)">
      <svg width="20" height="20" viewBox="2 2 20 21" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 14v-2a8 8 0 0 1 16 0v2" />
        <path d="M5 14v4h2v-4H6z" />
        <path d="M17 14v4h2v-4h-2z" />
        <path d="M12 12v10" />
        <path d="M9 19l3 3 3 -3" />
      </svg>
    </button>
    <svg xmlns="http://www.w3.org/2000/svg" width="5" height="50" viewBox="0 0 5 24" fill="none" style="margin-left:8px;margin-right:8px;"><line x1="2" y1="0" x2="2" y2="24" stroke="#999" stroke-width="2" stroke-linecap="round"/></svg>
    <button class="shape-btn" data-shape="brush" id="brushBtn" title="Brush (b)">
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="20" height="20" 
           viewBox="5 4 18 18" 
           fill="#333">
        <path d="M20.71 4.63a2 2 0 0 0-2.83 0l-9.9 9.9a3 3 0 0 0-.78 1.37l-.69 2.76a1 1 0 0 0 1.21 1.21l2.76-.69a3 3 0 0 0 1.37-.78l9.9-9.9a2 2 0 0 0 0-2.83zm-11.24 11.3l-.88.22.22-.88 9.19-9.19.66.66z"/>
      </svg>
    </button>
    <button class="shape-btn" data-shape="note" id="noteBtn" title="Note brush (o)">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="20px" height="20px"><path fill="#333" d="M28.6,178.2c0,0-13.7,53.7-18.6,74.8l26.3-36c-2.4-5.3-0.9-13.4,3.2-17.9c5.6-6.1,15.6-6.1,21.7-0.5c6.2,5.6,6.5,15.1,1,21.2c-4.3,4.6-12.1,6.5-17.7,4.4l-32.9,30.9l69.3-26.8l27.8-41.7l-36.4-34.1L28.6,178.2z M223.3,1.4c-10.5,7.2-142,140.9-142,140.9l37,35.4c0,0,111.5-132,127.7-158.8C243.6-3.8,223.3,1.4,223.3,1.4z"/></svg>
    </button>
    <button class="shape-btn" data-shape="stamp" id="stampBtn" title="Stamp (s)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="1.25 1.25 17.5 17.5" > <g fill="#333" stroke="#333" stroke-width="2" stroke-linejoin="round" > <rect x="2.5" y="10" width="15" height="5" rx="2" ry="2" /> <line x1="10" y1="9" x2="10" y2="6" /> <rect x="8" y="4" width="4" height="3" rx="2" ry="2" /> </g> </svg>
    </button>
    <button class="shape-btn" data-shape="line" id="lineBtn" title="Line (l)">
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="20" height="20" viewBox="0 0 20 20" 
           fill="none"
           stroke = "#333" stroke-width = "3">
        <path d="M20 0 L 0 20"/>
      </svg>
    </button>
    <button class="shape-btn" data-shape="rectangle" id="rectBtn" title="Rectangle (r)">
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="20" height="20" viewBox="0 0 20 20" 
           fill="none"
           stroke = "#333" stroke-width = "5">
        <path d="M0 0 H 20 V 20 H 0 V -20"/>
      </svg>
    </button>
    <button class="shape-btn" data-shape="image" id="imageBtn" title="Image Overlay (i)">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="18" cy="6" r="3" fill="#333" stroke="none"/>
        <polygon points="1,20 8,10 15,20" fill="#333"/>
        <polygon points="8,20 15,12 23,20" fill="#333"/>
      </svg>
    </button>
    <input type="file" id="overlayFile" accept="image/*" style="display:none;">
    <button class="shape-btn" data-shape="select" id="selectBtn" title="Selection Tool">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" >
        <rect x="1" y="1" width="22" height="22" rx="3" ry="3" stroke-dasharray="3 5" />
      </svg>
    </button>
    <svg xmlns="http://www.w3.org/2000/svg" width="5" height="50" viewBox="0 0 5 24" fill="none" style="margin-left:8px;margin-right:8px;"><line x1="2" y1="0" x2="2" y2="24" stroke="#999" stroke-width="2" stroke-linecap="round"/></svg>
    <button class="tool-btn" data-tool="fill" id="colorBtn" title="Fill (f)">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#333">
        <circle cx="12" cy="12" r="9"/>
      </svg>
    </button>
    <button class="tool-btn" data-tool="noiseRemover" id="noiseRemoverBtn" title="Noise Remover (x)">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"width="18.19" height="19.22" viewBox="0,0,18.19,19.22"><g transform="translate(-0.90,-0.39)"><g fill="#333333" stroke="none" stroke-miterlimit="10"><path d="M3.70,2.43l2.87,-2.04l7.13,10.01l-2.87,2.04z" stroke-width="NaN"/><path d="M0.90,4.90l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M2.28,6.82l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M3.73,8.91l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M5.10,10.83l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M6.45,12.73l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M11.39,11.97l2.26,-1.61l5.44,7.64l-2.26,1.61z" stroke-width="NaN"/></g></g></svg>
    </button>
    <button class="tool-btn" data-tool="cloner" id="clonerBtn" title="Cloner (c)">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 23 23" > <g fill="none" stroke="#333" stroke-width="3" stroke-linejoin="round" > <rect x="1.5" y="8.16" width="13.33" height="13.33" rx="2" ry="2" /> <rect x="8.16" y="1.5" width="13.33" height="13.33" rx="2" ry="2" /> </g> </svg>
    </button>
    <button class="tool-btn" data-tool="autotune" id="autotuneBtn" title="Autotune (shift+a)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" role="img" aria-label="Pitchfork">
        <path d=" M 8 2.5 V 12 A 4 10 0 0 0 12 12 V 2.5 " stroke="#333" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round" />
        <line x1="10" y1="14" x2="10" y2="17.5" stroke="#333" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    </button>
    <button class="tool-btn" data-tool="amplifier" id="amplifierBtn" title="Amplifier / Reducer (a)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M2 8V12C2 12.55 2.45 13 3 13H5L7 17C7.18 17.36 7.56 17.59 7.95 17.59C8.63 17.59 9.08 16.86 8.79 16.25L7.2 13H9L16 17V3L9 7H5V7H3C2.45 7 2 7.45 2 8Z" fill="#333"/>
        <path d="M18 7C18.55 7 19 7.45 19 8V12C19 12.55 18.55 13 18 13" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
      </svg>
    </button>
    <button class="tool-btn" data-tool="eraser" id="eraserBtn" title="Eraser (e)">
      <svg width="20" height="20" viewBox="-1 -1 16 16">
        <path d="M5,0 L0,5 L5,10 L10,5 Z " fill="#333" stroke="#333" stroke-width="1"/>
        <path d="M5,10 L10,5 L15,10 L12,13 L8,13 Z" fill="white" stroke="#333" stroke-width="1"/>
      </svg>
    </button>
    <button class="tool-btn" data-tool="blur" id="blurBtn" title="Blur (u)">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#333">
        <path d="M12 2C12 2 7 10 7 14a5 5 0 0 0 10 0c0-4-5-12-5-12z"/>
      </svg>
    </button>
    <svg xmlns="http://www.w3.org/2000/svg" width="5" height="50" viewBox="0 0 5 24" fill="none" style="margin-left:8px;margin-right:8px;"><line x1="2" y1="0" x2="2" y2="24" stroke="#999" stroke-width="2" stroke-linecap="round"/></svg>
    <button id="resetButton" onClick="onReset();" title="Reset audio">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="5" y="7" width="14" height="14" rx="2" ry="2" />
        <line x1="8" x2="8" y1="11" y2 = "17" stroke-width="1"/>
        <line x1="12" x2="12" y1="11" y2 = "17" stroke-width="1"/>
        <line x1="16" x2="16" y1="11" y2 = "17" stroke-width="1"/>
        <rect x="3" y="4" width="18" height="3" rx="2" ry="2" />
        <rect x="8" y="1" width="8" height="2" rx="2" ry="2" stroke-width="1"/>
      </svg>
    </button>
    <button id="undoBtn" title="Undo (Ctrl+Z)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 14H5V10"/>
        <path d="M20 20a9 9 0 0 0-15-6.7L5 10"/>
      </svg>
    </button>
    <button id="redoBtn" title="Redo (Ctrl+Y)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 14h4v-4"/>
        <path d="M4 20a9 9 0 0 1 15-6.7L19 10"/>
      </svg>
    </button>
  </header>
  <aside class="left-bar">
    <!-- Project info -->
    <button class="panel-btn" id="settingsBtn" title="Project (ctrl+d)" data-tool="0">
      <svg xmlns="http://www.w3.org/2000/svg" 
          width="20" height="20" viewBox="0 0 24 24" 
          fill="none" stroke="white" stroke-width="2" 
          stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 
                1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 
                1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 
                1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 
                1 1-2.83-2.83l.06-.06a1.65 
                1.65 0 0 0 .33-1.82 1.65 
                1.65 0 0 0-1.51-1H3a2 2 0 
                1 1 0-4h.09a1.65 1.65 0 
                0 0 1.51-1 1.65 1.65 0 
                0 0-.33-1.82l-.06-.06a2 
                2 0 1 1 2.83-2.83l.06.06a1.65 
                1.65 0 0 0 1.82.33H9a1.65 
                1.65 0 0 0 1-1.51V3a2 2 
                0 1 1 4 0v.09a1.65 1.65 0 
                0 0 1 1.51 1.65 1.65 0 
                0 0 1.82-.33l.06-.06a2 
                2 0 1 1 2.83 2.83l-.06.06a1.65 
                1.65 0 0 0-.33 1.82V9c0 
                .69.28 1.35.77 1.82.49.47 
                1.15.77 1.82.77h.09a2 2 
                0 1 1 0 4h-.09c-.69 0-1.35.28-1.82.77z"/>
      </svg>
    </button>
    
    <!--Tool editor-->
    <button class="panel-btn" id="toolEditBtn" title="Tool Editor" data-tool="1">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 20 20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12.58,11.21 C11.62,12.17 10.91,12.66 10.36,12.85 C10.19,12.35 9.92,11.88 9.52,11.49 C9.12,11.10 8.65,10.82 8.15,10.64 C8.35,10.09 8.84,9.38 9.79,8.43 C12.06,6.15 16.10,3.36 16.87,4.13 C17.64,4.90 14.85,8.94 12.58,11.21 Z 
        M8.39,15.41 C8.02,15.77 7.53,15.96 7.05,15.99 L7.05,16.00 L6.93,16.00 C3.68,16.11 2.26,12.44 3.38,12.83 C4.84,13.33 5.44,12.60 5.46,12.58 C6.27,11.81 7.58,11.81 8.39,12.58 C9.20,13.36 9.20,14.64 8.39,15.41 Z"/>
      </svg>
    </button>

    <!--Sprite-->
    <button class="panel-btn" id="spritesBtn" title="Sprites (ctrl+b)" data-tool="2">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="12,3 20,7 20,17 12,21 4,17 4,7" />
        <line x1="12" y1="11" x2="12" y2="21" />
        <line x1="4" y1="7" x2="12" y2="11" />
        <line x1="20" y1="7" x2="12" y2="11" />
      </svg>
    </button>

    <!--Uploads-->
    <button class="panel-btn" id="uploadsBtn" title="Uploads (ctrl+u)" data-tool="3">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 22 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M2 6h18v11a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6z" />
        <path d="M2 6V3h9v2" />
      </svg>
    </button>

    <!-- Midi -->
    <button class="panel-btn" id="pianoBtn" title="Piano (ctrl+p)" data-tool="4">
      <svg xmlns="http://www.w3.org/2000/svg" 
          width="24" height="24" viewBox="0 0 24 22" 
          fill="none" stroke="white" stroke-width="2" 
          stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="2" width="20" height="20" rx="2" ry="2"/>
        <line x1="7" y1="4" x2="7" y2="15" stroke-width="3"/>
        <line x1="17" y1="4" x2="17" y2="15" stroke-width="3"/>
        <line x1="12" y1="4" x2="12" y2="15" stroke-width="3"/>
      </svg>
    </button>

    <!-- EQ curve -->
    <button class="panel-btn" id="eqBtn" title="Equalizer (ctrl+e)" data-tool="5">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 17c2-4 4-6 8-6s6 4 10 4"/>
        <circle cx="3" cy="17" r="1.5" fill="white"/>
        <circle cx="11" cy="11" r="1.5" fill="white"/>
        <circle cx="21" cy="15" r="1.5" fill="white"/>
      </svg>
    </button>

    <!--Channels-->
    <button class="panel-btn" id="channelsBtn" title="Channels (ctrl+q)" data-tool="6">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="6"  y1="3" x2="6"  y2="21" />
        <line x1="12" y1="3" x2="12" y2="21" />
        <line x1="18" y1="3" x2="18" y2="21" />
        <rect x="2"  y="10.5" width="8"  height="3" rx="1.5" fill="white" stroke="white" stroke-width="1"/>
        <rect x="8"  y="5.5"  width="8"  height="3" rx="1.5" fill="white" stroke="white" stroke-width="1"/>
        <rect x="14" y="14.5" width="8"  height="3" rx="1.5" fill="white" stroke="white" stroke-width="1"/>
      </svg>
    </button>
  </aside>
  <aside class="left-panel">
    <div style="border:1px solid #888; padding: 4px; margin-top:-11px" id="midiv" title="Hold 'n' to preview pitch"><label id="mouseInfo">Pitch: 0hz<br>Time: 0.0<br>Loudness: -inf dB</label><br></div>
    <!--Project settings-->
    <div id="d0">
      <h2 style="margin:10px 0 10px 0;">Project</h2>
      <div class="slider-row"><label for="projectName">Name:</label><input type="text" id="projectName" value="Untitled"></input></div>
      <div id="fftParameters">
        <label class="h1">FFT Parameters
          <a id="fftLearnMore" class="learn-more" href="/faq/fft/#notes" title="Learn more about FFT / STFT" target="_blank" rel="noopener noreferrer" style="color:#777;font-size:10px;display:inline-block;transform:translateY(-1px)">Learn more</a>
        </label>
        <div class="slider-row">
          <label class="h2" title="Height of spectrogram in pixels.">Pitch resolution:</label>
          <select id="fftSize" style="margin-left:87px;">
            <option value="16384">16384</option>
            <option value="8192">8192</option>
            <option value="4096" selected>4096</option>
            <option value="2048">2048</option>
            <option value="1024">1024</option>
            <option value="512">512</option>
            <option value="256">256</option>
            <option value="128">128</option>
            <option value="64">64</option>
          </select>
        </div>
        <div class="slider-row" style="align-items:center;">
          <label class="h2" title="Number of audio samples given to each frame (x pixel).">Time resolution:</label>
          <button id="lockHopBtn" class="lock-btn" aria-pressed="true" title="Lock time resolution to prevent phase interference" style="background:none; border:none; margin-left:55px;" onclick="toggleLockHop();"></button>
          <input id="hopSize" type="number" value="1024" step="1" min="1" style="margin-left: 8px;">
        </div>
      </div>
      <hr>
      </label>
      <div id ="emptyAudioLengthDiv" class="slider-row" title="Buffer length">
        <label class="h2">Buffer length</label>
        <input id="emptyAudioLength" type="range" min="0.01" max="600" step="0.01" value="10">
        <input id="emptyAudioLengthInput" type="number" value="10" min="0.01" max="600">
      </div>
      <div class="slider-row" title="Preview sound while drawing">
          <label class="h2">Sound while drawing</label>
          <input id="previewWhileDrawing" type="checkbox" checked>
      </div>
      <hr>
      <button class="leftBtn" id="saveProject">Save</button>
      <button class="leftBtn" id="startNewProjectBtn">Save and start new project</button>
      <button class="leftBtn" id="saveAndOpenProject">Open project</button>
      <input type="file" id="openProject" accept=".zip*" style="display:none;">
      <div id="presetsModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center;z-index:69420;">
        <div class="modal-content" style="background:#222; padding:20px; border-radius:8px; max-width:300px; width:90%;">
          <h2>New Project</h2>
          <label class="h2" for="presets">Use preset...</label>
          <select id="presets">
            <option value="silence">Silence</option>
            <option value="male">Male sing</option>
            <option value="female">Female sing</option>
            <option value="dog">Dog</option>
            <option value="birdChirp">Bird chirp</option>
            <option value="lionRoar">Lion roar</option>
            <option value="seaLion">Sea lion</option>
            <option value="violin">Violin</option>
            <option value="trumpet">Trumpet</option>
            <option value="timpani">Timpani</option>
            <option value="piano">Piano</option>
            <option value="flute">Flute</option>
            <option value="cymbal">Cymbal</option>
            <option value="computerBeeps">Computer beeps</option>
            <option value="scream">Scream</option>
            <option value="bomb">Bomb</option>
            <option value="engine">Engine</option>
            <option value="fullSpectra">Loud noise</option>
            <option value="bass808">808 bass</option>
            <option value="hardstyle">Hardstyle</option>
            <option value="kick">Kick</option>
            <option value="hihat">Hihat</option>
            <option value="clap">Clap</option>
            <option value="cave14">Cave14.ogg</option>
            <option value="sine">Sine wave</option>
            <option value="triangle">Triangle wave</option>
            <option value="square">Square wave</option>
            <option value="saw">Saw wave</option>
          </select>
          <div style="margin-top:15px; text-align:right;">
            <button id="closeProjectModalBtn" class="leftBtn" style="width:40%;padding:5px;height:1.5rem;">Cancel</button>
            <button id="saveAndStart" class="leftBtn" style="width:40%;padding:5px;height:1.5rem;">Save and start</button>
          </div>
        </div>
      </div>



      <hr>
      <button id="trueScale" title="Use true aspect ratio" class="leftBtn">Use true scale</button>
      <button id="downloadButton" title="Download spectrogram (ctrl + shift + s)" class="leftBtn">Download Spectrogram</button>
      <button id="yAxisMode" title="Toggle Y axis label mode (y)" class="leftBtn">Display Notes</button><br>



    </div>
    <!--Brush editor-->
    <div id="d1" style="display:none;">
      <h2 style="margin:10px 0 10px 0;">Brush settings</h2>
      <canvas id="strokePreview" width="300" height="100" style="border:1px solid #ccc; display:block; margin-top:10px;"></canvas>
      <!--Tool select: Common: {Note brush (harmonics), Stamp, Cloner, Line}, Special: {Pressure brush, Rectangle, Image overlay} -->
      <div class="slider-row" title="Size" id="brushToolSelectDiv">
        <label class="h2">Tool</label>
        <select id="brushToolSelect">
          <option value="note" selected>Note Brush</option>
          <option value="stamp">Stamp</option>
          <option value="line">Line</option>
          <option value="brush">Pressure Brush</option>
          <option value="rectangle">Rectangle</option>
          <option value="image">Image Overlay</option>
          <option value="select">Selection</option>
        </select>
      </div>
      <!--Effect select: Fill, Noise remover (AI), amplifier, Eraser, Blur-->
      <div class="slider-row" title="Size" id="brushEffectSelectDiv">
        <label class="h2">Effect</label>
        <select id="brushEffectSelect">
          <option value="fill" selected>Fill</option>
          <option value="noiseRemover">Noise Remover</option>
          <option value="cloner">Cloner</option>
          <option value="autotune">Autotune</option>
          <option value="amplifier">Amplifier</option>
          <option value="eraser">Eraser</option>
          <option value="blur">Blur</option>
        </select>
      </div>
      <!--Tool settings: Size/width/height/opacity/harmonics-->
      <div id="toolSettings">
        <h3>
          Tool settings
          <button type="button"
                  class="section-toggle"
                  data-target="toolSettings"
                  aria-expanded="true"
                  aria-label="Toggle Effect settings"
                  id="btoolSettingsToggleBtn"></button>
        </h3>
        <div class="slider-row" id="dragToDrawDiv" style="display:none;">
          <label class="h2">Drag to draw</label>
          <input type="checkbox" id="dragToDraw"></input>
        </div>
        <div class="slider-row" id="changeClonerPosDiv" style="display:none;">
          <button id="changeClonerPosBtn" class="leftBtn moving">Changing Reference Point...</button>
        </div>
        <div class="slider-row" title="Cloner scale" id="clonerScaleDiv" style="display:none;">
          <label class="h2">Cloner scale</label>
          <input id="clonerScale" type="range" min="0.01" max="10" value="1" step="0.01">
          <input id="clonerScaleInput" type="number" value="1" min="0.01" max="10">
        </div>
        <div class="slider-row" title="Size" id="brushSizeDiv">
          <label class="h2">Size</label>
          <input id="brushSize" type="range" min="1" max="200" value="40">
          <input id="brushSizeInput" type="number" value="40" min="1" max="200">
        </div>
        <div class="slider-row" title="Width" id="brushWidthDiv">
          <label class="h2">Width</label>
          <input id="brushWidth" type="range" min="1" max="200" value="40">
          <input id="brushWidthInput" type="number" value="40" min="1" max="200">
        </div>
        <div class="slider-row" title="Height" id="brushHeightDiv">
          <label class="h2">Height</label>
          <input id="brushHeight" type="range" min="1" max="200" value="40">
          <input id="brushHeightInput" type="number" value="40" min="1" max="200">
        </div>
        <div class="slider-row" title="Opacity" id="opacityDiv">
          <label class="h2">Opacity</label>
          <input id="brushOpacity"  type="range" min="0" max="1" value="1" step="0.01">
          <input id="brushOpacityInput" type="number" value="1" min="0" max="1">
        </div>
        <div class="slider-row" title="Harmonics Preset" id="harmonicsPresetSelectDiv" style="display:none;">
          <label class="h2">Harmonics preset</label>
          <select id="harmonicsPresetSelect">
            <option value="sine" selected>Sine wave</option>
            <option value="triangle">Triangle wave</option>
            <option value="square">Square wave</option>
            <option value="saw">Saw wave</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div id="brushHarmonicsEditorDiv" style="margin-left:10px;display:none;">
          <h3 style="font-size:15px;margin:0;"id="brushHarmonicsEditorh3">Advanced Harmonics
            <button type="button"
                    class="section-toggle"
                    data-target="brushHarmonicsEditorDiv"
                    aria-expanded="false"
                    aria-label="Toggle Harmonics editor settings"
                    id="brushHarmonicsEditorDivToggleBtn"></button>
          </h3>
          <canvas id="harmonicsEditor" width="280" height="140" style="border:1px solid #ccc; margin-top:10px;"></canvas>
        </div>
        <div id="stampsDiv" style="display:none;">
          <h3>Stamps
            <button type="button"
                    class="section-toggle"
                    data-target="stampsDiv"
                    aria-expanded="true"
                    aria-label="Toggle Stamps"
                    id="stampsDivToggleBtn"></button>
          </h3>
          <div id="stampsWrapper"></div>
        </div>
      </div>
      <!--Effect settings: Depends on effect. -->
      <div id="effectSettings">
        <h3>
          Effect settings
          <button type="button"
                  class="section-toggle"
                  data-target="effectSettings"
                  aria-expanded="true"
                  aria-label="Toggle Effect settings"
                  id="beffectSettingsToggleBtn"></button>
        </h3>
        <div class="slider-row" title="Brightness" id="brushBrightnessDiv">
            <label class="h2">Brush Brightness</label>
            <input id="brushBrightness" type="range" min="0" max="255" value="255">
            <input id="brushBrightnessInput" type="number" value="255" min="0" max="255">
        </div>
        <div class="slider-row" title="Blur Radius" style="display:none;" id="blurRadiusDiv">
            <label class="h2">Blur Radius</label>
            <input id="blurRadius"  type="range" min="0" max="10" value="1.5" step="0.1">
            <input id="blurRadiusInput" type="number" value="1.5" min="0" max="10">
        </div>
        <div class="slider-row" title="Blur Radius" style="display:none;" id="amplifyDiv">
            <label class="h2">Amplifier</label>
            <input id="amp"  type="range" min="0" max="2" value="2" step="0.01">
            <input id="ampInput" type="number" value="2" min="0" max="2">
        </div>
        <div class="slider-row" title="Noise remover aggressiveness" style="display:none;" id="noiseAggDiv">
            <label class="h2">Aggressiveness</label>
            <input id="noiseAgg"  type="range" min="0" max="8" value="5" step="0.1">
            <input id="noiseAggInput" type="number" value="5" min="0" max="8">
        </div>
        <div class="slider-row" id="setNoiseProfileDiv" style="display:none;">
          <button id="setNoiseProfile" class="leftBtn">Set noise profile frames</button>
          <input id="setNoiseProfileMin" type="number" value="0" min="0" max="435">
          <input id="setNoiseProfileMax" type="number" value="0" min="0" max="435">
        </div>
        <div class="slider-row" title="Autotune strength" style="display:none;" id="autoTuneStrengthDiv">
            <label class="h2">Autotune strength</label>
            <input id="autoTuneStrength"  type="range" min="0" max="1" value="1" step="0.01">
            <input id="autoTuneStrengthInput" type="number" value="1" min="0" max="1">
        </div>
        <div class="slider-row" title="Base Pitch" id="astartOnPitchDiv" style="display:none;">
          <label class="h2">Base Hz</label>
          <input id="astartOnPitch" type="range" min="261.63" max="523.3" step="0.01" value="440">
          <input id="astartOnPitchInput" type="number" value="440">
        </div>
        <div class="slider-row" title="Notes Per Octave" id="anpoDiv" style="display:none;">
          <label class="h2">Notes per octave</label>
          <input id="anpo" type="range" min="1" max="48" step="1" value="12">
          <input id="anpoInput" type="number" value="12" min="1" max="384">
        </div>
        <div id="phaseTextureDiv" class="slider-row" title="Phase texture">
          <label class="h2" for="phaseTexture">Phase texture</label>
          <select id="phaseTexture" style="width:137.5px;">
            <option value="Static" selected>Static</option>
            <option value="Harmonics">Harmonics</option>
            <option value="Flat">Flat</option>
            <option value="ImpulseAlign">Custom Impulse</option>
            <option value="FrameAlignedImpulse">Frame Impulse</option>
            <option value="ExpectedAdvance">Expected Advance</option>
            <option value="PhasePropagate">Phase Propagate</option>
            <option value="RandomSmall">Random Small</option>
            <option value="HarmonicStack">Harmonic Stack</option>
            <option value="LinearDelay">Linear Delay</option>
            <option value="Chirp">Chirp</option>
            <option value="CopyFromRef">Reference frame</option>
            <option value="HopArtifact">Hop Artifact</option>
            <option value="Custom">Custom</option>
          </select>

        </div>
        <div class="slider-row" title="Phase" id="phaseSettingsDiv">
            <label class="h2" id="phaseSettingsLabel"></label>
            <input id="phaseSettings"  type="range" min="0" max="0" value="0" step="0.01">
            <input id="phaseSettingsInput" type="number" value="0" min="0" max="0">
        </div>
        <div class="slider-row" title="Phase" id="phaseDiv">
            <label class="h2">Phase shift</label>
            <input id="phaseShift"  type="range" min="0" max="6.283" value="0" step="0.0001">
            <input id="phaseShiftInput" type="number" value="0" min="0" max="6.283">
        </div>
        <div class="slider-row" title="Phase strength" id="phaseStrengthDiv">
            <label class="h2">Phase Strength</label>
            <input id="phaseStrength"  type="range" min="0" max="1" value="1" step="0.001">
            <input id="phaseStrengthInput" type="number" value="1" min="0" max="1">
        </div>
      </div>
    </div>
    <!--Sprites-->
    <div id="d2" style="display:none;">
      <h2 style="margin:10px 0 10px 0;">Sprites</h2>
      <div id="spriteTableWrap">
        <table id="spriteTable" role="grid" aria-label="Sprites table">
          <thead>
            <tr>
              <th style="width:55%;">Name</th>
              <th style="width:15%;">Enabled</th>
              <th style="width:30%;">Tool</th>
            </tr>
          </thead>
          <tbody id="spriteTableBody">
            <!-- rows inserted dynamically -->
          </tbody>
        </table>
      </div>
      <div id="spriteEditor" disabled>
        <div class="spriteEditorRow" style="gap: 12px;align-items: center;height:3rem;">
          <button id="moveSpriteBtn" class="leftBtn">Move Sprite</button>
          <button id="deleteSpriteBtn" class="leftBtn" style="color:Red;">Delete Sprite</button>
        </div>
        <div class="slider-row"><label for="spriteName">Name:</label><input type="text" id="spriteName" value="No sprite selected"></input></div>
        <div class="slider-row"><label for="spriteEnabled">Enabled:</label><input type="checkbox" id="spriteEnabled"></input></div>
        <div class="slider-row" id="spriteToolDiv"><label for="spriteTool" id="stlb">Tool:</label><select id="spriteTool">
          <option value="fill">Fill</option>
          <option value="noiseRemover">Noise Remover</option>
          <option value="autotune">Autotune</option>
          <option value="amplifier">Amplifier</option>
          <option value="eraser">Eraser</option>
          <option value="blur">Blur</option>
        </select></div>
        <div class="slider-row" id="spriteChannelDiv" style="display:none;"><label for="spriteChannel">Channel:</label><select id="spriteChannel">
          <option value="0">0</option>
          <option value="all">All</option>
        </select></div>
        <div id="spriteEffectSettings">
          <h3>
            Effect settings
            <button type="button"
                    class="section-toggle"
                    data-target="spriteEffectSettings"
                    aria-expanded="true"
                    aria-label="Toggle Effect settings"
                    id="effectSettingsToggleBtn"></button>
          </h3>
          <div class="slider-row" title="Brightness" id="sbrushBrightnessDiv">
              <label class="h2">Brush Brightness</label>
              <input id="sbrushBrightness" type="range" min="0" max="255" value="255">
              <input id="sbrushBrightnessInput" type="number" value="255" min="0" max="255">
          </div>
          <div class="slider-row" title="Blur Radius" id="sblurRadiusDiv">
              <label class="h2">Blur Radius</label>
              <input id="sblurRadius"  type="range" min="0" max="10" value="1.5" step="0.1">
              <input id="sblurRadiusInput" type="number" value="1.5" min="0" max="10">
          </div>
          <div class="slider-row" title="Blur Radius" id="samplifyDiv">
              <label class="h2">Amplifier</label>
              <input id="samp"  type="range" min="0" max="2" value="2" step="0.01">
              <input id="sampInput" type="number" value="2" min="0" max="2">
          </div>
          <div class="slider-row" title="Noise remover aggressiveness" id="snoiseAggDiv">
              <label class="h2">Aggressiveness</label>
              <input id="snoiseAgg"  type="range" min="0" max="8" value="5" step="0.1">
              <input id="snoiseAggInput" type="number" value="5" min="0" max="8">
          </div>
          <div class="slider-row" id="ssetNoiseProfileDiv" style="display:none;">
            <button id="ssetNoiseProfile" class="leftBtn">Set noise profile frames</button>
            <input id="ssetNoiseProfileMin" type="number" value="0" min="0" max="435">
            <input id="ssetNoiseProfileMax" type="number" value="0" min="0" max="435">
          </div>
          <div class="slider-row" title="Autotune strength" style="display:none;" id="sautoTuneStrengthDiv">
              <label class="h2">Autotune strength</label>
              <input id="sautoTuneStrength"  type="range" min="0" max="1" value="1" step="0.01">
              <input id="sautoTuneStrengthInput" type="number" value="1" min="0" max="1">
          </div>
          <div class="slider-row" title="Base Pitch" id="sstartOnPitchDiv" style="display:none;">
            <label class="h2">Base Hz</label>
            <input id="sstartOnPitch" type="range" min="261.63" max="523.3" step="0.01" value="440">
            <input id="sstartOnPitchInput" type="number" value="440">
          </div>
          <div class="slider-row" title="Notes Per Octave" id="snpoDiv" style="display:none;">
            <label class="h2">Notes per octave</label>
            <input id="snpo" type="range" min="1" max="48" step="1" value="12">
            <input id="snpoInput" type="number" value="12" min="1" max="384">
          </div>
          <div id="sphaseTextureDiv" class="slider-row" title="Phase texture">
            <label class="h2" for="sphaseTexture">Phase texture</label>
            <select id="sphaseTexture">
              <option value="Static" selected>Static</option>
              <option value="Harmonics">Harmonics</option>
              <option value="Flat">Flat</option>
              <option value="ImpulseAlign">Custom Impulse</option>
              <option value="FrameAlignedImpulse">Frame Impulse</option>
              <option value="ExpectedAdvance">Expected Advance</option>
              <option value="PhasePropagate">Phase Propagate</option>
              <option value="RandomSmall">Random Small</option>
              <option value="HarmonicStack">Harmonic Stack</option>
              <option value="LinearDelay">Linear Delay</option>
              <option value="Chirp">Chirp</option>
              <option value="CopyFromRef">Reference frame</option>
              <option value="HopArtifact">Hop Artifact</option>
              <option value="HopArtifact">Custom</option>
            </select>
          </div>
          <div class="slider-row" title="Phase" id="sphaseSettingsDiv">
              <label class="h2" id="sphaseSettingsLabel"></label>
              <input id="sphaseSettings"  type="range" min="0" max="0" value="0" step="0.01">
              <input id="sphaseSettingsInput" type="number" value="0" min="0" max="0">
          </div>
          <div class="slider-row" title="Phase" id="sphaseDiv">
              <label class="h2">Phase shift</label>
              <input id="sphaseShift"  type="range" min="0" max="6.283" value="0" step="0.0001">
              <input id="sphaseShiftInput" type="number" value="0" min="0" max="6.283">
          </div>
          <div class="slider-row" title="Brightness strength" id="sbrushOpacityDiv">
              <label class="h2">Opacity</label>
              <input id="sbrushOpacity"  type="range" min="0" max="1" value="1" step="0.01">
              <input id="sbrushOpacityInput" type="number" value="1" min="0" max="1">
          </div>
          <div class="slider-row" title="Phase strength" id="sphaseStrengthDiv">
              <label class="h2">Phase Strength</label>
              <input id="sphaseStrength"  type="range" min="0" max="1" value="0" step="0.01">
              <input id="sphaseStrengthInput" type="number" value="0" min="0" max="1">
          </div>
          <div class="slider-row" title="Width" id="sWidthDiv">
              <label class="h2">Selection Width</label>
              <input id="sWidth"  type="range" min="0" max="468" value="0" step="1">
              <input id="sWidthInput" type="number" value="0" min="0" max="468">
          </div>
          <div class="slider-row" title="Height" id="sHeightDiv">
              <label class="h2">Selection Height</label>
              <input id="sHeight"  type="range" min="0" max="2048" value="0" step="1">
              <input id="sHeightInput" type="number" value="0" min="0" max="2048">
          </div>
        </div>
        <div id="spriteFadeDiv">
          <h3>
            Fade
            <button type="button"
                    class="section-toggle"
                    data-target="spriteFadeDiv"
                    aria-expanded="true"
                    aria-label="Toggle Fade"></button>
          </h3>
          <canvas id="spriteFadeCanvas" style="border:1px solid #ccc; display:block; margin-top:10px;width:100%;"></canvas>
        </div>
      </div>
    </div>
    <!--Samples-->
    <div id="d3" style="display:none;">
      <div style="display:flex;">
        <h2 style="margin:10px 0 10px 0;">Samples</h2>
        <button id="rec" title="Record (Ctrl + space)" style="margin-left:170px;margin-top:10px;"></button>
      </div>
      <!-- Upload / Drop box -->
      <div id="samples-upload" style="margin: 6px 0 12px 0;">
        <label class="upload-box" for="samplesUpload">
          <div class="upload-inner" style="border: 3px dotted white; cursor:pointer;border-radius:5px;background:#222;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;" id="fileB">
            <svg viewBox="0 0 24 24" aria-hidden="true" width="48" height="48" style="margin-bottom:10px;">
              <path d="M12,3 v10 m0,-10 l-4,4 m4,-4 l4,4 M4,20 h16" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div style="font-size:13px;">Drop files here or click to upload</div>
          </div>
        </label>
        <input id="samplesUpload" type="file" multiple accept="audio/*,image/*" style="display:none;">
      </div>

      <!-- Collapsible sections use same format as #spriteEffectSettings h3 -->
      <section class="sample-section">
        <div class="section-content" id="uploadsSection">
          <h3>
            Uploads
            <button type="button"
                    class="section-toggle"
                    data-target="uploadsSection"
                    aria-expanded="false"
                    aria-label="Toggle uploads"
                    id="uploadsSectionBtn">
            </button>
          </h3>
          <div id="uploadsWrapper"></div>
        </div>
      </section>

      <section class="sample-section">
        <div class="section-content" id="channelsSection">
          <h3>
            Channels
            <button type="button"
                    class="section-toggle"
                    data-target="channelsSection"
                    aria-expanded="true"
                    aria-label="Toggle channels">
            </button>
          </h3>
          <div id="channelsSampleWrapper"></div>
        </div>
      </section>

      <section class="sample-section">
        <div class="section-content" id="imagesSection">
          <h3>
            Images
            <button type="button"
                    class="section-toggle"
                    data-target="imagesSection"
                    aria-expanded="true"
                    aria-label="Toggle images">
            </button>
          </h3>
          <div class="image-gallery" id="imageGallery" role="list" aria-label="Images gallery">
          </div>
        </div>
      </section>
    </div>
    <!--Midi-->
    <div id="d4" style="display:none;">
      <h2 style="margin:10px 0 10px 0;">Piano</h2>
      <label class="h1">Brush Alignment</label>
      <!--Auto align pitch-->
      <button class="leftBtn" id="alignPitch" title="Auto align pitch (j)">Auto Align Pitch</button>
      <div id="startOnPitchDiv" style="display:none;">
        <div class="slider-row" title="Base Pitch">
          <label class="h2">Base Hz</label>
          <input id="startOnPitch" type="range" min="261.63" max="523.3" step="0.01" value="440">
          <input id="startOnPitchInput" type="number" value="440">
        </div>
        <!--Notes per octave (achieve with pitch bends)-->
        <div class="slider-row" title="Notes Per Octave">
          <label class="h2">Notes per octave</label>
          <input id="npo" type="range" min="1" max="48" step="1" value="12">
          <input id="npoInput" type="number" value="12" min="1" max="384">
        </div>
      </div>
      <!--Auto align time-->
      <button class="leftBtn" id="alignTime" title="Auto align time (k)">Auto Align Time</button>
      <div id ="bpmDiv" class="slider-row" title="BPM" style="display:none;">
        <label class="h2">BPM</label>
        <input id="bpm" type="range" min="0.001" max="500" step="0.01" value="120">
        <input id="bpmInput" type="number" value="120" min="0.001" max="5000">
      </div>
      <!--Remove harmonics button-->
      <button class="leftBtn" id="removeHarmonicsBtn" title="Auto Remove Harmonics" onClick="removeHarmonics()">Remove Harmonics</button>
      <label class="h1">MIDI Export</label>
      <input type="checkbox" id="useMidiAI" title="Use AI model (Ideal for songs)">Use BasicPitch AI</input>
      <div class="slider-row" title="Duration cutoff">
        <label class="h2">Duration cutoff (secs)</label>
        <input id="durationCutoff" type="range" min="0" max="1" step="0.001" value="0.05">
        <input id="durationCutoffInput" type="number" value="0.05" min="0" max="1">
      </div>
      <div id="nonAiMidiDiv">
        <!--Noise floor cutoff-->
        <div class="slider-row" title="Noise floor cutoff">
          <label class="h2">Noise floor (dB)</label>
          <input id="noiseFloorCutoff" type="range" min="-50" max="0" step="0.1" value="-30">
          <input id="noiseFloorCutoffInput" type="number" value="-30" min="-50" max="0">
        </div>
        <input type="checkbox" id="midiAlignTime" title="Midi export time filter" checked>Align to tempo</input>
        <div id="matOptions">
          <div id ="midiBpmDiv" class="slider-row" title="Note BPM">
            <label class="h2">BPM</label>
            <input id="midiBpm" type="range" min="0.001" max="500" step="0.01" value="120">
            <input id="midiBpmInput" type="number" value="120" min="0.001" max="5000">
          </div>
          <div id ="subBeatDiv" class="slider-row" title="Sub beats">
            <label class="h2">Sub beats</label>
            <input id="subBeat" type="range" min="1" max="24" step="1" value="8">
            <input id="subBeatInput" type="number" value="8" min="1" max="24">
          </div>
        </div>
        <button class="leftBtn" title="Use volume controllers (Not recommended)" id="useVolumeControllers">Use Volume Controllers</button>
      </div>
      <div id="AiMidiDiv" style="display:none;">
        <label class="h1">Time Quantize</label>
        <div class="slider-row" title="Time quantize strength">
          <label class="h2">Strength</label>
          <input id="tQs" type="range" min="0" max="100" step="1" value="0">
          <input id="tQsInput" type="number" value="0" min="0" max="100">
        </div>
        <div class="slider-row" title="Time quantize strength">
          <label class="h2">Tempo</label>
          <input id="tQt" type="range" min="1" max="300" step="1" value="120">
          <input id="tQtInput" type="number" value="120" min="1" max="300">
        </div>
        <div class="slider-row" title="Phase texture">
          <label class="h2" for="tQd">Time division</label>
          <select id="tQd">
            <option value="1">1/1</option>
            <option value="2">1/2</option>
            <option value="3">1/3</option>
            <option value="4">1/4</option>
            <option value="5">1/5</option>
            <option value="6">1/6</option>
            <option value="7">1/7</option>
            <option value="8" selected="selected">1/8</option>
            <option value="12">1/12</option>
            <option value="16">1/16</option>
            <option value="24">1/24</option>
            <option value="32">1/32</option>
          </select>
        </div>
      </div>
      <div id="midiChannelSettings">
        <label class="h1">Midi audio channels</label>
        <div style="display:flex; gap:10px; margin-bottom:5px;" title="Channel mode">
          <label class="h2" for="midiChannelMode">Mode</label>
          <select id="midiChannelMode">
            <option value="all">All channels</option>
            <option value="allMixToMono">All channels mixed to mono</option>
            <option value="single">Single channel</option>
          </select>
        </div>
        <div class="slider-row" id="midiSingleChannelDiv" style="display:none;">
          <label class="h2" for="midiSingleChannel">Channel</label>
          <select id="midiSingleChannel"></select>
        </div>
      </div>
      <!--Export button-->
      <button class="leftBtn" id="exportMIDI" title="Export Midi (ctrl + m)" onclick="exportMidi()">Export MIDI</button>
    </div>
    <!--EQ-->
    <div id="d5" style="display:none; height: 80%">
      <h2 style="margin-bottom:10px;margin-top:10px;">Equalizer</h2>
      <h5 style="margin-top:0px; margin-bottom:10px;">Note: Does not update on the spectrogram to save lag</h5>
      <div class="slider-row" title="Global gain" id="globalGainDiv">
        <label class="h2">Global gain</label>
        <input id="globalGain" type="range" min="-30" max="30" step="0.1" value="0">
        <input id="globalGainInput" type="number" value="0" min="-30" max="30">
      </div>
      <div class="slider-row" title="EQ Presets" id="eqPresetsDiv">
        <label class="h2" for="eqPresets">Presets</label>
        <select id="eqPresets">
          <option value="Flat">Flat</option>
          <option value="Bass boost">Bass boost</option>
          <option value="Lowpass">Lowpass</option>
          <option value="Mid boost">Mid boost</option>
          <option value="Midpass">Midpass</option>
          <option value="High boost">High boost</option>
          <option value="Highpass">Highpass</option>
          <option value="Custom">Custom</option>
        </select>
      </div>
      <canvas id="eqCanvas" width="300" height="440" style="border:1px solid #ccc; display:block; margin-top:10px;"></canvas>
    </div>
    <!--Channels-->
    <div id="d6" style="display:none;">
      <h2 style="margin-bottom:10px;margin-top:10px;">Channels</h2>
      <div class="slider-row"><label for="channels">Channels:</label>
        <input type="range" id="channels" min="1" max="16" value="1">
        <input id="channelsInput" type="number" value="1" min="1" max="16">
      </input></div>
      <div class="slider-row" title="Channel Display Height" id="chdiv">
        <label class="h2">Channel height</label>
        <input id="channelHeight" type="range" min="0" max="500" step="1" value="500">
        <input id="channelHeightInput" type="number" value="500" min="0" max="500">
      </div>
      <div class="slider-row" title="Sync actions to all channels">
        <label class="h2">Sync channels</label>
        <input id="syncChannels" type="checkbox">
      </div>
      <div id="channelsMixerDiv"></div>
    </div>
  </aside>
  <main class="main-area"><div id="canvasWrapper" style="width:100%; top:0px"></div></main>
</div>
<div id="status" style="position:absolute;bottom:0px;"></div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<!-- <script>alert("Warning: You have claimed SpectroDraw Pro on this account, but it is still in development. Please sign in on an account without pro to return to the standard app.")</script> -->

<!-- <script data-manifest="fft.js"></script>
<script data-manifest="initialize.js"></script>
<script data-manifest="ui.js"></script>
<script data-manifest="harmonics.js"></script>
<script data-manifest="uploads.js"></script>
<script data-manifest="sprites.js"></script>
<script data-manifest="axes.js"></script>
<script data-manifest="midi.js"></script>
<script data-manifest="recordingAndPresets.js"></script>
<script data-manifest="renderer.js"></script>
<script data-manifest="expressions.js"></script>
<script data-manifest="expressionsParser.js"></script>
<script data-manifest="drawTools.js"></script>
<script data-manifest="undoredo.js"></script>
<script data-manifest="interactive.js"></script>
<script data-manifest="downloads.js"></script>
<script data-manifest="brushPreviewData.js"></script>
<script data-manifest="brushPreview.js"></script>
<script data-manifest="rightClick.js"></script>
<script data-manifest="initialRenders.js"></script>
<script data-manifest="eq.js"></script> -->

<!--Comment out on deploy-->

<link rel="stylesheet" type="text/css" href="style.css">
<script src="fft.js"></script>
<script src="initialize.js"></script>
<script src="ui.js"></script>
<script src="harmonics.js"></script>
<script src="uploads.js"></script>
<script src="sprites.js"></script>
<script src="axes.js"></script>
<script src="midi.js"></script>
<script src="recordingAndPresets.js"></script>
<script src="renderer.js"></script>
<script src="expressions.js"></script>
<script src="expressionsParser.js"></script>
<script src="drawTools.js"></script>
<script src="undoredo.js"></script>
<script src="interactive.js"></script>
<script src="downloads.js"></script>
<script src="brushPreviewData.js"></script>
<script src="brushPreview.js"></script>
<script src="rightClick.js"></script>
<script src="eq.js"></script>
<script src="initialRenders.js"></script>