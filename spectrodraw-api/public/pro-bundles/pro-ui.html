<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description" content="Use the SpectroDraw web app to draw, visualize, and sculpt sound directly on the spectrogram. Free, browser-based sound design.">
  <meta property="og:title" content="SpectroDraw Web App - Interactive Spectrogram Editor">
  <meta property="og:description" content="Draw directly on audio with the SpectroDraw web app. Visual sound editing, real-time playback, and more â€” all in your browser.">
  <link rel="canonical" href="https://spectrodraw.com/app">
  <title>SpectroDraw - Interactive spectrogram editor</title>

<script>
(async function () {if (true) return;
  try {
    if (window.parent && window.parent.location.host === "127.0.0.1:5500") return;
  } catch (e) {}
  const manifestUrl = 'https://api.spectrodraw.com/spectrodraw-pro/manifest.json';
  const loaderTimeoutMs = 3000;
  function isAbsolute(u) {return /^[a-zA-Z][a-zA-Z0-9+.-]*:\/\//.test(u) || u.startsWith('//');}
  function normalizeKey(ref) {
    if (!ref) return null;
    return ref.replace(/^[.\/]+/, '');
  }
  const manifestPromise = (async () => {
    try {
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), loaderTimeoutMs);
      const r = await fetch(manifestUrl, { method: 'GET',cache: 'no-cache', signal: controller.signal });
      clearTimeout(id);
      if (!r.ok) throw new Error('manifest fetch failed');
      return await r.json();
    } catch (e) {
      console.warn('Manifest load failed:', e);
      return null;
    }
  })();
  const manifest = await manifestPromise;
  if (!manifest) return;
  const map = {};
  for (const k of Object.keys(manifest)) map[normalizeKey(k)] = manifest[k];
  function resolveManifestUrl(ref) {
    if (!ref) return null;
    if (isAbsolute(ref)) return null;
    const key = normalizeKey(ref);
    const hashed = map[key];
    if (!hashed) return null;
    return 'https://api.spectrodraw.com/spectrodraw-pro/' + hashed;
  }
  const selectors = [
    'img[src]',
    'script[src]',
    'link[rel="stylesheet"][href]',
    'audio[src]',
    'video[src]',
    'source[src]',
    'track[src]',
    'iframe[src]',
    'img[data-src]',
    'script[data-src]',
    'link[data-href]',
    '[data-manifest]'
  ];
  const elems = Array.from(document.querySelectorAll(selectors.join(',')));
  const scriptsToLoad = [];
  for (const el of elems) {
    const manifestName = el.getAttribute('data-href') ||
                         el.getAttribute('data-src') ||
                         el.getAttribute('data-manifest') ||
                         el.getAttribute('src') ||
                         el.getAttribute('href');
    let ref = manifestName;
    if (!ref) continue;
    if (isAbsolute(ref)) continue;
    const resolved = resolveManifestUrl(ref);
    if (!resolved) continue;
    const tag = el.tagName && el.tagName.toLowerCase();
    if (tag === 'script') {
      el.removeAttribute('src');
      scriptsToLoad.push({
        original: el,
        src: resolved,
        async: el.hasAttribute('async'),
        defer: el.hasAttribute('defer'),
        type: el.getAttribute('type') || 'text/javascript',
        module: el.getAttribute('type') === 'module'
      });
    } else if (tag === 'link') {
      el.setAttribute('href', resolved);
    } else if (tag === 'img' || tag === 'iframe' || tag === 'video' || tag === 'audio' || tag.tagName === undefined) {
      if (el.hasAttribute('src') || el.hasAttribute('data-src')) {
        el.setAttribute('src', resolved);
      } else if (el.hasAttribute('href') || el.hasAttribute('data-href')) {
        el.setAttribute('href', resolved);
      } else {
        try { el.src = resolved; } catch (e) {}
      }
    } else if (tag === 'source' || tag === 'track') {
      el.setAttribute('src', resolved);
    } else {
      const bg = el.style && (el.style.backgroundImage || el.style.background);
      if (bg && bg.indexOf('url(') !== -1) {
        el.style.cssText = el.style.cssText.replace(/url\((['"]?)([^)'"]+)\1\)/g, (m, q, u) => {
          const r = resolveManifestUrl(u);
          return r ? `url('${r}')` : m;
        });
      }
    }
  }
  const styleEls = Array.from(document.querySelectorAll('style'));
  for (const s of styleEls) {
    let text = s.textContent;
    if (!text) continue;
    text = text.replace(/url\((['"]?)([^)'"]+)\1\)/g, (m, q, u) => {
      if (isAbsolute(u)) return m;
      const r = resolveManifestUrl(u);
      return r ? `url('${r}')` : m;
    });
    s.textContent = text;
  }
  for (const sheet of Array.from(document.styleSheets)) {
    try {
      const rules = sheet.cssRules || [];
      for (let i = 0; i < rules.length; i++) {
        const rule = rules[i];
        if (!rule || !rule.cssText) continue;
        const newText = rule.cssText.replace(/url\((['"]?)([^)'"]+)\1\)/g, (m, q, u) => {
          if (isAbsolute(u)) return m;
          const r = resolveManifestUrl(u);
          return r ? `url('${r}')` : m;
        });
        if (newText !== rule.cssText) {
          sheet.deleteRule(i);
          sheet.insertRule(newText, i);
        }
      }
    } catch (e) {}
  }
  async function loadScriptsSequentially(items) {
    for (const it of items) {
      const original = it.original;
      const newScript = document.createElement('script');
      if (it.module) newScript.type = 'module'; else newScript.type = it.type;
      if (it.async) newScript.async = true;
      if (it.defer) newScript.defer = true;
      if (original.getAttribute('nonce')) newScript.setAttribute('nonce', original.getAttribute('nonce'));
      if (original.id) newScript.id = original.id;
      await new Promise((resolve, reject) => {
        newScript.onload = () => resolve();
        newScript.onerror = (e) => {
          console.warn('Failed to load managed script', it.src, e);
          resolve();
        };
        newScript.src = it.src;
        original.parentNode && original.parentNode.replaceChild(newScript, original);
        if (it.async) resolve();
      });
    }
  }
  loadScriptsSequentially(scriptsToLoad).catch(e => console.warn('Script loader error', e));
})();
</script>


  <link rel="stylesheet" type="text/css" data-href="style.css">
  <link rel="icon" type="image/x-icon" data-href="favicon.ico">
  
</head>
<body>
<div class="app">
  <header class="top-bar">
    <a href="https://spectrodraw.com" id="home" title="Home" style="margin-left:10px;"><img src="BannerLogo2.png" style="background:transparent; height: 20px;"></a>
    <button id="playPause" title="Play (space)" style="margin-left: 20px">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#333" viewBox="9 8 16 16"><path d="M16 0 M14 22V10l8 6z"/></svg>
    </button>
    <button id="stop" title="Stop">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#333" viewBox="0 0 20 20">
        <rect x="0" y="0" width="18" height="18" rx="2" ry="2"/>
      </svg>
    </button>
    <button id="downloadWav" title="Download audio (ctrl + s)">
      <svg width="20" height="20" viewBox="2 2 20 21" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 14v-2a8 8 0 0 1 16 0v2" />
        <path d="M5 14v4h2v-4H6z" />
        <path d="M17 14v4h2v-4h-2z" />
        <path d="M12 12v10" />
        <path d="M9 19l3 3 3 -3" />
      </svg>
    </button>
    <svg xmlns="http://www.w3.org/2000/svg" width="5" height="50" viewBox="0 0 5 24" fill="none" style="margin-left:8px;margin-right:8px;"><line x1="2" y1="0" x2="2" y2="24" stroke="#999" stroke-width="2" stroke-linecap="round"/></svg>
    <button class="shape-btn" data-shape="brush" id="brushBtn" title="Brush (b)">
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="20" height="20" 
           viewBox="5 4 18 18" 
           fill="#333">
        <path d="M20.71 4.63a2 2 0 0 0-2.83 0l-9.9 9.9a3 3 0 0 0-.78 1.37l-.69 2.76a1 1 0 0 0 1.21 1.21l2.76-.69a3 3 0 0 0 1.37-.78l9.9-9.9a2 2 0 0 0 0-2.83zm-11.24 11.3l-.88.22.22-.88 9.19-9.19.66.66z"/>
      </svg>
    </button>
    <button class="shape-btn" data-shape="note" id="noteBtn" title="Note brush (o)">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="20px" height="20px"><path fill="#333" d="M28.6,178.2c0,0-13.7,53.7-18.6,74.8l26.3-36c-2.4-5.3-0.9-13.4,3.2-17.9c5.6-6.1,15.6-6.1,21.7-0.5c6.2,5.6,6.5,15.1,1,21.2c-4.3,4.6-12.1,6.5-17.7,4.4l-32.9,30.9l69.3-26.8l27.8-41.7l-36.4-34.1L28.6,178.2z M223.3,1.4c-10.5,7.2-142,140.9-142,140.9l37,35.4c0,0,111.5-132,127.7-158.8C243.6-3.8,223.3,1.4,223.3,1.4z"/></svg>
    </button>
    <button class="shape-btn" data-shape="stamp" id="stampBtn" title="Stamp (s)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="1.25 1.25 17.5 17.5" > <g fill="#333" stroke="#333" stroke-width="2" stroke-linejoin="round" > <rect x="2.5" y="10" width="15" height="5" rx="2" ry="2" /> <line x1="10" y1="9" x2="10" y2="6" /> <rect x="8" y="4" width="4" height="3" rx="2" ry="2" /> </g> </svg>
    </button>
    <button class="shape-btn" data-shape="line" id="lineBtn" title="Line (l)">
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="20" height="20" viewBox="0 0 20 20" 
           fill="none"
           stroke = "#333" stroke-width = "3">
        <path d="M20 0 L 0 20"/>
      </svg>
    </button>
    <button class="shape-btn" data-shape="rectangle" id="rectBtn" title="Rectangle (r)">
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="20" height="20" viewBox="0 0 20 20" 
           fill="none"
           stroke = "#333" stroke-width = "5">
        <path d="M0 0 H 20 V 20 H 0 V -20"/>
      </svg>
    </button>
    <button class="shape-btn" data-shape="image" id="imageBtn" title="Image Overlay (i)">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="18" cy="6" r="3" fill="#333" stroke="none"/>
        <polygon points="1,20 8,10 15,20" fill="#333"/>
        <polygon points="8,20 15,12 23,20" fill="#333"/>
      </svg>
    </button>
    <input type="file" id="overlayFile" accept="image/*" style="display:none;">
    <button class="shape-btn" data-shape="select" id="selectBtn" title="Selection Tool">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" >
        <rect x="1" y="1" width="22" height="22" rx="3" ry="3" stroke-dasharray="3 5" />
      </svg>
    </button>
    <svg xmlns="http://www.w3.org/2000/svg" width="5" height="50" viewBox="0 0 5 24" fill="none" style="margin-left:8px;margin-right:8px;"><line x1="2" y1="0" x2="2" y2="24" stroke="#999" stroke-width="2" stroke-linecap="round"/></svg>
    <button class="tool-btn" data-tool="fill" id="colorBtn" title="Fill (f)">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#333">
        <circle cx="12" cy="12" r="9"/>
      </svg>
    </button>
    <button class="tool-btn" data-tool="noiseRemover" id="noiseRemoverBtn" title="Noise Remover (x)">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"width="18.19" height="19.22" viewBox="0,0,18.19,19.22"><g transform="translate(-0.90,-0.39)"><g fill="#333333" stroke="none" stroke-miterlimit="10"><path d="M3.70,2.43l2.87,-2.04l7.13,10.01l-2.87,2.04z" stroke-width="NaN"/><path d="M0.90,4.90l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M2.28,6.82l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M3.73,8.91l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M5.10,10.83l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M6.45,12.73l3.08,-2.20l0.75,1.05l-3.08,2.20z" stroke-width="0"/><path d="M11.39,11.97l2.26,-1.61l5.44,7.64l-2.26,1.61z" stroke-width="NaN"/></g></g></svg>
    </button>
    <button class="tool-btn" data-tool="cloner" id="clonerBtn" title="Cloner (c)">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 23 23" > <g fill="none" stroke="#333" stroke-width="3" stroke-linejoin="round" > <rect x="1.5" y="8.16" width="13.33" height="13.33" rx="2" ry="2" /> <rect x="8.16" y="1.5" width="13.33" height="13.33" rx="2" ry="2" /> </g> </svg>
    </button>
    <button class="tool-btn" data-tool="autotune" id="autotuneBtn" title="Autotune (shift+a)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" role="img" aria-label="Pitchfork">
        <path d=" M 8 2.5 V 12 A 4 10 0 0 0 12 12 V 2.5 " stroke="#333" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round" />
        <line x1="10" y1="14" x2="10" y2="17.5" stroke="#333" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    </button>
    <button class="tool-btn" data-tool="amplifier" id="amplifierBtn" title="Amplifier / Reducer (a)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M2 8V12C2 12.55 2.45 13 3 13H5L7 17C7.18 17.36 7.56 17.59 7.95 17.59C8.63 17.59 9.08 16.86 8.79 16.25L7.2 13H9L16 17V3L9 7H5V7H3C2.45 7 2 7.45 2 8Z" fill="#333"/>
        <path d="M18 7C18.55 7 19 7.45 19 8V12C19 12.55 18.55 13 18 13" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
      </svg>
    </button>
    <button class="tool-btn" data-tool="eraser" id="eraserBtn" title="Eraser (e)">
      <svg width="20" height="20" viewBox="-1 -1 16 16">
        <path d="M5,0 L0,5 L5,10 L10,5 Z " fill="#333" stroke="#333" stroke-width="1"/>
        <path d="M5,10 L10,5 L15,10 L12,13 L8,13 Z" fill="white" stroke="#333" stroke-width="1"/>
      </svg>
    </button>
    <button class="tool-btn" data-tool="blur" id="blurBtn" title="Blur (u)">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#333">
        <path d="M12 2C12 2 7 10 7 14a5 5 0 0 0 10 0c0-4-5-12-5-12z"/>
      </svg>
    </button>
    <svg xmlns="http://www.w3.org/2000/svg" width="5" height="50" viewBox="0 0 5 24" fill="none" style="margin-left:8px;margin-right:8px;"><line x1="2" y1="0" x2="2" y2="24" stroke="#999" stroke-width="2" stroke-linecap="round"/></svg>
    <button id="resetButton" onClick="onReset();" title="Reset audio">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="5" y="7" width="14" height="14" rx="2" ry="2" />
        <line x1="8" x2="8" y1="11" y2 = "17" stroke-width="1"/>
        <line x1="12" x2="12" y1="11" y2 = "17" stroke-width="1"/>
        <line x1="16" x2="16" y1="11" y2 = "17" stroke-width="1"/>
        <rect x="3" y="4" width="18" height="3" rx="2" ry="2" />
        <rect x="8" y="1" width="8" height="2" rx="2" ry="2" stroke-width="1"/>
      </svg>
    </button>
    <button id="undoBtn" title="Undo (Ctrl+Z)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 14H5V10"/>
        <path d="M20 20a9 9 0 0 0-15-6.7L5 10"/>
      </svg>
    </button>
    <button id="redoBtn" title="Redo (Ctrl+Y)">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 14h4v-4"/>
        <path d="M4 20a9 9 0 0 1 15-6.7L19 10"/>
      </svg>
    </button>
    <div title="Master Volume" style="display:flex;" id="masterVolumeDiv">
        <label class="h2">Volume</label>
        <input id="masterVolume" style="max-width:100px;" type="range" min="0" max="1" value="1" step="0.01">
        <input id="masterVolumeInput" style="width:45px;"type="number" value="1" min="0" max="1">
    </div>
  </header>
  <div id="presetsModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center;z-index:9999999999969420;">
    <div class="modal-content" style="background:#222; padding:20px; border-radius:8px; max-width:300px; width:90%;">
      <h2 style="margin:0;margin-bottom:5px;">New Project</h2>
      <label class="h2" for="presets">Use preset...</label>
      <select id="presets">
        <option value="silence">Silence</option>
        <option value="male">Male sing</option>
        <option value="female">Female sing</option>
        <option value="dog">Dog</option>
        <option value="birdChirp">Bird chirp</option>
        <option value="lionRoar">Lion roar</option>
        <option value="seaLion">Sea lion</option>
        <option value="violin">Violin</option>
        <option value="trumpet">Trumpet</option>
        <option value="timpani">Timpani</option>
        <option value="piano">Piano</option>
        <option value="flute">Flute</option>
        <option value="cymbal">Cymbal</option>
        <option value="computerBeeps">Computer beeps</option>
        <option value="scream">Scream</option>
        <option value="bomb">Bomb</option>
        <option value="engine">Engine</option>
        <option value="fullSpectra">Loud noise</option>
        <option value="bass808">808 bass</option>
        <option value="hardstyle">Hardstyle</option>
        <option value="kick">Kick</option>
        <option value="hihat">Hihat</option>
        <option value="clap">Clap</option>
        <option value="cave14">Cave14.ogg</option>
        <option value="sine">Sine wave</option>
        <option value="triangle">Triangle wave</option>
        <option value="square">Square wave</option>
        <option value="saw">Saw wave</option>
      </select>
      <div style="margin-top:15px; text-align:right;">
        <button id="closeProjectModalBtn" class="leftBtn" style="width:40%;height:1.5rem;">Cancel</button>
        <button id="saveAndStart" class="leftBtn" style="width:40%;height:1.5rem;">Save and start</button>
      </div>
    </div>
  </div>
  <!-- <aside id="left-bar" class="window">
    <button class="panel-btn" id="settingsBtn" title="Project (ctrl+d)" data-tool="0">
      <svg xmlns="http://www.w3.org/2000/svg" 
          width="20" height="20" viewBox="0 0 24 24" 
          fill="none" stroke="white" stroke-width="2" 
          stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 
                1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 
                1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 
                1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 
                1 1-2.83-2.83l.06-.06a1.65 
                1.65 0 0 0 .33-1.82 1.65 
                1.65 0 0 0-1.51-1H3a2 2 0 
                1 1 0-4h.09a1.65 1.65 0 
                0 0 1.51-1 1.65 1.65 0 
                0 0-.33-1.82l-.06-.06a2 
                2 0 1 1 2.83-2.83l.06.06a1.65 
                1.65 0 0 0 1.82.33H9a1.65 
                1.65 0 0 0 1-1.51V3a2 2 
                0 1 1 4 0v.09a1.65 1.65 0 
                0 0 1 1.51 1.65 1.65 0 
                0 0 1.82-.33l.06-.06a2 
                2 0 1 1 2.83 2.83l-.06.06a1.65 
                1.65 0 0 0-.33 1.82V9c0 
                .69.28 1.35.77 1.82.49.47 
                1.15.77 1.82.77h.09a2 2 
                0 1 1 0 4h-.09c-.69 0-1.35.28-1.82.77z"/>
      </svg>
    </button>
    
    <button class="panel-btn" id="toolEditBtn" title="Tool Editor" data-tool="1">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 20 20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12.58,11.21 C11.62,12.17 10.91,12.66 10.36,12.85 C10.19,12.35 9.92,11.88 9.52,11.49 C9.12,11.10 8.65,10.82 8.15,10.64 C8.35,10.09 8.84,9.38 9.79,8.43 C12.06,6.15 16.10,3.36 16.87,4.13 C17.64,4.90 14.85,8.94 12.58,11.21 Z 
        M8.39,15.41 C8.02,15.77 7.53,15.96 7.05,15.99 L7.05,16.00 L6.93,16.00 C3.68,16.11 2.26,12.44 3.38,12.83 C4.84,13.33 5.44,12.60 5.46,12.58 C6.27,11.81 7.58,11.81 8.39,12.58 C9.20,13.36 9.20,14.64 8.39,15.41 Z"/>
      </svg>
    </button>

    <button class="panel-btn" id="spritesBtn" title="Sprites (ctrl+b)" data-tool="2">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="12,3 20,7 20,17 12,21 4,17 4,7" />
        <line x1="12" y1="11" x2="12" y2="21" />
        <line x1="4" y1="7" x2="12" y2="11" />
        <line x1="20" y1="7" x2="12" y2="11" />
      </svg>
    </button>

    <button class="panel-btn" id="uploadsBtn" title="Uploads (ctrl+u)" data-tool="3">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 22 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M2 6h18v11a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6z" />
        <path d="M2 6V3h9v2" />
      </svg>
    </button>

    <button class="panel-btn" id="pianoBtn" title="Piano (ctrl+p)" data-tool="4">
      <svg xmlns="http://www.w3.org/2000/svg" 
          width="24" height="24" viewBox="0 0 24 22" 
          fill="none" stroke="white" stroke-width="2" 
          stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="2" width="20" height="20" rx="2" ry="2"/>
        <line x1="7" y1="4" x2="7" y2="15" stroke-width="3"/>
        <line x1="17" y1="4" x2="17" y2="15" stroke-width="3"/>
        <line x1="12" y1="4" x2="12" y2="15" stroke-width="3"/>
      </svg>
    </button>

    <button class="panel-btn" id="eqBtn" title="Equalizer (ctrl+e)" data-tool="5">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 17c2-4 4-6 8-6s6 4 10 4"/>
        <circle cx="3" cy="17" r="1.5" fill="white"/>
        <circle cx="11" cy="11" r="1.5" fill="white"/>
        <circle cx="21" cy="15" r="1.5" fill="white"/>
      </svg>
    </button>

    <button class="panel-btn" id="layersBtn" title="Layers (ctrl+q)" data-tool="6">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="6"  y1="3" x2="6"  y2="21" />
        <line x1="12" y1="3" x2="12" y2="21" />
        <line x1="18" y1="3" x2="18" y2="21" />
        <rect x="2"  y="10.5" width="8"  height="3" rx="1.5" fill="white" stroke="white" stroke-width="1"/>
        <rect x="8"  y="5.5"  width="8"  height="3" rx="1.5" fill="white" stroke="white" stroke-width="1"/>
        <rect x="14" y="14.5" width="8"  height="3" rx="1.5" fill="white" stroke="white" stroke-width="1"/>
      </svg>
    </button>
  </aside>
-->
  <div id="tools" class="window">
    <!--Samples-->
    <div id="d3" style="display:none;">
      <div style="display:flex;">
        <h2 style="margin:10px 0 10px 0;">Samples</h2>
        <button id="rec" title="Record (Ctrl + space)" style="margin-left:170px;margin-top:10px;"></button>
      </div>
      <!-- Upload / Drop box -->
      <div id="samples-upload" style="margin: 6px 0 12px 0;">
        <label class="upload-box" for="samplesUpload">
          <div class="upload-inner" style="border: 3px dotted white; cursor:pointer;border-radius:5px;background:#222;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;" id="fileB">
            <svg viewBox="0 0 24 24" aria-hidden="true" width="48" height="48" style="margin-bottom:10px;">
              <path d="M12,3 v10 m0,-10 l-4,4 m4,-4 l4,4 M4,20 h16" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div style="font-size:13px;">Drop files here or click to upload</div>
          </div>
        </label>
        <input id="samplesUpload" type="file" multiple accept="audio/*,image/*" style="display:none;">
      </div>

      <!-- Collapsible sections use same format as #spriteEffectSettings h3 -->
      <section class="sample-section">
        <div class="section-content" id="uploadsSection">
          <h3>
            Uploads
            <button type="button"
                    class="section-toggle"
                    data-target="uploadsSection"
                    aria-expanded="false"
                    aria-label="Toggle uploads"
                    id="uploadsSectionBtn">
            </button>
          </h3>
          <div id="uploadsWrapper"></div>
        </div>
      </section>

      <section class="sample-section">
        <div class="section-content" id="layersSection">
          <h3>
            Layers
            <button type="button"
                    class="section-toggle"
                    data-target="layersSection"
                    aria-expanded="true"
                    aria-label="Toggle layers">
            </button>
          </h3>
          <div id="layersSampleWrapper"></div>
        </div>
      </section>

      <section class="sample-section">
        <div class="section-content" id="imagesSection">
          <h3>
            Images
            <button type="button"
                    class="section-toggle"
                    data-target="imagesSection"
                    aria-expanded="true"
                    aria-label="Toggle images">
            </button>
          </h3>
          <div class="image-gallery" id="imageGallery" role="list" aria-label="Images gallery">
          </div>
        </div>
      </section>
    </div>
    <!--Midi-->
    <div id="d4" style="display:none;">
      <h2 style="margin:10px 0 10px 0;">Piano</h2>
      <label class="h1">Brush Alignment</label>
      <!--Auto align pitch-->
      <button class="leftBtn" id="alignPitch" title="Auto align pitch (j)">Auto Align Pitch</button>
      <div id="startOnPitchDiv" style="display:none;">
        <div class="slider-row" title="Base Pitch">
          <label class="h2">Base Hz</label>
          <input id="startOnPitch" type="range" min="261.63" max="523.3" step="0.01" value="440">
          <input id="startOnPitchInput" type="number" value="440">
        </div>
        <!--Notes per octave (achieve with pitch bends)-->
        <div class="slider-row" title="Notes Per Octave">
          <label class="h2">Notes per octave</label>
          <input id="npo" type="range" min="1" max="48" step="1" value="12">
          <input id="npoInput" type="number" value="12" min="1" max="384">
        </div>
      </div>
      <!--Auto align time-->
      <button class="leftBtn" id="alignTime" title="Auto align time (k)">Auto Align Time</button>
      <div id ="bpmDiv" class="slider-row" title="BPM" style="display:none;">
        <label class="h2">BPM</label>
        <input id="bpm" type="range" min="0.001" max="500" step="0.01" value="120">
        <input id="bpmInput" type="number" value="120" min="0.001" max="5000">
      </div>
      <!--Remove harmonics button-->
      <button class="leftBtn" id="removeHarmonicsBtn" title="Auto Remove Harmonics" onClick="removeHarmonics()">Remove Harmonics</button>
      <label class="h1">MIDI Export</label>
      <input type="checkbox" id="useMidiAI" title="Use AI model (Ideal for songs)">Use BasicPitch AI</input>
      <div class="slider-row" title="Duration cutoff">
        <label class="h2">Duration cutoff (secs)</label>
        <input id="durationCutoff" type="range" min="0" max="1" step="0.001" value="0.05">
        <input id="durationCutoffInput" type="number" value="0.05" min="0" max="1">
      </div>
      <div id="nonAiMidiDiv">
        <!--Noise floor cutoff-->
        <div class="slider-row" title="Noise floor cutoff">
          <label class="h2">Noise floor (dB)</label>
          <input id="noiseFloorCutoff" type="range" min="-50" max="0" step="0.1" value="-30">
          <input id="noiseFloorCutoffInput" type="number" value="-30" min="-50" max="0">
        </div>
        <input type="checkbox" id="midiAlignTime" title="Midi export time filter" checked>Align to tempo</input>
        <div id="matOptions">
          <div id ="midiBpmDiv" class="slider-row" title="Note BPM">
            <label class="h2">BPM</label>
            <input id="midiBpm" type="range" min="0.001" max="500" step="0.01" value="120">
            <input id="midiBpmInput" type="number" value="120" min="0.001" max="5000">
          </div>
          <div id ="subBeatDiv" class="slider-row" title="Sub beats">
            <label class="h2">Sub beats</label>
            <input id="subBeat" type="range" min="1" max="24" step="1" value="8">
            <input id="subBeatInput" type="number" value="8" min="1" max="24">
          </div>
        </div>
        <button class="leftBtn" title="Use volume controllers (Not recommended)" id="useVolumeControllers">Use Volume Controllers</button>
      </div>
      <div id="AiMidiDiv" style="display:none;">
        <label class="h1">Time Quantize</label>
        <div class="slider-row" title="Time quantize strength">
          <label class="h2">Strength</label>
          <input id="tQs" type="range" min="0" max="100" step="1" value="0">
          <input id="tQsInput" type="number" value="0" min="0" max="100">
        </div>
        <div class="slider-row" title="Time quantize strength">
          <label class="h2">Tempo</label>
          <input id="tQt" type="range" min="1" max="300" step="1" value="120">
          <input id="tQtInput" type="number" value="120" min="1" max="300">
        </div>
        <div class="slider-row" title="Phase texture">
          <label class="h2" for="tQd">Time division</label>
          <select id="tQd">
            <option value="1">1/1</option>
            <option value="2">1/2</option>
            <option value="3">1/3</option>
            <option value="4">1/4</option>
            <option value="5">1/5</option>
            <option value="6">1/6</option>
            <option value="7">1/7</option>
            <option value="8" selected="selected">1/8</option>
            <option value="12">1/12</option>
            <option value="16">1/16</option>
            <option value="24">1/24</option>
            <option value="32">1/32</option>
          </select>
        </div>
      </div>
      <div id="midiLayerSettings">
        <label class="h1">Midi audio layers</label>
        <div style="display:flex; gap:10px; margin-bottom:5px;" title="Layer mode">
          <label class="h2" for="midiLayerMode">Mode</label>
          <select id="midiLayerMode">
            <option value="all">All layers</option>
            <option value="allMixToMono">All layers mixed to mono</option>
            <option value="single">Single layer</option>
          </select>
        </div>
        <div class="slider-row" id="midiSingleLayerDiv" style="display:none;">
          <label class="h2" for="midiSingleLayer">Layer</label>
          <select id="midiSingleLayer"></select>
        </div>
      </div>
      <!--Export button-->
      <button class="leftBtn" id="exportMIDI" title="Export Midi (ctrl + m)" onclick="exportMidi()">Export MIDI</button>
    </div>
    <!--EQ-->
    <div id="d5" style="display:none; height: 80%">
      <h2 style="margin-bottom:10px;margin-top:10px;">Equalizer</h2>
      <h5 style="margin-top:0px; margin-bottom:10px;">Note: Does not update on the spectrogram to save lag</h5>
      <div class="slider-row" title="Global gain" id="globalGainDiv">
        <label class="h2">Global gain</label>
        <input id="globalGain" type="range" min="-30" max="30" step="0.1" value="0">
        <input id="globalGainInput" type="number" value="0" min="-30" max="30">
      </div>
      <div class="slider-row" title="EQ Presets" id="eqPresetsDiv">
        <label class="h2" for="eqPresets">Presets</label>
        <select id="eqPresets">
          <option value="Flat">Flat</option>
          <option value="Bass boost">Bass boost</option>
          <option value="Lowpass">Lowpass</option>
          <option value="Mid boost">Mid boost</option>
          <option value="Midpass">Midpass</option>
          <option value="High boost">High boost</option>
          <option value="Highpass">Highpass</option>
          <option value="Custom">Custom</option>
        </select>
      </div>
      <canvas id="eqCanvas" width="300" height="440" style="border:1px solid #ccc; display:block; margin-top:10px;"></canvas>
    </div>
    <!--Layers-->
    <div id="d6" style="display:none;">
      <h2 style="margin-bottom:10px;margin-top:10px;">Layers</h2>
      <div class="slider-row"><label for="layers">Layers:</label>
        <input type="range" id="layers" min="1" max="16" value="1">
        <input id="layersInput" type="number" value="1" min="1" max="16">
      </input></div>
      <div class="slider-row" title="Layer Display Height" id="chdiv">
        <label class="h2">Layer height</label>
        <input id="layerHeight" type="range" min="0" max="500" step="1" value="500">
        <input id="layerHeightInput" type="number" value="500" min="0" max="500">
      </div>
      <div class="slider-row" title="Sync actions to all layers">
        <label class="h2">Sync layers</label>
        <input id="syncLayers" type="checkbox">
      </div>
      <div id="layersMixerDiv"></div>
    </div>
  </div>
  <div id="rightPanel" class="window"></div>
</div>
<div id="status" style="position:absolute;bottom:0px;"></div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<!-- <script>alert("Warning: You have claimed SpectroDraw Pro on this account, but it is still in development. Please sign in on an account without pro to return to the standard app.")</script> -->

<!-- <script data-manifest="windows.js"></script>
<script data-manifest="fft.js"></script>
<script data-manifest="initialize.js"></script>
<script data-manifest="ui.js"></script>
<script data-manifest="harmonics.js"></script>
<script data-manifest="uploads.js"></script>
<script data-manifest="sprites.js"></script>
<script data-manifest="axes.js"></script>
<script data-manifest="midi.js"></script>
<script data-manifest="recordingAndPresets.js"></script>
<script data-manifest="renderer.js"></script>
<script data-manifest="expressions.js"></script>
<script data-manifest="expressionsParser.js"></script>
<script data-manifest="drawTools.js"></script>
<script data-manifest="undoredo.js"></script>
<script data-manifest="interactive.js"></script>
<script data-manifest="downloads.js"></script>
<script data-manifest="brushPreviewData.js"></script>
<script data-manifest="brushPreview.js"></script>
<script data-manifest="rightClick.js"></script>
<script data-manifest="initialRenders.js"></script>
<script data-manifest="eq.js"></script> -->

<!--Comment out on deploy-->

<link rel="stylesheet" type="text/css" href="style.css">
<script src="windows.js"></script>
<script src="fft.js"></script>
<script src="initialize.js"></script>
<script src="ui.js"></script>
<script src="harmonics.js"></script>
<script src="uploads.js"></script>
<script src="sprites.js"></script>
<script src="axes.js"></script>
<script src="midi.js"></script>
<script src="recordingAndPresets.js"></script>
<script src="renderer.js"></script>
<script src="expressions.js"></script>
<script src="expressionsParser.js"></script>
<script src="drawTools.js"></script>
<script src="undoredo.js"></script>
<script src="interactive.js"></script>
<script src="downloads.js"></script>
<script src="brushPreviewData.js"></script>
<script src="brushPreview.js"></script>
<script src="rightClick.js"></script>
<script src="eq.js"></script>
<script src="initialRenders.js"></script>