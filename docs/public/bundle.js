var Vz=Object.create;var Nk=Object.defineProperty;var Uz=Object.getOwnPropertyDescriptor;var Gz=Object.getOwnPropertyNames;var Hz=Object.getPrototypeOf,qz=Object.prototype.hasOwnProperty;var Ck=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var gr=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Kz=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Gz(e))!qz.call(r,a)&&a!==t&&Nk(r,a,{get:()=>e[a],enumerable:!(n=Uz(e,a))||n.enumerable});return r};var Xm=(r,e,t)=>(t=r!=null?Vz(Hz(r)):{},Kz(e||!r||!r.__esModule?Nk(t,"default",{value:r,enumerable:!0}):t,r));var Ak=gr(()=>{});var _k=gr(()=>{});var vp=gr(()=>{});var Ds=gr(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});var rg=function(r,e){return rg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},rg(r,e)};function ro(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");rg(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ye(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function Ze(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Tn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function qe(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Rt(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(qe(arguments[e]));return r}var jz=1e-7,Xz=1e-4,Yz=(function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r})(),Yk=(function(){function r(){}return r.prototype.refCount=function(e){return da("refCount")},r.prototype.incRef=function(e){return da("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return da("time")},r.prototype.read=function(e){return da("read")},r.prototype.readSync=function(e){return da("readSync")},r.prototype.readToGPU=function(e,t){return da("readToGPU")},r.prototype.numDataIds=function(){return da("numDataIds")},r.prototype.disposeData=function(e,t){return da("disposeData")},r.prototype.write=function(e,t,n){return da("write")},r.prototype.move=function(e,t,n,a,i){return da("move")},r.prototype.memory=function(){return da("memory")},r.prototype.floatPrecision=function(){return da("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?jz:Xz},r.prototype.dispose=function(){return da("dispose")},r})();function da(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen")}function Zk(r){for(var e=r.length,t=0;e>0;)t=Math.random()*e|0,e--,kp(r,e,t)}function Zz(r,e){if(r.length!==e.length)throw new Error("Array sizes must match to be shuffled together "+("First array length was "+r.length)+("Second array length was "+e.length));for(var t=r.length,n=0;t>0;)n=Math.random()*t|0,t--,kp(r,t,n),kp(e,t,n)}function Wc(r,e,t){return Math.max(r,Math.min(e,t))}function Qz(r){return r%2===0?r:r+1}function kp(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function Jz(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function e$(r,e){var t=Math.random();return e*t+(1-t)*r}function t$(r,e){for(var t=0,n=0;n<r.length;n++){var a=Number(r[n])-Number(e[n]);t+=a*a}return t}function X(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function gn(r,e,t){t===void 0&&(t=""),X(Oo(r,e),function(){return t+(" Shapes "+r+" and "+e+" must match")})}function Is(r){X(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function xs(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||fn(r)&&!t)for(var n=0;n<r.length;++n)xs(r[n],e,t);else e.push(r);return e}function rr(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function r$(r){return r.length===0}function Oo(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function ju(r){return r%1===0}function n$(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function a$(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function i$(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return Zk(e),e}function Bc(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function o$(r,e,t,n){return e===void 0&&(e=function(a){return 0}),n===void 0&&(n=setTimeout),new Promise(function(a,i){var o=0,s=function(){if(r()){a();return}o++;var u=e(o);if(t!=null&&o>=t){i();return}n(s,u)};s()})}function s$(r,e){for(var t=1,n=-1,a=0;a<r.length;++a)if(r[a]>=0)t*=r[a];else if(r[a]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. "+("Found -1 at dim "+n+" and dim "+a));n=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found "+r[a]+" at dim "+a);if(n===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%t!==0)throw Error("The implicit shape can't be a fractional number. "+("Got "+e+" / "+t));var i=r.slice();return i[n]=e/t,i}function Jc(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),X(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but "+("got axis "+r)}),X(r.every(function(n){return ju(n)}),function(){return"All values in axis param must be integers but "+("got axis "+r)}),r.map(function(n){return n<0?t+n:n})}function Qk(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Jc(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function Jk(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type "+r);return t}function e2(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type "+r);return t}function t2(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function r2(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function u$(r,e){return!(e==="complex64"||e==="float32"&&r!=="complex64"||e==="int32"&&r!=="float32"&&r!=="complex64"||e==="bool"&&r==="bool")}function fn(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function ng(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function n2(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function Ao(r){return typeof r=="string"||r instanceof String}function a2(r){return typeof r=="boolean"}function i2(r){return typeof r=="number"}function Pp(r){return Array.isArray(r)?Pp(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":i2(r)?"float32":Ao(r)?"string":a2(r)?"bool":"float32"}function Fo(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Sp(r,e){for(var t=e;t<r;++t)if(r%t===0)return t;return r}function Ju(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function o2(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(c,f){return c*f})*(n?2:1),o=0;o<i;o++)a[o]=o2(r+o*u,s,t,n);return a}function Vu(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("["+r+"] does not match the input size "+e.length+(t?" for a complex tensor":"")+".");return o2(0,r,e,t)}function Cg(r,e){for(var t=Lp(r,e),n=0;n<t.length;n++)t[n]=1;return t}function Lp(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function l$(r,e){var t=r.reduce(function(n,a){return n*a},1);if(e==null||e==="float32")return Vu(r,new Float32Array(t));if(e==="int32")return Vu(r,new Int32Array(t));if(e==="bool")return Vu(r,new Uint8Array(t));throw new Error("Unknown data type "+e)}function Ag(r){r.forEach(function(e){X(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+("shape ["+r+"].")})})}function c$(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],a=0;a<r.length-1;++a)n+=t[a]*r[a];return n}function f$(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),a=0;a<n.length-1;++a)n[a]=Math.floor(r/t[a]),r-=n[a]*t[a];return n[n.length-1]=r,n}function _g(r){return r&&r.then&&typeof r.then=="function"}var Dk="tfjsflags",s2=(function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=h$,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(kt().getBool("IS_TEST")||kt().getBool("PROD")||console.warn("Platform "+this.platformName+" has already been set. "+("Overwriting the platform with "+e+"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];kt().getBool("IS_TEST")||kt().getBool("PROD")||console.warn("Setting feature override from URL "+e+": "+a+"."),this.set(e,a)}},r.prototype.getAsync=function(e){return Ye(this,void 0,void 0,function(){var t,n;return Ze(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(_g(t))throw new Error("Flag "+e+" cannot be synchronously evaluated. Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(Dk in t){var n=t[Dk].split(",");n.forEach(function(a){var i=qe(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=d$(o,s)})}}},r})();function h$(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return p$(e,n[0],n[1]),n.join("=")}),e}function p$(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function d$(r,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+r+".")}function kt(){return D.ENV}D.ENV=null;function v$(r){D.ENV=r}var Ym;function u2(){if(Ym==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Ym=r}return Ym}function m$(){var r=u2();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Dg(r,e){var t=m$();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var l2="Abs",c2="Acos",f2="Acosh",Fg="Add",h2="AddN",p2="All",d2="Any",v2="ArgMax",m2="ArgMin",g2="Asin",y2="Asinh",b2="Atan",w2="Atanh",x2="Atan2",k2="AvgPool",g$="AvgPoolGrad",S2="AvgPool3D",y$="AvgPool3DGrad",E2="BatchMatMul",T2="BatchToSpaceND",I2="Bincount",b$="BroadcastTo",N2="BroadcastArgs",Rg="Cast",C2="Ceil",A2="ClipByValue",_2="Complex",D2="ComplexAbs",F2="Concat",R2="Conv2D",M2="Conv2DBackpropFilter",O2="Conv2DBackpropInput",P2="Conv3D",w$="Conv3DBackpropFilterV2",L2="Conv3DBackpropInputV2",B2="Cos",z2="Cosh",$2="Cumprod",W2="Cumsum",V2="CropAndResize",U2="DenseBincount",G2="DepthToSpace",H2="DepthwiseConv2dNative",q2="DepthwiseConv2dNativeBackpropFilter",K2="DepthwiseConv2dNativeBackpropInput",j2="Diag",X2="Dilation2D",x$="Dilation2DBackpropInput",k$="Dilation2DBackpropFilter",Y2="RealDiv",Z2="Einsum",Q2="Elu",S$="EluGrad",J2="Erf",eS="Equal",tS="Exp",rS="ExpandDims",nS="Expm1",aS="FFT",iS="Fill",oS="FlipLeftRight",sS="Floor",uS="FloorDiv",lS="FusedBatchNorm",cS="GatherV2",fS="GatherNd",hS="Greater",pS="GreaterEqual",Mg="Identity",dS="IFFT",vS="Imag",mS="IsFinite",gS="IsInf",yS="IsNan",bS="LeakyRelu",wS="Less",xS="LessEqual",kS="LinSpace",SS="Log",ES="Log1p",TS="LogicalAnd",IS="LogicalNot",NS="LogicalOr",E$="LogicalXor",T$="LogSoftmax",I$="LowerBound",CS="LRN",N$="LRNGrad",AS="Max",_S="Maximum",DS="MaxPool",C$="MaxPoolGrad",FS="MaxPool3D",A$="MaxPool3DGrad",RS="MaxPoolWithArgmax",MS="Mean",OS="Min",PS="Minimum",LS="MirrorPad",BS="Mod",zS="Multinomial",$S="Multiply",WS="Neg",VS="NotEqual",US="NonMaxSuppressionV3",GS="NonMaxSuppressionV4",HS="NonMaxSuppressionV5",qS="OnesLike",KS="OneHot",jS="Pack",XS="PadV2",_$="Pool",YS="Pow",ZS="Prelu",QS="Prod",JS="RaggedGather",eE="RaggedTensorToTensor",tE="Range",rE="Real",nE="Reciprocal",aE="Relu",iE="Reshape",oE="ResizeNearestNeighbor",D$="ResizeNearestNeighborGrad",sE="ResizeBilinear",F$="ResizeBilinearGrad",uE="Relu6",lE="Reverse",cE="Round",fE="Rsqrt",hE="ScatterNd",pE="SearchSorted",dE="Select",vE="Selu",mE="Slice",gE="Sin",yE="Sinh",bE="Sign",wE="Sigmoid",xE="Softplus",kE="Sqrt",SE="Sum",EE="SpaceToBatchND",TE="SplitV",IE="Softmax",NE="SparseFillEmptyRows",CE="SparseReshape",AE="SparseSegmentMean",_E="SparseSegmentSum",DE="SparseToDense",FE="SquaredDifference",R$="Square",RE="StridedSlice",ME="StringNGrams",OE="StringSplit",PE="StringToHashBucketFast",LE="Sub",BE="Tan",zE="Tanh",Og="Tile",$E="TopK",WE="Transform",yp="Transpose",VE="Unique",UE="Unpack",GE="UnsortedSegmentSum",M$="UpperBound",HE="ZerosLike",qE="Step",ag="FromPixels",KE="RotateWithOffset",ig="_FusedMatMul",og="FusedConv2D",sg="FusedDepthwiseConv2D";function Co(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];kt().getBool("IS_TEST")||kt().getBool("PROD")||console.warn.apply(console,Rt(r))}function O$(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];kt().getBool("IS_TEST")||kt().getBool("PROD")||console.log.apply(console,Rt(r))}var Xu=Dg("kernelRegistry",function(){return new Map}),Vc=Dg("gradRegistry",function(){return new Map});function Ep(r,e){var t=Pg(r,e);return Xu.get(t)}function ug(r){return Vc.get(r)}function Tp(r){for(var e=Xu.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=qe(i,2),s=o[0],u=o[1],l=qe(s.split("_"),1),c=l[0];c===r&&t.push(u)}return t}function jE(r){var e=r.kernelName,t=r.backendName,n=Pg(e,t);Xu.has(n)&&Co("The kernel '"+e+"' for backend "+("'"+t+"' is already registered")),Xu.set(n,r)}function P$(r){var e=r.kernelName;Vc.has(e)&&kt().getBool("DEBUG")&&Co("Overriding the gradient for '"+e+"'"),Vc.set(e,r)}function L$(r,e){var t=Pg(r,e);if(!Xu.has(t))throw new Error("The kernel '"+r+"' for backend "+("'"+e+"' is not registered"));Xu.delete(t)}function B$(r){if(!Vc.has(r))throw new Error("The gradient '"+r+"' for backend is not registered");Vc.delete(r)}function z$(r,e){var t=Tp(r);t.forEach(function(n){var a=Object.assign({},n,{backendName:e});jE(a)})}function Pg(r,e){return e+"_"+r}var lg=nr,Da=null;try{Da=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function nr(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}nr.prototype.__isLong__;Object.defineProperty(nr.prototype,"__isLong__",{value:!0});function Hn(r){return(r&&r.__isLong__)===!0}nr.isLong=Hn;var Fk={},Rk={};function Ns(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=Rk[r],n)?n:(t=ar(r,(r|0)<0?-1:0,!0),a&&(Rk[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=Fk[r],n)?n:(t=ar(r,r<0?-1:0,!1),a&&(Fk[r]=t),t))}nr.fromInt=Ns;function Fa(r,e){if(isNaN(r))return e?ms:Ra;if(e){if(r<0)return ms;if(r>=XE)return QE}else{if(r<=-Ok)return Vn;if(r+1>=Ok)return ZE}return r<0?Fa(-r,e).neg():ar(r%Yu|0,r/Yu|0,e)}nr.fromNumber=Fa;function ar(r,e,t){return new nr(r,e,t)}nr.fromBits=ar;var Ip=Math.pow;function Lg(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Ra;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Lg(r.substring(1),e,t).neg();for(var a=Fa(Ip(t,8)),i=Ra,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var l=Fa(Ip(t,s));i=i.mul(l).add(Fa(u))}else i=i.mul(a),i=i.add(Fa(u))}return i.unsigned=e,i}nr.fromString=Lg;function ui(r,e){return typeof r=="number"?Fa(r,e):typeof r=="string"?Lg(r,e):ar(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}nr.fromValue=ui;var Mk=65536,$$=1<<24,Yu=Mk*Mk,XE=Yu*Yu,Ok=XE/2,Pk=Ns($$),Ra=Ns(0);nr.ZERO=Ra;var ms=Ns(0,!0);nr.UZERO=ms;var Wu=Ns(1);nr.ONE=Wu;var YE=Ns(1,!0);nr.UONE=YE;var cg=Ns(-1);nr.NEG_ONE=cg;var ZE=ar(-1,2147483647,!1);nr.MAX_VALUE=ZE;var QE=ar(-1,-1,!0);nr.MAX_UNSIGNED_VALUE=QE;var Vn=ar(0,-2147483648,!1);nr.MIN_VALUE=Vn;var _e=nr.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*Yu+(this.low>>>0):this.high*Yu+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Vn)){var t=Fa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Fa(Ip(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),l=o.sub(u.mul(i)).toInt()>>>0,c=l.toString(e);if(o=u,o.isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Vn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return Hn(e)||(e=ui(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(Hn(e)||(e=ui(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(Vn)?Vn:this.not().add(Wu)};_e.neg=_e.negate;_e.add=function(e){Hn(e)||(e=ui(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,l=e.low&65535,c=0,f=0,h=0,p=0;return p+=i+l,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,c+=f>>>16,f&=65535,c+=t+o,c&=65535,ar(h<<16|p,c<<16|f,this.unsigned)};_e.subtract=function(e){return Hn(e)||(e=ui(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return Ra;if(Hn(e)||(e=ui(e)),Da){var t=Da.mul(this.low,this.high,e.low,e.high);return ar(t,Da.get_high(),this.unsigned)}if(e.isZero())return Ra;if(this.eq(Vn))return e.isOdd()?Vn:Ra;if(e.eq(Vn))return this.isOdd()?Vn:Ra;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Pk)&&e.lt(Pk))return Fa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,l=e.low>>>16,c=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*c,p+=d>>>16,d&=65535,p+=i*c,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,h+=a*c,f+=h>>>16,h&=65535,h+=i*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*c+a*l+i*u+o*s,f&=65535,ar(p<<16|d,f<<16|h,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(Hn(e)||(e=ui(e)),e.isZero())throw Error("division by zero");if(Da){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Da.div_u:Da.div_s)(this.low,this.high,e.low,e.high);return ar(t,Da.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ms:Ra;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ms;if(e.gt(this.shru(1)))return YE;i=ms}else{if(this.eq(Vn)){if(e.eq(Wu)||e.eq(cg))return Vn;if(e.eq(Vn))return Wu;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Ra)?e.isNegative()?Wu:cg:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Vn))return this.unsigned?ms:Ra;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ra}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Ip(2,s-48),l=Fa(n),c=l.mul(e);c.isNegative()||c.gt(a);)n-=u,l=Fa(n,this.unsigned),c=l.mul(e);l.isZero()&&(l=Wu),i=i.add(l),a=a.sub(c)}return i};_e.div=_e.divide;_e.modulo=function(e){if(Hn(e)||(e=ui(e)),Da){var t=(this.unsigned?Da.rem_u:Da.rem_s)(this.low,this.high,e.low,e.high);return ar(t,Da.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return ar(~this.low,~this.high,this.unsigned)};_e.and=function(e){return Hn(e)||(e=ui(e)),ar(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return Hn(e)||(e=ui(e)),ar(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return Hn(e)||(e=ui(e)),ar(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return Hn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ar(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ar(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return Hn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ar(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ar(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(Hn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return ar(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?ar(t,0,this.unsigned):ar(t>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?ar(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:ar(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};nr.fromBytes=function(e,t,n){return n?nr.fromBytesLE(e,t):nr.fromBytesBE(e,t)};nr.fromBytesLE=function(e,t){return new nr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};nr.fromBytesBE=function(e,t){return new nr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var W$=Object.assign(Object.create(null),lg,{default:lg}),vs=lg||W$;function ef(r){return vs.fromString(r,!0,16)}var JE=ef("c3a5c85c97cb3127"),ps=ef("b492b66fbe98f273"),mn=ef("9ae16a3b2f90404f");function fg(r){return r.xor(r.shru(47))}function eT(r,e,t){var n=r.slice(e,e+t);return vs.fromBytes(Array.from(n),!0,!0)}function jt(r,e){return eT(r,e,8)}function Lk(r,e){return eT(r,e,4)}function Zr(r,e){return e===0?r:r.shru(e).or(r.shl(64-e))}function Do(r,e,t){t===void 0&&(t=ef("9ddfea08eb382d69"));var n=r.xor(e).mul(t);n=n.xor(n.shru(47));var a=e.xor(n).mul(t);return a=a.xor(a.shru(47)),a=a.mul(t),a}function V$(r,e,t,n,a,i){a=a.add(r),i=Zr(i.add(a).add(n),21);var o=a;return a=a.add(e),a=a.add(t),i=i.add(Zr(a,44)),[a.add(n),i.add(o)]}function mp(r,e,t,n){return V$(jt(r,e),jt(r,e+8),jt(r,e+16),jt(r,e+24),t,n)}function U$(r,e){if(e===void 0&&(e=r.length),e>=8){var t=mn.add(e*2),n=jt(r,0).add(mn),a=jt(r,e-8),i=Zr(a,37).mul(t).add(n),o=Zr(n,25).add(a).mul(t);return Do(i,o,t)}if(e>=4){var t=mn.add(e*2),n=Lk(r,0);return Do(n.shl(3).add(e),Lk(r,e-4),t)}if(e>0){var n=r[0],a=r[e>>1],i=r[e-1],s=n+(a<<8),u=e+(i<<2);return fg(mn.mul(s).xor(JE.mul(u))).mul(mn)}return mn}function G$(r,e){e===void 0&&(e=r.length);var t=mn.add(e*2),n=jt(r,0).mul(ps),a=jt(r,8),i=jt(r,e-8).mul(t),o=jt(r,e-16).mul(mn);return Do(Zr(n.add(a),43).add(Zr(i,30)).add(o),n.add(Zr(a.add(mn),18)).add(i),t)}function H$(r,e){e===void 0&&(e=r.length);var t=mn.add(e*2),n=jt(r,0).mul(mn),a=jt(r,8),i=jt(r,e-8).mul(t),o=jt(r,e-16).mul(mn),s=Zr(n.add(a),43).add(Zr(i,30)).add(o),u=Do(s,n.add(Zr(a.add(mn),18)).add(i),t),l=jt(r,16).mul(t),c=jt(r,24),f=s.add(jt(r,e-32)).mul(t),h=u.add(jt(r,e-24)).mul(t);return Do(Zr(l.add(c),43).add(Zr(f,30)).add(h),l.add(Zr(c.add(n),18)).add(f),t)}function q$(r,e){var t,n;e===void 0&&(e=r.length);var a=vs.fromNumber(81,!0);if(e<=32)return e<=16?U$(r,e):G$(r,e);if(e<=64)return H$(r,e);var i=a,o=a.mul(ps).add(113),s=fg(o.mul(mn).add(113)).mul(mn),u=[vs.UZERO,vs.UZERO],l=[vs.UZERO,vs.UZERO];i=i.mul(mn).add(jt(r,0));var c=0,f=(e-1>>6)*64,h=f+(e-1&63)-63;do i=Zr(i.add(o).add(u[0]).add(jt(r,c+8)),37).mul(ps),o=Zr(o.add(u[1]).add(jt(r,c+48)),42).mul(ps),i=i.xor(l[1]),o=o.add(u[0]).add(jt(r,c+40)),s=Zr(s.add(l[0]),33).mul(ps),u=mp(r,c,u[1].mul(ps),i.add(l[0])),l=mp(r,c+32,s.add(l[1]),o.add(jt(r,c+16))),t=qe([i,s],2),s=t[0],i=t[1],c+=64;while(c!==f);var p=ps.add(s.and(255).shl(1));return c=h,l[0]=l[0].add(e-1&63),u[0]=u[0].add(l[0]),l[0]=l[0].add(u[0]),i=Zr(i.add(o).add(u[0]).add(jt(r,c+8)),37).mul(p),o=Zr(o.add(u[1]).add(jt(r,c+48)),42).mul(p),i=i.xor(l[1].mul(9)),o=o.add(u[0].mul(9).add(jt(r,c+40))),s=Zr(s.add(l[0]),33).mul(p),u=mp(r,c,u[1].mul(p),i.add(l[0])),l=mp(r,c+32,s.add(l[1]),o.add(jt(r,c+16))),n=qe([i,s],2),s=n[0],i=n[1],Do(Do(u[0],l[0],p).add(fg(o).mul(JE)).add(s),Do(u[1],l[1],p).add(i),p)}function K$(r,e){return e==="string"?tf(r):Bp([r],e)}function j$(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function Bp(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=xs(r)),kt().getBool("DEBUG")&&t2(r,e),j$(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type "+e)}function Uc(){return kt().platform.now()}function X$(r,e){return kt().platform.fetch(r,e)}function tf(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",kt().platform.encode(r,e)}function Np(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",kt().platform.decode(r,e)}var Y$={__proto__:null,createScalarValue:K$,toTypedArray:Bp,now:Uc,fetch:X$,encodeString:tf,decodeString:Np,shuffle:Zk,shuffleCombo:Zz,clamp:Wc,nearestLargerEven:Qz,swap:kp,sum:Jz,randUniform:e$,distSquared:t$,assert:X,assertShapesMatch:gn,assertNonNull:Is,flatten:xs,sizeFromShape:rr,isScalarShape:r$,arraysEqual:Oo,isInt:ju,tanh:n$,sizeToSquarishShape:a$,createShuffledIndices:i$,rightPad:Bc,repeatedTry:o$,inferFromImplicitShape:s$,parseAxisParam:Jc,squeezeShape:Qk,getTypedArrayFromDType:Jk,getArrayFromDType:e2,checkConversionForErrors:t2,isValidDtype:r2,hasEncodingLoss:u$,isTypedArray:fn,bytesPerElement:ng,bytesFromStringArray:n2,isString:Ao,isBoolean:a2,isNumber:i2,inferDtype:Pp,isFunction:Fo,nearestDivisor:Sp,computeStrides:Ju,toNestedArray:Vu,makeOnesTypedArray:Cg,makeZerosTypedArray:Lp,makeZerosNestedTypedArray:l$,assertNonNegativeIntegerDimensions:Ag,locToIndex:c$,indexToLoc:f$,isPromise:_g,hexToLong:ef,fingerPrint64:q$},Z$=(function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new J$)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,l=Uc();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var c=Tn(o),f=c.next();!f.done;f=c.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Uc()-l})}if(kt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(m){var g=o[m];g.data().then(function(y){Q$(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(l){t.logger.logKernelProfile(n,u,l[0],l[1],o,l[2])})})},r})();function Q$(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found "+a+" in the result of '"+t+"'"),!0}return!1}var J$=(function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?Bc(a+"ms",9):a.error,u=Bc(e,25),l=t.rank,c=t.size,f=Bc(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var v=d.shape||t.shape,m=v.length;h+=p+": "+m+"D "+(m>0?v:"")+" "}}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+f+"	%c"+c+"	%c"+h+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r})();function eW(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var l=s[u],c=!1,f=0;f<e.length;f++)if(n[l.id]){o.outputs.forEach(function(b){return n[b.id]=!0}),c=!0,a[o.id]=!0;break}if(c)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];n[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,d.push(g)}}return d}function tW(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+("for "+s.kernelName+"."));var l=s.gradient(u),c=function(h){if(!(h in l))throw new Error("Cannot backprop through input "+h+". "+("Available gradients found: "+Object.keys(l)+"."));var p=t(function(){return l[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+(h+" must have 'float32' dtype, but has '"+p.dtype+"'"));var d=s.inputs[h];if(!Oo(p.shape,d.shape))throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+("'"+h+"' has shape '"+p.shape+"', which does not match ")+("the shape of the input '"+d.shape+"'"));if(r[d.id]==null)r[d.id]=p;else{var v=r[d.id];r[d.id]=n(v,p),v.dispose()}};for(var f in s.inputs)c(f)},i=e.length-1;i>=0;i--)a(i)}var Bk=20,Oc=3,Zm=7;function rW(r,e,t,n){var a=Ju(e),i=nW(r,e,t,a),o=e.length,s=bp(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function nW(r,e,t,n){var a=rr(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Lc(r):r;if(s>1)for(var l=0;l<a/i;l++)for(var c=l*i,f=0;f<i;f++)o[f]=Math.max(o[f],Pc(u[c+f],0,t).length);return o}function Pc(r,e,t){var n;return Array.isArray(r)?n=parseFloat(r[0].toFixed(Zm))+" + "+(parseFloat(r[1].toFixed(Zm))+"j"):Ao(r)?n="'"+r+"'":t==="bool"?n=tT(r):n=parseFloat(r.toFixed(Zm)).toString(),Bc(n,e)}function tT(r){return r===0?"false":"true"}function bp(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var l=Lc(r);return[Pc(l[0],0,t)]}return t==="bool"?[tT(r[0])]:[r[0].toString()]}if(u===1){if(s>Bk){var c=Oc*o,f=Array.from(r.slice(0,c)),h=Array.from(r.slice((s-Oc)*o,s*o));return t==="complex64"&&(f=Lc(f),h=Lc(h)),["["+f.map(function(E,N){return Pc(E,a[N],t)}).join(", ")+", ..., "+h.map(function(E,N){return Pc(E,a[s-Oc+N],t)}).join(", ")+"]"]}var p=t==="complex64"?Lc(r):Array.from(r);return["["+p.map(function(E,N){return Pc(E,a[N],t)}).join(", ")+"]"]}var d=e.slice(1),v=n.slice(1),m=n[0]*o,g=[];if(s>Bk){for(var y=0;y<Oc;y++){var b=y*m,w=b+m;g.push.apply(g,Rt(bp(r.slice(b,w),d,t,v,a,!1)))}g.push("...");for(var y=s-Oc;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,Rt(bp(r.slice(b,w),d,t,v,a,y===s-1)))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,Rt(bp(r.slice(b,w),d,t,v,a,y===s-1)))}var k=u===2?",":"";g[0]="["+g[0]+k;for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+k;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function Lc(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Cp=(function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=rr(e),n!=null){var i=n.length;X(i===this.size,function(){return"Length of values '"+i+"' does not match the size "+("inferred by the shape '"+a.size+"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||e2(t,this.size),this.strides=Ju(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),X(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must "+("match the rank ("+t.rank+")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=Tn(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var l="Requested out of range element at "+n+". "+("  Buffer shape="+this.shape);throw new Error(l)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=n[n.length-1],f=0;f<n.length-1;++f)c+=this.strides[f]*n[f];return this.values[c]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return ii().makeTensor(this.values,this.shape,this.dtype)},r})(),ii=null,zu=null;function aW(r){ii=r}function iW(r){zu=r}var zr=(function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=rr(e),this.strides=Ju(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Ye(this,void 0,void 0,function(){var e;return Ze(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,zu.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return zu.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ye(this,void 0,void 0,function(){var e;return Ze(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Vu(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return Vu(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Ye(this,void 0,void 0,function(){var e,t;return Ze(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=ii().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return Np(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),ii().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=ii().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Np(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ye(this,void 0,void 0,function(){var e;return Ze(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ii().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(ii().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),zu.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),zu.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return rW(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),zu.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),ii().makeVariable(this,e,t,n)},r})();Object.defineProperty(zr,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function oW(){return Dg("Tensor",function(){return zr})}oW();var Gc=(function(r){ro(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and "+("previous value ("+this.dtype+") must match"));if(!Oo(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and "+("previous value ("+this.shape+") must match"));ii().disposeTensor(this),this.dataId=t.dataId,ii().incRef(this,null)},e.prototype.dispose=function(){ii().disposeVariable(this),this.isDisposedInternal=!0},e})(zr);Object.defineProperty(Gc,Symbol.hasInstance,{value:function(r){return r instanceof zr&&r.assign!=null&&r.assign instanceof Function}});D.Rank=void 0;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(D.Rank||(D.Rank={}));var hg;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(hg||(hg={}));var pg;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(pg||(pg={}));var dg;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(dg||(dg={}));var vg;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(vg||(vg={}));var sW={float32:dg,int32:hg,bool:pg,complex64:vg};function zp(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return sW[r][e]}function uW(r){return zp(r,"int32")}function Er(r,e){if(r.dtype===e.dtype)return[r,e];var t=zp(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function rT(r,e){X(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and"+(" second("+e.dtype+") input must match")})}function lW(r,e){return e.some(function(t){return t.id===r.id})}function Bg(r){var e=[],t=new Set;return nT(r,e,t),e}function nT(r,e,t){if(r!=null){if(r instanceof zr){e.push(r);return}if(cW(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),nT(i,e,t))}}}}function cW(r){return Array.isArray(r)||typeof r=="object"}var fW={__proto__:null,makeTypesMatch:Er,assertTypesMatch:rT,isTensorInList:lW,getTensorsInContainer:Bg};function Qm(r){return r.kernelName!=null}var zk=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r})(),zg=(function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new zk}return r.prototype.ready=function(){return Ye(this,void 0,void 0,function(){var e,t,n,a;return Ze(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(Co(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ye(this,void 0,void 0,function(){var t,n,a,i,o;return Ze(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Z$(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=Tp(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=Tp(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var a=n.factory();if(a&&!(a instanceof Yk)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Co("Initialization of backend "+e+" failed"),Co(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Co("Initialization of backend "+e+" failed"),Co(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=ne.runKernel(Mg,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},l={dtype:s};return ne.runKernel(Rg,u,l)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=Ep(e,this.backendName)!=null;if(!a)throw new Error("Kernel '"+e+"' not registered for backend '"+this.backendName+"'");return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak "+("("+s+" data ids) after running '"+e+"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var l,c=Qm(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Qm(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=Ep(f,this.backendName);X(d!=null,function(){return"Cannot find registered kernel '"+f+"' for backend '"+t.backendName+"'"}),u=function(){var k=t.backend.numDataIds();l=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(l)?l:[l];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,k,S);var E=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var N=t.getTensorsForGradient(f,h,E);a=t.saveTensorsForBackwardMode(N)}return E}}else{var v=e.forwardFunc,m=function(k){i&&(a=k.map(function(S){return t.keep(t.clone(S))}))};u=function(){var k=t.backend.numDataIds();l=t.tidy(function(){return v(t.backend,m)});var S=Array.isArray(l)?l:[l];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(c,k,S),S}}var g=e.inputs,y=e.attrs,b=Qm(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(w=t.profiler.profileKernel(c,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),n=w.outputs)}),i&&this.addTapeNode(c,g,n,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(k){return g[k]!=null?g[k].shape:null}),outputShapes:n.map(function(k){return k.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(l)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=ug(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(X(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(l){return t[l]})):s=i.map(function(l){return t[l]});var u=n.filter(function(l,c){return o[c]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&Ao(e[0])&&(i=e.map(function(c){return tf(c)}));var o=a.write(i,t,n),s=new zr(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),l=n2(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new zr(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Gc(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*ng(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Gc||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*ng(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ye(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return Ze(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Rt(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=Tn(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),l=s,[4,s.extraInfo];case 5:l.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return c=p.sent(),f={error:c},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},l=ug(e);l!=null&&(a=l.gradFunc),a!=null&&(u.gradient=function(c){return c=c.map(function(f,h){if(f==null){var p=n[h],d=Lp(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(c.length>1?c:c[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=Bg(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),X(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});X(o instanceof zr,function(){return"The result y returned by f() must be a tensor."});var s=eW(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??hW(o.shape),tW(u,s,function(c){return i.tidy(c)},pW);var l=t.map(function(c){return u[c.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(c){var f,h;try{for(var p=Tn(c.saved),d=p.next();!d.done;d=p.next()){var v=d.value;v.dispose()}}catch(m){f={error:m}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:l}})},r.prototype.customGrad=function(e){var t=this;return X(Fo(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];X(n.every(function(l){return l instanceof zr}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(l,c){o[c]=l});var s=function(l,c){return i=e.apply(void 0,Rt(n,[c])),X(i.value instanceof zr,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),X(Fo(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(l,c){var f=i.gradFunc(l,c),h=Array.isArray(f)?f:[f];X(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),X(h.every(function(d){return d instanceof zr}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,v){p[v]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Ye(this,void 0,void 0,function(){var t,n;return Ze(this,function(a){switch(a.label){case 0:return t=Uc(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Uc()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new zk;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r})();zg.nextTensorId=0;zg.nextVariableId=0;function hW(r){var e=Cg(rr(r),"float32");return ne.makeTensor(e,r,"float32")}function aT(){var r=u2();if(r._tfengine==null){var e=new s2(r);r._tfengine=new zg(e)}return v$(r._tfengine.ENV),aW(function(){return r._tfengine}),r._tfengine}var ne=aT();function pW(r,e){var t={a:r,b:e};return ne.runKernel(Fg,t)}function dW(){return typeof navigator<"u"&&navigator!=null}var mg;function vW(r){mg=r}function mW(r){if(mg!==void 0)return mg;if(r||dW()){if(r||(r=navigator),r.product==="ReactNative")return!0;var e=r.userAgent||r.vendor||(typeof window<"u"?window.opera:"");if(!e){var t=r;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function iT(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var gW={__proto__:null,mockIsMobile:vW,isMobile:mW,isBrowser:iT};var Gn=kt();Gn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Gn.registerFlag("IS_BROWSER",function(){return iT()});Gn.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});Gn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});Gn.registerFlag("PROD",function(){return!1});Gn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Gn.getBool("DEBUG")});Gn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});Gn.registerFlag("IS_TEST",function(){return!1});Gn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});Gn.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});Gn.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});Gn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});Gn.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function Di(r,e){var t=r;if(fn(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||fn(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&kt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&oT(r,n,[]),n}function oT(r,e,t){if(t=t||[],!Array.isArray(r)&&!fn(r)){X(e.length===0,function(){return"Element arr["+t.join("][")+"] is a primitive, "+("but should be an array/TypedArray of "+e[0]+" elements")});return}X(e.length>0,function(){return"Element arr["+t.join("][")+"] should be a primitive, "+("but is an array of "+r.length+" elements")}),X(r.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" "+("elements, but has "+r.length+" elements")});for(var n=e.slice(1),a=0;a<r.length;++a)oT(r[a],n,t.concat(a))}function $k(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '"+t+"' passed to '"+n+"' must "+("be "+r+" tensor, but got "+e+" tensor"))}}function V(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof zr)return $k(n,r.dtype,e,t),r;var a=Pp(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),$k(n,a,e,t),r==null||!fn(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a "+("Tensor or TensorLike, but got '"+i+"'"))}var o=Di(r,a);!fn(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?Bp(r,a):xs(r,[],s);return ne.makeTensor(u,o,a)}function Hc(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return V(i,e+"["+o+"]",t,n)})}var sT="__op";function re(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+(e.length+" keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+sT;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ne.startScope(t);try{var s=n.apply(void 0,Rt(i));return _g(s)&&console.error("Cannot return a Promise inside of tidy."),ne.endScope(s),s}catch(u){throw ne.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function yW(r,e){var t=V(r,"real","complex"),n=V(e,"imag","complex");gn(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex().");var a={real:t,imag:n};return ne.runKernel(_2,a)}var Ro=re({complex_:yW});function Po(r,e,t,n){if(n==null&&(n=Pp(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!fn(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Ag(e);var a=rr(e),i=rr(t);X(a===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+(a+" values but has "+i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==rr(e.slice(o)):!0;X(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+("("+t+") does not match the provided ")+("shape ("+e+"). ")})}}return!fn(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?Bp(r,n):xs(r,[],!0),ne.makeTensor(r,e,n)}function Uu(r,e,t){var n=Di(r,t);return Po(r,e,n,t)}var gg={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Ap=4;function bW(r,e){return Ye(this,void 0,void 0,function(){var t,n,a,i,o,s,u=this;return Ze(this,function(l){switch(l.label){case 0:for(t=[],n=[],a=Array.isArray(r)?r.map(function(c){return c.name}):Object.keys(r),i=function(c){var f=a[c],h=Array.isArray(r)?r[c].tensor:r[f];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error("Unsupported dtype in weight '"+f+"': "+h.dtype);var p={name:f,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(v){return Ye(u,void 0,void 0,function(){var m,g,y,b,w,k,S;return Ze(this,function(E){switch(E.label){case 0:return[4,h.bytes()];case 1:for(m=E.sent(),g=m.reduce(function(N,C){return N+C.length},0)+Ap*m.length,y=new Uint8Array(g),b=0,w=0;w<m.length;w++)k=m[w],S=new Uint8Array(new Uint32Array([k.length]).buffer),y.set(S,b),b+=Ap,y.set(k,b),b+=k.length;return v(y),[2]}})})});n.push(d)}else n.push(h.data());e!=null&&(p.group=e),t.push(p)},o=0;o<a.length;++o)i(o);return[4,Promise.all(n)];case 1:return s=l.sent(),[2,{data:wW(s),specs:t}]}})})}function uT(r,e){var t,n,a={},i,o=0;try{for(var s=Tn(e),u=s.next();!u.done;u=s.next()){var l=u.value,c=l.name,f=l.dtype,h=l.shape,p=rr(h),d=void 0;if("quantization"in l){var v=l.quantization;if(v.dtype==="uint8"||v.dtype==="uint16"){if(!("min"in v&&"scale"in v))throw new Error("Weight "+l.name+" with quantization "+v.dtype+" doesn't have corresponding metadata min and scale.")}else if(v.dtype==="float16"){if(f!=="float32")throw new Error("Weight "+l.name+" is quantized with "+v.dtype+" "+("which only supports weights of type float32 not "+f+"."))}else throw new Error("Weight "+l.name+" has unknown "+("quantization dtype "+v.dtype+". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var m=gg[v.dtype],g=r.slice(o,o+p*m),y=v.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(f==="float32")if(v.dtype==="uint8"||v.dtype==="uint16"){d=new Float32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];d[b]=w*v.scale+v.min}}else if(v.dtype==="float16")i===void 0&&(i=IW()),d=i(y);else throw new Error("Unsupported quantization type "+v.dtype+" for weight type float32.");else if(f==="int32"){if(v.dtype!=="uint8"&&v.dtype!=="uint16")throw new Error("Unsupported quantization type "+v.dtype+" for weight type int32.");d=new Int32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];d[b]=Math.round(w*v.scale+v.min)}}else throw new Error("Unsupported dtype in weight '"+c+"': "+f);o+=p*m}else if(f==="string"){var k=rr(l.shape);d=[];for(var b=0;b<k;b++){var S=new Uint32Array(r.slice(o,o+Ap))[0];o+=Ap;var E=new Uint8Array(r.slice(o,o+S));d.push(E),o+=S}}else{var N=gg[f],g=r.slice(o,o+p*N);if(f==="float32")d=new Float32Array(g);else if(f==="int32")d=new Int32Array(g);else if(f==="bool")d=new Uint8Array(g);else if(f==="complex64"){d=new Float32Array(g);for(var C=new Float32Array(d.length/2),R=new Float32Array(d.length/2),b=0;b<C.length;b++)C[b]=d[b*2],R[b]=d[b*2+1];var _=Uu(C,h,"float32"),O=Uu(R,h,"float32");a[c]=Ro(_,O),_.dispose(),O.dispose()}else throw new Error("Unsupported dtype in weight '"+c+"': "+f);o+=p*N}f!=="complex64"&&(a[c]=Uu(d,h,f))}}catch(P){t={error:P}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a}function wW(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var e=0,t=[];r.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var n=new Uint8Array(e),a=0;return t.forEach(function(i){n.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),n.buffer}var $g=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Wk(r){return $g?Buffer.byteLength(r):new Blob([r]).size}function xW(r){if($g)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function kW(r){if($g){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function Wg(r){if(r.length===1)return r[0];var e=0;r.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(a){t.set(new Uint8Array(a),n),n+=a.byteLength}),t.buffer}function Vk(r){var e="/";for(r=r.trim();r.endsWith(e);)r=r.slice(0,r.length-1);var t=r.split(e);return t[t.length-1]}function lT(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function cT(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),n}function Vg(r,e){return Ye(this,void 0,void 0,function(){var t,n,a;return Ze(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=qe.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,cT(r,t,n)]}})})}function rf(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:Wk(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:Wk(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}function fT(r){var e,t,n=[];try{for(var a=Tn(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,Rt(o.weights))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function SW(){var r=function(n){for(var a=n<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=r(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function EW(){var r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(var e=1;e<31;e++)r[e]=e<<23;for(var e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function TW(){for(var r=new Uint32Array(64),e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function IW(){var r=SW(),e=EW(),t=TW();return function(n){for(var a=new ArrayBuffer(4*n.length),i=new Uint32Array(a),o=0;o<n.length;o++){var s=n[o],u=r[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var ga=(function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r})(),NW=function(r){return ga.registerSaveRouter(r)},CW=function(r){return ga.registerLoadRouter(r)},AW=function(r){return ga.getSaveHandlers(r)},_W=function(r,e){return ga.getLoadHandlers(r,e)},yg="tensorflowjs",bg=1,gs="models_store",_o="model_info_store";function hT(){if(!kt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function wg(r){var e=r.result;e.createObjectStore(gs,{keyPath:"modelPath"}),e.createObjectStore(_o,{keyPath:"modelPath"})}var ks=(function(){function r(e){if(this.indexedDB=hT(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ye(this,void 0,void 0,function(){return Ze(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ye(this,void 0,void 0,function(){return Ze(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(yg,bg);o.onupgradeneeded=function(){return wg(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(gs,"readonly"),l=u.objectStore(gs),c=l.get(n.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));a(c.result.modelArtifacts)},c.onerror=function(m){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var f=rf(t),h=s.transaction(_o,"readwrite"),p=h.objectStore(_o),d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f}),v;d.onsuccess=function(){v=s.transaction(gs,"readwrite");var m=v.objectStore(gs),g=m.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(_o);var b=p.delete(n.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},d.onerror=function(m){return s.close(),i(d.error)},h.oncomplete=function(){v==null?s.close():v.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r})();ks.URL_SCHEME="indexeddb://";var pT=function(r){return kt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ks.URL_SCHEME)?DW(r.slice(ks.URL_SCHEME.length)):null};ga.registerSaveRouter(pT);ga.registerLoadRouter(pT);function DW(r){return new ks(r)}function FW(r){return r.startsWith(ks.URL_SCHEME)?r.slice(ks.URL_SCHEME.length):r}var RW=(function(){function r(){this.indexedDB=hT()}return r.prototype.listModels=function(){return Ye(this,void 0,void 0,function(){var e=this;return Ze(this,function(t){return[2,new Promise(function(n,a){var i=e.indexedDB.open(yg,bg);i.onupgradeneeded=function(){return wg(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(_o,"readonly"),u=s.objectStore(_o),l=u.getAll();l.onsuccess=function(){var c,f,h={};try{for(var p=Tn(l.result),d=p.next();!d.done;d=p.next()){var v=d.value;h[v.modelPath]=v.modelArtifactsInfo}}catch(m){c={error:m}}finally{try{d&&!d.done&&(f=p.return)&&f.call(p)}finally{if(c)throw c.error}}n(h)},l.onerror=function(c){return o.close(),a(l.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},r.prototype.removeModel=function(e){return Ye(this,void 0,void 0,function(){var t=this;return Ze(this,function(n){return e=FW(e),[2,new Promise(function(a,i){var o=t.indexedDB.open(yg,bg);o.onupgradeneeded=function(){return wg(o)},o.onsuccess=function(){var s=o.result,u=s.transaction(_o,"readwrite"),l=u.objectStore(_o),c=l.get(e),f;c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var h=l.delete(e),p=function(){f=s.transaction(gs,"readwrite");var d=f.objectStore(gs),v=d.delete(e);v.onsuccess=function(){return a(c.result.modelArtifactsInfo)},v.onerror=function(m){return i(c.error)}};h.onsuccess=p,h.onerror=function(d){return p(),s.close(),i(c.error)}},c.onerror=function(h){return s.close(),i(c.error)},u.oncomplete=function(){f==null?s.close():f.oncomplete=function(){return s.close()}}},o.onerror=function(s){return i(o.error)}})]})})},r})(),Qi="/",$u="tensorflowjs_models",dT="info",MW="model_topology",OW="weight_specs",PW="weight_data",LW="model_metadata";function vT(r){return{info:[$u,r,dT].join(Qi),topology:[$u,r,MW].join(Qi),weightSpecs:[$u,r,OW].join(Qi),weightData:[$u,r,PW].join(Qi),modelMetadata:[$u,r,LW].join(Qi)}}function mT(r){var e,t;try{for(var n=Tn(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}function BW(r){var e=r.split(Qi);if(e.length<3)throw new Error("Invalid key format: "+r);return e.slice(1,e.length-1).join(Qi)}function zW(r){return r.startsWith(Ss.URL_SCHEME)?r.slice(Ss.URL_SCHEME.length):r}var Ss=(function(){function r(e){if(!kt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=vT(this.modelPath)}return r.prototype.save=function(e){return Ye(this,void 0,void 0,function(){var t,n,a,i;return Ze(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=rf(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,xW(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw mT(this.keys),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: "+("modelTopologyBytes="+a.modelTopologyBytes+", ")+("weightSpecsBytes="+a.weightSpecsBytes+", ")+("weightDataBytes="+a.weightDataBytes+"."))}return[2]})})},r.prototype.load=function(){return Ye(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Ze(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+("'"+this.modelPath+"' are missing."));return t.weightData=kW(s),[2,t]})})},r})();Ss.URL_SCHEME="localstorage://";var gT=function(r){return kt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ss.URL_SCHEME)?$W(r.slice(Ss.URL_SCHEME.length)):null};ga.registerSaveRouter(gT);ga.registerLoadRouter(gT);function $W(r){return new Ss(r)}var WW=(function(){function r(){X(kt().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),X(typeof window>"u"||typeof window.localStorage<"u",function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return Ye(this,void 0,void 0,function(){var e,t,n,a,i,o;return Ze(this,function(s){for(e={},t=$u+Qi,n=Qi+dT,a=0;a<this.LS.length;++a)i=this.LS.key(a),i.startsWith(t)&&i.endsWith(n)&&(o=BW(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},r.prototype.removeModel=function(e){return Ye(this,void 0,void 0,function(){var t,n;return Ze(this,function(a){if(e=zW(e),t=vT(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),mT(t),[2,n]})})},r})(),Gu="://",Mo=(function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){X(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Gu)&&(e=e.slice(0,e.indexOf(Gu))),X(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();X(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),n.managers[e]=t},r.getManager=function(e){var t=r.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(r.getInstance().managers)},r})();function wp(r){if(r.indexOf(Gu)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+(""+Mo.getSchemes().join(",")));return{scheme:r.split(Gu)[0],path:r.split(Gu)[1]}}function yT(r,e,t){return t===void 0&&(t=!1),Ye(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f;return Ze(this,function(h){switch(h.label){case 0:return X(r!==e,function(){return"Old path and new path are the same: '"+r+"'"}),n=ga.getLoadHandlers(r),X(n.length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),X(n.length<2,function(){return"Copying failed because more than one ("+n.length+") "+("load handlers for source URL "+r+".")}),a=n[0],i=ga.getSaveHandlers(e),X(i.length>0,function(){return"Copying failed because no save handler is found for destination "+("URL "+e+".")}),X(i.length<2,function(){return"Copying failed because more than one ("+n.length+") "+("save handlers for destination URL "+e+".")}),o=i[0],s=wp(r).scheme,u=wp(r).path,l=s===wp(r).scheme,[4,a.load()];case 1:return c=h.sent(),t&&l?[4,Mo.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(c)];case 4:return f=h.sent(),t&&!l?[4,Mo.getManager(s).removeModel(u)]:[3,6];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}function VW(){return Ye(this,void 0,void 0,function(){var r,e,t,n,a,i,o,s,u,l,c;return Ze(this,function(f){switch(f.label){case 0:r=Mo.getSchemes(),e={},f.label=1;case 1:f.trys.push([1,6,7,8]),t=Tn(r),n=t.next(),f.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,Mo.getManager(a).listModels()]);case 3:i=f.sent();for(o in i)s=a+Gu+o,e[s]=i[o];f.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),l={error:u},[3,8];case 7:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(l)throw l.error}return[7];case 8:return[2,e]}})})}function UW(r){return Ye(this,void 0,void 0,function(){var e,t;return Ze(this,function(n){return e=wp(r),t=Mo.getManager(e.scheme),[2,t.removeModel(e.path)]})})}function GW(r,e){return Ye(this,void 0,void 0,function(){var t;return Ze(this,function(n){return t=!1,[2,yT(r,e,t)]})})}function HW(r,e){return Ye(this,void 0,void 0,function(){var t;return Ze(this,function(n){return t=!0,[2,yT(r,e,t)]})})}var qW=(function(){function r(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r.prototype.setTimeoutCustom=function(e,t){var n=this;if(!window||!kt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",function(a){if(a.source===window&&a.data.name===n.messageName){a.stopPropagation();var i=n.functionRefs[a.data.index];i(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0)}},!0))},r})();if(kt().get("IS_BROWSER")){kt().setPlatform("browser",new qW);try{Mo.registerManager(Ss.URL_SCHEME,new WW)}catch{}try{Mo.registerManager(ks.URL_SCHEME,new RW)}catch{}}var KW={importFetch:function(){return Ak()}},Jm,jW=(function(){function r(){this.util=_k(),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return kt().global.fetch!=null?kt().global.fetch(e,t):(Jm==null&&(Jm=KW.importFetch()),Jm(e,t))},r.prototype.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r})();kt().get("IS_NODE")&&!kt().get("IS_BROWSER")&&kt().setPlatform("node",new jW);function eo(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",Ag(r),new Cp(r,e,t)}function XW(r,e){var t=V(r,"x","cast");if(!r2(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return ne.runKernel(Rg,n,a)}var Ar=re({cast_:XW});function YW(r){var e=V(r,"x","clone","string_or_numeric"),t={x:e};return ne.runKernel(Mg,t)}var bs=re({clone_:YW});function bT(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}aT();var ZW={buffer:eo,cast:Ar,clone:bs,print:bT};iW(ZW);var QW="model",JW=".json",eV=".weights.bin";function Uk(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var _p=(function(){function r(e){if(!kt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=QW),this.modelJsonFileName=e+JW,this.weightDataFileName=e+eV}return r.prototype.save=function(e){return Ye(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ze(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=lT(e,n),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,Uk(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,Uk(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:rf(e)}]}})})},r})();_p.URL_SCHEME="downloads://";var tV=(function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+("but received "+e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}return r.prototype.load=function(){return Ye(this,void 0,void 0,function(){var e=this;return Ze(this,function(t){return[2,new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(u==null){a(new Error("modelTopology field is missing from file "+e.jsonFile.name));return}var l=s.weightsManifest;if(l==null){a(new Error("weightManifest field is missing from file "+e.jsonFile.name));return}if(e.weightsFiles.length===0){n({modelTopology:u});return}var c=Vg(s,function(f){return e.loadWeights(f)});n(c)},i.onerror=function(o){return a("Failed to read model topology and weights manifest JSON "+("from file '"+e.jsonFile.name+"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(e.jsonFile)})]})})},r.prototype.loadWeights=function(e){var t,n,a=this,i=[],o=[];try{for(var s=Tn(e),u=s.next();!u.done;u=s.next()){var l=u.value;i.push.apply(i,Rt(l.weights)),o.push.apply(o,Rt(l.paths))}}catch(h){t={error:h}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}var c=this.checkManifestAndWeightFiles(e),f=o.map(function(h){return a.loadWeightsFile(h,c[h])});return Promise.all(f).then(function(h){return[i,Wg(h)]})},r.prototype.loadWeightsFile=function(e,t){return new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=o.target.result;n(s)},i.onerror=function(o){return a("Failed to weights data from file of path '"+e+"'.")},i.readAsArrayBuffer(t)})},r.prototype.checkManifestAndWeightFiles=function(e){var t,n,a=this,i=[],o=this.weightsFiles.map(function(f){return Vk(f.name)}),s={};try{for(var u=Tn(e),l=u.next();!l.done;l=u.next()){var c=l.value;c.paths.forEach(function(f){var h=Vk(f);if(i.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+("'"+h+"'"));if(i.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");s[f]=a.weightsFiles[o.indexOf(h)]})}}catch(f){t={error:f}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}if(i.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+("("+i.length+") and the number of weight files provided ")+("("+this.weightsFiles.length+")."));return s},r})(),rV=function(r){return kt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(_p.URL_SCHEME)?nV(r.slice(_p.URL_SCHEME.length)):null};ga.registerSaveRouter(rV);function nV(r){return r===void 0&&(r="model"),new _p(r)}function aV(r){return new tV(r)}function Gk(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(l){var c=t+ ++a/r.length*(n-t);return e(c),l}),u};function o(u){X(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,l){X(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+("got startFraction "+u)}),X(l>=0&&l<=1,function(){return"Progress fraction must be in range [0, 1], but "+("got endFraction "+l)}),X(l>=u,function(){return"startFraction must be no more than endFraction, but "+("got startFraction "+u+" and endFraction ")+(""+l)})}return Promise.all(r.map(i))}function wT(r,e){return Ye(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return Ze(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?kt().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,Gk(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),l=.5,c=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,Gk(u,e.onProgress,l,c)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function iV(r,e,t,n){return e===void 0&&(e=""),Ye(this,void 0,void 0,function(){var a,i;return Ze(this,function(o){return a=function(s){return wT(s,{requestInit:n})},i=xT(a),[2,i(r,e,t)]})})}function xT(r){var e=this;return function(t,n,a){return n===void 0&&(n=""),Ye(e,void 0,void 0,function(){var i,o,s,u,l,c,f,h,p,d;return Ze(this,function(v){switch(v.label){case 0:if(i=t.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],t.forEach(function(m,g){var y=0;m.weights.forEach(function(b){var w="quantization"in b?b.quantization.dtype:b.dtype,k=gg[w]*rr(b.shape),S=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:b,groupOffset:y,sizeBytes:k})};a!=null?a.forEach(function(E,N){E===b.name&&(S(),s[N]=!0)}):S(),u.push(b.name),y+=k})}),!s.every(function(m){return m}))throw l=a.filter(function(m,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+(l.join(", ")+`. 
`)+"Manifest JSON has weights with names: "+(u.join(", ")+"."));return c=i.reduce(function(m,g,y){return g&&m.push(y),m},[]),f=[],c.forEach(function(m){t[m].paths.forEach(function(g){var y=n+(n.endsWith("/")?"":"/")+g;f.push(y)})}),[4,r(f)];case 1:return h=v.sent(),p={},d=0,c.forEach(function(m){for(var g=t[m].paths.length,y=0,b=0;b<g;b++)y+=h[d+b].byteLength;for(var w=new ArrayBuffer(y),k=new Uint8Array(w),S=0,E=0;E<g;E++){var N=new Uint8Array(h[d+E]);k.set(N,S),S+=N.byteLength}var C=o[m];C.forEach(function(R){var _=w.slice(R.groupOffset,R.groupOffset+R.sizeBytes),O=uT(_,[R.manifestEntry]);for(var P in O)p[P]=O[P]}),d+=g}),[2,p]}})})}}var oV="application/octet-stream",sV="application/json",Ug=(function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(X(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=kt().platform.fetch,X(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&X(e.length===2,function(){return"URL paths for http must have a length of 2, "+("(actual length is "+e.length+").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return Ye(this,void 0,void 0,function(){var t,n,a,i;return Ze(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=lT(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:sV}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:oV}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:rf(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+(i.status+"."))}})})},r.prototype.load=function(){return Ye(this,void 0,void 0,function(){var e,t,n,a,i,o=this;return Ze(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to "+this.path+" failed with status code "+(e.status+". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return[2,Vg(t,function(u){return o.loadWeights(u)})]}})})},r.prototype.loadWeights=function(e){return Ye(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h,p,d,v,m,g,y,b,w,k,S,E;return Ze(this,function(N){switch(N.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=qe(uV(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=fT(e),u=[],l=[];try{for(c=Tn(e),f=c.next();!f.done;f=c.next()){h=f.value;try{for(p=(S=void 0,Tn(h.paths)),d=p.next();!d.done;d=p.next())v=d.value,this.weightUrlConverter!=null?l.push(this.weightUrlConverter(v)):u.push(o+v+i)}catch(C){S={error:C}}finally{try{d&&!d.done&&(E=p.return)&&E.call(p)}finally{if(S)throw S.error}}}}catch(C){w={error:C}}finally{try{f&&!f.done&&(k=c.return)&&k.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(g=(m=u.push).apply,y=[u],[4,Promise.all(l)]):[3,2];case 1:g.apply(m,y.concat([Rt.apply(void 0,[N.sent()])])),N.label=2;case 2:return[4,wT(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return b=N.sent(),[2,[s,Wg(b)]]}})})},r})();Ug.URL_SCHEME_REGEX=/^https?:\/\//;function uV(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function xg(r){return r.match(Ug.URL_SCHEME_REGEX)!=null}var kT=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return xg(n)}):t=xg(r),t?Gg(r,e):null};ga.registerSaveRouter(kT);ga.registerLoadRouter(kT);function Gg(r,e){return new Ug(r,e)}function lV(r,e){return Gg(r,e)}var eg=(function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return this.modelArtifacts},r})(),ST=(function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return this.saveHandler(e)},r})(),cV=(function(){function r(e){e.load&&(this.load=function(){return Promise.resolve(e.load())}),e.save&&(this.save=function(t){return Promise.resolve(e.save(t))})}return r})();function fV(r,e,t,n){var a=arguments;return new cV(ET.apply(void 0,Rt(a)))}function ET(r,e,t,n){if(arguments.length===1){var a=r.modelTopology!=null||r.weightSpecs!=null;return a?new eg(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new eg({modelTopology:r}))}else return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new eg({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n})}function hV(r){return new ST(r)}function pV(r){return new ST(r)}var dV={__proto__:null,browserFiles:aV,browserHTTPRequest:lV,concatenateArrayBuffers:Wg,decodeWeights:uT,encodeWeights:bW,fromMemory:fV,fromMemorySync:ET,getLoadHandlers:_W,getModelArtifactsForJSON:Vg,getModelArtifactsForJSONSync:cT,getModelArtifactsInfoForJSON:rf,getSaveHandlers:AW,getWeightSpecs:fT,http:Gg,isHTTPScheme:xg,loadWeights:iV,registerLoadRouter:CW,registerSaveRouter:NW,weightsLoaderFactory:xT,withSaveHandler:hV,withSaveHandlerSync:pV,copyModel:GW,listModels:VW,moveModel:HW,removeModel:UW};function vV(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=V(r,"a","matMul"),o=V(e,"b","matMul");a=qe(Er(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return ne.runKernel(E2,s,u)}var Pt=re({matMul_:vV});function mV(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=V(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return ne.runKernel(KS,o,s)}var kg=re({oneHot_:mV});function gV(){kt().set("PROD",!0)}function yV(){kt().set("DEBUG",!0)}function bV(){kt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function wV(r){kt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function xV(){ne.disposeVariables()}function kV(){return ne}function SV(){return ne.memory()}function EV(r){return ne.profile(r)}function $r(r,e){return ne.tidy(r,e)}function En(r){var e=Bg(r);e.forEach(function(t){return t.dispose()})}function TT(r){return ne.keep(r)}function TV(r){return ne.time(r)}function IV(r){return ne.setBackend(r)}function NV(){return ne.ready()}function CV(){return ne.backendName}function AV(r){ne.removeBackend(r)}function _V(r){return ne.findBackend(r)}function DV(r){return ne.findBackendFactory(r)}function FV(r,e,t){return t===void 0&&(t=1),ne.registerBackend(r,e,t)}function RV(){return ne.backend}function MV(r,e){kt().setPlatform(r,e)}function OV(r){var e=V(r,"input","imag"),t={input:e};return ne.runKernel(vS,t)}var $p=re({imag_:OV});function PV(r){var e=V(r,"x","neg"),t={x:e};return ne.runKernel(WS,t)}var Ji=re({neg_:PV});function LV(r){var e=V(r,"input","real"),t={input:e};return ne.runKernel(rE,t)}var qc=re({real_:LV});function BV(r,e,t){var n=V(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),X(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" "+("must match length of perm "+e+".")}),e.forEach(function(o){X(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+(" but got "+e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?$r(function(){var o=qc(n),s=$p(n);return o=ne.runKernel(yp,{x:o},i),s=ne.runKernel(yp,{x:s},i),t&&(s=Ji(s)),Ro(o,s)}):ne.runKernel(yp,a,i)}var Dp=re({transpose_:BV});function zV(r,e,t){var n=V(r,"labels","confusionMatrix"),a=V(e,"predictions","confusionMatrix");X(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+("but got "+t)}),X(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),X(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+("but got "+a.rank)}),X(n.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+(n.shape[0]+" vs. "+a.shape[0]+". ")+"Labels and predictions should have the same number of elements."}),X(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+(""+t)});var i=kg(Ar(n,"int32"),t),o=kg(Ar(a,"int32"),t),s=Dp(i),u=Pt(s,o);return Ar(u,"int32")}var $V=re({confusionMatrix_:zV});var WV={__proto__:null,confusionMatrix:$V};function IT(r,e){for(var t=r.length,n=[],a=0;a<t;a++){var i=t-1-a,o=r[i]||1,s=e[e.length-1-a]||1;s>1&&o===1&&n.unshift(i)}return n}function Hg(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Wr(r,e){for(var t=[],n=Math.max(r.length,e.length),a=0;a<n;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+(r+" and "+e+".");throw Error(s)}else t.unshift(i)}return t}var VV={__proto__:null,getBroadcastDims:IT,getReductionAxes:Hg,assertAndGetBroadcastShape:Wr};function NT(r,e,t){if(Is(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Di(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Po(r,e,n,t)}var hs;function CT(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+("but was "+r.constructor.name));var u=Ep(ag,ne.backendName);if(u!=null){var l={pixels:r},c={numChannels:e};return ne.runKernel(ag,l,c)}var f=qe(a?[r.videoWidth,r.videoHeight]:[r.width,r.height],2),h=f[0],p=f[1],d;if(o)d=r.getContext("2d").getImageData(0,0,h,p).data;else if(n||t)d=r.data;else if(i||a||s){if(hs==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")hs=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else hs=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});hs.canvas.width=h,hs.canvas.height=p,hs.drawImage(r,0,0,h,p),d=hs.getImageData(0,0,h,p).data}var v;if(e===4)v=new Int32Array(d);else{var m=h*p;v=new Int32Array(m*e);for(var g=0;g<m;g++)for(var y=0;y<e;++y)v[g*e+y]=d[g*4+y]}var b=[p,h,e];return NT(v,b,"int32")}function UV(r){return r!=null&&r.data instanceof Uint8Array}function GV(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function HV(r){return r!=null&&r.width!==0&&r.height!==0}function qV(r){return GV()&&!(r instanceof ImageBitmap)&&HV(r)&&!UV(r)}function KV(r,e){return e===void 0&&(e=3),Ye(this,void 0,void 0,function(){var t,n;return Ze(this,function(a){switch(a.label){case 0:if(t=null,!(kt().getBool("WRAP_TO_IMAGEBITMAP")&&qV(r)))return[3,5];n=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,createImageBitmap(r,{premultiplyAlpha:"none"})];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),n=null,[3,4];case 4:return n!=null&&n.width===r.width&&n.height===r.height?t=n:t=r,[3,6];case 5:t=r,a.label=6;case 6:return[2,CT(t,e)]}})})}function jV(r,e){return Ye(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h,p,d,v,m,g;return Ze(this,function(y){switch(y.label){case 0:if(t=V(r,"img","toPixels"),r instanceof zr||(n=t,t=Ar(n,"int32"),n.dispose()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(a=qe(t.shape.slice(0,2),2),i=a[0],o=a[1],s=t.rank===2?1:t.shape[2],s>4||s===2)throw new Error("toPixels only supports depth of size "+("1, 3 or 4 but got "+s));if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");return[4,t.data()];case 1:for(u=y.sent(),l=t.dtype==="float32"?255:1,c=new Uint8ClampedArray(o*i*4),f=0;f<i*o;++f){for(h=[0,0,0,255],p=0;p<s;p++){if(d=u[f*s+p],t.dtype==="float32"){if(d<0||d>1)throw new Error("Tensor values for a float32 Tensor must be in the "+("range [0 - 1] but encountered "+d+"."))}else if(t.dtype==="int32"&&(d<0||d>255))throw new Error("Tensor values for a int32 Tensor must be in the "+("range [0 - 255] but encountered "+d+"."));s===1?(h[0]=d*l,h[1]=d*l,h[2]=d*l):h[p]=d*l}v=f*4,c[v+0]=Math.round(h[0]),c[v+1]=Math.round(h[1]),c[v+2]=Math.round(h[2]),c[v+3]=Math.round(h[3])}return e!=null&&(e.width=o,e.height=i,m=e.getContext("2d"),g=new ImageData(c,o,i),m.putImageData(g,0,0)),t!==r&&t.dispose(),[2,c]}})})}var XV=re({fromPixels_:CT}),YV={__proto__:null,fromPixelsAsync:KV,toPixels:jV,fromPixels:XV};function AT(r,e){var t=r.shape.length,n=e.shape.length;if(t<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+(" but the rank was "+t+"."));if(n<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+(" but the rank was "+n+"."));if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type,"+(" but the dtype was "+e.dtype+"."));if(e.shape[n-1]>t)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+(e.shape[n-1]+" vs. "+t));if(rr(r.shape)===0)throw new Error("Requested more than 0 entries, but input is empty."+(" Input shape: "+r.shape+"."));for(var a=e.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=r.shape,l=a.slice();l.pop();for(var c=1,s=i;s<t;++s)c*=u[s],l.push(u[s]);var f=Rt(Ju(r.shape).map(function(h){return h/c}),[1]).slice(0,i);return[l,o,c,f]}var ZV={__proto__:null,prepareAndValidate:AT};function qg(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+("shape[sliceDim:], got updates.shape: "+t.shape)+(", indices.shape: "+e.shape+", shape: "+r)+(", sliceDim: "+n+", and batchDim: "+a+".");if(t.rank<a)throw new Error(i+(" update.rank < "+a+". "));if(r.length<n+(t.rank-a))throw new Error(i+(" Output shape length < "+(n+(t.rank-a))));if(t.rank!==a+r.length-n)throw new Error(i+(" update.rank != "+(a+r.length-n)));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+(" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+(" updates.shape["+(o+a)+"] ("+t.shape[o+a]+") != shape["+(o+a)+"] ("+r[o+a]+")"))}function Kg(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+(" but the rank was "+e.rank+"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+(" but the rank was "+r.rank+"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}qg(t,e,r)}function _T(r,e,t){for(var n=e.shape.length,a=n>1?e.shape[n-1]:1,i=t.length,o=1,s=a;s<i;++s)o*=t[s];var u=a<1?1:a,l=rr(e.shape)/u,c=Rt(Ju(t.slice(0,a)),[1]),f=rr(t);return{sliceRank:a,numUpdates:l,sliceSize:o,strides:c,outputSize:f}}var QV={__proto__:null,validateUpdateShape:qg,validateInput:Kg,calculateShapes:_T},Sg=-2,JV=-1;function eU(r,e,t){var n=r.shape.length;X(n===e.length,function(){return"Error in slice"+n+"D: Length of begin "+e+" must "+("match the rank of the array ("+n+").")}),X(n===t.length,function(){return"Error in slice"+n+"D: Length of size "+t+" must "+("match the rank of the array ("+n+").")});for(var a=function(o){X(e[o]+t[o]<=r.shape[o],function(){return"Error in slice"+n+"D: begin["+o+"] + size["+o+"] "+("("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+r.shape[o]+")")})},i=0;i<n;++i)a(i)}function tU(r){for(var e=[],t=0;r>0;)r&1&&e.push(t),r/=2,t++;return e}function rU(r,e,t){for(var n=[],a=0;a<r.length;a++)n[a]=Math.ceil((e[a]-r[a])/t[a]);return n}function DT(r,e,t,n){for(var a=Rt(r),i=a.length;i<n.length;i++)a.push(1);for(var i=0;i<t;i++)i===0?a[e]=1:(a.splice(e,0,1),a.pop());return a}function FT(r,e,t){return t<=r?t:t-(e-1)}function RT(r,e){for(var t=[],n=0;n<r;n++)t.push(e+n);return t}function nU(r,e,t,n,a,i,o,s,u){var l=r.length,c=new Array(l),f=new Array(l),h=new Array(l);if(e.length&&t>0){var p=e[0],d=t+1;c=MT(o,p,d,n,r),f=OT(s,p,d,a,r),h=DT(i,p,d,r)}else for(var v=0;v<l;v++)c[v]=LT(o,n,i,r,v,u),f[v]=BT(s,a,i,r,v,u),h[v]=PT(i,v,u);return{begin:c,end:f,strides:h}}function MT(r,e,t,n,a){for(var i=Rt(a),o=RT(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=FT(e,t,s),l=n[u];r&1<<u&&(l=0),i[s]=l}return i}function OT(r,e,t,n,a){for(var i=Rt(a),o=RT(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=FT(e,t,s),l=n[u];r&1<<u&&(l=Number.MAX_SAFE_INTEGER),i[s]=l}for(var c=0;c<i.length;c++){var f=a[c];i[c]<0&&(i[c]+=f),i[c]=Wc(0,i[c],a[c])}return i}function PT(r,e,t){var n=r[e];return(t&1<<e||n==null)&&(n=1),n}function LT(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),o=Wc(0,o,u-1),o}function BT(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),s>0?o=Wc(0,o,u):o=Wc(-1,o,u-1),o}function aU(r,e,t){for(var n=t.length,a=0;a<t.length;a++)if(t[a]>1){n=a;break}for(var a=n+1;a<t.length;a++)if(e[a]>0||t[a]!==r[a])return!1;return!0}function iU(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function oU(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=Rt([e],new Array(a-1).fill(0)):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){X(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=Rt([t],new Array(a-1).fill(-1)):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(X(o===-1,function(){return"Negative size values should be exactly -1 but got "+(o+" for the slice() size at index "+s+".")}),r.shape[s]-n[s])}),[n,i]}function sU(r,e,t,n,a,i,o,s,u){var l;if(n==null?(l=new Array(e.length),l.fill(1)):l=n,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");for(var c=!1,f={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:l.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<f.dims;h++)c&&(1<<h&s)!==0&&f.numAddAxisAfterEllipsis++,1<<h&o&&(c=!0);c||(f.ellipsisMask|=1<<f.dims,f.dims++);var p={dims:r.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};uU(f,p);for(var d=!0,v=!0,m=!0,g=[],y=[],h=0;h<r.length;++h){if(p.strides[h]===0)throw Error("strides["+h+"] must be non-zero");var b=!!(p.shrinkAxisMask&1<<h),w=r[h];if(w===-1){g.push(b?1:-1);continue}var k=[p.beginMask&1<<h,p.endMask&1<<h],S=[p.strides[h]>0?0:-1,p.strides[h]>0?w:w-1];if(b&&p.strides[h]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&p.strides[h]===1;var E=!!(p.beginMask&1<<h&&p.endMask&1<<h);if(p.beginValid&&p.endValid){if(b){var N=p.begin[h]<0?w+p.begin[h]:p.begin[h];if(p.begin[h]=N,p.end[h]=p.begin[h]+1,N<0||N>=w)throw Error("slice index "+p.begin[h]+" of dimension "+h+" out of bounds.")}else p.begin[h]=Hk(p.begin[h],0,p.strides[h],w,k,S),p.end[h]=Hk(p.end[h],1,p.strides[h],w,k,S);var C=p.strides[h]===1&&p.begin[h]===0&&p.end[h]===w;d=d&&C,v=v&&(h===0&&p.strides[h]===1||C)}else d=d&&p.strides[h]===1&&E,v=v&&(h===0&&p.strides[h]===1||E);var R=void 0,_=!1;if(p.beginValid&&p.endValid?(R=p.end[h]-p.begin[h],_=!0):b?(R=1,_=!0):E&&w>=0&&(p.strides[h]<0?R=-w:R=w,_=!0),_){var O=void 0;R===0||R<0!=p.strides[h]<0?O=0:O=Math.trunc(R/p.strides[h])+(R%p.strides[h]!==0?1:0),g.push(O)}else g.push(-1)}for(var P=0;P<p.finalShapeGatherIndices.length;++P){var B=p.finalShapeGatherIndices[P];B>=0?y.push(g[B]):B===Sg&&y.push(1)}var W=y.filter(function(L,G){return p.finalShapeGatherIndices[G]!==Sg});return{finalShapeSparse:W,finalShape:y,isIdentity:d,sliceDim0:v,isSimpleSlice:m,begin:p.begin,end:p.end,strides:p.strides}}function uU(r,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;var t=0;e.beginValid=r.begin!=null,e.endValid=r.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(var n=0;n<r.dims;n++)if(1<<n&r.ellipsisMask)for(var a=Math.min(e.dims-(r.dims-n)+1+r.numAddAxisAfterEllipsis,e.dims);t<a;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=n;else if(1<<n&r.newAxisMask)e.finalShapeGatherIndices.push(Sg),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error("Index out of range using input dim "+t+"; input "+("has only "+e.dims+" dims, "+e.begin.length+"."));r.begin!=null&&(e.begin[t]=r.begin[n]),r.end!=null&&(e.end[t]=r.end[n]),e.strides[t]=r.strides[n],r.beginMask&1<<n&&(e.beginMask|=1<<t),r.endMask&1<<n&&(e.endMask|=1<<t),r.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(JV),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[t]=n,t++}}function Hk(r,e,t,n,a,i){if(a[e])return t>0?i[e]:i[e+1&1];var o=r<0?n+r:r;return o<i[0]?i[0]:o>i[1]?i[1]:o}var zT={__proto__:null,assertParamsValid:eU,maskToAxes:tU,computeOutShape:rU,stridesWithElidedDims:DT,getNormalizedAxes:nU,startIndicesWithElidedDims:MT,stopIndicesWithElidedDims:OT,stridesForAxis:PT,startForAxis:LT,stopForAxis:BT,isSliceContinous:aU,computeFlatOffset:iU,parseSliceParams:oU,sliceInfo:sU};var $T=(function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r})(),WT=(function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r})();function Lo(r){X(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),X(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),X(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),WT.register(r)}var lU={__proto__:null,Serializable:$T,SerializationMap:WT,registerClass:Lo},cU=.001,VT=.1;function fU(r,e,t){return t==null&&(t=jg()),Eg(r,e,function(n,a){return Xg(n,a,t)})}function jg(){return ne.backend.floatPrecision()===32?cU:VT}function Eg(r,e,t){var n=!0;if((fn(r)||fn(e))&&(n=!1),fn(r)&&fn(e)&&(n=!0),n){var a=r.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: "+a+". "+("Expected: "+i))}if(Array.isArray(r)&&Array.isArray(e)){var o=Di(r),s=Di(e);if(!Oo(o,s))throw new Error("Arrays have different shapes. "+("Actual: ["+o+"]. Expected: ["+s+"]"))}var u=fn(r)?r:xs(r),l=fn(e)?e:xs(e);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs "+("expected: "+l.length+`.
`)+("Actual:   "+u+`.
`)+("Expected: "+l+"."));for(var c=0;c<l.length;++c){var f=u[c],h=l[c];if(!t(f,h))throw new Error("Arrays differ: actual["+c+"] = "+f+", expected["+c+"] = "+h+`.
`+("Actual:   "+u+`.
`)+("Expected: "+l+"."))}typeof expect<"u"&&expect().nothing()}function hU(r,e){r().then(function(){return e.fail()},function(){return e()}),typeof expect<"u"&&expect().nothing()}function pU(r,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Ao(r)||Ao(r[0])||Ao(e)||Ao(e[0])?Eg(r,t,function(n,a){return n==a}):Eg(r,e,function(n,a){return Xg(n,a,0)})}function dU(r,e,t){if(t==null&&(t=jg()),!Xg(r,e,t))throw new Error("Numbers differ: actual === "+r+", expected === "+e);typeof expect<"u"&&expect().nothing()}function Xg(r,e,t){return!isFinite(r)&&!isFinite(e)?!0:!(isNaN(r)||isNaN(e)||Math.abs(r-e)>t)}function vU(r,e,t){for(var n=0;n<r.length;n++)if(r[n]<e||r[n]>t)throw new Error("Value out of range:"+r[n]+" low: "+e+", high: "+t)}function mU(r,e){var t=new Float32Array(r),n=new Float32Array(e);if(t.length!==n.length)throw new Error("Expected ArrayBuffer to be of length "+(n.length+", but it was "+t.length));for(var a=0;a<n.length;a++)if(t[a]!==n[a])throw new Error("Expected ArrayBuffer value at "+a+" to be "+(n[a]+" but got "+t[a]+" instead"))}function UT(r){for(var e=0;e<r.length;e++){var t=r[e];Array.isArray(t)?UT(t):r[e]=tf(t)}return r}function gU(r){var e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(r),new Promise(function(t){e.addEventListener("loadeddata",function(n){return t(e)}),e.load()})}function yU(r){return Ye(this,void 0,void 0,function(){return Ze(this,function(e){switch(e.label){case 0:return[4,r.play()];case 1:return e.sent(),"requestVideoFrameCallback"in r?[4,new Promise(function(t){r.requestVideoFrameCallback(t)})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}var bU={__proto__:null,TEST_EPSILON_FLOAT16:VT,expectArraysClose:fU,testEpsilon:jg,expectPromiseToFail:hU,expectArraysEqual:pU,expectNumbersClose:dU,expectValuesInRange:vU,expectArrayBuffersEqual:mU,encodeStrings:UT,createVideoElement:gU,play:yU};var wU="3.21.0";function xU(r,e){var t,n=V(r,"a","add"),a=V(e,"b","add");t=qe(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(Fg,i)}var ht=re({add_:xU});function kU(r,e){var t,n=V(r,"a","floorDiv"),a=V(e,"b","floorDiv");t=qe(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(uS,i)}var GT=re({floorDiv_:kU});function SU(r,e){var t,n=V(r,"a","div"),a=V(e,"b","div");if(t=qe(Er(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return GT(n,a);var i={a:n,b:a},o={};return ne.runKernel(Y2,i,o)}var tr=re({div_:SU});function EU(r,e){var t,n=V(r,"a","mul"),a=V(e,"b","mul");t=qe(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel($S,i)}var Oe=re({mul_:EU});function TU(r){var e=V(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return ne.runKernel(D2,t)}else{var t={x:e};return ne.runKernel(l2,t)}}var va=re({abs_:TU});function IU(r){var e=V(r,"x","acos"),t={x:e};return ne.runKernel(c2,t)}var NU=re({acos_:IU});function CU(r){var e=V(r,"x","acosh"),t={x:e};return ne.runKernel(f2,t)}var AU=re({acosh_:CU});function _U(r){X(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),X(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+(""+r.length)});var e=r.map(function(a,i){return V(a,"tensors"+i,"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!Oo(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return ne.runKernel(h2,n)}var DU=re({addN_:_U});function FU(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=V(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return ne.runKernel(p2,a,i)}var RU=re({all_:FU});function MU(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=V(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return ne.runKernel(d2,a,i)}var OU=re({any_:MU});function PU(r,e){e===void 0&&(e=0);var t=V(r,"x","argMax"),n={x:t},a={axis:e};return ne.runKernel(v2,n,a)}var LU=re({argMax_:PU});function BU(r,e){e===void 0&&(e=0);var t=V(r,"x","argMin"),n={x:t},a={axis:e};return ne.runKernel(m2,n,a)}var zU=re({argMin_:BU});function $U(r){var e=V(r,"x","asin"),t={x:e};return ne.runKernel(g2,t)}var WU=re({asin_:$U});function VU(r){var e=V(r,"x","asinh"),t={x:e};return ne.runKernel(y2,t)}var UU=re({asinh_:VU});function GU(r){var e=V(r,"x","atan"),t={x:e};return ne.runKernel(b2,t)}var HU=re({atan_:GU});function qU(r,e){var t,n=V(r,"a","atan2"),a=V(e,"b","atan2");t=qe(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(x2,i)}var KU=re({atan2_:qU});function jU(r){var e=V(r,"x","atanh"),t={x:e};return ne.runKernel(w2,t)}var XU=re({atanh_:jU});function YU(r,e,t,n,a,i){a===void 0&&(a="NHWC");var o=r[3],s=Rt(e,[o]),u=KT(a);return nf(r,s,t,i,n,null,null,u)}function HT(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=qe(Fp(e),2),u=s[0],l=s[1],c;if(o==="channelsLast")c=[u,l,r[3],r[3]];else if(o==="channelsFirst")c=[u,l,r[1],r[1]];else throw new Error("Unknown dataFormat "+o);return nf(r,c,t,n,a,i,!1,o)}function ZU(r,e,t,n,a,i,o){o===void 0&&(o="NDHWC");var s=qe(Tg(e),3),u=s[0],l=s[1],c=s[2],f,h;if(o==="NDHWC")h="channelsLast",f=[u,l,c,r[4],r[4]];else if(o==="NCDHW")h="channelsFirst",f=[u,l,c,r[1],r[1]];else throw new Error("Unknown dataFormat "+o);return qT(r,f,t,n,a,!1,h,i)}function nf(r,e,t,n,a,i,o,s){var u,l;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var c=qe([-1,-1,-1,-1],4),f=c[0],h=c[1],p=c[2],d=c[3];if(s==="channelsLast")u=qe(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")l=qe(r,4),f=l[0],d=l[1],h=l[2],p=l[3];else throw new Error("Unknown dataFormat "+s);var v=qe(e,4),m=v[0],g=v[1],y=v[3],b=qe(Fp(t),2),w=b[0],k=b[1],S=qe(Fp(n),2),E=S[0],N=S[1],C=Hu(m,E),R=Hu(g,N),_=eG(a,h,p,w,k,C,R,i,s),O=_.padInfo,P=_.outHeight,B=_.outWidth,W=o?y*d:y,L;return s==="channelsFirst"?L=[f,W,P,B]:s==="channelsLast"&&(L=[f,P,B,W]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:P,outWidth:B,outChannels:W,padInfo:O,strideHeight:w,strideWidth:k,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:E,dilationWidth:N,inShape:r,outShape:L,filterShape:e}}function qT(r,e,t,n,a,i,o,s){var u,l;i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var c=qe([-1,-1,-1,-1,-1],5),f=c[0],h=c[1],p=c[2],d=c[3],v=c[4];if(o==="channelsLast")u=qe(r,5),f=u[0],h=u[1],p=u[2],d=u[3],v=u[4];else if(o==="channelsFirst")l=qe(r,5),f=l[0],v=l[1],h=l[2],p=l[3],d=l[4];else throw new Error("Unknown dataFormat "+o);var m=qe(e,5),g=m[0],y=m[1],b=m[2],w=m[4],k=qe(Tg(t),3),S=k[0],E=k[1],N=k[2],C=qe(Tg(n),3),R=C[0],_=C[1],O=C[2],P=Hu(g,R),B=Hu(y,_),W=Hu(b,O),L=tG(a,h,p,d,S,E,N,P,B,W,s),G=L.padInfo,M=L.outDepth,$=L.outHeight,K=L.outWidth,j=i?w*v:w,te;return o==="channelsFirst"?te=[f,j,M,$,K]:o==="channelsLast"&&(te=[f,M,$,K,j]),{batchSize:f,dataFormat:o,inDepth:h,inHeight:p,inWidth:d,inChannels:v,outDepth:M,outHeight:$,outWidth:K,outChannels:j,padInfo:G,strideDepth:S,strideHeight:E,strideWidth:N,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:P,effectiveFilterHeight:B,effectiveFilterWidth:W,dilationDepth:R,dilationHeight:_,dilationWidth:O,inShape:r,outShape:te,filterShape:e}}function QU(r,e,t,n,a){n==null&&(n=Yg(r,e,t));var i=r[0],o=r[1],s=ws((i-e+2*n)/t+1,a),u=ws((o-e+2*n)/t+1,a);return[s,u]}function JU(r,e,t,n,a,i){a==null&&(a=Yg(r,e,n));var o=r[0],s=r[1],u=r[2],l=ws((o-e+2*a)/n+1,i),c=ws((s-e+2*a)/n+1,i),f=ws((u-e+2*a)/n+1,i);return[l,c,f,t]}function Yg(r,e,t,n){n===void 0&&(n=1);var a=Hu(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Fp(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Tg(r){return typeof r=="number"?[r,r,r]:r}function Hu(r,e){return e<=1?r:r+(r-1)*(e-1)}function eG(r,e,t,n,a,i,o,s,u){var l,c,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";l={top:r,bottom:r,left:r,right:r,type:h};var p=QU([e,t],i,n,r,s);c=p[0],f=p[1]}else if(r==="same"){c=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(c-1)*n+i-e),v=Math.max(0,(f-1)*a+o-t),m=Math.floor(d/2),g=d-m,y=Math.floor(v/2),b=v-y;l={top:m,bottom:g,left:y,right:b,type:"SAME"}}else if(r==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var m=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],b=u==="channelsLast"?r[2][1]:r[3][1],h=m===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";l={top:m,bottom:g,left:y,right:b,type:h},c=ws((e-i+m+g)/n+1,s),f=ws((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: "+r);return{padInfo:l,outHeight:c,outWidth:f}}function tG(r,e,t,n,a,i,o,s,u,l,c){var f,h,p,d;if(typeof r=="number"){var v=r===0?"VALID":"NUMBER";f={top:r,bottom:r,left:r,right:r,front:r,back:r,type:v};var m=JU([e,t,n,1],s,1,a,r,c);h=m[0],p=m[1],d=m[2]}else if(r==="same"){h=Math.ceil(e/a),p=Math.ceil(t/i),d=Math.ceil(n/o);var g=(h-1)*a+s-e,y=(p-1)*i+u-t,b=(d-1)*o+l-n,w=Math.floor(g/2),k=g-w,S=Math.floor(y/2),E=y-S,N=Math.floor(b/2),C=b-N;f={top:S,bottom:E,left:N,right:C,front:w,back:k,type:"SAME"}}else if(r==="valid")f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-s+1)/a),p=Math.ceil((t-u+1)/i),d=Math.ceil((n-l+1)/o);else throw Error("Unknown padding parameter: "+r);return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}function ws(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function Kc(r){var e=qe(Fp(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function no(r,e){return Kc(r)||Kc(e)}function KT(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function Ma(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+"."));if(typeof e=="number")X(ju(e),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){X(ju(a),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+a+".")})})});else throw Error("Error in "+r+": Unknown padding parameter: "+e)}}function rG(r,e){var t=V(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return ne.runKernel(iE,n,a)}var Te=re({reshape_:rG});function nG(r,e,t,n,a){var i=V(r,"x","avgPool","float32"),o=1;X(no(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=Te(i,[1,i.shape[0],i.shape[1],i.shape[2]])),X(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),Ma("avgPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ne.runKernel(k2,l,c);return f=Ar(f,i.dtype),u?Te(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var jT=re({avgPool_:nG});function aG(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=V(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=Te(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),X(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."}),X(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Ma("avgPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=ne.runKernel(S2,l,c);return f=Ar(f,s.dtype),u?Te(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var iG=re({avgPool3d_:aG});function oG(r,e){e===void 0&&(e=0),X(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Hc(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+i.dtype+". ")}),t.length===1)return bs(t[0]);var n=t,a={axis:e};return ne.runKernel(F2,n,a)}var Un=re({concat_:oG});function sG(r){var e=V(r,"x","sigmoid","float32"),t={x:e};return ne.runKernel(wE,t)}var qu=re({sigmoid_:sG});function uG(r,e,t){var n=V(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return ne.runKernel(mE,a,i)}var yr=re({slice_:uG});function lG(r){var e=V(r,"x","tanh","float32"),t={x:e};return ne.runKernel(zE,t)}var Ig=re({tanh_:lG});function cG(r,e,t,n,a,i){var o=V(r,"forgetBias","basicLSTMCell"),s=V(e,"lstmKernel","basicLSTMCell"),u=V(t,"lstmBias","basicLSTMCell"),l=V(n,"data","basicLSTMCell"),c=V(a,"c","basicLSTMCell"),f=V(i,"h","basicLSTMCell"),h=Un([l,f],1),p=Pt(h,s),d=ht(p,u),v=d.shape[0],m=d.shape[1]/4,g=[v,m],y=yr(d,[0,0],g),b=yr(d,[0,m],g),w=yr(d,[0,m*2],g),k=yr(d,[0,m*3],g),S=ht(Oe(qu(y),Ig(b)),Oe(c,qu(ht(o,w)))),E=Oe(Ig(S),qu(k));return[S,E]}var fG=re({basicLSTMCell_:cG});function hG(r,e,t){var n=V(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});X(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),X(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),X(n.shape[0]%a===0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of "+("the elements of blockShape "+e.join(" * ")+" === "+a)});var i={x:n},o={blockShape:e,crops:t};return ne.runKernel(T2,i,o)}var XT=re({batchToSpaceND_:hG});function pG(r){var e;return r.rank===0||r.rank===1?e=Te(r,[1,1,1,r.size]):r.rank===2?e=Te(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=Te(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function dG(r,e,t,n,a,i){i==null&&(i=.001);var o=V(r,"x","batchNorm"),s=V(e,"mean","batchNorm"),u=V(t,"variance","batchNorm"),l;a!=null&&(l=V(a,"scale","batchNorm"));var c;n!=null&&(c=V(n,"offset","batchNorm")),X(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),X(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),X(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=pG(o),h={x:f,scale:l,offset:c,mean:s,variance:u},p={varianceEpsilon:i},d=ne.runKernel(lS,h,p);return Te(d,o.shape)}var Wp=re({batchNorm_:dG});function vG(r,e,t,n,a,i){var o=V(r,"x","batchNorm"),s=V(e,"mean","batchNorm"),u=V(t,"variance","batchNorm"),l;a!=null&&(l=V(a,"scale","batchNorm"));var c;return n!=null&&(c=V(n,"offset","batchNorm")),X(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+(o.rank+".")}),X(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+("got rank "+s.rank+".")}),X(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&X(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&X(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+("but got rank "+c.rank+".")}),Wp(o,s,u,c,l,i)}var mG=re({batchNorm2d_:vG});function gG(r,e,t,n,a,i){var o=V(r,"x","batchNorm"),s=V(e,"mean","batchNorm"),u=V(t,"variance","batchNorm"),l;a!=null&&(l=V(a,"scale","batchNorm"));var c;return n!=null&&(c=V(n,"offset","batchNorm")),X(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+(o.rank+".")}),X(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+("got rank "+s.rank+".")}),X(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&X(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&X(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+("but got rank "+c.rank+".")}),Wp(o,s,u,c,l,i)}var yG=re({batchNorm3d_:gG});function bG(r,e,t,n,a,i){var o=V(r,"x","batchNorm"),s=V(e,"mean","batchNorm"),u=V(t,"variance","batchNorm"),l;a!=null&&(l=V(a,"scale","batchNorm"));var c;return n!=null&&(c=V(n,"offset","batchNorm")),X(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+(o.rank+".")}),X(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+("got rank "+s.rank+".")}),X(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&X(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&X(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+("but got rank "+c.rank+".")}),Wp(o,s,u,c,l,i)}var wG=re({batchNorm4d_:bG});function xG(r,e,t){var n=V(r,"x","bincount"),a=V(e,"weights","bincount");X(n.dtype==="int32",function(){return"Error in bincount: input "+("dtype must be int32, but got "+n.dtype)}),X(t>=0,function(){return"size must be non-negative, but got "+t+"."}),X(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+("0-length, but got input shape: "+n.shape+", weights shape: ")+(a.shape+".")});var i={x:n,weights:a},o={size:t};return ne.runKernel(I2,i,o)}var YT=re({bincount_:xG});function kG(r,e){var t=V(r,"s0","broadcastArgs","int32"),n=V(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+("Has rank "+t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+("Has rank "+n.rank));var a={s0:t,s1:n};return ne.runKernel(N2,a)}var SG=re({broadcastArgs_:kG});function EG(r,e){var t=V(r,"broadcastTo","x"),n=t.shape;if(e.some(function(f){return!(f>0)||f%1!==0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Te(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return bs(t);var l={x:t},c={reps:o};return ne.runKernel(Og,l,c)}var xp=re({broadcastTo_:EG});function TG(r){var e=V(r,"x","ceil","float32"),t={x:e};return ne.runKernel(C2,t)}var IG=re({ceil_:TG});function af(r,e,t){var n={shape:r,value:e,dtype:t};return ne.runKernel(iS,{},n)}function NG(r,e,t){var n=V(r,"x","clipByValue");if(X(e<=t,function(){return"Error in clip: min ("+e+") must be "+("less than or equal to max ("+t+").")}),e===t)return af(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return ne.runKernel(A2,a,i)}var CG=re({clipByValue_:NG});function AG(r){return Un(r,0)}var _G=re({concat1d_:AG});function DG(r,e){return Un(r,e)}var FG=re({concat2d_:DG});function RG(r,e){return Un(r,e)}var MG=re({concat3d_:RG});function OG(r,e){return Un(r,e)}var PG=re({concat4d_:OG});function LG(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=V(r,"x","conv2d","float32"),u=V(e,"filter","conv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=Te(s,[1,s.shape[0],s.shape[1],s.shape[2]])),X(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),X(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+(u.rank+".")}),Ma("conv2d",n,o);var f=a==="NHWC"?l.shape[3]:l.shape[1];X(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match "+("input depth for filter "+u.shape[2]+".")}),X(no(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")});var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ne.runKernel(R2,h,p);return c?Te(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Vp=re({conv2d_:LG});function BG(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=V(r,"x","conv1d"),u=V(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=Te(s,[1,s.shape[0],s.shape[1]])),X(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),X(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+(u.rank+".")}),Ma("conv1d",n,o),X(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match "+("input depth for filter "+u.shape[1]+".")}),X(no(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+("Got stride "+t+" and dilation '"+i+"'")}),X(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var f=Te(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=Te(l,[l.shape[0],1,l.shape[1],l.shape[2]]),p=[1,t],d=[1,i],v="NHWC",m=Vp(h,f,p,n,v,d,o);return c?Te(m,[m.shape[2],m.shape[3]]):Te(m,[m.shape[0],m.shape[2],m.shape[3]])}var zG=re({conv1d_:BG});function $G(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),X(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var s=r,u=e,l=!1;e.rank===3&&(l=!0,u=Te(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),X(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+(s.length+".")}),X(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+("rank "+u.rank)}),X(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+("rank "+t.rank)});var c=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];X(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must "+("match input depth for filter "+t.shape[2]+".")}),X(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must "+("match output depth for filter "+t.shape[3]+".")}),Ma("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ne.runKernel(O2,h,p);return l?Te(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var ZT=re({conv2DBackpropInput_:$G});function WG(r,e,t,n,a,i){var o=V(r,"x","conv2dTranspose"),s=V(e,"filter","conv2dTranspose");return ZT(t,o,s,n,a,"NHWC",i)}var VG=re({conv2dTranspose_:WG});function UG(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=V(r,"x","conv3d"),s=V(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=Te(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),X(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),X(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+(s.rank+".")}),X(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match "+("input depth for filter "+s.shape[3]+".")}),X(no(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")}),X(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var c={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=ne.runKernel(P2,c,f);return l?Te(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var GG=re({conv3d_:UG});function HG(r,e,t,n,a){X(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=Te(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],l=o.shape[4];X(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+(i.length+".")}),X(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+("rank "+o.rank)}),X(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+("rank "+t.rank)}),X(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must "+("match input depth for filter "+t.shape[3]+".")}),X(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must "+("match output depth for filter "+t.shape[4]+".")});var c={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ne.runKernel(L2,c,f);return s?Te(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var qG=re({conv3DBackpropInput_:HG});function KG(r,e,t,n,a){var i=V(r,"x","conv3dTranspose"),o=V(e,"filter","conv3dTranspose");return qG(t,i,o,n,a)}var jG=re({conv3dTranspose_:KG});function XG(r){var e=V(r,"x","cos","float32"),t={x:e};return ne.runKernel(B2,t)}var YG=re({cos_:XG});function ZG(r){var e=V(r,"x","cosh","float32"),t={x:e};return ne.runKernel(z2,t)}var QG=re({cosh_:ZG});function JG(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=V(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ne.runKernel($2,i,o)}var eH=re({cumprod_:JG});function tH(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=V(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ne.runKernel(W2,i,o)}var rH=re({cumsum_:tH});function nH(r,e,t,n){n===void 0&&(n=!1);var a=V(r,"x","denseBincount"),i=V(e,"weights","denseBincount");X(a.dtype==="int32",function(){return"Error in denseBincount: input "+("dtype must be int32, but got "+a.dtype)}),X(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+("rank "+a.rank+".")}),X(t>=0,function(){return"size must be non-negative, but got "+t+"."}),X(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+("0-length, but got x shape: "+a.shape+", weights shape: ")+(i.shape+".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return ne.runKernel(U2,o,s)}var aH=re({denseBincount_:nH});function iH(r,e,t){t===void 0&&(t="NHWC");var n=V(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];X(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}),X(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+a+" and "+e+`  for depthToSpace with input shape
    `+n.shape}),X(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+i+" and "+e+` for depthToSpace with input shape
        `+n.shape}),X(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+n.shape});var s={x:n},u={blockSize:e,dataFormat:t};return ne.runKernel(G2,s,u)}var oH=re({depthToSpace_:iH});function sH(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=V(r,"x","depthwiseConv2d","float32"),u=V(e,"filter","depthwiseConv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=Te(s,[1,s.shape[0],s.shape[1],s.shape[2]])),X(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+("rank "+l.rank+".")}),X(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+(u.rank+".")});var f=a==="NHWC"?l.shape[3]:l.shape[1];X(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+("("+f+") must match the inChannels dimension in ")+("filter "+u.shape[2]+".")}),Ma("depthwiseConv2d",n,o);var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ne.runKernel(H2,h,p);return c?Te(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Zg=re({depthwiseConv2d_:sH});function uH(r){var e=V(r,"x","diag"),t={x:e};return ne.runKernel(j2,t)}var lH=re({diag_:uH});function cH(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=V(r,"x","dilation2d"),s=V(e,"filter","dilation2d");X(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+(o.rank+".")}),X(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+(s.rank+".")}),X(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+("but got dataFormat of "+i)});var u=o,l=!1;o.rank===3&&(u=Te(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);var c={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=ne.runKernel(X2,c,f);return l?Te(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var fH=re({dilation2d_:cH});function hH(r,e){var t,n=V(r,"a","equal","string_or_numeric"),a=V(e,"b","equal","string_or_numeric");t=qe(Er(n,a),2),n=t[0],a=t[1],Wr(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(eS,i)}var QT=re({equal_:hH});function pH(r,e,t){var n=V(e,"a","where"),a=V(t,"b","where"),i=V(r,"condition","where","bool"),o=Wr(Wr(i.shape,n.shape),a.shape),s=xp(i,o),u=xp(n,o),l=xp(a,o),c={condition:s,t:u,e:l};return ne.runKernel(dE,c)}var Zu=re({where_:pH});function dH(r){var e=V(r,"x","zerosLike"),t={x:e};return ne.runKernel(HE,t)}var ma=re({zerosLike_:dH});function vH(r,e){var t,n=V(r,"a","div"),a=V(e,"b","div");t=qe(Er(n,a),2),n=t[0],a=t[1];var i=tr(n,a),o=ma(i),s=QT(a,o);return Zu(s,o,i)}var mH=re({divNoNan_:vH});function gH(r,e){var t=V(r,"t1","dot"),n=V(e,"t2","dot");X((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+(t.rank+" and "+n.rank+".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(X(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+(a+" and "+i+".")}),t.rank===1&&n.rank===1){var o=Te(t,[1,-1]),s=Te(n,[-1,1]),u=Pt(o,s);return Te(u,[])}else if(t.rank===1&&n.rank===2){var o=Te(t,[1,-1]),s=Te(n,[n.shape[0],n.shape[1]]),u=Pt(o,s);return Te(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=Te(n,[-1,1]),u=Pt(t,s);return Te(u,[u.size])}else{var s=Te(n,[n.shape[0],n.shape[1]]),u=Pt(t,s);return u}}var yH=re({dot_:gH});function bH(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return V(i,"tensors"+o,"einsum")}),a={equation:r};return ne.runKernel(Z2,n,a)}var wH=re({einsum_:bH});function xH(r){var e=V(r,"x","elu","float32"),t={x:e};return ne.runKernel(Q2,t)}var JT=re({elu_:xH});function kH(r){var e=V(r,"x","erf");X(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=Ar(e,"float32"));var t={x:e};return ne.runKernel(J2,t)}var SH=re({erf_:kH});function Qg(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function eI(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function EH(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function of(r,e){var t=e.map(function(n){return 1});return eI(r,t,e)}function TH(r,e,t){X(Qg(e,t),function(){return r+" supports only inner-most axes for now. "+("Got axes "+e+" and rank-"+t+" input.")})}function IH(r,e){if(Qg(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function NH(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function CH(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function AH(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=V(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return ne.runKernel(AS,a,i)}var Ku=re({max_:AH});function _H(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=V(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return ne.runKernel(OS,a,i)}var Ng=re({min_:_H});function DH(r,e){var t,n=V(r,"base","pow"),a=V(e,"exp","pow");t=qe(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(YS,i)}var jc=re({pow_:DH});function Lt(r,e){if((fn(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&fn(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return Po(r,t,n,e)}function FH(r){var e=V(r,"x","sqrt","float32"),t={x:e};return ne.runKernel(kE,t)}var to=re({sqrt_:FH});function RH(r){var e=V(r,"x","square"),t={};return ne.runKernel("Square",{x:e},t)}var si=re({square_:RH});function MH(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=V(r,"x","sum");n.dtype==="bool"&&(n=Ar(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return ne.runKernel(SE,a,i)}var er=re({sum_:MH});function OH(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=V(r,"x","norm");var a=tI(r,e,t),i=a.shape;if(n){var o=Jc(t,r.shape);i=of(a.shape,o)}return Te(a,i)}function tI(r,e,t){if(t===void 0&&(t=null),r.rank===0)return va(r);if(r.rank!==1&&t===null)return tI(Te(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return er(va(r),t);if(e===1/0)return Ku(va(r),t);if(e===-1/0)return Ng(va(r),t);if(e==="euclidean"||e===2)return to(er(jc(va(r),Lt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&t.length===2){if(e===1)return Ku(er(va(r),t[0]),t[1]-1);if(e===1/0)return Ku(er(va(r),t[1]),t[0]);if(e===-1/0)return Ng(er(va(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return to(er(si(r),t));throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}var Up=re({norm_:OH});function PH(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),Up(r,"euclidean",e,t)}var LH=re({euclideanNorm_:PH});function BH(r){var e=V(r,"x","exp"),t={x:e};return ne.runKernel(tS,t)}var Es=re({exp_:BH});function zH(r,e){e===void 0&&(e=0);var t=V(r,"x","expandDims","string_or_numeric");X(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return ne.runKernel(rS,n,a)}var ds=re({expandDims_:zH});function $H(r){var e=V(r,"x","expm1"),t={x:e};return ne.runKernel(nS,t)}var WH=re({expm1_:$H});function VH(r,e){var t=V(r,"x","tile","string_or_numeric");X(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" "+("must match length of reps "+e+".")});var n={x:t},a={reps:e};return ne.runKernel(Og,n,a)}var zc=re({tile_:VH});function UH(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=eo([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=Te(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return zc(ds(s,0),[t[0],1,1]);if(t.length===2)return zc(ds(ds(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return zc(ds(ds(ds(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+("batchShapes, but received "+t.length+"D."))}var rI=re({eye_:UH});function GH(r){var e=V(r,"x","floor","float32"),t={x:e};return ne.runKernel(sS,t)}var nI=re({floor_:GH});function HH(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=V(r,"x","gather"),i=V(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ne.runKernel(cS,o,s)}var aI=re({gather_:HH});function qH(r,e){var t,n=V(r,"a","greater","string_or_numeric"),a=V(e,"b","greater","string_or_numeric");t=qe(Er(n,a),2),n=t[0],a=t[1],Wr(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(hS,i)}var Gp=re({greater_:qH});function KH(r,e){var t,n=V(r,"a","greaterEqual","string_or_numeric"),a=V(e,"b","greaterEqual","string_or_numeric");t=qe(Er(n,a),2),n=t[0],a=t[1],Wr(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(pS,i)}var iI=re({greaterEqual_:KH});function jH(r){var e=V(r,"x","isFinite"),t={x:e};return ne.runKernel(mS,t)}var XH=re({isFinite_:jH});function YH(r){var e=V(r,"x","isInf"),t={x:e};return ne.runKernel(gS,t)}var ZH=re({isInf_:YH});function QH(r){var e=V(r,"x","isNaN"),t={x:e};return ne.runKernel(yS,t)}var JH=re({isNaN_:QH});function eq(r,e){e===void 0&&(e=.2);var t=V(r,"x","leakyRelu"),n={x:t},a={alpha:e};return ne.runKernel(bS,n,a)}var oI=re({leakyRelu_:eq});function tq(r,e){var t,n=V(r,"a","less","string_or_numeric"),a=V(e,"b","less","string_or_numeric");t=qe(Er(n,a),2),n=t[0],a=t[1],Wr(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(wS,i)}var rq=re({less_:tq});function nq(r,e){var t,n=V(r,"a","lessEqual","string_or_numeric"),a=V(e,"b","lessEqual","string_or_numeric");t=qe(Er(n,a),2),n=t[0],a=t[1],Wr(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(xS,i)}var Jg=re({lessEqual_:nq});function aq(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return ne.runKernel(kS,{},n)}function iq(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=V(r,"x","localResponseNormalization");X(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),X(ju(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+("integer but got depthRadius "+e+".")});var o=i,s=!1;i.rank===3&&(s=!0,o=Te(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},l={depthRadius:e,bias:t,alpha:n,beta:a},c=ne.runKernel(CS,u,l);return s?Te(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var oq=re({localResponseNormalization_:iq});function sq(r){var e=V(r,"x","log","float32"),t={x:e};return ne.runKernel(SS,t)}var Xc=re({log_:sq});function uq(r){var e=V(r,"x","log1p"),t={x:e};return ne.runKernel(ES,t)}var sI=re({log1p_:uq});function lq(r){return X(Fo(r),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var n=V(e,"x","tf.grad","string_or_numeric"),a=t!=null?V(t,"dy","tf.grad"):null;return ne.tidy(function(){var i=ne.gradients(function(){return r(n)},[n],a),o=i.value,s=i.grads;return a!=null&&gn(o.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Hp(s),s[0]})}}function cq(r){return X(Fo(r),function(){return"The f passed in grads(f) must be a function"}),function(e,t){X(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=Hc(e,"args","tf.grads","string_or_numeric"),a=t!=null?V(t,"dy","tf.grads"):null;return ne.tidy(function(){var i=ne.gradients(function(){return r.apply(void 0,Rt(n))},n,a),o=i.value,s=i.grads;return a!=null&&gn(o.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Hp(s),s})}}function fq(r){return X(Fo(r),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){X(e instanceof zr,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),X(t==null||t instanceof zr,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=ne.gradients(function(){return r(e)},[e],t),a=n.grads,i=n.value;return Hp(a),{grad:a[0],value:i}}}function hq(r){return X(Fo(r),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){X(Array.isArray(e)&&e.every(function(a){return a instanceof zr}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),X(t==null||t instanceof zr,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=ne.gradients(function(){return r.apply(void 0,Rt(e))},e,t);return t!=null&&gn(n.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Hp(n.grads),n}}function uI(r,e){X(Fo(r),function(){return"The f passed in variableGrads(f) must be a function"}),X(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Gc}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in ne.registeredVariables)e.push(ne.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),X(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+("be trainable, but none of the "+i+" variables is ")+"trainable."});var o=!0,s=ne.gradients(r,e,null,o),u=s.value,l=s.grads;X(l.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),X(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+("returned a rank-"+u.rank+" tensor")});var c={};return e.forEach(function(f,h){l[h]!=null&&(c[f.name]=l[h])}),a?.forEach(function(f){return c[f.name]=null}),{value:u,grads:c}}function Fi(r){return ne.customGrad(r)}function Hp(r){var e=r.filter(function(t){return t==null}).length;if(e>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function pq(r){var e=V(r,"x","softplus"),t={x:e};return ne.runKernel(xE,t)}var lI=re({softplus_:pq});function dq(r){var e=V(r,"x","logSigmoid"),t=Fi(function(n){var a=Ji(lI(Ji(n))),i=function(o){var s=Oe(o,qu(Ji(n)));return s};return{value:a,gradFunc:i}});return t(e)}var vq=re({logSigmoid_:dq});function mq(r,e){var t,n=V(r,"a","sub"),a=V(e,"b","sub");t=qe(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(LE,i)}var Et=re({sub_:mq});function gq(r,e){e===void 0&&(e=-1);var t=V(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and axis was "+e));var n=Fi(function(a,i){var o=!0,s=Ku(a,e,!0),u=Et(a,s),l=Et(Ar(u,"float32"),Xc(er(Es(u),e,o)));i([l]);var c=function(f,h){var p=qe(h,1),d=p[0],v=!0,m=Es(d);return Et(f,Oe(er(f,e,v),m))};return{value:l,gradFunc:c}});return n(t)}var yq=re({logSoftmax_:gq});function bq(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=V(r,"x","logSumExp"),a=Jc(e,n.shape),i=Ku(n,a,!0),o=Et(n,i),s=Es(o),u=er(s,a),l=Xc(u),c=ht(Te(i,l.shape),l);if(t){var f=of(c.shape,a);return Te(c,f)}return c}var cI=re({logSumExp_:bq});function wq(r,e){var t=V(r,"a","logicalAnd","bool"),n=V(e,"b","logicalAnd","bool");Wr(t.shape,n.shape);var a={a:t,b:n};return ne.runKernel(TS,a)}var Rp=re({logicalAnd_:wq});function xq(r){var e=V(r,"x","logicalNot","bool"),t={x:e};return ne.runKernel(IS,t)}var fI=re({logicalNot_:xq});function kq(r,e){var t=V(r,"a","logicalOr","bool"),n=V(e,"b","logicalOr","bool");Wr(t.shape,n.shape);var a={a:t,b:n};return ne.runKernel(NS,a)}var hI=re({logicalOr_:kq});function Sq(r,e){var t=V(r,"a","logicalXor","bool"),n=V(e,"b","logicalXor","bool");return Wr(t.shape,n.shape),Rp(hI(r,e),fI(Rp(r,e)))}var Eq=re({logicalXor_:Sq});var gp=2147483648;function Tq(r,e,t){t===void 0&&(t="left");var n=V(r,"sortedSequence","searchSorted"),a=V(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=Te(n,[-1,i]),u=Te(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(rr(u.shape)>=gp)throw new Error("values tensor size must less than "+gp);if(s.shape[1]>=gp)throw new Error("trailing dim_size must less than "+gp+" for int32 output type, was "+s.shape[1]);var l={sortedSequence:s,values:u},c={side:t};return ne.runKernel(pE,l,c)}var ey=re({searchSorted_:Tq});function Iq(r,e){return ey(r,e,"left")}function Nq(r,e,t,n,a){var i=V(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=Te(i,[1,i.shape[0],i.shape[1],i.shape[2]])),X(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),X(no(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")}),Ma("maxPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ne.runKernel(DS,l,c);return u?Te(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var pI=re({maxPool_:Nq});function Cq(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=V(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=Te(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),X(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."}),X(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Ma("maxPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=ne.runKernel(FS,l,c);return u?Te(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Aq=re({maxPool3d_:Cq});function _q(r,e,t,n,a){a===void 0&&(a=!1);var i=V(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=ne.runKernel(RS,o,s);return{result:u[0],indexes:u[1]}}var Dq=re({maxPoolWithArgmax_:_q});function Fq(r,e){var t,n=V(r,"a","maximum"),a=V(e,"b","maximum");t=qe(Er(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Ar(n,"int32"),a=Ar(a,"int32")),Wr(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(_S,i)}var dI=re({maximum_:Fq});function Rq(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=V(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return ne.runKernel(MS,a,i)}var Mp=re({mean_:Rq});function Qu(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Qu(r,"float32"),n=Qu(r,"float32");return Ro(t,n)}var a=Lp(rr(r),e);return ne.makeTensor(a,r,e)}function ys(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=ys(r,"float32"),n=Qu(r,"float32");return Ro(t,n)}var a=Cg(rr(r),e);return ne.makeTensor(a,r,e)}function Mq(r,e,t){var n=(t===void 0?{}:t).indexing,a=n===void 0?"xy":n;if(a!=="xy"&&a!=="ij")throw new TypeError(a+" is not a valid third argument to meshgrid");if(r===void 0)return[];var i=V(r,"x","meshgrid",r instanceof zr?r.dtype:"float32");if(e===void 0)return[i];var o=V(e,"y","meshgrid",e instanceof zr?e.dtype:"float32"),s=rr(i.shape),u=rr(o.shape);return a==="xy"?(i=Te(i,[1,-1]),o=Te(o,[-1,1]),[Pt(ys([u,1],i.dtype),i),Pt(o,ys([1,s],o.dtype))]):(i=Te(i,[-1,1]),o=Te(o,[1,-1]),[Pt(i,ys([1,u],i.dtype)),Pt(ys([s,1],o.dtype),o)])}function Oq(r,e){var t,n=V(r,"a","minimum"),a=V(e,"b","minimum");t=qe(Er(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Ar(n,"int32"),a=Ar(a,"int32")),Wr(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(PS,i)}var vI=re({minimum_:Oq});function Pq(r,e,t){X(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+("Got "+t+".")});var n=V(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");X(e.length===n.rank,function(){return"Padding doesn't match input. Must be "+n.rank+". "+("Got "+e.length+".")});for(var a=t==="reflect"?1:0,i=function(l){X(e[l].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),X(e[l][0]>=0&&e[l][0]<=n.shape[l]-a&&e[l][1]>=0&&e[l][1]<=n.shape[l]-a,function(){return"Padding in dimension "+l+" cannot be greater than or equal "+("to "+(n.shape[l]-a)+" or less than 0 for input of ")+("shape "+n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return ne.runKernel(LS,u,s)}var Lq=re({mirrorPad_:Pq});function Bq(r,e){var t,n=V(r,"a","mod"),a=V(e,"b","mod");t=qe(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(BS,i)}var zq=re({mod_:Bq});function $q(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=V(r,"x","moments");var n=Jc(e,r.shape),a=Mp(r,n,t),i=a.shape;t||(i=of(a.shape,n));var o=si(Et(Ar(r,"float32"),Te(a,i))),s=Mp(o,n,t);return{mean:a,variance:s}}var Wq=re({moments_:$q});function Vq(r,e,t,n){for(var a=V(e,"data","multiRNNCell"),i=Hc(t,"c","multiRNNCell"),o=Hc(n,"h","multiRNNCell"),s=a,u=[],l=0;l<r.length;l++){var c=r[l](s,i[l],o[l]);u.push(c[0]),u.push(c[1]),s=c[1]}for(var f=[],h=[],l=0;l<u.length;l+=2)f.push(u[l]),h.push(u[l+1]);return[f,h]}var Uq=re({multiRNNCell_:Vq});function Gq(r,e,t,n){n===void 0&&(n=!1);var a=V(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+(i+"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var s=o===1?Te(a,[1,-1]):a,u={logits:s},l={numSamples:e,seed:t,normalized:n},c=ne.runKernel(zS,u,l);return o===1?Te(c,[c.size]):c}var Hq=re({multinomial_:Gq});function qq(r,e){var t,n=V(r,"a","notEqual","string_or_numeric"),a=V(e,"b","notEqual","string_or_numeric");t=qe(Er(n,a),2),n=t[0],a=t[1],Wr(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(VS,i)}var mI=re({notEqual_:qq});function Kq(r){var e=V(r,"x","onesLike"),t={x:e};return ne.runKernel(qS,t)}var jq=re({onesLike_:Kq});function Xq(r,e){var t=V(r,"v1","outerProduct"),n=V(e,"v2","outerProduct");X(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+(t.rank+" and "+n.rank+".")});var a=Te(t,[-1,1]),i=Te(n,[1,-1]);return Pt(a,i)}var Yq=re({outerProduct_:Xq});function Zq(r,e,t){t===void 0&&(t=0);var n=V(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return ne.runKernel(XS,i,a)}var sf=re({pad_:Zq});function Qq(r,e,t){return t===void 0&&(t=0),X(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),sf(r,[e],t)}var Jq=re({pad1d_:Qq});function e6(r,e,t){return t===void 0&&(t=0),X(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),sf(r,e,t)}var t6=re({pad2d_:e6});function r6(r,e,t){return t===void 0&&(t=0),X(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),sf(r,e,t)}var n6=re({pad3d_:r6});function a6(r,e,t){return t===void 0&&(t=0),X(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),sf(r,e,t)}var i6=re({pad4d_:a6});function o6(r,e,t){var n=V(r,"x","spaceToBatchND");X(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),X(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),X(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()});var a={x:n},i={blockShape:e,paddings:t};return ne.runKernel(EE,a,i)}var gI=re({spaceToBatchND_:o6});function s6(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=V(r,"x","maxPool"),u=s,l=!1;s.rank===3&&(l=!0,u=Te(s,[1,s.shape[0],s.shape[1],s.shape[2]])),X(no(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+("Got strides "+i+" and dilations '"+a+"'")});var c=HT(u.shape,e,i,a,n),f=[c.dilationHeight,c.dilationWidth],h;n==="same"?h=l6([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=qe(u6([c.inHeight,c.inWidth],f,h),2),v=d[0],m=d[1],g=p?n:"valid",y=p?u:gI(u,f,v),b=t==="avg"?function(){return jT(y,e,i,g,o)}:function(){return pI(y,e,i,g,o)},w=b(),k=p?w:XT(w,f,m);return l?Te(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function u6(r,e,t){var n=t.map(function(c){return c[0]}),a=t.map(function(c){return c[1]}),i=r.concat(n,a),o=e.map(function(c,f){return(c-i[f]%c)%c}),s=a.map(function(c,f){return c+o[f]}),u=e.map(function(c,f){return[n[f],s[f]]}),l=e.map(function(c,f){return[0,o[f]]});return[u,l]}function l6(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var c6=re({pool_:s6});function f6(r,e){var t=V(r,"x","prelu"),n=V(e,"alpha","prelu"),a={x:t,alpha:n};return ne.runKernel(ZS,a)}var yI=re({prelu_:f6});function h6(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=V(r,"x","prod");n.dtype==="bool"&&(n=Ar(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return ne.runKernel(QS,a,i)}var p6=re({prod_:h6});function d6(r,e,t,n){var a=r.map(function(c,f){return V(c,"tensors"+f,"raggedGather","int32")}),i=V(e,"paramsDenseValues","raggedGather"),o=V(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},l=ne.runKernel(JS,s,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}var v6=re({raggedGather_:d6});function m6(r,e,t,n,a){var i=V(r,"shape","raggedTensorToTensor","int32"),o=V(e,"values","raggedTensorToTensor"),s=V(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return V(f,"tensors"+h,"raggedTensorToTensor","int32")}),l={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},c={rowPartitionTypes:a};return ne.runKernel(eE,l,c)}var g6=re({raggedTensorToTensor_:m6});function y6(r,e,t){var n=rr(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type "+t);for(var i=0;i<n;i++)a[i]=e();return ne.makeTensor(a,r,t)}var b6=re({rand_:y6}),Cs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function As(r){var e={exports:{}};return r(e,e.exports),e.exports}var w6=As(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Cs,r,!1)}),x6=As(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Cs,r,!1)}),k6=As(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Cs,r,!1)}),S6=As(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),c.x=p,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Cs,r,!1)}),E6=As(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=512;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=m,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Cs,r,!1)}),T6=As(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Cs,r,!1)}),_s=As(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,k,S){var E=[];k=k==!0?{entropy:!0}:k||{};var N=g(m(k.entropy?[w,b(t)]:w??y(),3),E),C=new d(E),R=function(){for(var _=C.g(i),O=u,P=0;_<l;)_=(_+P)*a,O*=a,P=C.g(1);for(;_>=c;)_/=2,O/=2,P>>>=1;return(_+P)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(b(C.S),t),(k.pass||S||function(_,O,P,B){return B&&(B.S&&v(B,C),_.state=function(){return v(C,{})}),P?(n[s]=_,O):_})(R,N,"global"in k?k.global:this==n,k.state)}function d(w){var k,S=w.length,E=this,N=0,C=E.i=E.j=0,R=E.S=[];for(S||(w=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+w[N%S]+(k=R[N])],R[C]=k;(E.g=function(_){for(var O,P=0,B=E.i,W=E.j,L=E.S;_--;)O=L[B=f&B+1],P=P*a+L[f&(L[B]=L[W=f&W+O])+(L[W]=O)];return E.i=B,E.j=W,P})(a)}function v(w,k){return k.i=w.i,k.j=w.j,k.S=w.S.slice(),k}function m(w,k){var S=[],E=typeof w,N;if(k&&E=="object")for(N in w)try{S.push(m(w[N],k-1))}catch{}return S.length?S:E=="string"?w:w+"\0"}function g(w,k){for(var S=w+"",E,N=0;N<S.length;)k[f&N]=f&(E^=k[f&N]*19)+S.charCodeAt(N++);return b(k)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var k=e.navigator,S=k&&k.plugins;return[+new Date,e,S,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=vp()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Cs,[],Math)});_s.alea=w6;_s.xor128=x6;_s.xorwow=k6;_s.xorshift7=S6;_s.xor4096=E6;_s.tychei=T6;var ty=_s;var ry=(function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=ty.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r})(),I6=(function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=ty.alea(i.toString()),this.randn=new ry(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r})(),N6=(function(){function r(e,t,n,a){var i=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=ty.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r})();function C6(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var i=new I6(e,t,n,a),o=eo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var A6=re({randomGamma_:C6});function _6(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new ry(e,t,n,!1,a),o=eo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var bI=re({randomNormal_:_6});function D6(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type "+e);return bI(r,0,1,e,t)}var F6=re({randomStandardNormal_:D6});function R6(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var i=eo(r,n),o=new N6(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var wI=re({randomUniform_:R6});function Yc(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return ne.runKernel(tE,{},a)}function M6(r){var e=V(r,"x","reciprocal"),t={x:e};return ne.runKernel(nE,t)}var O6=re({reciprocal_:M6});function P6(r){var e=V(r,"x","relu"),t={x:e};return ne.runKernel(aE,t)}var qp=re({relu_:P6});function L6(r){var e=V(r,"x","relu6"),t={x:e};return ne.runKernel(uE,t)}var xI=re({relu6_:L6});function B6(r,e){var t=V(r,"x","reverse"),n={x:t},a={dims:e};return ne.runKernel(lE,n,a)}var Ts=re({reverse_:B6});function z6(r){var e=V(r,"x","reverse");return X(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Ts(e,0)}var $6=re({reverse1d_:z6});function W6(r,e){var t=V(r,"x","reverse");return X(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Ts(t,e)}var V6=re({reverse2d_:W6});function U6(r,e){var t=V(r,"x","reverse");return X(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Ts(t,e)}var G6=re({reverse3d_:U6});function H6(r,e){var t=V(r,"x","reverse");return X(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Ts(t,e)}var q6=re({reverse4d_:H6});function K6(r){var e=V(r,"x","round"),t={x:e};return ne.runKernel(cE,t)}var kI=re({round_:K6});function j6(r){var e=V(r,"x","rsqrt","float32"),t={x:e};return ne.runKernel(fE,t)}var X6=re({rsqrt_:j6});function Y6(r){var e=V(r,"x","selu"),t={x:e};return ne.runKernel(vE,t)}var Z6=re({selu_:Y6});function Q6(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=V(r,"x","separableConv2d"),u=V(e,"depthwiseFilter","separableConv2d"),l=V(t,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(s.rank===3&&(f=!0,c=Te(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");X(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+("rank "+c.rank+".")}),X(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+("got rank "+u.rank+".")}),X(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+("got rank "+u.rank+".")}),X(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+(" must be 1, but got "+l.shape[0]+".")}),X(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+("filter must be 1, but got "+l.shape[1]+".")});var h=u.shape[2],p=u.shape[3];X(l.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+("must be "+h*p+", ")+("but got "+l.shape[2]+".")});var d=Zg(c,u,n,a,o,i),v=1,m=Vp(d,l,v,"valid",o);return f?Te(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var J6=re({separableConv2d_:Q6});function e5(r,e){return Ye(this,void 0,void 0,function(){var t,n,a,i,o,s,c,u,l,c,f;return Ze(this,function(h){switch(h.label){case 0:return t=V(r,"x","setdiff1d"),n=V(e,"y","setdiff1d"),X(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),X(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),X(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,c=0;c<a.length;c++)o.has(a[c])||s++;for(u=new Cp([s],t.dtype),l=new Cp([s],"int32"),c=0,f=0;c<a.length;c++)o.has(a[c])||(u.values[f]=a[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})}var t5=e5;function r5(r){var e=V(r,"x","sign"),t={x:e};return ne.runKernel(bE,t)}var n5=re({sign_:r5});function a5(r){var e=V(r,"x","sin","float32"),t={x:e};return ne.runKernel(gE,t)}var i5=re({sin_:a5});function o5(r){var e=V(r,"x","sinh"),t={x:e};return ne.runKernel(yE,t)}var s5=re({sinh_:o5});function u5(r,e,t){var n=V(r,"x","slice1d");return X(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),yr(n,[e],[t])}var l5=re({slice1d_:u5});function c5(r,e,t){var n=V(r,"x","slice2d");return X(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),yr(n,e,t)}var f5=re({slice2d_:c5});function h5(r,e,t){var n=V(r,"x","slice3d");return X(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),yr(n,e,t)}var p5=re({slice3d_:h5});function d5(r,e,t){var n=V(r,"x","slice4d");return X(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),yr(n,e,t)}var v5=re({slice4d_:d5});function m5(r,e){e===void 0&&(e=-1);var t=V(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and dim was "+e));var n={logits:t},a={dim:e};return ne.runKernel(IE,n,a)}var g5=re({softmax_:m5});function y5(r){X(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return ne.runKernel(aS,e)}var ny=re({fft_:y5});function b5(r){X(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return ne.runKernel(dS,e)}var Op=re({ifft_:b5});function w5(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=Te(r,[t,e]);n=Op(a)}else{var i=[t,2*(e-1)],o=Te(qc(r),[t,e]),s=Te($p(r),[t,e]),u=Ts(yr(o,[0,1],[t,e-2]),1),l=Oe(Ts(yr(s,[0,1],[t,e-2]),1),Lt(-1)),c=Un([o,u],1),f=Un([s,l],1),a=Te(Ro(c,f),[i[0],i[1]]);n=Op(a)}if(n=qc(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=Te(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var SI=re({irfft_:w5});function x5(r,e,t){t===void 0&&(t=0);var n=V(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return ne.runKernel(TE,a,i)}var Zc=re({split_:x5});function k5(r,e){X(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=yr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=Un([r,Qu(s)],r.shape.length-1),t=e}else a=r;var u=ma(a),l=Te(Ro(a,u),[n,t]),c=ny(l),f=Math.floor(t/2)+1,h=qc(c),p=$p(c),d=Zc(h,[f,t-f],h.shape.length-1),v=Zc(p,[f,t-f],p.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=f,Te(Ro(d[0],v[0]),m)}var ay=re({rfft_:k5});function S5(r,e){var t,n=V(r,"a","squaredDifference"),a=V(e,"b","squaredDifference");t=qe(Er(n,a),2),n=t[0],a=t[1],Wr(n.shape,a.shape);var i={a:n,b:a},o={};return ne.runKernel(FE,i,o)}var EI=re({squaredDifference_:S5});function E5(r,e){var t=V(r,"x","squeeze","string_or_numeric");return Te(t,Qk(t.shape,e).newShape)}var iy=re({squeeze_:E5});function T5(r,e){e===void 0&&(e=0);var t=Hc(r,"tensors","stack","string_or_numeric");X(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&X(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return ne.runKernel(jS,n,a)}var Qc=re({stack_:T5});function I5(r,e){e===void 0&&(e=0);var t=V(r,"x","step"),n={x:t},a={alpha:e};return ne.runKernel(qE,n,a)}var TI=re({step_:I5});function N5(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var l=V(r,"x","stridedSlice","string_or_numeric"),c={x:l},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ne.runKernel(RE,c,f)}var C5=re({stridedSlice_:N5});function A5(r){var e=V(r,"x","tan","float32"),t={x:e};return ne.runKernel(BE,t)}var _5=re({tan_:A5});function oi(r,e){Is(r);var t=Di(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return Po(r,n,t,e)}function $c(r,e,t){if(Is(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Di(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Po(r,e,n,t)}function D5(r,e,t){if(Is(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Di(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Po(r,e,n,t)}function F5(r,e,t){if(Is(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Di(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Po(r,e,n,t)}function R5(r,e,t){if(Is(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Di(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,Po(r,e,n,t)}function M5(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=V(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got "+e);if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") "+("but got "+e));var i={x:n},o={k:e,sorted:t},s=qe(ne.runKernel($E,i,o),2),u=s[0],l=s[1];return{values:u,indices:l}}var O5=re({topk_:M5});function P5(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new ry(e,t,n,!0,a),o=eo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var L5=re({truncatedNormal_:P5});function B5(r,e){e===void 0&&(e=0);var t=V(r,"x","unique","string_or_numeric");X(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=qe(ne.runKernel(VE,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var z5=re({unique_:B5});function $5(r,e,t){var n=V(r,"x","unsortedSegmentSum"),a=V(e,"segmentIds","unsortedSegmentSum","int32");X(ju(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return ne.runKernel(GE,i,o)}var W5=re({unsortedSegmentSum_:$5});function V5(r,e){e===void 0&&(e=0);var t=V(r,"x","unstack","string_or_numeric");X(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"});var n={value:t},a={axis:e};return ne.runKernel(UE,n,a)}var oy=re({unstack_:V5});function U5(r,e){return ey(r,e,"right")}function G5(r,e,t,n){return e===void 0&&(e=!0),ne.makeVariable(r,e,t,n)}function II(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=eo(r,"int32"),i=eo([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function H5(r){return Ye(this,void 0,void 0,function(){var e,t,n;return Ze(this,function(a){switch(a.label){case 0:return e=V(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=II(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var NI=H5;function q5(r,e,t){return Ye(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,v;return Ze(this,function(m){switch(m.label){case 0:for(n=V(r,"tensor","boolMask"),a=V(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,X(o>0,function(){return"mask cannot be scalar"}),gn(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=i;l<i+o;l++)u*=s[l];return c=s.slice(0,i).concat([u],s.slice(i+o)),f=Te(n,c),h=Te(a,[-1]),[4,NI(h)];case 1:return p=m.sent(),d=iy(p,[1]),v=aI(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,v]}})})}var K5=q5;function j5(r,e,t,n,a){a===void 0&&(a=!0);var i=V(r,"v","movingAverage"),o=V(e,"x","movingAverage"),s=V(t,"decay","movingAverage");rT(i,o),X(Oo(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Lt(1),l=Et(u,s),c=Oe(Et(o,i),l);if(a){X(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=V(n,"step","movingAverage");c=tr(c,Et(u,jc(s,f)))}return ht(i,c)}var X5=re({movingAverage_:j5});function Y5(r,e,t){var n=V(r,"indices","scatterND","int32"),a=V(e,"updates","scatterND");Kg(a,n,t);var i={indices:n,updates:a},o={shape:t};return ne.runKernel(hE,i,o)}var Z5=re({scatterND_:Y5});function Q5(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+(" but the dtype was "+r.dtype+"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+(" but got shape "+r.shape+"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+(" "+t.length+", should be: "+i+"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+(e.shape+", should be [] or ["+a+"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function J5(r,e,t,n){n===void 0&&(n=0);var a=V(r,"sparseIndices","sparseToDense","int32"),i=V(e,"sparseValues","sparseToDense","string_or_numeric"),o=V(n,"defaultValue","sparseToDense",i.dtype);Q5(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return ne.runKernel(DE,s,u)}var eK=re({sparseToDense_:J5});function tK(r,e){var t=V(e,"indices","gatherND","int32"),n=V(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return ne.runKernel(fS,a)}var rK=re({gatherND_:tK});function nK(r,e){if(e==null)return r.shape.slice();if(Oo(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function aK(r,e,t,n){var a=V(r,"x","dropout");if(X(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+("scaled, but got a "+a.dtype+" tensor instead.")}),X(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof zr?a.clone():a;var i=nK(a,t),o=1-e,s=tr(nI(ht(wI(i,0,1,"float32",n),o)),o);return Oe(a,s)}var iK=re({dropout_:aK});function CI(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function sy(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return oi(a,"float32")}function oK(r,e,t){return t===void 0&&(t=1),Ye(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,v,m,m;return Ze(this,function(g){switch(g.label){case 0:return n=V(r,"predictions","inTopK"),a=V(e,"targets","inTopK"),X(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+("but got "+n.rank)}),X(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+(n.rank+" and targets rank "+a.rank)}),gn(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],X(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+("dimension ("+i+"), but got "+t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=qe([o.length/i,i],2),l=u[0],c=u[1],f=Jk("bool",l),h=0;h<l;h++){for(p=h*c,d=o.subarray(p,p+c),v=[],m=0;m<d.length;m++)v.push({value:d[m],index:m});for(v.sort(function(y,b){return b.value-y.value}),f[h]=0,m=0;m<t;m++)if(v[m].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,Uu(f,a.shape,"bool")]}})})}var sK=oK;function uK(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=Te(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Te(e,[1,e.shape[0],e.shape[1],e.shape[2]])),X(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+(s.shape+".")}),X(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+(u.shape+".")}),X(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+(t+".")});var l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];X(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must "+("match input depth in filter ("+t[2]+".")}),X(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must "+("match output depth for filter ("+t[3]+").")}),Ma("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ne.runKernel(M2,f,h)}var lK=re({conv2DBackpropFilter_:uK});function Kp(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return Oe(r,TI(e));throw new Error("Cannot compute gradient for fused activation "+t+".")}function jp(r,e){var t=e,n=Hg(r.shape,e.shape);return n.length>0&&(t=er(t,n)),Te(t,r.shape)}function Xp(r,e,t,n){if(e==="linear")return r;if(e==="relu")return qp(r);if(e==="elu")return JT(r);if(e==="relu6")return xI(r);if(e==="prelu")return yI(r,t);if(e==="leakyrelu")return oI(r,n);if(e==="sigmoid")return qu(r);throw new Error("Unknown fused activation "+e+".")}var Yp=function(r,e){var t=r>0;return!t||e==="linear"};function cK(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,v=r.leakyreluAlpha;if(p=p||"linear",Yp(ne.state.gradientDepth,p)===!1){X(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of "+s+" but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var m=Vp(t,n,a,i,s,l,c);return f!=null&&(m=ht(m,f)),Xp(m,p,d,v)}var g=V(t,"x","conv2d","float32"),y=V(n,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=Te(g,[1,g.shape[0],g.shape[1],g.shape[2]])),X(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+(b.rank+".")}),X(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+(y.rank+".")}),Ma("fused conv2d",i,c);var k=s==="NHWC"?b.shape[3]:b.shape[1];X(y.shape[2]===k,function(){return"Error in conv2d: depth of input ("+k+") must match "+("input depth for filter "+y.shape[2]+".")}),X(no(a,l),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+a+" and dilations '"+l+"'")});var S=nf(b.shape,y.shape,a,l,i,c),E;f!=null&&(E=V(f,"bias","fused conv2d"),e=qe(Er(E,g),1),E=e[0],s==="NHWC"?Wr(S.outShape,E.shape):(X(E.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+("rank-"+E.shape.length+".")}),X(E.shape.length===0||E.shape[0]===S.outChannels||E.shape[0]===1,function(){return"Error in fused conv2d: bias shape ("+E.shape+") is not compatible with the number of output channels "+("("+S.outChannels+")")})));var N;if(d!=null){var C=d.shape;if(X(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+("rank-"+C.length+".")}),C.length===1)X(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+("("+C+") is not compatible with the number of output ")+("channels ("+S.outChannels+").")});else if(C.length===3)try{Wr(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights ("+C+") is not compatible with the output shape of the conv2d "+("("+S.outShape+").");throw Error(R)}N=V(d,"prelu weights","fused conv2d")}var _=function(L,G){X(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of "+s+" but only NHWC is currently supported."});var M=qe(G,4),$=M[0],K=M[1],j=M[2],te=M[3],Q=Kp(L,j,p);X(Kc(l),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+("are not yet supported in gradients. Got dilations '"+l+"'")});var ie=ZT(K.shape,Q,$,a,i),le=lK(K,Q,$.shape,a,i),de=[ie,le];if(te!=null){var we=jp(te,Q);de.push(we)}return de},O={x:b,filter:y,bias:E,preluActivationWeights:N},P={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:v};if(f==null){var B=Fi(function(L,G,M){var $=ne.runKernel(og,O,P);return M([G,L,$]),w&&($=Te($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:_}});return B(b,y)}else{var W=Fi(function(L,G,M,$){var K=ne.runKernel(og,O,P);return $([G,L,K,M]),w&&(K=Te(K,[K.shape[1],K.shape[2],K.shape[3]])),{value:K,gradFunc:_}});return W(b,y,E)}}var fK=re({fusedConv2d_:cK});function hK(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=Te(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Te(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={x:s,dy:u},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ne.runKernel(q2,l,c)}var pK=re({depthwiseConv2dNativeBackpropFilter_:hK});function dK(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Te(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={dy:s,filter:t},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ne.runKernel(K2,l,c);return u?Te(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var vK=re({depthwiseConv2dNativeBackpropInput_:dK});function mK(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,v=r.leakyreluAlpha;if(Yp(ne.state.gradientDepth,p)===!1){var m=Zg(t,n,a,i,s,l,c);return f!=null&&(m=ht(m,f)),Xp(m,p,d,v)}var g=V(t,"x","depthwiseConv2d","float32"),y=V(n,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=Te(g,[1,g.shape[0],g.shape[1],g.shape[2]])),X(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+("rank "+b.rank+".")}),X(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+("but got rank "+y.rank+".")}),X(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+("("+b.shape[3]+") must match the inChannels dimension in ")+("filter "+y.shape[2]+".")}),l==null&&(l=[1,1]),X(no(a,l),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+("be 1. Got strides "+a+" and dilations '"+l+"'")}),Ma("fused depthwiseConv2d",i,c);var k=nf(b.shape,y.shape,a,l,i,c,!0),S;f!=null&&(S=V(f,"bias","fused conv2d"),e=qe(Er(S,g),1),S=e[0],Wr(k.outShape,S.shape));var E;d!=null&&(E=V(d,"prelu weights","fused depthwiseConv2d"));var N=function(P,B){X(Kc(l),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+("'"+l+"'")});var W=qe(B,4),L=W[0],G=W[1],M=W[2],$=W[3],K=Kp(P,M,p),j=vK(G.shape,K,L,a,i,l,c),te=pK(G,K,L.shape,a,i,l,c);if($!=null){var Q=jp(S,K);return[j,te,Q]}return[j,te]},C={x:b,filter:y,bias:S,preluActivationWeights:E},R={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:v};if(f==null){var _=Fi(function(P,B,W){var L=ne.runKernel(sg,C,R);return W([B,P,L]),w&&(L=Te(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:N}});return _(b,y)}else{var O=Fi(function(P,B,W,L){var G=ne.runKernel(sg,C,R);return L([B,P,G,W]),w&&(G=Te(G,[G.shape[1],G.shape[2],G.shape[3]])),{value:G,gradFunc:N}});return O(b,y,S)}}var gK=re({fusedDepthwiseConv2d_:mK});function yK(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,l=r.bias,c=r.activation,f=c===void 0?"linear":c,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(Yp(ne.state.gradientDepth,f)===!1){var v=Pt(n,a,o,u);return l!=null&&(v=ht(v,l)),Xp(v,f,h,d)}var m=V(n,"a","fused matMul"),g=V(a,"b","fused matMul");e=qe(Er(m,g),2),m=e[0],g=e[1];var y=o?m.shape[m.rank-2]:m.shape[m.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?m.shape[m.rank-1]:m.shape[m.rank-2],k=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=m.shape.slice(0,-2),E=g.shape.slice(0,-2),N=rr(S),C=rr(E);X(y===b,function(){return"Error in fused matMul: inner shapes ("+y+") and ("+(b+") of Tensors with shapes "+m.shape+" and ")+(g.shape+" and transposeA="+o)+(" and transposeB="+u+" must match.")});var R=Wr(m.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([w,k]),O=o?Te(m,[N,y,w]):Te(m,[N,w,y]),P=u?Te(g,[C,k,b]):Te(g,[C,b,k]),B;l!=null&&(B=V(l,"bias","fused matMul"),t=qe(Er(B,m),1),B=t[0],Wr(_,B.shape));var W;h!=null&&(W=V(h,"prelu weights","fused matMul"));var L=function(j,te){var Q=qe(te,4),ie=Q[0],le=Q[1],de=Q[2],we=Q[3],pe=Kp(Te(j,de.shape),de,f),Se,Ee;if(!o&&!u?(Se=Pt(pe,le,!1,!0),Ee=Pt(ie,pe,!0,!1)):!o&&u?(Se=Pt(pe,le,!1,!1),Ee=Pt(pe,ie,!0,!1)):o&&!u?(Se=Pt(le,pe,!1,!0),Ee=Pt(ie,pe,!1,!1)):(Se=Pt(le,pe,!0,!0),Ee=Pt(pe,ie,!0,!0)),l!=null){var Ne=jp(we,pe);return[Se,Ee,Ne]}else return[Se,Ee]},G={a:O,b:P,bias:B,preluActivationWeights:W},M={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(l==null){var $=Fi(function(j,te,Q){var ie=ne.runKernel(ig,G,M);return Q([j,te,ie]),{value:Te(ie,_),gradFunc:L}});return $(O,P)}else{var K=Fi(function(j,te,Q,ie){var le=ne.runKernel(ig,G,M);return ie([j,te,le,Q]),{value:Te(le,_),gradFunc:L}});return K(O,P,B)}}var bK=re({fusedMatMul_:yK});var wK={__proto__:null,conv2d:fK,depthwiseConv2d:gK,matMul:bK};function xK(r){return sy(r,.54,.46)}var kK=re({hammingWindow_:xK});function SK(r){return sy(r,.5,.5)}var AI=re({hannWindow_:SK});function EK(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(yr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=Un([yr(r,i,e-s),af([s],a)]);o.push(u),i+=t}return o.length===0?$c([],[0,e]):Te(Un(o),[o.length,e])}var _I=re({frame_:EK});function TK(r,e,t,n,a){a===void 0&&(a=AI),n==null&&(n=CI(e));var i=_I(r,e,t),o=Oe(i,a(e));return ay(o,n)}var IK=re({stft_:TK});function NK(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=V(r,"image","cropAndResize"),s=V(e,"boxes","cropAndResize","float32"),u=V(t,"boxInd","cropAndResize","int32"),l=s.shape[0];X(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+("but got rank "+o.rank+".")}),X(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] "+("but had shape "+s.shape+".")}),X(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] "+("but had shape "+s.shape+".")}),X(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+("length "+n.length+".")}),X(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),X(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a});var c={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=ne.runKernel(V2,c,f);return h}var CK=re({cropAndResize_:NK});function AK(r){var e=V(r,"image","flipLeftRight","float32");X(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+("but got rank "+e.rank+".")});var t={image:e},n=ne.runKernel(oS,t,{});return n}var _K=re({flipLeftRight_:AK});function DK(r){var e=V(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];X(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+("but got rank "+e.rank+".")}),X(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+("should be size 1, but got size "+n+".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,zc(e,a)}var FK=re({grayscaleToRGB_:DK});function RK(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=V(r,"image","rotateWithOffset","float32");X(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+("but got rank "+a.rank+".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=ne.runKernel(KE,i,o);return s}var MK=re({rotateWithOffset_:RK});function el(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),X(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),X(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),X(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),X(e.rank===1,function(){return"scores must be a 1D tensor"}),X(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", "+("but was "+e.shape[0])}),X(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function OK(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=V(r,"boxes","nonMaxSuppression","float32"),o=V(e,"scores","nonMaxSuppression","float32"),s=el(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return ne.runKernel(US,{boxes:i,scores:o},u)}var PK=re({nonMaxSuppression_:OK});function LK(r,e,t){var n=BK(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function BK(r,e,t){return $K(r,e,t||zK)}function zK(r,e){return r>e?1:r<e?-1:0}function $K(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function DI(r,e,t,n,a){return uy(r,e,t,n,a,0)}function FI(r,e,t,n,a,i){return uy(r,e,t,n,a,0,!1,i,!0)}function RI(r,e,t,n,a,i){return uy(r,e,t,n,a,i,!0)}function uy(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var l=[],c=0;c<e.length;c++)e[c]>a&&l.push({score:e[c],boxIndex:c,suppressBeginIndex:0});l.sort(qk);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&l.length>0;){var d=l.pop(),v=d.score,m=d.boxIndex,g=d.suppressBeginIndex;if(v<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=WK(r,m,h[b]);if(w>=n){y=!0;break}if(d.score=d.score*VK(n,f,w),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===v?(h.push(m),p.push(d.score)):d.score>a&&LK(l,d,qk))}var k=h.length,S=t-k;s&&S>0&&(h.push.apply(h,Rt(new Array(S).fill(0))),p.push.apply(p,Rt(new Array(S).fill(0))));var E={selectedIndices:h};return o&&(E.selectedScores=p),u&&(E.validOutputs=k),E}function WK(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-l)*(h-c);if(p<=0||d<=0)return 0;var v=Math.max(i,l),m=Math.max(o,c),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(p+d-b)}function VK(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function qk(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function UK(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Ye(this,void 0,void 0,function(){var i,o,s,u,l,c,f;return Ze(this,function(h){switch(h.label){case 0:return i=V(r,"boxes","nonMaxSuppressionAsync"),o=V(e,"scores","nonMaxSuppressionAsync"),s=el(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),l=u[0],c=u[1],f=DI(l,c,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,oi(f,"int32")]}})})}var GK=UK;function HK(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=V(r,"boxes","nonMaxSuppression"),s=V(e,"scores","nonMaxSuppression"),u=el(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var l={boxes:o,scores:s},c={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=ne.runKernel(HS,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}var qK=re({nonMaxSuppressionWithScore_:HK});function KK(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Ye(this,void 0,void 0,function(){var o,s,u,l,c,f,h,p,d;return Ze(this,function(v){switch(v.label){case 0:return o=V(r,"boxes","nonMaxSuppressionAsync"),s=V(e,"scores","nonMaxSuppressionAsync"),u=el(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return l=v.sent(),c=l[0],f=l[1],h=RI(c,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:oi(p,"int32"),selectedScores:oi(d)}]}})})}var jK=KK;function XK(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=V(r,"boxes","nonMaxSuppression"),s=V(e,"scores","nonMaxSuppression"),u=el(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:i},d=ne.runKernel(GS,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var YK=re({nonMaxSuppressionPadded_:XK});function ZK(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),Ye(this,void 0,void 0,function(){var o,s,u,l,c,f,h,p,d,v,m,g;return Ze(this,function(y){switch(y.label){case 0:return o=V(r,"boxes","nonMaxSuppressionAsync"),s=V(e,"scores","nonMaxSuppressionAsync"),u=el(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=qe.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],v=FI(p,d,l,c,f,i),m=v.selectedIndices,g=v.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:oi(m,"int32"),validOutputs:Lt(g,"int32")}]}})})}var QK=ZK;function JK(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=V(r,"images","resizeBilinear");X(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),X(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+(e+".")}),X(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=Te(a,[1,a.shape[0],a.shape[1],a.shape[2]])),qe(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=ne.runKernel(sE,s,u);return o?Te(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var e8=re({resizeBilinear_:JK});function t8(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=V(r,"images","resizeNearestNeighbor");X(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),X(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+(e+".")}),X(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),X(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=Te(a,[1,a.shape[0],a.shape[1],a.shape[2]])),qe(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=ne.runKernel(oE,s,u);return o?Te(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var r8=re({resizeNearestNeighbor_:t8});function n8(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=V(r,"image","threshold"),o=.2989,s=.587,u=.114,l=i.shape[0]*i.shape[1],c=Oe(oi([n]),255),f,h,p,d;if(X(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+("but got rank "+i.rank+".")}),X(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+("but got "+i.shape[2]+".")}),X(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+("but got dtype "+i.dtype+".")}),X(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was "+e}),i.shape[2]===3){a=qe(Zc(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var v=Oe(f,o),m=Oe(h,s),g=Oe(p,u);d=ht(ht(v,m),g)}else d=r;if(e==="otsu"){var y=YT(Ar(kI(d),"int32"),Uu([]),256);c=a8(y,l)}var b=t?Jg(d,c):Gp(d,c),w=Ar(Oe(b,255),"int32");return w}function a8(r,e){for(var t=oi([-1]),n=oi([0]),a=oi([0]),i,o,s,u,l,c,f=0;f<r.size-1;f++){i=yr(r,0,f+1),o=yr(r,f+1),l=tr(er(i),e),c=tr(er(o),e);var h=er(Oe(i,Yc(0,i.size)));s=tr(h,er(i));var p=af(o.shape,i.size),d=ht(Yc(0,o.size),p),v=Oe(o,d);u=tr(er(v),er(o));var m=Et(s,u),g=Et(s,u),y=Oe(l,c);a=Oe(Oe(y,m),g);var b=Gp(a,n);n=Zu(b,a,n),t=Zu(b,oi([f]),t)}return t}var i8=re({threshold_:n8});function o8(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=V(r,"image","transform","float32"),s=V(e,"transforms","transform","float32");X(o.rank===4,function(){return"Error in transform: image must be rank 4,"+("but got rank "+o.rank+".")}),X(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),X(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+("but got "+i+".")});var u={image:o,transforms:s},l={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return ne.runKernel(WE,u,l)}var s8=re({transform_:o8});function u8(r,e,t){X(e%1===0,function(){return"bandPart(): numLower must be an integer, got "+e+"."}),X(t%1===0,function(){return"bandPart(): numUpper must be an integer, got "+t+"."});var n=V(r,"a","bandPart");X(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got "+n.rank+"."});var a=n.shape,i=qe(n.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+")"+(" must not be greater than the number of rows ("+o+")."));if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+")"+(" must not be greater than the number of columns ("+s+")."));e<0&&(e=o),t<0&&(t=s);var u=Te(Yc(0,o,1,"int32"),[-1,1]),l=Yc(0,s,1,"int32"),c=Et(u,l),f=Rp(Jg(c,Lt(+e,"int32")),iI(c,Lt(-t,"int32"))),h=Qu([o,s],n.dtype);return Te(Qc(oy(Te(n,[-1,o,s])).map(function(p){return Zu(f,p,h)})),a)}var l8=re({bandPart_:u8});function c8(r){var e;if(Array.isArray(r)){e=!1,X(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){X(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+("("+r[u].shape[0]+" vs. "+t+")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=Zc(r,r.shape[0],0).map(function(u){return iy(u,[0])});X(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds "+("number of dimensions ("+r[0].shape[0]+").")});for(var i=[],o=r,s=function(u){i.push(ne.tidy(function(){var l=o[u];if(u>0)for(var c=0;c<u;++c){var f=Oe(er(Oe(i[c],l)),i[c]);l=Et(l,f)}return tr(l,Up(l,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?Qc(i,0):i}var f8=re({gramSchmidt_:c8});function h8(r,e){if(e===void 0&&(e=!1),X(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+r.rank}),r.rank===2)return Kk(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,l){return u*l}),n=oy(Te(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var l=qe(Kk(u,e),2),c=l[0],f=l[1];a.push(c),i.push(f)});var o=Te(Qc(a,0),r.shape),s=Te(Qc(i,0),r.shape);return[o,s]}function Kk(r,e){return e===void 0&&(e=!1),ne.tidy(function(){X(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor."});for(var t=r.shape[0],n=r.shape[1],a=rI(t),i=bs(r),o=$c([[1]],[1,1]),s=bs(o),u=t>=n?n:t,l=function(f){var h,p=i,d=s,v=a;h=qe(ne.tidy(function(){var m=yr(i,[f,f],[t-f,1]),g=Up(m),y=yr(i,[f,f],[1,1]),b=Zu(Gp(y,0),$c([[-1]]),$c([[1]])),w=Et(y,Oe(b,g)),k=tr(m,w);k.shape[0]===1?s=bs(o):s=Un([o,yr(k,[1,0],[k.shape[0]-1,k.shape[1]])],0);var S=Ji(tr(Pt(b,w),g)),E=yr(i,[f,0],[t-f,n]),N=Oe(S,s),C=Dp(s);if(f===0)i=Et(E,Pt(N,Pt(C,E)));else{var R=Et(E,Pt(N,Pt(C,E)));i=Un([yr(i,[0,0],[f,n]),R],0)}var _=Dp(N),O=yr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=Et(O,Pt(Pt(O,s),_));else{var P=Et(O,Pt(Pt(O,s),_));a=Un([yr(a,[0,0],[t,f]),P],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],En([p,d,v])},c=0;c<u;++c)l(c);return!e&&t>n&&(a=yr(a,[0,0],[t,n]),i=yr(i,[0,0],[n,n])),[a,i]})}var p8=re({qr_:h8});D.Reduction=void 0;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(D.Reduction||(D.Reduction={}));function d8(r,e,t){t===void 0&&(t=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var n=V(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=V(e,"weights","computeWeightedLoss"));var i=a==null?n:Oe(n,a);if(t===D.Reduction.NONE)return i;if(t===D.Reduction.SUM)return er(i);if(t===D.Reduction.MEAN){if(a==null)return Mp(i);var o=n.size/a.size,s=tr(er(i),er(a));return o>1?tr(s,Lt(o)):s}if(t===D.Reduction.SUM_BY_NONZERO_WEIGHTS){if(a==null)return tr(er(i),Lt(n.size));var u=Oe(a,ys(n.shape)),l=Ar(er(mI(u,Lt(0))),"float32");return tr(er(i),l)}throw Error("Unknown reduction: "+t)}var ao=re({computeWeightedLoss_:d8});function v8(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=V(r,"labels","absoluteDifference"),i=V(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=V(t,"weights","absoluteDifference")),gn(a.shape,i.shape,"Error in absoluteDifference: ");var s=va(Et(a,i));return ao(s,o,n)}var m8=re({absoluteDifference_:v8});function g8(r,e,t,n,a){a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=V(r,"labels","cosineDistance"),o=V(e,"predictions","cosineDistance"),s=null;n!=null&&(s=V(n,"weights","cosineDistance")),gn(i.shape,o.shape,"Error in cosineDistance: ");var u=Lt(1),l=Et(u,er(Oe(i,o),t,!0));return ao(l,s,a)}var y8=re({cosineDistance_:g8});function b8(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=V(r,"labels","hingeLoss"),i=V(e,"predictions","hingeLoss"),o=null;t!=null&&(o=V(t,"weights","hingeLoss")),gn(a.shape,i.shape,"Error in hingeLoss: ");var s=Lt(1);a=Et(Oe(Lt(2),a),s);var u=qp(Et(s,Oe(a,i)));return ao(u,o,n)}var w8=re({hingeLoss_:b8});function x8(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=V(r,"labels","huberLoss"),o=V(e,"predictions","huberLoss"),s=null;t!=null&&(s=V(t,"weights","huberLoss")),gn(i.shape,o.shape,"Error in huberLoss: ");var u=Lt(n),l=va(Et(o,i)),c=vI(l,u),f=Et(l,c),h=ht(Oe(Lt(.5),si(c)),Oe(u,f));return ao(h,s,a)}var k8=re({huberLoss_:x8});function S8(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=V(r,"labels","logLoss"),o=V(e,"predictions","logLoss"),s=null;t!=null&&(s=V(t,"weights","logLoss")),gn(i.shape,o.shape,"Error in logLoss: ");var u=Lt(1),l=Lt(n),c=Ji(Oe(i,Xc(ht(o,l)))),f=Oe(Et(u,i),Xc(ht(Et(u,o),l))),h=Et(c,f);return ao(h,s,a)}var E8=re({logLoss_:S8});function T8(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=V(r,"labels","meanSquaredError"),i=V(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=V(t,"weights","meanSquaredError")),gn(a.shape,i.shape,"Error in meanSquaredError: ");var s=EI(a,i);return ao(s,o,n)}var I8=re({meanSquaredError_:T8});function N8(r,e){var t=V(r,"labels","sigmoidCrossEntropyWithLogits"),n=V(e,"logits","sigmoidCrossEntropyWithLogits");gn(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=qp(n),i=Oe(n,t),o=sI(Es(Ji(va(n))));return ht(Et(a,i),o)}function C8(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=V(r,"multiClassLabels","sigmoidCrossEntropy"),o=V(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=V(t,"weights","sigmoidCrossEntropy")),gn(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=Lt(n),l=Lt(1),c=Lt(.5);i=ht(Oe(i,Et(l,u)),Oe(c,u))}var f=N8(i,o);return ao(f,s,a)}var A8=re({sigmoidCrossEntropy_:C8});function _8(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+("supported. Labels / logits was rank "+e.rank+" ")+("and dim was "+t));var n=Fi(function(a,i,o){var s=!0,u=cI(i,[t],s),l=Et(Ar(i,"float32"),u);o([a,l]);var c=Ji(Oe(l,a)),f=er(c,[t]),h=function(p,d){var v=qe(d,2),m=v[0],g=v[1],y=of(p.shape,[t]);return[Oe(Te(p,y),Et(Ar(m,"float32"),Es(g))),Oe(Te(p,y),Et(Es(g),Ar(m,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function D8(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=V(r,"onehotLabels","softmaxCrossEntropy"),o=V(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=V(t,"weights","softmaxCrossEntropy")),gn(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=Lt(n),l=Lt(1),c=Lt(i.shape[1]);i=ht(Oe(i,Et(l,u)),tr(u,c))}var f=_8(i,o);return ao(f,s,a)}var F8=re({softmaxCrossEntropy_:D8});function R8(r,e,t,n){var a=V(r,"indices","sparseFillEmptyRows","int32"),i=V(e,"values","sparseFillEmptyRows"),o=V(t,"denseShape","sparseFillEmptyRows","int32"),s=V(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `+a.shape);if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape "+i.shape);if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape "+o.shape);if(s.rank!==0)throw new Error("Default value should be a scalar but received shape "+s.shape);var u={indices:a,values:i,denseShape:o,defaultValue:s},l=ne.runKernel(NE,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}var M8=re({sparseFillEmptyRows_:R8});function O8(r,e,t){var n=V(r,"inputIndices","sparseReshape","int32"),a=V(e,"inputShape","sparseReshape","int32"),i=V(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `+n.shape);if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape "+a.shape);if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape "+i.shape);var o={inputIndices:n,inputShape:a,newShape:i},s=ne.runKernel(CE,o);return{outputIndices:s[0],outputShape:s[1]}}var P8=re({sparseReshape_:O8});function L8(r,e,t){var n=V(r,"data","sparseSegmentMean"),a=V(e,"indices","sparseSegmentMean","int32"),i=V(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `+i.shape);var o={data:n,indices:a,segmentIds:i};return ne.runKernel(AE,o)}var B8=re({sparseSegmentMean_:L8});function z8(r,e,t){var n=V(r,"data","sparseSegmentSum"),a=V(e,"indices","sparseSegmentSum","int32"),i=V(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `+i.shape);var o={data:n,indices:a,segmentIds:i};return ne.runKernel(_E,o)}var $8=re({sparseSegmentSum_:z8});function W8(r,e,t,n,a,i,o,s){var u=V(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: "+u.shape);var l=V(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var c={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:l},h=ne.runKernel(ME,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}var V8=re({stringNGrams_:W8});function U8(r,e,t){t===void 0&&(t=!0);var n=V(r,"input","stringSplit","string"),a=V(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape "+n.shape);if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape "+a.shape);var i={skipEmpty:t},o={input:n,delimiter:a},s=ne.runKernel(OE,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var G8=re({stringSplit_:U8});function H8(r,e){var t=V(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return ne.runKernel(PE,a,n)}var q8=re({stringToHashBucketFast_:H8});var K8={fft:ny,ifft:Op,rfft:ay,irfft:SI},j8={hammingWindow:kK,hannWindow:AI,frame:_I,stft:IK},X8={flipLeftRight:_K,grayscaleToRGB:FK,resizeNearestNeighbor:r8,resizeBilinear:e8,rotateWithOffset:MK,cropAndResize:CK,nonMaxSuppression:PK,nonMaxSuppressionAsync:GK,nonMaxSuppressionWithScore:qK,nonMaxSuppressionWithScoreAsync:jK,nonMaxSuppressionPadded:YK,nonMaxSuppressionPaddedAsync:QK,threshold:i8,transform:s8},Y8={bandPart:l8,gramSchmidt:f8,qr:p8},Z8={absoluteDifference:m8,computeWeightedLoss:ao,cosineDistance:y8,hingeLoss:w8,huberLoss:k8,logLoss:E8,meanSquaredError:I8,sigmoidCrossEntropy:A8,softmaxCrossEntropy:F8},Q8={sparseFillEmptyRows:M8,sparseReshape:P8,sparseSegmentMean:B8,sparseSegmentSum:$8},J8={stringNGrams:V8,stringSplit:G8,stringToHashBucketFast:q8},Bo=(function(r){ro(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return En(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return uI(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&En(this.iterations_)},e.prototype.saveIterations=function(){return Ye(this,void 0,void 0,function(){return Ze(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Lt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ye(this,void 0,void 0,function(){return Ze(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ye(this,void 0,void 0,function(){return Ze(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+(""+this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ye(this,void 0,void 0,function(){var n;return Ze(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e})($T);Object.defineProperty(Bo,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var Zp=(function(r){ro(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=ne.backend.epsilon()),i}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ne.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:$r(function(){return ma(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:$r(function(){return ma(s).variable(u)})});var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;$r(function(){var h=ht(Oe(c,n.rho),Oe(si(l),1-n.rho)),p=Oe(tr(to(ht(f,n.epsilon)),to(ht(c,n.epsilon))),l),d=ht(Oe(f,n.rho),Oe(si(p),1-n.rho));c.assign(h),f.assign(d);var v=ht(Oe(p,-n.learningRate),s);s.assign(v)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(En(this.accumulatedGrads.map(function(t){return t.variable})),En(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ye(this,void 0,void 0,function(){var t;return Ze(this,function(n){switch(n.label){case 0:return t=Rt(this.accumulatedGrads,this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ye(this,void 0,void 0,function(){var n,a;return Ze(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e})(Bo);Zp.className="Adadelta";Lo(Zp);var Qp=(function(r){ro(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ne.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:i+"/accumulator",variable:$r(function(){return af(s.shape,n.initialAccumulatorValue).variable(u)})}}var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedGrads[o].variable;$r(function(){var f=ht(c,si(l));c.assign(f);var h=ht(Oe(tr(l,to(ht(f,ne.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&En(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ye(this,void 0,void 0,function(){return Ze(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ye(this,void 0,void 0,function(){var n;return Ze(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e})(Bo);Qp.className="Adagrad";Lo(Qp);var Jp=(function(r){ro(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],$r(function(){o.accBeta1=Lt(n).variable(),o.accBeta2=Lt(a).variable()}),i==null&&(o.epsilon=ne.backend.epsilon()),o}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);$r(function(){var i=Et(1,n.accBeta1),o=Et(1,n.accBeta2);a.forEach(function(s,u){var l=ne.registeredVariables[s],c=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:$r(function(){return ma(l).variable(c)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:s+"/v",variable:$r(function(){return ma(l).variable(c)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=ht(Oe(h,n.beta1),Oe(f,1-n.beta1)),v=ht(Oe(p,n.beta2),Oe(si(f),1-n.beta2)),m=tr(d,i),g=tr(v,o);h.assign(d),p.assign(v);var y=ht(Oe(tr(m,ht(to(g),n.epsilon)),-n.learningRate),l);l.assign(y)}}),n.accBeta1.assign(Oe(n.accBeta1,n.beta1)),n.accBeta2.assign(Oe(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&En(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&En(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ye(this,void 0,void 0,function(){var t;return Ze(this,function(n){switch(n.label){case 0:return t=Rt(this.accumulatedFirstMoment,this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ye(this,void 0,void 0,function(){var n,a,i=this;return Ze(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),$r(function(){i.accBeta1.assign(jc(i.beta1,i.iterations_+1)),i.accBeta2.assign(jc(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e})(Bo);Jp.className="Adam";Lo(Jp);var ed=(function(r){ro(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],$r(function(){s.iteration=Lt(0).variable(),s.accBeta1=Lt(n).variable()}),i==null&&(s.epsilon=ne.backend.epsilon()),s}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);$r(function(){var i=Et(1,n.accBeta1),o=tr(-n.learningRate,ht(Oe(n.iteration,n.decay),1));a.forEach(function(s,u){var l=ne.registeredVariables[s],c=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ma(l).variable(c)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:ma(l).variable(c)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=ht(Oe(h,n.beta1),Oe(f,1-n.beta1)),v=Oe(p,n.beta2),m=va(f),g=dI(v,m);h.assign(d),p.assign(g);var y=ht(Oe(tr(o,i),tr(d,ht(g,n.epsilon))),l);l.assign(y)}}),n.iteration.assign(ht(n.iteration,1)),n.accBeta1.assign(Oe(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&En(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&En(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ye(this,void 0,void 0,function(){return Ze(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ye(this,void 0,void 0,function(){return Ze(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e})(Bo);ed.className="Adamax";Lo(ed);var uf=(function(r){ro(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=ne.registeredVariables[i];$r(function(){var l=ht(Oe(n.c,s),u);u.assign(l)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=TT(Lt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ye(this,void 0,void 0,function(){return Ze(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ye(this,void 0,void 0,function(){return Ze(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e})(Bo);uf.className="SGD";Lo(uf);var td=(function(r){ro(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=Lt(i.momentum),i}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ne.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:i+"/momentum",variable:$r(function(){return ma(s).variable(u)})}}var l=n.accumulations[o].variable,c=Array.isArray(t)?t[o].tensor:t[i];c!=null&&$r(function(){var f,h=ht(Oe(n.m,l),c);n.useNesterov?f=ht(Oe(n.c,ht(c,Oe(h,n.m))),s):f=ht(Oe(n.c,h),s),l.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&En(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ye(this,void 0,void 0,function(){return Ze(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ye(this,void 0,void 0,function(){var n;return Ze(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e})(uf);td.className="Momentum";Lo(td);var rd=(function(r){ro(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=ne.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ne.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:$r(function(){return ma(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:i+"/momentum",variable:$r(function(){return ma(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:$r(function(){return ma(s).variable(u)})});var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;$r(function(){var h=ht(Oe(c,n.decay),Oe(si(l),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=ht(Oe(p,n.decay),Oe(l,1-n.decay)),v=tr(Oe(l,n.learningRate),to(Et(h,ht(si(d),n.epsilon)))),m=ht(Oe(f,n.momentum),v);c.assign(h),p.assign(d),f.assign(m);var g=Et(s,m);s.assign(g)}else{var y=ht(Oe(c,n.decay),Oe(si(l),1-n.decay)),m=ht(Oe(f,n.momentum),tr(Oe(l,n.learningRate),to(ht(y,n.epsilon))));c.assign(y),f.assign(m);var g=Et(s,m);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&En(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&En(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&En(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ye(this,void 0,void 0,function(){var t;return Ze(this,function(n){switch(n.label){case 0:return t=Rt(this.accumulatedMeanSquares,this.accumulatedMoments),this.centered&&t.push.apply(t,Rt(this.accumulatedMeanGrads)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ye(this,void 0,void 0,function(){var n,a;return Ze(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e})(Bo);rd.className="RMSProp";Lo(rd);var No=(function(){function r(){}return r.sgd=function(e){return new uf(e)},r.momentum=function(e,t,n){return n===void 0&&(n=!1),new td(e,t,n)},r.rmsprop=function(e,t,n,a,i){return t===void 0&&(t=.9),n===void 0&&(n=0),a===void 0&&(a=null),i===void 0&&(i=!1),new rd(e,t,n,a,i)},r.adam=function(e,t,n,a){return e===void 0&&(e=.001),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),new Jp(e,t,n,a)},r.adadelta=function(e,t,n){return e===void 0&&(e=.001),t===void 0&&(t=.95),n===void 0&&(n=null),new Zp(e,t,n)},r.adamax=function(e,t,n,a,i){return e===void 0&&(e=.002),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),i===void 0&&(i=0),new ed(e,t,n,a,i)},r.adagrad=function(e,t){return t===void 0&&(t=.1),new Qp(e,t)},r})();var ej={sgd:No.sgd,momentum:No.momentum,adadelta:No.adadelta,adagrad:No.adagrad,rmsprop:No.rmsprop,adamax:No.adamax,adam:No.adam};var tj=(function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}})();function rj(){return new Promise(function(r){return tj(function(){return r()})})}function nj(r,e){var t=r[0].length;r.forEach(function(a,i){X(a.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+i+"] must be the same "+("as the rank of the rest ("+t+")")})}),X(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var n=r[0];r.forEach(function(a,i){for(var o=0;o<t;o++)X(o===e||a[o]===n[o],function(){return"Error in concat"+t+"D: Shape of tensors["+i+"] ("+a+") "+("does not match the shape of the rest ("+n+") ")+("along the non-concatenated axis "+i+".")})})}function aj(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}var _i;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(_i||(_i={}));function ij(r,e,t){var n=new Array;if(t==null&&e==null)return n;if(e==null)for(;n.length<r+t.length;)n.push(-1);else n=e.slice();if(t==null)return n;if(r+t.length!==n.length)throw new Error("rt input.shape and shape="+e+" are incompatible: rt input.rank = "+(r+t.length)+", but shape.rank = "+n.length);for(var a=1;a<t.length;++a){var i=t[a],o=n[n.length-t.length+a],s=n[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape="+e+" are incompatible: rt input.shape["+(a+r)+"] = "+i+" but shape["+(a+r)+"] = "+s)}else n[o]=i}return n}function oj(r){var e,t,n={FIRST_DIM_SIZE:_i.FIRST_DIM_SIZE,VALUE_ROWIDS:_i.VALUE_ROWIDS,ROW_LENGTHS:_i.ROW_LENGTHS,ROW_SPLITS:_i.ROW_SPLITS,ROW_LIMITS:_i.ROW_LIMITS,ROW_STARTS:_i.ROW_STARTS},a=[];try{for(var i=Tn(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s in n)a.push(n[s]);else break}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return a}function sj(r){return r.length===0?0:r[0]===_i.FIRST_DIM_SIZE?r.length-1:r.length}function uj(r,e){if(!(r==null||e==null)){var t=r.length,n=e.length;if(t>=n)throw new Error("defaultValue.shape="+r+" and ragged tensor flatValues.shape="+e+", are incompatible: defaultValue.rank = "+t+" must be less than ragged tensor input flatValues.rank = "+n+")");for(var a=0;a<Math.min(t,n-1);++a){var i=r[a],o=e[a+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error("defaultValue.shape="+r+", and ragged tensor input flatValues.shape="+e+" are incompatible: defaultValue.shape["+(a-r.length)+"] = "+i+" but ragged tensor input.flatValues.shape["+(a-r.length)+"] = "+o)}}}var ly=30;function lj(r){return r<=ly?r:Sp(r,Math.floor(Math.sqrt(r)))}function cj(r,e,t){var n=t*(typeof r=="number"?r:r[0]),a=e*(typeof r=="number"?r:r[1]);return[n,a]}function fj(r,e,t,n){n===void 0&&(n=!0);var a=[];if(n)a=a.concat(e.slice(0)),a.push(r[0]/t),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var i=e.length,o=0;o<i;++o)a=a.concat([r[o+1]/e[o],e[o]]);a=a.concat(r.slice(i+1))}return a}function hj(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var a=e+1;a<r;++a)a<=2*e?(n.push(a),n.push(a-(e+1))):n.push(a)}else{for(var i=[],o=[],a=1;a<r;++a)a>=e*2+1||a%2===1?o.push(a):i.push(a);n.push.apply(n,Rt(i)),n.push(0),n.push.apply(n,Rt(o))}return n}function pj(r,e,t,n){n===void 0&&(n=!0);var a=[];n?a.push(r[0]/t):a.push(r[0]*t);for(var i=1;i<r.length;++i)i<=e.length?n?a.push(e[i-1]*r[i]):a.push(r[i]/e[i-1]):a.push(r[i]);return a}function dj(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function vj(r,e,t){for(var n=r.slice(0,1),a=0;a<t;++a)n.push(r[a+1]-e[a][0]-e[a][1]);return n}var mj=1.7580993408473768,gj=1.0507009873554805;var yj=.3275911,bj=.254829592,wj=-.284496736,xj=1.421413741,kj=-1.453152027,Sj=1.061405429;function Ej(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+(r.length+", imag: "+e.length+"."));for(var t=new Float32Array(r.length*2),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function Tj(r){for(var e=new Float32Array(r.length/2),t=new Float32Array(r.length/2),n=0;n<r.length;n+=2)e[n/2]=r[n],t[n/2]=r[n+1];return{real:e,imag:t}}function Ij(r){for(var e=Math.ceil(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=0;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function Nj(r){for(var e=Math.floor(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=2;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function Cj(r,e){var t=r[e*2],n=r[e*2+1];return{real:t,imag:n}}function Aj(r,e,t,n){r[n*2]=e,r[n*2+1]=t}function _j(r,e){for(var t=new Float32Array(r/2),n=new Float32Array(r/2),a=0;a<Math.ceil(r/2);a++){var i=(e?2:-2)*Math.PI*(a/r);t[a]=Math.cos(i),n[a]=Math.sin(i)}return{real:t,imag:n}}function Dj(r,e,t){var n=(t?2:-2)*Math.PI*(r/e),a=Math.cos(n),i=Math.sin(n);return{real:a,imag:i}}var tg="->",Fj=/->/g,jk=",",Xk="...";function Rj(r,e){r=r.replace(/\s/g,"");var t=(r.length-r.replace(Fj,"").length)/tg.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error('Equation must contain exactly one arrow ("'+tg+'").');var n=qe(r.split(tg),2),a=n[0],i=n[1];X(a.indexOf(Xk)===-1,function(){return'The ellipsis notation ("'+Xk+'") is not supported yet.'});var o=a.split(jk),s=o.length;if(e!==s)throw new Error("Expected "+s+" input tensors, received "+e);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],l=function(g){var y=i[g];if(!o.some(function(b){return b.indexOf(y)!==-1}))throw new Error("Output subscripts contain the label "+y+" not present in the input subscripts.");u.indexOf(y)===-1&&u.push(y)},c=0;c<i.length;++c)l(c);for(var c=0;c<a.length;++c){var f=a[c];u.indexOf(f)===-1&&f!==jk&&u.push(f)}for(var h=new Array(o.length),c=0;c<s;++c){if(new Set(o[c].split("")).size!==o[c].length)throw new Error("Found duplicate axes in input component "+o[c]+". Support for duplicate axes in input is not implemented yet.");h[c]=[];for(var p=0;p<o[c].length;++p)h[c].push(u.indexOf(o[c][p]))}for(var d=u.length,v=i.length,m=[],c=v;c<d;++c)m.push(c);return{allDims:u,summedDims:m,idDims:h}}function Mj(r,e){var t=new Array(r);t.fill(-1);for(var n=0;n<e.length;++n)t[e[n]]=n;for(var a=[],n=0;n<r;++n)t[n]===-1&&a.push(n);return t=t.filter(function(i){return i!==-1}),{permutationIndices:t,expandDims:a}}function Oj(r,e,t){for(var n=new Array(r),a=function(o){for(var s=t[o].shape,u=function(c){n[e[o][c]]===void 0?n[e[o][c]]=s[c]:X(n[e[o][c]]===s[c],function(){return"Expected dimension "+n[e[o][c]]+" at axis "+c+" "+("of input shaped "+JSON.stringify(s)+", ")+("but got dimension "+s[c])})},l=0;l<e[o].length;++l)u(l)},i=0;i<t.length;++i)a(i)}function Pj(r,e){var t,n,a=r,i=[],o=0;r.length===0&&a.push(-1),o=r.length+1;for(var s=0;s<o;++s)i.push([]);for(var u=[],s=0;s<a.length;++s){var l=a[s],c=Bj(e,l);try{for(var f=(t=void 0,Tn(c)),h=f.next();!h.done;h=f.next()){var p=h.value;u.indexOf(p)===-1&&(i[s].push(p),u.push(p))}}catch(v){t={error:v}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}}return{path:a,steps:i}}function Lj(r){return r.every(function(e,t){return e===t})}function Bj(r,e){for(var t=[],n=0;n<r.length;++n)(r[n].length===0||r[n].indexOf(e)!==-1||e===-1)&&t.push(n);return t}function zj(r,e,t){t===void 0&&(t=0);var n=[];if(typeof e=="number")X(r.shape[t]%e===0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(r.shape[t]/e);else{var a=e.reduce(function(s,u){return u===-1&&(s+=1),s},0);X(a<=1,function(){return"There should be only one negative value in split array."});var i=e.indexOf(-1);if(i!==-1){var o=e.reduce(function(s,u){return u>0?s+u:s});e[i]=r.shape[t]-o}X(r.shape[t]===e.reduce(function(s,u){return s+u}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e}return n}function $j(r){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = `+r}function Wj(r,e){return"indices("+r+", 0) is invalid: "+e+" < 0"}function Vj(r,e,t){return"indices("+r+", 0) is invalid: "+e+" >= "+t}function Uj(r,e){return"only one output dimension may be -1, not both "+r+" and "+e}function Gj(r,e){return"size "+r+" must be non-negative, not "+e}function Hj(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function qj(r,e){var t=rr(r),n=rr(e);return"Input to reshape is a SparseTensor with "+t+`
  dense values, but the requested shape requires a multiple of `+n+". inputShape="+r+" outputShape= "+e}function Kj(r,e){var t=rr(r),n=rr(e);return"Input to reshape is a tensor with "+t+" dense values, but the requested shape has "+n+". inputShape="+r+" outputShape="+e}function jj(){return"segment ids must be >= 0"}function Xj(){return"segment ids are not increasing"}function Yj(r,e){return"Segment id "+r+" out of range [0, "+e+"), possibly because segmentIds input is not sorted."}function Zj(r,e,t){return"Bad: indices["+r+"] == "+e+" out of range [0, "+t+")"}function Qj(r,e){var t=!1,n;for(r<=ly?(n=r,t=!0):n=Sp(r,Math.floor(Math.sqrt(r)));!t;)n>e||n===r?t=!0:n=Sp(r,n+1);return n}function Jj(r,e,t){for(var n=[],a=r.length,i=0;i<a;i++)i!==e?n.push(r[i]):n.push(t);return n}function e7(r,e,t,n){var a=e.shape.length,i=r.shape.length;if(n!==0&&(n<-a||n>a))throw new Error("Expect batchDims in the range of [-"+a+", "+a+"], but got "+n);if(n<0&&(n+=a),n>i)throw new Error("batchDims ("+n+`) must be less than rank(x) (
    `+i+").");if(t<n)throw new Error("batchDims ("+n+") must be less than or equal to axis ("+t+").");for(var o=0;o<n;++o)if(r.shape[o]!==e.shape[o])throw new Error("x.shape["+o+"]: "+r.shape[o]+" should be equal to indices.shape["+o+"]: "+e.shape[o]+".");for(var s=r.shape[t],u=[],l=1,c=1,f=1,o=0;o<n;++o)u.push(r.shape[o]),l*=r.shape[o];for(var o=n;o<t;o++)u.push(r.shape[o]),c*=r.shape[o];for(var o=n;o<a;o++)u.push(e.shape[o]);for(var o=t+1;o<i;o++)u.push(r.shape[o]),f*=r.shape[o];return{batchSize:l,sliceSize:f,outerSize:c,dimSize:s,outputShape:u}}var t7={__proto__:null,segOpComputeOptimalWindowSize:Qj,computeOutShape:Jj,collectGatherOpShapeInfo:e7};function r7(r){try{return r.map(function(e){return Np(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: "+e)}}function n7(r){return r.map(function(e){return tf(e)})}var a7={__proto__:null,slice_util:zT,segment_util:t7,fromUint8ToStringArray:r7,fromStringArrayToUint8:n7,upcastType:zp,axesAreInnerMostDims:Qg,combineLocations:eI,computeOutAndReduceShapes:EH,expandShapeToKeepDim:of,assertAxesAreInnerMostDims:TH,getAxesPermutation:IH,getUndoAxesPermutation:NH,getInnerMostAxes:CH,getBroadcastDims:IT,getReductionAxes:Hg,assertAndGetBroadcastShape:Wr,assertParamsConsistent:nj,computeOutShape:aj,computeDilation2DInfo:YU,computePool2DInfo:HT,computePool3DInfo:ZU,computeConv2DInfo:nf,computeConv3DInfo:qT,computeDefaultPad:Yg,tupleValuesAreOne:Kc,eitherStridesOrDilationsAreOne:no,convertConv2DDataFormat:KT,checkPadOnDimRoundingMode:Ma,getFusedDyActivation:Kp,getFusedBiasGradient:jp,applyActivation:Xp,shouldFuse:Yp,get RowPartitionType(){return _i},combineRaggedTensorToTensorShapes:ij,getRowPartitionTypesHelper:oj,getRaggedRank:sj,validateDefaultValueShape:uj,PARALLELIZE_THRESHOLD:ly,computeOptimalWindowSize:lj,getImageCenter:cj,getReshaped:fj,getPermuted:hj,getReshapedPermuted:pj,getSliceBeginCoords:dj,getSliceSize:vj,prepareAndValidate:AT,validateUpdateShape:qg,validateInput:Kg,calculateShapes:_T,SELU_SCALEALPHA:mj,SELU_SCALE:gj,ERF_P:yj,ERF_A1:bj,ERF_A2:wj,ERF_A3:xj,ERF_A4:kj,ERF_A5:Sj,warn:Co,log:O$,mergeRealAndImagArrays:Ej,splitRealAndImagArrays:Tj,complexWithEvenIndex:Ij,complexWithOddIndex:Nj,getComplexWithIndex:Cj,assignToTypedArray:Aj,exponents:_j,exponent:Dj,decodeEinsumEquation:Rj,getEinsumPermutation:Mj,checkEinsumDimSizes:Oj,getEinsumComputePath:Pj,isIdentityPermutation:Lj,prepareSplitSize:zj,getSparseFillEmptyRowsIndicesDenseShapeMismatch:$j,getSparseFillEmptyRowsNegativeIndexErrorMessage:Wj,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Vj,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Uj,getSparseReshapeNegativeOutputDimErrorMessage:Gj,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Hj,getSparseReshapeInputOutputMultipleErrorMessage:qj,getSparseReshapeInputOutputMismatchErrorMessage:Kj,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:jj,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Xj,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Yj,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Zj};var i7={__proto__:null,nonMaxSuppressionV3Impl:DI,nonMaxSuppressionV4Impl:FI,nonMaxSuppressionV5Impl:RI,whereImpl:II};D.Abs=l2;D.Acos=c2;D.Acosh=f2;D.AdadeltaOptimizer=Zp;D.AdagradOptimizer=Qp;D.AdamOptimizer=Jp;D.AdamaxOptimizer=ed;D.Add=Fg;D.AddN=h2;D.All=p2;D.Any=d2;D.ArgMax=v2;D.ArgMin=m2;D.Asin=g2;D.Asinh=y2;D.Atan=b2;D.Atan2=x2;D.Atanh=w2;D.AvgPool=k2;D.AvgPool3D=S2;D.AvgPool3DGrad=y$;D.AvgPoolGrad=g$;D.BatchMatMul=E2;D.BatchToSpaceND=T2;D.Bincount=I2;D.BroadcastArgs=N2;D.BroadcastTo=b$;D.Cast=Rg;D.Ceil=C2;D.ClipByValue=A2;D.Complex=_2;D.ComplexAbs=D2;D.Concat=F2;D.Conv2D=R2;D.Conv2DBackpropFilter=M2;D.Conv2DBackpropInput=O2;D.Conv3D=P2;D.Conv3DBackpropFilterV2=w$;D.Conv3DBackpropInputV2=L2;D.Cos=B2;D.Cosh=z2;D.CropAndResize=V2;D.Cumprod=$2;D.Cumsum=W2;D.DataStorage=Yz;D.DenseBincount=U2;D.DepthToSpace=G2;D.DepthwiseConv2dNative=H2;D.DepthwiseConv2dNativeBackpropFilter=q2;D.DepthwiseConv2dNativeBackpropInput=K2;D.Diag=j2;D.Dilation2D=X2;D.Dilation2DBackpropFilter=k$;D.Dilation2DBackpropInput=x$;D.Einsum=Z2;D.Elu=Q2;D.EluGrad=S$;D.Environment=s2;D.Equal=eS;D.Erf=J2;D.Exp=tS;D.ExpandDims=rS;D.Expm1=nS;D.FFT=aS;D.Fill=iS;D.FlipLeftRight=oS;D.Floor=sS;D.FloorDiv=uS;D.FromPixels=ag;D.FusedBatchNorm=lS;D.FusedConv2D=og;D.FusedDepthwiseConv2D=sg;D.GatherNd=fS;D.GatherV2=cS;D.Greater=hS;D.GreaterEqual=pS;D.IFFT=dS;D.Identity=Mg;D.Imag=vS;D.IsFinite=mS;D.IsInf=gS;D.IsNan=yS;D.KernelBackend=Yk;D.LRN=CS;D.LRNGrad=N$;D.LeakyRelu=bS;D.Less=wS;D.LessEqual=xS;D.LinSpace=kS;D.Log=SS;D.Log1p=ES;D.LogSoftmax=T$;D.LogicalAnd=TS;D.LogicalNot=IS;D.LogicalOr=NS;D.LogicalXor=E$;D.LowerBound=I$;D.Max=AS;D.MaxPool=DS;D.MaxPool3D=FS;D.MaxPool3DGrad=A$;D.MaxPoolGrad=C$;D.MaxPoolWithArgmax=RS;D.Maximum=_S;D.Mean=MS;D.Min=OS;D.Minimum=PS;D.MirrorPad=LS;D.Mod=BS;D.MomentumOptimizer=td;D.Multinomial=zS;D.Multiply=$S;D.Neg=WS;D.NonMaxSuppressionV3=US;D.NonMaxSuppressionV4=GS;D.NonMaxSuppressionV5=HS;D.NotEqual=VS;D.OP_SCOPE_SUFFIX=sT;D.OneHot=KS;D.OnesLike=qS;D.Optimizer=Bo;D.OptimizerConstructors=No;D.Pack=jS;D.PadV2=XS;D.Pool=_$;D.Pow=YS;D.Prelu=ZS;D.Prod=QS;D.RMSPropOptimizer=rd;D.RaggedGather=JS;D.RaggedTensorToTensor=eE;D.Range=tE;D.Real=rE;D.RealDiv=Y2;D.Reciprocal=nE;D.Relu=aE;D.Relu6=uE;D.Reshape=iE;D.ResizeBilinear=sE;D.ResizeBilinearGrad=F$;D.ResizeNearestNeighbor=oE;D.ResizeNearestNeighborGrad=D$;D.Reverse=lE;D.RotateWithOffset=KE;D.Round=cE;D.Rsqrt=fE;D.SGDOptimizer=uf;D.ScatterNd=hE;D.SearchSorted=pE;D.Select=dE;D.Selu=vE;D.Sigmoid=wE;D.Sign=bE;D.Sin=gE;D.Sinh=yE;D.Slice=mE;D.Softmax=IE;D.Softplus=xE;D.SpaceToBatchND=EE;D.SparseFillEmptyRows=NE;D.SparseReshape=CE;D.SparseSegmentMean=AE;D.SparseSegmentSum=_E;D.SparseToDense=DE;D.SplitV=TE;D.Sqrt=kE;D.Square=R$;D.SquaredDifference=FE;D.Step=qE;D.StridedSlice=RE;D.StringNGrams=ME;D.StringSplit=OE;D.StringToHashBucketFast=PE;D.Sub=LE;D.Sum=SE;D.Tan=BE;D.Tanh=zE;D.Tensor=zr;D.TensorBuffer=Cp;D.Tile=Og;D.TopK=$E;D.Transform=WE;D.Transpose=yp;D.Unique=VE;D.Unpack=UE;D.UnsortedSegmentSum=GE;D.UpperBound=M$;D.Variable=Gc;D.ZerosLike=HE;D._FusedMatMul=ig;D.abs=va;D.acos=NU;D.acosh=AU;D.add=ht;D.addN=DU;D.all=RU;D.any=OU;D.argMax=LU;D.argMin=zU;D.asin=WU;D.asinh=UU;D.atan=HU;D.atan2=KU;D.atanh=XU;D.avgPool=jT;D.avgPool3d=iG;D.backend=RV;D.backend_util=a7;D.basicLSTMCell=fG;D.batchNorm=Wp;D.batchNorm2d=mG;D.batchNorm3d=yG;D.batchNorm4d=wG;D.batchToSpaceND=XT;D.bincount=YT;D.booleanMaskAsync=K5;D.broadcastArgs=SG;D.broadcastTo=xp;D.broadcast_util=VV;D.browser=YV;D.buffer=eo;D.cast=Ar;D.ceil=IG;D.clipByValue=CG;D.clone=bs;D.complex=Ro;D.concat=Un;D.concat1d=_G;D.concat2d=FG;D.concat3d=MG;D.concat4d=PG;D.conv1d=zG;D.conv2d=Vp;D.conv2dTranspose=VG;D.conv3d=GG;D.conv3dTranspose=jG;D.copyRegisteredKernels=z$;D.cos=YG;D.cosh=QG;D.cosineWindow=sy;D.cumprod=eH;D.cumsum=rH;D.customGrad=Fi;D.denseBincount=aH;D.deprecationWarn=wV;D.depthToSpace=oH;D.depthwiseConv2d=Zg;D.device_util=gW;D.diag=lH;D.dilation2d=fH;D.disableDeprecationWarnings=bV;D.dispose=En;D.disposeVariables=xV;D.div=tr;D.divNoNan=mH;D.dot=yH;D.dropout=iK;D.einsum=wH;D.elu=JT;D.enableDebugMode=yV;D.enableProdMode=gV;D.enclosingPowerOfTwo=CI;D.engine=kV;D.env=kt;D.equal=QT;D.erf=SH;D.euclideanNorm=LH;D.exp=Es;D.expandDims=ds;D.expm1=WH;D.eye=rI;D.fft=ny;D.fill=af;D.findBackend=_V;D.findBackendFactory=DV;D.floor=nI;D.floorDiv=GT;D.fused=wK;D.gather=aI;D.gatherND=rK;D.gather_util=ZV;D.getBackend=CV;D.getGradient=ug;D.getKernel=Ep;D.getKernelsForBackend=Tp;D.grad=lq;D.grads=cq;D.greater=Gp;D.greaterEqual=iI;D.ifft=Op;D.imag=$p;D.image=X8;D.inTopKAsync=sK;D.io=dV;D.irfft=SI;D.isFinite=XH;D.isInf=ZH;D.isNaN=JH;D.keep=TT;D.kernel_impls=i7;D.leakyRelu=oI;D.less=rq;D.lessEqual=Jg;D.linalg=Y8;D.linspace=aq;D.localResponseNormalization=oq;D.log=Xc;D.log1p=sI;D.logSigmoid=vq;D.logSoftmax=yq;D.logSumExp=cI;D.logicalAnd=Rp;D.logicalNot=fI;D.logicalOr=hI;D.logicalXor=Eq;D.losses=Z8;D.lowerBound=Iq;D.matMul=Pt;D.math=WV;D.max=Ku;D.maxPool=pI;D.maxPool3d=Aq;D.maxPoolWithArgmax=Dq;D.maximum=dI;D.mean=Mp;D.memory=SV;D.meshgrid=Mq;D.min=Ng;D.minimum=vI;D.mirrorPad=Lq;D.mod=zq;D.moments=Wq;D.movingAverage=X5;D.mul=Oe;D.multiRNNCell=Uq;D.multinomial=Hq;D.neg=Ji;D.nextFrame=rj;D.norm=Up;D.notEqual=mI;D.oneHot=kg;D.ones=ys;D.onesLike=jq;D.op=re;D.outerProduct=Yq;D.pad=sf;D.pad1d=Jq;D.pad2d=t6;D.pad3d=n6;D.pad4d=i6;D.pool=c6;D.pow=jc;D.prelu=yI;D.print=bT;D.prod=p6;D.profile=EV;D.raggedGather=v6;D.raggedTensorToTensor=g6;D.rand=b6;D.randomGamma=A6;D.randomNormal=bI;D.randomStandardNormal=F6;D.randomUniform=wI;D.range=Yc;D.ready=NV;D.real=qc;D.reciprocal=O6;D.registerBackend=FV;D.registerGradient=P$;D.registerKernel=jE;D.relu=qp;D.relu6=xI;D.removeBackend=AV;D.reshape=Te;D.reverse=Ts;D.reverse1d=$6;D.reverse2d=V6;D.reverse3d=G6;D.reverse4d=q6;D.rfft=ay;D.round=kI;D.rsqrt=X6;D.scalar=Lt;D.scatterND=Z5;D.scatter_util=QV;D.searchSorted=ey;D.selu=Z6;D.separableConv2d=J6;D.serialization=lU;D.setBackend=IV;D.setPlatform=MV;D.setdiff1dAsync=t5;D.sigmoid=qu;D.sign=n5;D.signal=j8;D.sin=i5;D.sinh=s5;D.slice=yr;D.slice1d=l5;D.slice2d=f5;D.slice3d=p5;D.slice4d=v5;D.slice_util=zT;D.softmax=g5;D.softplus=lI;D.spaceToBatchND=gI;D.sparse=Q8;D.sparseToDense=eK;D.spectral=K8;D.split=Zc;D.sqrt=to;D.square=si;D.squaredDifference=EI;D.squeeze=iy;D.stack=Qc;D.step=TI;D.stridedSlice=C5;D.string=J8;D.sub=Et;D.sum=er;D.sumOutType=uW;D.tan=_5;D.tanh=Ig;D.tensor=Uu;D.tensor1d=oi;D.tensor2d=$c;D.tensor3d=NT;D.tensor4d=D5;D.tensor5d=F5;D.tensor6d=R5;D.tensor_util=fW;D.test_util=bU;D.tidy=$r;D.tile=zc;D.time=TV;D.topk=O5;D.train=ej;D.transpose=Dp;D.truncatedNormal=L5;D.unique=z5;D.unregisterGradient=B$;D.unregisterKernel=L$;D.unsortedSegmentSum=W5;D.unstack=oy;D.upcastType=zp;D.upperBound=U5;D.util=Y$;D.valueAndGrad=fq;D.valueAndGrads=hq;D.variable=G5;D.variableGrads=uI;D.version_core=wU;D.where=Zu;D.whereAsync=NI;D.zeros=Qu;D.zerosLike=ma});var GI=gr((jHe,UI)=>{UI.exports=ir;var Oa=null;try{Oa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ir(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}ir.prototype.__isLong__;Object.defineProperty(ir.prototype,"__isLong__",{value:!0});function Kn(r){return(r&&r.__isLong__)===!0}ir.isLong=Kn;var MI={},OI={};function Rs(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=OI[r],n)?n:(t=or(r,(r|0)<0?-1:0,!0),a&&(OI[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=MI[r],n)?n:(t=or(r,r<0?-1:0,!1),a&&(MI[r]=t),t))}ir.fromInt=Rs;function Pa(r,e){if(isNaN(r))return e?Fs:La;if(e){if(r<0)return Fs;if(r>=zI)return VI}else{if(r<=-LI)return qn;if(r+1>=LI)return WI}return r<0?Pa(-r,e).neg():or(r%rl|0,r/rl|0,e)}ir.fromNumber=Pa;function or(r,e,t){return new ir(r,e,t)}ir.fromBits=or;var nd=Math.pow;function fy(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return La;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return fy(r.substring(1),e,t).neg();for(var a=Pa(nd(t,8)),i=La,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var l=Pa(nd(t,s));i=i.mul(l).add(Pa(u))}else i=i.mul(a),i=i.add(Pa(u))}return i.unsigned=e,i}ir.fromString=fy;function li(r,e){return typeof r=="number"?Pa(r,e):typeof r=="string"?fy(r,e):or(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}ir.fromValue=li;var PI=65536,o7=1<<24,rl=PI*PI,zI=rl*rl,LI=zI/2,BI=Rs(o7),La=Rs(0);ir.ZERO=La;var Fs=Rs(0,!0);ir.UZERO=Fs;var tl=Rs(1);ir.ONE=tl;var $I=Rs(1,!0);ir.UONE=$I;var cy=Rs(-1);ir.NEG_ONE=cy;var WI=or(-1,2147483647,!1);ir.MAX_VALUE=WI;var VI=or(-1,-1,!0);ir.MAX_UNSIGNED_VALUE=VI;var qn=or(0,-2147483648,!1);ir.MIN_VALUE=qn;var De=ir.prototype;De.toInt=function(){return this.unsigned?this.low>>>0:this.low};De.toNumber=function(){return this.unsigned?(this.high>>>0)*rl+(this.low>>>0):this.high*rl+(this.low>>>0)};De.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(qn)){var t=Pa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Pa(nd(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),l=o.sub(u.mul(i)).toInt()>>>0,c=l.toString(e);if(o=u,o.isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}};De.getHighBits=function(){return this.high};De.getHighBitsUnsigned=function(){return this.high>>>0};De.getLowBits=function(){return this.low};De.getLowBitsUnsigned=function(){return this.low>>>0};De.getNumBitsAbs=function(){if(this.isNegative())return this.eq(qn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};De.isZero=function(){return this.high===0&&this.low===0};De.eqz=De.isZero;De.isNegative=function(){return!this.unsigned&&this.high<0};De.isPositive=function(){return this.unsigned||this.high>=0};De.isOdd=function(){return(this.low&1)===1};De.isEven=function(){return(this.low&1)===0};De.equals=function(e){return Kn(e)||(e=li(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};De.eq=De.equals;De.notEquals=function(e){return!this.eq(e)};De.neq=De.notEquals;De.ne=De.notEquals;De.lessThan=function(e){return this.comp(e)<0};De.lt=De.lessThan;De.lessThanOrEqual=function(e){return this.comp(e)<=0};De.lte=De.lessThanOrEqual;De.le=De.lessThanOrEqual;De.greaterThan=function(e){return this.comp(e)>0};De.gt=De.greaterThan;De.greaterThanOrEqual=function(e){return this.comp(e)>=0};De.gte=De.greaterThanOrEqual;De.ge=De.greaterThanOrEqual;De.compare=function(e){if(Kn(e)||(e=li(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};De.comp=De.compare;De.negate=function(){return!this.unsigned&&this.eq(qn)?qn:this.not().add(tl)};De.neg=De.negate;De.add=function(e){Kn(e)||(e=li(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,l=e.low&65535,c=0,f=0,h=0,p=0;return p+=i+l,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,c+=f>>>16,f&=65535,c+=t+o,c&=65535,or(h<<16|p,c<<16|f,this.unsigned)};De.subtract=function(e){return Kn(e)||(e=li(e)),this.add(e.neg())};De.sub=De.subtract;De.multiply=function(e){if(this.isZero())return La;if(Kn(e)||(e=li(e)),Oa){var t=Oa.mul(this.low,this.high,e.low,e.high);return or(t,Oa.get_high(),this.unsigned)}if(e.isZero())return La;if(this.eq(qn))return e.isOdd()?qn:La;if(e.eq(qn))return this.isOdd()?qn:La;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(BI)&&e.lt(BI))return Pa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,l=e.low>>>16,c=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*c,p+=d>>>16,d&=65535,p+=i*c,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,h+=a*c,f+=h>>>16,h&=65535,h+=i*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*c+a*l+i*u+o*s,f&=65535,or(p<<16|d,f<<16|h,this.unsigned)};De.mul=De.multiply;De.divide=function(e){if(Kn(e)||(e=li(e)),e.isZero())throw Error("division by zero");if(Oa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Oa.div_u:Oa.div_s)(this.low,this.high,e.low,e.high);return or(t,Oa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Fs:La;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Fs;if(e.gt(this.shru(1)))return $I;i=Fs}else{if(this.eq(qn)){if(e.eq(tl)||e.eq(cy))return qn;if(e.eq(qn))return tl;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(La)?e.isNegative()?tl:cy:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(qn))return this.unsigned?Fs:La;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=La}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:nd(2,s-48),l=Pa(n),c=l.mul(e);c.isNegative()||c.gt(a);)n-=u,l=Pa(n,this.unsigned),c=l.mul(e);l.isZero()&&(l=tl),i=i.add(l),a=a.sub(c)}return i};De.div=De.divide;De.modulo=function(e){if(Kn(e)||(e=li(e)),Oa){var t=(this.unsigned?Oa.rem_u:Oa.rem_s)(this.low,this.high,e.low,e.high);return or(t,Oa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};De.mod=De.modulo;De.rem=De.modulo;De.not=function(){return or(~this.low,~this.high,this.unsigned)};De.and=function(e){return Kn(e)||(e=li(e)),or(this.low&e.low,this.high&e.high,this.unsigned)};De.or=function(e){return Kn(e)||(e=li(e)),or(this.low|e.low,this.high|e.high,this.unsigned)};De.xor=function(e){return Kn(e)||(e=li(e)),or(this.low^e.low,this.high^e.high,this.unsigned)};De.shiftLeft=function(e){return Kn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?or(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):or(0,this.low<<e-32,this.unsigned)};De.shl=De.shiftLeft;De.shiftRight=function(e){return Kn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?or(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):or(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};De.shr=De.shiftRight;De.shiftRightUnsigned=function(e){if(Kn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return or(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?or(t,0,this.unsigned):or(t>>>e-32,0,this.unsigned)};De.shru=De.shiftRightUnsigned;De.shr_u=De.shiftRightUnsigned;De.toSigned=function(){return this.unsigned?or(this.low,this.high,!1):this};De.toUnsigned=function(){return this.unsigned?this:or(this.low,this.high,!0)};De.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};De.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};De.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};ir.fromBytes=function(e,t,n){return n?ir.fromBytesLE(e,t):ir.fromBytesBE(e,t)};ir.fromBytesLE=function(e,t){return new ir(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};ir.fromBytesBE=function(e,t){return new ir(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var R3=gr(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});var z=Ds();function s7(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var F=s7(z),xy=function(r,e){return xy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},xy(r,e)};function be(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");xy(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ae(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function Ce(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function ke(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ye(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function pt(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(ye(arguments[e]));return r}var $o=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error),Oi=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error),ce=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error),wt=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error),u7=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error);(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error);var YN=(function(){function r(e){this.maxEntries=e||100,this.cache=new Map}return r.prototype.get=function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t},r.prototype.put=function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)},r.prototype.getMaxEntries=function(){return this.maxEntries},r.prototype.setMaxEntries=function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got "+e+".");if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e},r})();function $s(r,e){if(Array.isArray(r)){for(var t=[],n=0;n<e;n++)t=t.concat(r);return t}else{var t=new Array(e);return t.fill(r),t}}function Ri(r,e){if(!r)throw new u7(e)}function HI(r,e){var t,n,a=0;try{for(var i=ke(r),o=i.next();!o.done;o=i.next()){var s=o.value;s===e&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function In(r){return r.length===1?r[0]:r}function sr(r){return Array.isArray(r)?r:[r]}function io(r){var e=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ps(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var Ba={};function Uy(r){if(r==null)return null;var e={};return e.className=r.getClassName(),e.config=r.getConfig(),e}function ky(r){var e,t;if(!(r==null||typeof r!="object"))if(Array.isArray(r))r.forEach(function(u){return ky(u)});else{var n=Object.keys(r);try{for(var a=ke(n),i=a.next();!i.done;i=a.next()){var o=i.value,s=r[o];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?r[o]=s.value:ky(s))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}}function Ff(r,e,t,n,a){var i,o,s,u,l,c,f,h,p,d,v;if(e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n="object"),a===void 0&&(a=!1),typeof r=="string"){var m=r,g=void 0;if(m in t)g=t[m];else if(m in Ba)g=Ba[m];else if(g=e[m],g==null)throw new ce("Unknown "+n+": "+r+`. This may be due to one of the following reasons:
`+("1. The "+n+" is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+("2. The custom "+n+" is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return g}else{var y=r;if(y.className==null||y.config==null)throw new ce(n+": Improper config format: "+(JSON.stringify(y)+`.
`)+"'className' and 'config' must set.");var b=y.className,w=void 0,k=void 0;if(b in t?(i=ye(t[b],2),w=i[0],k=i[1]):b in Ba?(o=ye(Ba.className,2),w=o[0],k=o[1]):b in e&&(s=ye(e[b],2),w=s[0],k=s[1]),w==null)throw new ce("Unknown "+n+": "+b+`. This may be due to one of the following reasons:
`+("1. The "+n+" is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+("2. The custom "+n+" is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(k!=null){var S={};try{for(var E=ke(Object.keys(Ba)),N=E.next();!N.done;N=E.next()){var C=N.value;S[C]=Ba[C]}}catch($){u={error:$}}finally{try{N&&!N.done&&(l=E.return)&&l.call(E)}finally{if(u)throw u.error}}try{for(var R=ke(Object.keys(t)),_=R.next();!_.done;_=R.next()){var C=_.value;S[C]=t[C]}}catch($){c={error:$}}finally{try{_&&!_.done&&(f=R.return)&&f.call(R)}finally{if(c)throw c.error}}var O=y.config;O.customObjects=S;var P=Object.assign({},Ba);try{for(var B=ke(Object.keys(t)),W=B.next();!W.done;W=B.next()){var C=W.value;Ba[C]=t[C]}}catch($){h={error:$}}finally{try{W&&!W.done&&(p=B.return)&&p.call(B)}finally{if(h)throw h.error}}ky(y.config);var L=k(w,y.config,t,a);return Ba=Object.assign({},P),L}else{var P=Object.assign({},Ba);try{for(var G=ke(Object.keys(t)),M=G.next();!M.done;M=G.next()){var C=M.value;Ba[C]=t[C]}}catch(j){d={error:j}}finally{try{M&&!M.done&&(v=G.return)&&v.call(G)}finally{if(d)throw d.error}}var L=new w(y.config);return Ba=Object.assign({},P),L}}}function l7(r,e){return r<e?-1:r>e?1:0}function ad(r,e){return-1*l7(r,e)}function Wo(r){var e,t;if(r==null)return r;var n=[];try{for(var a=ke(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.indexOf(o)===-1&&n.push(o)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function c7(r){if(r==null)throw new ce("Invalid value in obj: "+JSON.stringify(r));for(var e in r)if(r.hasOwnProperty(e))return!1;return!0}function Us(r,e,t){if(t!=null&&r.indexOf(t)<0)throw new ce(t+" is not a valid "+e+".  Valid values are "+r+" or null/undefined.")}function Gy(r,e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1/0),Ri(t>=0),Ri(n>=t),Array.isArray(r)&&r.length>=t&&r.length<=n&&r.every(function(a){return typeof a===e})}function Qr(r,e){Array.isArray(r)?(z.util.assert(r.length>0,function(){return e+" is unexpectedly an empty array."}),r.forEach(function(t,n){return Qr(t,"element "+(n+1)+" of "+e)})):z.util.assert(Number.isInteger(r)&&r>0,function(){return"Expected "+e+" to be a positive integer, but got "+(ZN(r)+".")})}function ZN(r){return r===null?"null":Array.isArray(r)?"["+r.map(function(e){return ZN(e)}).join(",")+"]":typeof r=="string"?'"'+r+'"':""+r}function f7(r,e,t){var n=t!=null?t():z.util.now(),a,i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=t!=null?t():z.util.now();return u-n<e||(n=u,a=r.apply(void 0,pt(o))),a};return i}function QN(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}var h7=0;function JN(){return h7++}var id={};function Od(r){return r===void 0&&(r=""),r in id||(id[r]=0),id[r]+=1,r+id[r].toString()}var p7=["channelsFirst","channelsLast"],d7=["nearest","bilinear"],v7=["valid","same","causal"],m7=["max","avg"],g7=["sum","mul","concat","ave"];var nl=new Map;function Lr(r){Us(p7,"DataFormat",r)}function y7(r){Us(d7,"InterpolationFormat",r)}function xa(r){Us(v7,"PaddingMode",r)}function eC(r){Us(m7,"PoolMode",r)}var wf=[],qI="/";function Bs(r,e){wf.push(r);try{var t=e();return wf.pop(),t}catch(n){throw wf.pop(),n}}function b7(){return wf.length===0?"":wf.join(qI)+qI}function tC(r){if(!nC(r))throw new Error("Not a valid tensor name: '"+r+"'");return b7()+r}function rC(r){if(!nC(r))throw new Error("Not a valid tensor name: '"+r+"'");nl.has(r)||nl.set(r,0);var e=nl.get(r);if(nl.set(r,nl.get(r)+1),e>0){var t=r+"_"+e;return nl.set(t,1),t}else return r}var w7=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function nC(r){return!!r.match(w7)}function x7(r){return r===parseInt(r.toString(),10)}function Vo(r,e,t){e==null&&(e=0),t==null&&(t=r.length);for(var n=1,a=e;a<t;++a)n*=r[a];return n}function fl(r){if(r.length===0)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n<e&&(e=n)}return e}function Uo(r){if(r.length===0)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n>e&&(e=n)}return e}function vi(r,e){if(e<r)throw new ce("end ("+e+") < begin ("+r+") is forbidden.");for(var t=[],n=r;n<e;++n)t.push(n);return t}var hy;function qr(){return hy==null&&(hy=z.backend().epsilon()),hy}function mi(){return"channelsLast"}function Rf(r,e){return F.cast(r,e)}function Mf(r,e){e===void 0&&(e=-1);var t=r.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),F.reshape(r,t)}function k7(r,e){return z.tidy(function(){if(r.shape.length!==2)throw new ce("repeat() expects a rank-2 tensor, but received a "+("rank-"+r.shape.length+" tensor."));var t=Mf(r,1);return Sy(t,[1,e,1])})}function S7(r){var e=[Vo(r.shape)];return F.reshape(r,e)}function E7(r){if(r.rank<=1)throw new ce("batchFlatten requires a minimum rank of 2. Got rank: "+r.rank+".");var e=[r.shape[0],Vo(r.shape,1)];return F.reshape(r,e)}function zs(r,e,t){return z.tidy(function(){switch(r.rank){case 1:return F.slice1d(r,e,t);case 2:return F.slice2d(r,[e,0],[t,r.shape[1]]);case 3:return F.slice3d(r,[e,0,0],[t,r.shape[1],r.shape[2]]);case 4:return F.slice4d(r,[e,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3]]);case 5:return F.slice(r,[e,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return F.slice(r,[e,0,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new ce("sliceAlongFirstAxis() received an unsupported tensor rank: "+(""+r.rank))}})}function py(r,e,t){return z.tidy(function(){switch(r.rank){case 1:return F.slice1d(r,e,t);case 2:return F.slice2d(r,[0,e],[r.shape[0],t]);case 3:return F.slice3d(r,[0,0,e],[r.shape[0],r.shape[1],t]);case 4:return F.slice4d(r,[0,0,0,e],[r.shape[0],r.shape[1],r.shape[2],t]);default:throw new ce("sliceAlongLastAxis() received an unsupported tensor rank: "+(""+r.rank))}})}function od(r,e,t,n){return z.tidy(function(){switch(r.rank){case 1:return F.slice1d(r,e,t);case 2:switch(n){case 1:return zs(r,e,t);case 2:return py(r,e,t);default:throw new ce("The axis is not within the rank of the tensor "+(""+n))}case 3:switch(n){case 1:return zs(r,e,t);case 2:return F.slice3d(r,[0,e,0],[r.shape[0],t,r.shape[2]]);case 3:return py(r,e,t);default:throw new ce("The axis is not within the rank of the tensor "+(""+n))}case 4:switch(n){case 1:return zs(r,e,t);case 2:return F.slice4d(r,[0,e,0,0],[r.shape[0],t,r.shape[2],r.shape[3]]);case 3:return F.slice4d(r,[0,0,e,0],[r.shape[0],r.shape[1],t,r.shape[3]]);case 4:return py(r,e,t);default:throw new ce("The axis is not within the rank of the tensor "+(""+n))}default:throw new ce("sliceAlongLastAxis() received an unsupported tensor rank: "+(""+r.rank))}})}function Hy(r,e){e===void 0&&(e=-1);var t;return e<0&&(t=r[0].rank,t!==0?e=t:e=0),e===r[0].rank&&(e=-1),F.concat(r,e)}function KI(r,e){switch(r.rank){case 1:return F.concat1d([r,e]);case 2:return F.concat2d([r,e],0);case 3:return F.concat3d([r,e],0);case 4:return F.concat4d([r,e],0);default:throw new ce("concatAlongFirstAxis() received an unsupported "+("tensor rank: "+r.rank))}}function Sy(r,e){if(Array.isArray(e)||(e=[e]),r.rank!==e.length)throw new ce("The length of input n ("+e.length+") does not match "+("the number of dimensions in input x ("+r.rank+")"));return F.tile(r,e)}function Pd(r,e,t,n,a){return e===void 0&&(e=0),t===void 0&&(t=1),F.randomNormal(r,e,t,n,a)}function Pi(r,e,t,n){if(r.rank<2||e.rank<2)throw new wt("dot requires both inputs to be rank >= 2"+(" but got x shape = "+r.shape+" and y shape = "+e.shape));if(e.rank>=3){var a=r.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(a!==i)throw new wt("If rank y >= 3, then the second last dim"+(" of y must equal the last dim of x but got x shape = "+r.shape+" and ")+(" y shape = "+e.shape))}if(r.rank===2&&e.rank===2){var o=!1,s=!1;return F.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?Ey(r.rank,n,mi()):null,activation:t})}else{var u=r.shape.slice(),l=u.pop();r=F.reshape(r,[-1,l]);var c=e.shape.slice(),f=c.pop(),i=c.pop(),h=pt(c,[f]),p=Array.from({length:e.rank},function(y,b){return b===0?e.rank-2:b<=e.rank-2?b-1:b});e=F.reshape(F.transpose(e,p),[i,-1]);var d=pt(u,h),o=!1,s=!1;return F.reshape(F.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?Ey(r.rank,n,mi()):null,activation:t}),d)}}function aC(r,e,t){return z.tidy(function(){return Array.isArray(e)?e=z.tensor1d(e,"int32"):e=F.cast(e,"int32"),F.gather(r,e,t)})}function Of(r){return F.mul(r,r)}function Ey(r,e,t){var n=e.shape;if(e.rank!==1&&e.rank!==r)throw new ce("Unexpected bias dimensions: "+e.rank+("; expected it to be 1 or "+r));if(r===5){if(t==="channelsFirst")return n.length===1?F.reshape(e,[1,n[0],1,1,1]):F.reshape(e,[1,n[3],n[0],n[1],n[2]]);if(t==="channelsLast")return n.length===1?F.reshape(e,[1,1,1,1,n[0]]):F.reshape(e,[1].concat(n))}else if(r===4){if(t==="channelsFirst")return n.length===1?F.reshape(e,[1,n[0],1,1]):F.reshape(e,[1,n[2],n[0],n[1]]);if(t==="channelsLast")return n.length===1?F.reshape(e,[1,1,1,n[0]]):F.reshape(e,[1].concat(n))}else if(r===3){if(t==="channelsFirst")return n.length===1?F.reshape(e,[1,n[0],1]):F.reshape(e,[1,n[1],n[0]]);if(t==="channelsLast")return n.length===1?F.reshape(e,[1,1,n[0]]):F.reshape(e,[1].concat(n))}else if(r<3)return e;throw new ce("Unsupported input rank by biasAdd: "+e.rank)}function gi(r,e,t){return z.tidy(function(){return t==null&&(t=mi()),Lr(t),F.add(r,Ey(r.rank,e,t))})}function T7(r,e){if(e===void 0&&(e=1),e!==1)throw new wt("Support for alpha values other than 1 ("+e+") is not implemented yet.");return F.elu(r)}function I7(r){return z.tidy(function(){return F.div(r,F.add(F.abs(r),1))})}function iC(r,e,t,n){return z.tidy(function(){return F.dropout(r,e,t,n)})}function N7(r){return z.tidy(function(){var e=F.add(.5,F.mul(.2,r));return F.clipByValue(e,0,1)})}function Pf(r,e,t){return t===void 0&&(t=!1),t?r():e()}var C7=["fanIn","fanOut","fanAvg"],A7=["normal","uniform","truncatedNormal"];function _7(r){Us(C7,"FanMode",r)}function D7(r){Us(A7,"Distribution",r)}var Ga=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e})(z.serialization.Serializable),qy=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return z.zeros(t,n)},e})(Ga);qy.className="Zeros";z.serialization.registerClass(qy);var Ld=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return z.ones(t,n)},e})(Ga);Ld.className="Ones";z.serialization.registerClass(Ld);var Ky=(function(r){be(e,r);function e(t){var n=r.call(this)||this;if(typeof t!="object")throw new ce("Expected argument of type ConstantConfig but got "+t);if(t.value===void 0)throw new ce("config must have value set but got "+t);return n.value=t.value,n}return e.prototype.apply=function(t,n){var a=this;return z.tidy(function(){return z.mul(z.scalar(a.value),z.ones(t,n))})},e.prototype.getConfig=function(){return{value:this.value}},e})(Ga);Ky.className="Constant";z.serialization.registerClass(Ky);var jy=(function(r){be(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return e.prototype.apply=function(t,n){return z.randomUniform(t,this.minval,this.maxval,n)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e})(Ga);jy.className="RandomUniform";z.serialization.registerClass(jy);var Xy=(function(r){be(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new wt("randomNormal does not support dType "+n+".");return Pd(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e})(Ga);Xy.className="RandomNormal";z.serialization.registerClass(Xy);var Yy=(function(r){be(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new wt("truncatedNormal does not support dType "+n+".");return z.truncatedNormal(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e})(Ga);Yy.className="TruncatedNormal";z.serialization.registerClass(Yy);var Zy=(function(r){be(e,r);function e(t){var n=r.call(this)||this;return n.gain=t.gain!=null?t.gain:1,n}return e.prototype.apply=function(t,n){var a=this;return z.tidy(function(){if(t.length!==2||t[0]!==t[1])throw new ce("Identity matrix initializer can only be used for 2D square matrices.");return z.mul(a.gain,z.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e})(Ga);Zy.className="Identity";z.serialization.registerClass(Zy);function F7(r,e){e===void 0&&(e="channelsLast");var t,n;if(Lr(e),r.length===2)t=r[0],n=r[1];else if([3,4,5].indexOf(r.length)!==-1){if(e==="channelsFirst"){var a=Vo(r,2);t=r[1]*a,n=r[0]*a}else if(e==="channelsLast"){var a=Vo(r,0,r.length-2);t=r[r.length-2]*a,n=r[r.length-1]*a}}else{var i=Vo(r);t=Math.sqrt(i),n=Math.sqrt(i)}return[t,n]}var Cn=(function(r){be(e,r);function e(t){var n=r.call(this)||this;if(t.scale<0)throw new ce("scale must be a positive float. Got: "+t.scale);return n.scale=t.scale==null?1:t.scale,n.mode=t.mode==null?"fanIn":t.mode,_7(n.mode),n.distribution=t.distribution==null?"normal":t.distribution,D7(n.distribution),n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=F7(t),i=a[0],o=a[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,i):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(i+o)/2),this.distribution==="normal"){var u=Math.sqrt(s);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new wt(this.getClassName()+" does not support dType "+n+".");return z.truncatedNormal(t,0,u,n,this.seed)}else{var l=Math.sqrt(3*s);return z.randomUniform(t,-l,l,n)}},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e})(Ga);Cn.className="VarianceScaling";z.serialization.registerClass(Cn);var Bd=(function(r){be(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cn.className},e})(Cn);Bd.className="GlorotUniform";z.serialization.registerClass(Bd);var zd=(function(r){be(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cn.className},e})(Cn);zd.className="GlorotNormal";z.serialization.registerClass(zd);var $d=(function(r){be(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cn.className},e})(Cn);$d.className="HeNormal";z.serialization.registerClass($d);var Wd=(function(r){be(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cn.className},e})(Cn);Wd.className="HeUniform";z.serialization.registerClass(Wd);var Vd=(function(r){be(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cn.className},e})(Cn);Vd.className="LeCunNormal";z.serialization.registerClass(Vd);var Ud=(function(r){be(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cn.className},e})(Cn);Ud.className="LeCunNormal";z.serialization.registerClass(Ud);var Qy=(function(r){be(e,r);function e(t){var n=r.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=t.gain==null?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,n.seed!=null)throw new wt("Random seed is not implemented for Orthogonal Initializer yet.");return n}return e.prototype.apply=function(t,n){var a=this;return z.tidy(function(){if(t.length<2)throw new wt("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+("than 2000 ("+t[0]*t[1]+") elements: ")+"Slowness may result.");var i=t[0]>t[1]?[t[1],t[0]]:t,o=Pd(i,0,1,"float32"),s=z.linalg.gramSchmidt(o);return t[0]>t[1]&&(s=z.transpose(s)),z.mul(a.gain,s)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e})(Ga);Qy.className="Orthogonal";z.serialization.registerClass(Qy);var jI={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function XI(r,e){return e===void 0&&(e={}),Ff(r,z.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function Tr(r){return Uy(r)}function br(r){if(typeof r=="string"){var e=r in jI?jI[r]:r;if(e==="GlorotNormal")return new zd;if(e==="GlorotUniform")return new Bd;if(e==="HeNormal")return new $d;if(e==="HeUniform")return new Wd;if(e==="LeCunNormal")return new Vd;if(e==="LeCunUniform")return new Ud;var t={};return t.className=e,t.config={},XI(t)}else return r instanceof Ga?r:XI(r)}function Ty(r){return Array.isArray(r)&&Array.isArray(r[0])}function vd(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function gt(r){var e;if(Array.isArray(r)){if(r.length!==1)throw new ce("Expected Tensor length to be 1; got "+r.length);e=r[0]}else e=r;return e}function zt(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return r=r,r[0];throw new ce("Expected exactly 1 Shape; got "+r.length)}else return r}function md(r){var e,t,n=0;try{for(var a=ke(r),i=a.next();!i.done;i=a.next()){var o=i.value;o.shape.length===0?n+=1:n+=o.shape.reduce(function(s,u){return s*u})}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var YI="Variable",oC=(function(){function r(e,t,n,a,i){t===void 0&&(t="float32"),n===void 0&&(n=YI),a===void 0&&(a=!0),i===void 0&&(i=null),this.dtype=t??"float32",this.shape=e.shape,this.id=JN(),n=n??YI,this.originalName=tC(n),this.name=rC(this.originalName),this.trainable_=a,this.constraint=i,this.val=F.variable(e,this.trainable_,this.name,this.dtype)}return r.prototype.read=function(){return this.assertNotDisposed(),this.val},r.prototype.write=function(e){return this.assertNotDisposed(),R7(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},r.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},r.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(r.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!0,configurable:!0}),r})();function R7(r,e){if(r.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(e.shape))}function Iy(r){return r.map(function(e){return e.read()})}function Jy(r){r.forEach(function(e){var t=e[0];t.write(e[1])})}var Vr=(function(){function r(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}return r})(),hi=(function(){function r(e,t,n,a,i,o,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=JN(),o!=null&&(this.originalName=tC(o),this.name=rC(this.originalName)),this.rank=t.length}return r})(),M7=0,Gd=(function(){function r(e,t){var n,a;this.callArgs=t,this.id=M7++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;try{for(var i=ke(e.inboundLayers),o=i.next();!o.done;o=i.next()){var s=o.value;s?.outboundNodes.push(this)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}e.outboundLayer.inboundNodes.push(this)}return r.prototype.getConfig=function(){var e,t,n=[];try{for(var a=ke(this.inboundLayers),i=a.next();!i.done;i=a.next()){var o=i.value;o!=null?n.push(o.name):n.push(null)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},r})(),O7=0,Tt=(function(r){be(e,r);function e(t){t===void 0&&(t={});var n=r.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=O7++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var a=t.name;if(!a){var i=n.getClassName();a=io(i)+"_"+Od(i)}if(n.name=a,n.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var s=null;t.batchSize!=null&&(s=t.batchSize),o=[s].concat(t.inputShape)}n.batchInputShape=o;var u=t.dtype;u==null&&(u=t.inputDType),u==null&&(u="float32"),n.dtype=u}return t.weights!=null?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return e.nodeKey=function(t,n){return t.name+"_ib-"+n.toString()},e.prototype.getNodeAtIndex=function(t,n){if(this.inboundNodes.length===0)throw new Oi("The layer has never been called "+("and thus has no defined "+n+"."));if(this.inboundNodes.length<=t)throw new ce("Asked to get "+n+" at node "+t+", "+("but the layer has only "+this.inboundNodes.length+" inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return In(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return In(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new $o("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new $o("Layer "+this.name+" is not connected, no input to return.");return In(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new $o("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new $o("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return In(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(n){return n.trainable=t}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=sr(t),!(this.inputSpec==null||this.inputSpec.length===0)){var n=sr(this.inputSpec);if(t.length!==n.length)throw new ce("Layer "+this.name+" expects "+n.length+" inputs, "+("but it received "+t.length+" input tensors. ")+("Input received: "+t));for(var a=0;a<t.length;a++){var i=t[a],o=n[a];if(o!=null){var s=i.rank;if(o.ndim!=null&&s!==o.ndim)throw new ce("Input "+a+" is incompatible with layer "+this.name+": "+("expected ndim="+o.ndim+", found ndim="+s));if(o.maxNDim!=null&&s>o.maxNDim)throw new ce("Input "+a+" is incompatible with layer "+this.name+(": expected max_ndim="+o.maxNDim+", found ndim="+s));if(o.minNDim!=null&&s<o.minNDim)throw new ce("Input "+a+" is incompatible with layer "+this.name+(": expected min_ndim="+o.minNDim+", found ndim="+s+"."));if(o.dtype!=null&&i.dtype!==o.dtype)throw new ce("Input "+a+" is incompatible with layer "+this.name+" "+(": expected dtype="+o.dtype+", found dtype="+i.dtype+"."));if(o.axes){var u=i.shape;for(var l in o.axes){var c=Number(l),f=o.axes[l],h=c>=0?u[c]:u[u.length+c];if(f!=null&&[f,null].indexOf(h)===-1)throw new ce("Input "+a+" is incompatible with layer "+(this.name+": expected axis "+c+" of input shape to ")+("have value "+f+" but got shape "+u+"."))}}if(o.shape!=null)for(var p=0;p<o.shape.length;++p){var d=o.shape[p],v=i.shape[p];if(d!=null&&v!=null&&d!==v)throw new ce("Input "+a+" is incompatible with layer "+(this.name+": expected shape="+o.shape+", ")+("found shape="+i.shape+"."))}}}}},e.prototype.call=function(t,n){return t},e.prototype.invokeCallHook=function(t,n){this._callHook!=null&&this._callHook(t,n)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,n){var a,i,o,s,u=this;n=n||{},this.assertNotDisposed();var l=sr(t),c=!0;try{for(var f=ke(l),h=f.next();!h.done;h=f.next()){var p=h.value;if(!(p instanceof hi)){c=!1;break}}}catch(g){a={error:g}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var d=!0;try{for(var v=ke(l),m=v.next();!m.done;m=v.next()){var p=m.value;if(p instanceof hi){d=!1;break}}}catch(g){o={error:g}}finally{try{m&&!m.done&&(s=v.return)&&s.call(v)}finally{if(o)throw o.error}}if(c===d)throw new ce("Arguments to apply() must be all SymbolicTensors or all Tensors");return Bs(this.name,function(){var g,y,b,w;if(!u.built){u.assertInputCompatibility(t);var k=[];try{for(var S=ke(sr(t)),E=S.next();!E.done;E=S.next()){var N=E.value;k.push(N.shape)}}catch(M){g={error:M}}finally{try{E&&!E.done&&(y=S.return)&&y.call(S)}finally{if(g)throw g.error}}u.build(In(k)),u.built=!0,u.initialWeights&&u.setWeights(u.initialWeights),u._refCount===null&&d&&(u._refCount=1)}if(u.assertInputCompatibility(t),d){var C=u.call(t,n),R=sr(C),_=[];try{for(var O=ke(R),P=O.next();!P.done;P=O.next()){var B=P.value;l.indexOf(B)!==-1&&(B=B.clone()),_.push(B)}}catch(M){b={error:M}}finally{try{P&&!P.done&&(w=O.return)&&w.call(O)}finally{if(b)throw b.error}}if(C=In(_),u.activityRegularizer!=null)throw new wt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}else{var W=P7(t),L=u.computeOutputShape(W),C=void 0,G=L7(t);if(u.warnOnIncompatibleInputShape(Array.isArray(t)?W[0]:W),L!=null&&L.length>0&&Array.isArray(L[0])?C=L.map(function($,K){return new hi(G,$,u,sr(t),n,u.name,K)}):C=new hi(G,L,u,sr(t),n,u.name),u.addInboundNode(t,C,null,null,W,L,n),u._refCount++,u.activityRegularizer!=null)throw new wt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+(JSON.stringify(t)+") does not match that of the ")+("batchInputShape ("+JSON.stringify(this.batchInputShape)+") ")+("of the layer "+this.name));else{var n=!1;this.batchInputShape.forEach(function(a,i){a!=null&&t[i]!=null&&t[i]!==a&&(n=!0)}),n&&console.warn("The shape of the input tensor "+("("+JSON.stringify(t)+") does not ")+("match the expectation of layer "+this.name+": ")+(""+JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){var t,n;if(this.inboundNodes==null||this.inboundNodes.length===0)throw new $o("The layer "+this.name+" has never been called and thus has no defined output shape.");var a=[];try{for(var i=ke(this.inboundNodes),o=i.next();!o.done;o=i.next()){var s=o.value,u=JSON.stringify(s.outputShapes);a.indexOf(u)===-1&&a.push(u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}if(a.length===1){var l=this.inboundNodes[0].outputShapes;return Array.isArray(l)&&Array.isArray(l[0])&&l.length===1?l[0]:l}else throw new $o("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new Oi("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return md(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),Iy(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var n=this;z.tidy(function(){var a=n.weights;if(a.length!==t.length)throw new ce('You called setWeights(weights) on layer "'+n.name+'" '+("with a weight list of length "+t.length+", ")+("but the layer was expecting "+a.length+" weights. ")+("Provided weights: "+t+"..."));if(a.length!==0){for(var i=[],o=Iy(a),s=0;s<o.length;++s){var u=o[s],l=a[s],c=t[s];if(!z.util.arraysEqual(u.shape,c.shape))throw new ce("Layer weight shape "+u.shape+" "+("not compatible with provided weight shape "+c.shape));i.push([l,c])}Jy(i)}})},e.prototype.addWeight=function(t,n,a,i,o,s,u,l){if(this._addedWeightNames.indexOf(t)!==-1)throw new ce("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),a==null&&(a="float32"),this.fastWeightInitDuringBuild&&(i=l!=null?l():br("zeros"));var c=i.apply(n,a),f=new oC(c,a,t,s,u);return c.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),s==null&&(s=!0),s?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var n;t==null||Array.isArray(t)&&t.length===0||(t=sr(t),this._losses!==void 0&&this._losses!==null&&(n=this.losses).push.apply(n,pt(t)))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,n){var a=this;if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(function(i){if(i!=null)throw new TypeError("Layer "+a.name+" does not support masking, but was passed an inputMask.")});else throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");return null}return n},e.prototype.addInboundNode=function(t,n,a,i,o,s,u){var l,c;u===void 0&&(u=null);var f=sr(t);n=sr(n),a=sr(a),i=sr(i),o=vd(o),s=vd(s);var h=[],p=[],d=[];try{for(var v=ke(f),m=v.next();!m.done;m=v.next()){var g=m.value;h.push(g.sourceLayer),p.push(g.nodeIndex),d.push(g.tensorIndex)}}catch(b){l={error:b}}finally{try{m&&!m.done&&(c=v.return)&&c.call(v)}finally{if(l)throw l.error}}new Gd({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:d,inputTensors:f,outputTensors:n,inputMasks:a,outputMasks:i,inputShapes:o,outputShapes:s},u);for(var y=0;y<n.length;y++)n[y].sourceLayer=this,n[y].nodeIndex=this.inboundNodes.length-1,n[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e})(z.serialization.Serializable);function P7(r){var e,t;r=sr(r);var n=[];try{for(var a=ke(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push(o.shape)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return In(n)}function L7(r){return"float32"}function sC(r,e,t){var n,a;if((e==null||t!=null&&t>0)&&(e=r.sourceLayer,t=r.nodeIndex),e.inboundNodes.length===0)return[r];var i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;for(var o=[],s=0;s<i.inboundLayers.length;s++){var u=i.inputTensors[s],l=i.inboundLayers[s],c=i.nodeIndices[s],f=sC(u,l,c);try{for(var h=(n=void 0,ke(f)),p=h.next();!p.done;p=h.next()){var d=p.value;o.indexOf(d)===-1&&o.push(d)}}catch(v){n={error:v}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}}return o}var yl=(function(r){be(e,r);function e(t){var n=r.call(this,{dtype:t.dtype,name:t.name!=null?t.name:Od("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new ce("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=t.batchInputShape;if(a==null){if(t.inputShape==null)throw new ce("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new ce("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=a,n.dtype=i,n.inputSpec=[{shape:a}];var o=new hi(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new Gd({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),n}return e.prototype.apply=function(t,n){throw new ce("Cannot pass any input to an "+("InputLayer's apply() method. InputLayer name: "+this.name))},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e})(Tt);yl.className="InputLayer";z.serialization.registerClass(yl);function uC(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new ce("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=r.batchShape;r.shape!=null&&e==null&&(e=[null].concat(r.shape));var t=r.dtype;t==null&&(t="float32");var n=new yl({batchInputShape:e,name:r.name,dtype:t,sparse:r.sparse}),a=n.inboundNodes[0].outputTensors;return a[0]}function B7(r,e){if(r.dtype==null||r.dtype===e.dtype)return e;try{return z.cast(e,r.dtype)}catch{throw new ce("The dtype of the feed ("+e.dtype+") can not be cast to the dtype "+("of the key '"+r.name+"' ("+r.dtype+")."))}}var ol=(function(){function r(e){var t,n;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof r)for(var a in e.id2Value)this.id2Value[a]=e.id2Value[a],a in e.id2Mask&&(this.id2Mask[a]=e.id2Mask[a]);else{if(e==null)return;try{for(var i=ke(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s.key,s.value)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}return r.prototype.add=function(e,t,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=B7(e,t),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new ce("Duplicate key: name="+e.name+", id="+e.id);return this},r.prototype.addFeed=function(e){this.add(e.key,e.value)},r.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},r.prototype.names=function(){return Object.keys(this.name2Id)},r.prototype.getValue=function(e){if(e instanceof hi){if(this.id2Value[e.id]==null)throw new ce("Nonexistent key: "+e.name);return this.id2Value[e.id]}else{var t=this.name2Id[e];if(t==null)throw new ce("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]}},r.prototype.getMask=function(e){if(e instanceof hi){if(this.id2Value[e.id]==null)throw new ce("Nonexistent key: "+e.name);return this.id2Mask[e.id]}else{var t=this.name2Id[e];if(t==null)throw new ce("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]}},r.prototype.disposeMasks=function(){this.id2Mask!=null&&z.dispose(this.id2Mask)},r})(),gd=new YN,yd=new YN;function z7(r){gd?.setMaxEntries(r),yd?.setMaxEntries(r)}function vf(r,e,t,n){var a,i,o,s,u=t==null?!1:t.training,l=Array.isArray(r),c=l?r:[r],f=c.map(function(le){return le.name}),h=[],p=e.names();try{for(var d=ke(f),v=d.next();!v.done;v=d.next()){var m=v.value;p.indexOf(m)!==-1?h.push(e.getValue(m)):h.push(null)}}catch(le){a={error:le}}finally{try{v&&!v.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}n!=null&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);var g=f.join(",")+"|"+e.names().sort().join(","),y=gd.get(g),b;if(y==null){var w=$7(c,e);y=w.sorted,b=w.recipientCounts,gd.put(g,y),yd.put(g,b)}b={},u||Object.assign(b,yd.get(g));for(var k=new ol(e),S=0;S<y.length;++S){if(n!=null){var E=z.memory().numTensors;E>n.maxNumTensors&&(n.maxNumTensors=E),E<n.minNumTensors&&(n.minNumTensors=E)}var N=y[S],C=N.sourceLayer;if(!(C instanceof yl)){var R=[],_=[],O=[],P=!1;try{for(var B=(o=void 0,ke(N.inputs)),W=B.next();!W.done;W=B.next()){var L=W.value,G=k.getValue(L),M=k.getMask(L);R.push(G),_.push(M),M!=null&&(P=!0),u||(b[L.name]--,b[L.name]===0&&!e.hasKey(L)&&f.indexOf(L.name)===-1&&!G.isDisposed&&L.sourceLayer.stateful!==!0&&O.push(G))}}catch(le){o={error:le}}finally{try{W&&!W.done&&(s=B.return)&&s.call(B)}finally{if(o)throw o.error}}P&&(t=t||{},t.mask=_[0]);var $=sr(C.apply(R,t)),K=null;C.supportsMasking&&(K=C.computeMask(R,_));for(var j=V7(N),te=Array.isArray(j)?j:[j],Q=0;Q<te.length;++Q){k.hasKey(te[Q])||k.add(te[Q],$[Q],Array.isArray(K)?K[0]:K);var ie=f.indexOf(te[Q].name);ie!==-1&&(h[ie]=$[Q])}u||z.dispose(O)}}return k.disposeMasks(),l?h:h[0]}function $7(r,e){var t,n,a,i;z.util.assert(r!=null&&r.length>0,function(){return"Expected at least one fetch, got none"});var o=[],s={};if(r.length===1){var u=ZI(r[0],e);o=u.sorted,s=u.recipientMap}else{var l=new Set;try{for(var c=ke(r),f=c.next();!f.done;f=c.next()){var h=f.value,p=ZI(h,e),d=p.sorted,v=p.recipientMap;try{for(var m=(a=void 0,ke(d)),g=m.next();!g.done;g=m.next()){var y=g.value;l.has(y.name)||(o.push(y),l.add(y.name))}}catch(k){a={error:k}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(a)throw a.error}}var b=function(k){s[k]==null&&(s[k]=new Set),v[k].forEach(function(S){return s[k].add(S)})};for(var w in v)b(w)}}catch(k){t={error:k}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}}return{sorted:o,recipientCounts:W7(s)}}function W7(r){var e={};for(var t in r)e[t]=r[t].size;return e}function ZI(r,e){var t,n,a,i,o=new Set,s=[],u={};try{for(var l=ke(e.names()),c=l.next();!c.done;c=l.next()){var f=c.value;o.add(f)}}catch(b){t={error:b}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}var h=[],p=[];for(h.push(r);h.length>0;){var d=h[h.length-1];if(o.has(d.name)){h.pop();continue}var v=p[p.length-1]===h.length-1;if(d.inputs.length===0||v)h.pop(),s.push(d),o.add(d.name),v&&p.pop();else{p.push(h.length-1);try{for(var m=(a=void 0,ke(d.inputs)),g=m.next();!g.done;g=m.next()){var y=g.value;u[y.name]==null&&(u[y.name]=new Set),u[y.name].add(d.name),!o.has(y.name)&&h.push(y)}}catch(b){a={error:b}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(a)throw a.error}}}}return{sorted:s,recipientMap:u}}function V7(r){var e,t,n;if(r.sourceLayer.inboundNodes.length===1)n=r.sourceLayer.output;else{for(var a=null,i=0;i<r.sourceLayer.inboundNodes.length;++i)try{for(var o=(e=void 0,ke(r.sourceLayer.inboundNodes[i].outputTensors)),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===r.id){a=i;break}}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}n=r.sourceLayer.getOutputAt(a)}return n}var U7=z.env();U7.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",function(){return 100},z7);var lC="Abs",cC="Acos",fC="Acosh",e0="Add",hC="AddN",G7="All",H7="Any",pC="ArgMax",dC="ArgMin",vC="Asin",mC="Asinh",gC="Atan",yC="Atanh",bC="Atan2",wC="AvgPool",q7="AvgPoolGrad",xC="AvgPool3D",K7="AvgPool3DGrad",kC="BatchMatMul",SC="BatchToSpaceND",j7="Bincount",X7="BroadcastTo",Y7="BroadcastArgs",t0="Cast",EC="Ceil",TC="ClipByValue",Z7="Complex",IC="ComplexAbs",NC="Concat",CC="Conv2D",Q7="Conv2DBackpropFilter",AC="Conv2DBackpropInput",_C="Conv3D",J7="Conv3DBackpropFilterV2",eX="Conv3DBackpropInputV2",DC="Cos",FC="Cosh",tX="Cumprod",RC="Cumsum",rX="CropAndResize",nX="DenseBincount",aX="DepthToSpace",MC="DepthwiseConv2dNative",iX="DepthwiseConv2dNativeBackpropFilter",oX="DepthwiseConv2dNativeBackpropInput",sX="Diag",OC="Dilation2D",uX="Dilation2DBackpropInput",lX="Dilation2DBackpropFilter",PC="RealDiv",cX="Einsum",LC="Elu",fX="EluGrad",BC="Erf",hX="Equal",zC="Exp",$C="ExpandDims",WC="Expm1",pX="FFT",dX="Fill",vX="FlipLeftRight",VC="Floor",UC="FloorDiv",GC="FusedBatchNorm",HC="GatherV2",mX="GatherNd",gX="Greater",qC="GreaterEqual",r0="Identity",yX="IFFT",bX="Imag",KC="IsFinite",jC="IsInf",XC="IsNan",YC="LeakyRelu",wX="Less",xX="LessEqual",ZC="Log",QC="Log1p",kX="LogicalAnd",SX="LogicalNot",EX="LogicalOr",TX="LogSoftmax",JC="LRN",IX="LRNGrad",eA="Max",tA="Maximum",rA="MaxPool",NX="MaxPoolGrad",nA="MaxPool3D",CX="MaxPool3DGrad",AX="MaxPoolWithArgmax",aA="Mean",iA="Min",oA="Minimum",sA="MirrorPad",uA="Mod",_X="Multinomial",lA="Multiply",cA="Neg",DX="NotEqual",FX="NonMaxSuppressionV3",RX="NonMaxSuppressionV4",MX="NonMaxSuppressionV5",fA="OnesLike",hA="OneHot",pA="Pack",dA="PadV2",vA="Pow",mA="Prelu",gA="Prod",OX="RaggedGather",PX="RaggedTensorToTensor",LX="Range",BX="Real",yA="Reciprocal",bA="Relu",wA="Reshape",xA="ResizeNearestNeighbor",zX="ResizeNearestNeighborGrad",kA="ResizeBilinear",$X="ResizeBilinearGrad",SA="Relu6",EA="Reverse",TA="Round",IA="Rsqrt",WX="ScatterNd",VX="SearchSorted",NA="Select",CA="Selu",AA="Slice",_A="Sin",DA="Sinh",FA="Sign",RA="Sigmoid",MA="Softplus",OA="Sqrt",PA="Sum",LA="SpaceToBatchND",BA="SplitV",zA="Softmax",UX="SparseFillEmptyRows",GX="SparseReshape",HX="SparseSegmentMean",qX="SparseSegmentSum",KX="SparseToDense",$A="SquaredDifference",jX="Square",XX="StridedSlice",YX="StringNGrams",ZX="StringSplit",QX="StringToHashBucketFast",WA="Sub",VA="Tan",UA="Tanh",n0="Tile",JX="TopK",e9="Transform",cd="Transpose",t9="Unique",GA="Unpack",HA="UnsortedSegmentSum",qA="ZerosLike",KA="Step",QI="FromPixels",r9="RotateWithOffset",JI="_FusedMatMul",eN="FusedConv2D",tN="FusedDepthwiseConv2D";var n9=1e-7,a9=1e-4,i9=(function(){function r(){}return r.prototype.refCount=function(e){return ya("refCount")},r.prototype.incRef=function(e){return ya("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return ya("time")},r.prototype.read=function(e){return ya("read")},r.prototype.readSync=function(e){return ya("readSync")},r.prototype.readToGPU=function(e,t){return ya("readToGPU")},r.prototype.numDataIds=function(){return ya("numDataIds")},r.prototype.disposeData=function(e,t){return ya("disposeData")},r.prototype.write=function(e,t,n){return ya("write")},r.prototype.move=function(e,t,n,a,i){return ya("move")},r.prototype.memory=function(){return ya("memory")},r.prototype.floatPrecision=function(){return ya("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?n9:a9},r.prototype.dispose=function(){return ya("dispose")},r})();function ya(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen")}function Z(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function zi(r,e,t){t===void 0&&(t=""),Z(bl(r,e),function(){return t+(" Shapes "+r+" and "+e+" must match")})}function a0(r){Z(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Hd(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||Li(r)&&!t)for(var n=0;n<r.length;++n)Hd(r[n],e,t);else e.push(r);return e}function Xn(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function bl(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Ef(r){return r%1===0}function fd(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function yi(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),Z(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but "+("got axis "+r)}),Z(r.every(function(n){return Ef(n)}),function(){return"All values in axis param must be integers but "+("got axis "+r)}),r.map(function(n){return n<0?t+n:n})}function o9(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:yi(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function s9(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type "+r);return t}function u9(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function l9(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Li(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function rN(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function c9(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function i0(r){return typeof r=="string"||r instanceof String}function f9(r){return typeof r=="boolean"}function h9(r){return typeof r=="number"}function o0(r){return Array.isArray(r)?o0(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":h9(r)?"float32":i0(r)?"string":f9(r)?"bool":"float32"}function Ny(r){return!!(r&&r.constructor&&r.call&&r.apply)}function s0(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function jA(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(c,f){return c*f})*(n?2:1),o=0;o<i;o++)a[o]=jA(r+o*u,s,t,n);return a}function nN(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("["+r+"] does not match the input size "+e.length+(t?" for a complex tensor":"")+".");return jA(0,r,e,t)}function XA(r,e){for(var t=u0(r,e),n=0;n<t.length;n++)t[n]=1;return t}function u0(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function YA(r){r.forEach(function(e){Z(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+("shape ["+r+"].")})})}function ZA(r){return r&&r.then&&typeof r.then=="function"}var aN="tfjsflags",p9=(function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=d9,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(Pr().getBool("IS_TEST")||Pr().getBool("PROD")||console.warn("Platform "+this.platformName+" has already been set. "+("Overwriting the platform with "+e+"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];Pr().getBool("IS_TEST")||Pr().getBool("PROD")||console.warn("Setting feature override from URL "+e+": "+a+"."),this.set(e,a)}},r.prototype.getAsync=function(e){return Ae(this,void 0,void 0,function(){var t,n;return Ce(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(ZA(t))throw new Error("Flag "+e+" cannot be synchronously evaluated. Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(aN in t){var n=t[aN].split(",");n.forEach(function(a){var i=ye(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=m9(o,s)})}}},r})();function d9(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return v9(e,n[0],n[1]),n.join("=")}),e}function v9(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function m9(r,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+r+".")}function Pr(){return QA}var QA=null;function g9(r){QA=r}var dy;function JA(){if(dy==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");dy=r}return dy}function y9(){var r=JA();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function l0(r,e){var t=y9();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}function il(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];Pr().getBool("IS_TEST")||Pr().getBool("PROD")||console.warn.apply(console,pt(r))}var e_=l0("kernelRegistry",function(){return new Map}),Cy=l0("gradRegistry",function(){return new Map});function Ay(r,e){var t=w9(r,e);return e_.get(t)}function iN(r){return Cy.get(r)}function oN(r){for(var e=e_.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=ye(i,2),s=o[0],u=o[1],l=ye(s.split("_"),1),c=l[0];c===r&&t.push(u)}return t}function b9(r){var e=r.kernelName;Cy.has(e)&&Pr().getBool("DEBUG")&&il("Overriding the gradient for '"+e+"'"),Cy.set(e,r)}function w9(r,e){return e+"_"+r}var _y=lr,$a=null;try{$a=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function lr(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}lr.prototype.__isLong__;Object.defineProperty(lr.prototype,"__isLong__",{value:!0});function Jn(r){return(r&&r.__isLong__)===!0}lr.isLong=Jn;var sN={},uN={};function Gs(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=uN[r],n)?n:(t=cr(r,(r|0)<0?-1:0,!0),a&&(uN[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=sN[r],n)?n:(t=cr(r,r<0?-1:0,!1),a&&(sN[r]=t),t))}lr.fromInt=Gs;function Wa(r,e){if(isNaN(r))return e?Ls:Va;if(e){if(r<0)return Ls;if(r>=t_)return a_}else{if(r<=-cN)return jn;if(r+1>=cN)return n_}return r<0?Wa(-r,e).neg():cr(r%hl|0,r/hl|0,e)}lr.fromNumber=Wa;function cr(r,e,t){return new lr(r,e,t)}lr.fromBits=cr;var bd=Math.pow;function c0(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Va;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return c0(r.substring(1),e,t).neg();for(var a=Wa(bd(t,8)),i=Va,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var l=Wa(bd(t,s));i=i.mul(l).add(Wa(u))}else i=i.mul(a),i=i.add(Wa(u))}return i.unsigned=e,i}lr.fromString=c0;function bi(r,e){return typeof r=="number"?Wa(r,e):typeof r=="string"?c0(r,e):cr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}lr.fromValue=bi;var lN=65536,x9=1<<24,hl=lN*lN,t_=hl*hl,cN=t_/2,fN=Gs(x9),Va=Gs(0);lr.ZERO=Va;var Ls=Gs(0,!0);lr.UZERO=Ls;var sl=Gs(1);lr.ONE=sl;var r_=Gs(1,!0);lr.UONE=r_;var Dy=Gs(-1);lr.NEG_ONE=Dy;var n_=cr(-1,2147483647,!1);lr.MAX_VALUE=n_;var a_=cr(-1,-1,!0);lr.MAX_UNSIGNED_VALUE=a_;var jn=cr(0,-2147483648,!1);lr.MIN_VALUE=jn;var Fe=lr.prototype;Fe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Fe.toNumber=function(){return this.unsigned?(this.high>>>0)*hl+(this.low>>>0):this.high*hl+(this.low>>>0)};Fe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(jn)){var t=Wa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Wa(bd(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),l=o.sub(u.mul(i)).toInt()>>>0,c=l.toString(e);if(o=u,o.isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}};Fe.getHighBits=function(){return this.high};Fe.getHighBitsUnsigned=function(){return this.high>>>0};Fe.getLowBits=function(){return this.low};Fe.getLowBitsUnsigned=function(){return this.low>>>0};Fe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(jn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Fe.isZero=function(){return this.high===0&&this.low===0};Fe.eqz=Fe.isZero;Fe.isNegative=function(){return!this.unsigned&&this.high<0};Fe.isPositive=function(){return this.unsigned||this.high>=0};Fe.isOdd=function(){return(this.low&1)===1};Fe.isEven=function(){return(this.low&1)===0};Fe.equals=function(e){return Jn(e)||(e=bi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Fe.eq=Fe.equals;Fe.notEquals=function(e){return!this.eq(e)};Fe.neq=Fe.notEquals;Fe.ne=Fe.notEquals;Fe.lessThan=function(e){return this.comp(e)<0};Fe.lt=Fe.lessThan;Fe.lessThanOrEqual=function(e){return this.comp(e)<=0};Fe.lte=Fe.lessThanOrEqual;Fe.le=Fe.lessThanOrEqual;Fe.greaterThan=function(e){return this.comp(e)>0};Fe.gt=Fe.greaterThan;Fe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Fe.gte=Fe.greaterThanOrEqual;Fe.ge=Fe.greaterThanOrEqual;Fe.compare=function(e){if(Jn(e)||(e=bi(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Fe.comp=Fe.compare;Fe.negate=function(){return!this.unsigned&&this.eq(jn)?jn:this.not().add(sl)};Fe.neg=Fe.negate;Fe.add=function(e){Jn(e)||(e=bi(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,l=e.low&65535,c=0,f=0,h=0,p=0;return p+=i+l,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,c+=f>>>16,f&=65535,c+=t+o,c&=65535,cr(h<<16|p,c<<16|f,this.unsigned)};Fe.subtract=function(e){return Jn(e)||(e=bi(e)),this.add(e.neg())};Fe.sub=Fe.subtract;Fe.multiply=function(e){if(this.isZero())return Va;if(Jn(e)||(e=bi(e)),$a){var t=$a.mul(this.low,this.high,e.low,e.high);return cr(t,$a.get_high(),this.unsigned)}if(e.isZero())return Va;if(this.eq(jn))return e.isOdd()?jn:Va;if(e.eq(jn))return this.isOdd()?jn:Va;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(fN)&&e.lt(fN))return Wa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,l=e.low>>>16,c=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*c,p+=d>>>16,d&=65535,p+=i*c,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,h+=a*c,f+=h>>>16,h&=65535,h+=i*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*c+a*l+i*u+o*s,f&=65535,cr(p<<16|d,f<<16|h,this.unsigned)};Fe.mul=Fe.multiply;Fe.divide=function(e){if(Jn(e)||(e=bi(e)),e.isZero())throw Error("division by zero");if($a){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?$a.div_u:$a.div_s)(this.low,this.high,e.low,e.high);return cr(t,$a.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ls:Va;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ls;if(e.gt(this.shru(1)))return r_;i=Ls}else{if(this.eq(jn)){if(e.eq(sl)||e.eq(Dy))return jn;if(e.eq(jn))return sl;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Va)?e.isNegative()?sl:Dy:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(jn))return this.unsigned?Ls:Va;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Va}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:bd(2,s-48),l=Wa(n),c=l.mul(e);c.isNegative()||c.gt(a);)n-=u,l=Wa(n,this.unsigned),c=l.mul(e);l.isZero()&&(l=sl),i=i.add(l),a=a.sub(c)}return i};Fe.div=Fe.divide;Fe.modulo=function(e){if(Jn(e)||(e=bi(e)),$a){var t=(this.unsigned?$a.rem_u:$a.rem_s)(this.low,this.high,e.low,e.high);return cr(t,$a.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Fe.mod=Fe.modulo;Fe.rem=Fe.modulo;Fe.not=function(){return cr(~this.low,~this.high,this.unsigned)};Fe.and=function(e){return Jn(e)||(e=bi(e)),cr(this.low&e.low,this.high&e.high,this.unsigned)};Fe.or=function(e){return Jn(e)||(e=bi(e)),cr(this.low|e.low,this.high|e.high,this.unsigned)};Fe.xor=function(e){return Jn(e)||(e=bi(e)),cr(this.low^e.low,this.high^e.high,this.unsigned)};Fe.shiftLeft=function(e){return Jn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?cr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):cr(0,this.low<<e-32,this.unsigned)};Fe.shl=Fe.shiftLeft;Fe.shiftRight=function(e){return Jn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?cr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):cr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Fe.shr=Fe.shiftRight;Fe.shiftRightUnsigned=function(e){if(Jn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return cr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?cr(t,0,this.unsigned):cr(t>>>e-32,0,this.unsigned)};Fe.shru=Fe.shiftRightUnsigned;Fe.shr_u=Fe.shiftRightUnsigned;Fe.toSigned=function(){return this.unsigned?cr(this.low,this.high,!1):this};Fe.toUnsigned=function(){return this.unsigned?this:cr(this.low,this.high,!0)};Fe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Fe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Fe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};lr.fromBytes=function(e,t,n){return n?lr.fromBytesLE(e,t):lr.fromBytesBE(e,t)};lr.fromBytesLE=function(e,t){return new lr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};lr.fromBytesBE=function(e,t){return new lr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var k9=Object.assign(Object.create(null),_y,{default:_y}),S9=_y||k9;function f0(r){return S9.fromString(r,!0,16)}f0("c3a5c85c97cb3127");f0("b492b66fbe98f273");f0("9ae16a3b2f90404f");function E9(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function i_(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Hd(r)),Pr().getBool("DEBUG")&&u9(r,e),E9(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type "+e)}function wd(){return Pr().platform.now()}function T9(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Pr().platform.encode(r,e)}function hN(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Pr().platform.decode(r,e)}var I9=(function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new C9)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,l=wd();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var c=ke(o),f=c.next();!f.done;f=c.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:wd()-l})}if(Pr().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(m){var g=o[m];g.data().then(function(y){N9(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(l){t.logger.logKernelProfile(n,u,l[0],l[1],o,l[2])})})},r})();function N9(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found "+a+" in the result of '"+t+"'"),!0}return!1}var C9=(function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?fd(a+"ms",9):a.error,u=fd(e,25),l=t.rank,c=t.size,f=fd(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var v=d.shape||t.shape,m=v.length;h+=p+": "+m+"D "+(m>0?v:"")+" "}}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+f+"	%c"+c+"	%c"+h+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r})();function A9(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var l=s[u],c=!1,f=0;f<e.length;f++)if(n[l.id]){o.outputs.forEach(function(b){return n[b.id]=!0}),c=!0,a[o.id]=!0;break}if(c)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];n[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,d.push(g)}}return d}function _9(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+("for "+s.kernelName+"."));var l=s.gradient(u),c=function(h){if(!(h in l))throw new Error("Cannot backprop through input "+h+". "+("Available gradients found: "+Object.keys(l)+"."));var p=t(function(){return l[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+(h+" must have 'float32' dtype, but has '"+p.dtype+"'"));var d=s.inputs[h];if(!bl(p.shape,d.shape))throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+("'"+h+"' has shape '"+p.shape+"', which does not match ")+("the shape of the input '"+d.shape+"'"));if(r[d.id]==null)r[d.id]=p;else{var v=r[d.id];r[d.id]=n(v,p),v.dispose()}};for(var f in s.inputs)c(f)},i=e.length-1;i>=0;i--)a(i)}var pN=20,lf=3,vy=7;function D9(r,e,t,n){var a=s0(e),i=F9(r,e,t,a),o=e.length,s=hd(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function F9(r,e,t,n){var a=Xn(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?gf(r):r;if(s>1)for(var l=0;l<a/i;l++)for(var c=l*i,f=0;f<i;f++)o[f]=Math.max(o[f],mf(u[c+f],0,t).length);return o}function mf(r,e,t){var n;return Array.isArray(r)?n=parseFloat(r[0].toFixed(vy))+" + "+(parseFloat(r[1].toFixed(vy))+"j"):i0(r)?n="'"+r+"'":t==="bool"?n=o_(r):n=parseFloat(r.toFixed(vy)).toString(),fd(n,e)}function o_(r){return r===0?"false":"true"}function hd(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var l=gf(r);return[mf(l[0],0,t)]}return t==="bool"?[o_(r[0])]:[r[0].toString()]}if(u===1){if(s>pN){var c=lf*o,f=Array.from(r.slice(0,c)),h=Array.from(r.slice((s-lf)*o,s*o));return t==="complex64"&&(f=gf(f),h=gf(h)),["["+f.map(function(E,N){return mf(E,a[N],t)}).join(", ")+", ..., "+h.map(function(E,N){return mf(E,a[s-lf+N],t)}).join(", ")+"]"]}var p=t==="complex64"?gf(r):Array.from(r);return["["+p.map(function(E,N){return mf(E,a[N],t)}).join(", ")+"]"]}var d=e.slice(1),v=n.slice(1),m=n[0]*o,g=[];if(s>pN){for(var y=0;y<lf;y++){var b=y*m,w=b+m;g.push.apply(g,pt(hd(r.slice(b,w),d,t,v,a,!1)))}g.push("...");for(var y=s-lf;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,pt(hd(r.slice(b,w),d,t,v,a,y===s-1)))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,pt(hd(r.slice(b,w),d,t,v,a,y===s-1)))}var k=u===2?",":"";g[0]="["+g[0]+k;for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+k;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function gf(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var R9=(function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Xn(e),n!=null){var i=n.length;Z(i===this.size,function(){return"Length of values '"+i+"' does not match the size "+("inferred by the shape '"+a.size+"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||s9(t,this.size),this.strides=s0(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),Z(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must "+("match the rank ("+t.rank+")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=ke(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var l="Requested out of range element at "+n+". "+("  Buffer shape="+this.shape);throw new Error(l)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=n[n.length-1],f=0;f<n.length-1;++f)c+=this.strides[f]*n[f];return this.values[c]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return ci().makeTensor(this.values,this.shape,this.dtype)},r})(),ci=null,cf=null;function M9(r){ci=r}var ba=(function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Xn(e),this.strides=s0(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Ae(this,void 0,void 0,function(){var e;return Ce(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,cf.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return cf.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ae(this,void 0,void 0,function(){var e;return Ce(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,nN(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return nN(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Ae(this,void 0,void 0,function(){var e,t;return Ce(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=ci().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return hN(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),ci().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=ci().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return hN(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ae(this,void 0,void 0,function(){var e;return Ce(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ci().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(ci().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),cf.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),cf.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return D9(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),cf.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),ci().makeVariable(this,e,t,n)},r})();Object.defineProperty(ba,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function O9(){return l0("Tensor",function(){return ba})}O9();var xd=(function(r){be(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and "+("previous value ("+this.dtype+") must match"));if(!bl(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and "+("previous value ("+this.shape+") must match"));ci().disposeTensor(this),this.dataId=t.dataId,ci().incRef(this,null)},e.prototype.dispose=function(){ci().disposeVariable(this),this.isDisposedInternal=!0},e})(ba);Object.defineProperty(xd,Symbol.hasInstance,{value:function(r){return r instanceof ba&&r.assign!=null&&r.assign instanceof Function}});var dN;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(dN||(dN={}));var Fy;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(Fy||(Fy={}));var Ry;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(Ry||(Ry={}));var My;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(My||(My={}));var Oy;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Oy||(Oy={}));var P9={float32:My,int32:Fy,bool:Ry,complex64:Oy};function L9(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return P9[r][e]}function _r(r,e){if(r.dtype===e.dtype)return[r,e];var t=L9(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function B9(r,e){Z(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and"+(" second("+e.dtype+") input must match")})}function s_(r){var e=[],t=new Set;return u_(r,e,t),e}function u_(r,e,t){if(r!=null){if(r instanceof ba){e.push(r);return}if(z9(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),u_(i,e,t))}}}}function z9(r){return Array.isArray(r)||typeof r=="object"}function my(r){return r.kernelName!=null}var vN=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r})(),h0=(function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new vN}return r.prototype.ready=function(){return Ae(this,void 0,void 0,function(){var e,t,n,a;return Ce(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(il(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ae(this,void 0,void 0,function(){var t,n,a,i,o;return Ce(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new I9(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=oN(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=oN(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var a=n.factory();if(a&&!(a instanceof i9)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,il("Initialization of backend "+e+" failed"),il(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return il("Initialization of backend "+e+" failed"),il(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=se.runKernel(r0,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},l={dtype:s};return se.runKernel(t0,u,l)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=Ay(e,this.backendName)!=null;if(!a)throw new Error("Kernel '"+e+"' not registered for backend '"+this.backendName+"'");return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak "+("("+s+" data ids) after running '"+e+"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var l,c=my(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(my(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=Ay(f,this.backendName);Z(d!=null,function(){return"Cannot find registered kernel '"+f+"' for backend '"+t.backendName+"'"}),u=function(){var k=t.backend.numDataIds();l=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(l)?l:[l];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,k,S);var E=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var N=t.getTensorsForGradient(f,h,E);a=t.saveTensorsForBackwardMode(N)}return E}}else{var v=e.forwardFunc,m=function(k){i&&(a=k.map(function(S){return t.keep(t.clone(S))}))};u=function(){var k=t.backend.numDataIds();l=t.tidy(function(){return v(t.backend,m)});var S=Array.isArray(l)?l:[l];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(c,k,S),S}}var g=e.inputs,y=e.attrs,b=my(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(w=t.profiler.profileKernel(c,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),n=w.outputs)}),i&&this.addTapeNode(c,g,n,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(k){return g[k]!=null?g[k].shape:null}),outputShapes:n.map(function(k){return k.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(l)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=iN(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(Z(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(l){return t[l]})):s=i.map(function(l){return t[l]});var u=n.filter(function(l,c){return o[c]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&i0(e[0])&&(i=e.map(function(c){return T9(c)}));var o=a.write(i,t,n),s=new ba(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),l=c9(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new ba(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new xd(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*rN(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof xd||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*rN(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ae(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return Ce(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,pt(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=ke(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),l=s,[4,s.extraInfo];case 5:l.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return c=p.sent(),f={error:c},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},l=iN(e);l!=null&&(a=l.gradFunc),a!=null&&(u.gradient=function(c){return c=c.map(function(f,h){if(f==null){var p=n[h],d=u0(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(c.length>1?c:c[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=s_(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),Z(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});Z(o instanceof ba,function(){return"The result y returned by f() must be a tensor."});var s=A9(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??$9(o.shape),_9(u,s,function(c){return i.tidy(c)},V9);var l=t.map(function(c){return u[c.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(c){var f,h;try{for(var p=ke(c.saved),d=p.next();!d.done;d=p.next()){var v=d.value;v.dispose()}}catch(m){f={error:m}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:l}})},r.prototype.customGrad=function(e){var t=this;return Z(Ny(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];Z(n.every(function(l){return l instanceof ba}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(l,c){o[c]=l});var s=function(l,c){return i=e.apply(void 0,pt(n,[c])),Z(i.value instanceof ba,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Z(Ny(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(l,c){var f=i.gradFunc(l,c),h=Array.isArray(f)?f:[f];Z(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Z(h.every(function(d){return d instanceof ba}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,v){p[v]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Ae(this,void 0,void 0,function(){var t,n;return Ce(this,function(a){switch(a.label){case 0:return t=wd(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=wd()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new vN;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r})();h0.nextTensorId=0;h0.nextVariableId=0;function $9(r){var e=XA(Xn(r),"float32");return se.makeTensor(e,r,"float32")}function W9(){var r=JA();if(r._tfengine==null){var e=new p9(r);r._tfengine=new h0(e)}return g9(r._tfengine.ENV),M9(function(){return r._tfengine}),r._tfengine}var se=W9();function V9(r,e){var t={a:r,b:e};return se.runKernel(e0,t)}function Lf(r,e){var t=r;if(Li(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||Li(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&Pr().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&l_(r,n,[]),n}function l_(r,e,t){if(t=t||[],!Array.isArray(r)&&!Li(r)){Z(e.length===0,function(){return"Element arr["+t.join("][")+"] is a primitive, "+("but should be an array/TypedArray of "+e[0]+" elements")});return}Z(e.length>0,function(){return"Element arr["+t.join("][")+"] should be a primitive, "+("but is an array of "+r.length+" elements")}),Z(r.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" "+("elements, but has "+r.length+" elements")});for(var n=e.slice(1),a=0;a<r.length;++a)l_(r[a],n,t.concat(a))}function mN(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '"+t+"' passed to '"+n+"' must "+("be "+r+" tensor, but got "+e+" tensor"))}}function H(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof ba)return mN(n,r.dtype,e,t),r;var a=o0(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),mN(n,a,e,t),r==null||!Li(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a "+("Tensor or TensorLike, but got '"+i+"'"))}var o=Lf(r,a);!Li(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?i_(r,a):Hd(r,[],s);return se.makeTensor(u,o,a)}function kd(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return H(i,e+"["+o+"]",t,n)})}var U9="__op";function J(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+(e.length+" keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+U9;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];se.startScope(t);try{var s=n.apply(void 0,pt(i));return ZA(s)&&console.error("Cannot return a Promise inside of tidy."),se.endScope(s),s}catch(u){throw se.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function G9(r,e){var t=H(r,"x","cast");if(!l9(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return se.runKernel(t0,n,a)}var ot=J({cast_:G9});function H9(r,e){var t,n=H(r,"a","mul"),a=H(e,"b","mul");t=ye(_r(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return se.runKernel(lA,i)}var me=J({mul_:H9});function q9(r,e){e===void 0&&(e=0);var t=H(r,"x","step"),n={x:t},a={alpha:e};return se.runKernel(KA,n,a)}var qd=J({step_:q9}),c_={kernelName:lC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(r,qd(ot(n,"float32"),-1))}}}};function K9(r,e){var t,n=H(r,"a","floorDiv"),a=H(e,"b","floorDiv");t=ye(_r(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return se.runKernel(UC,i)}var j9=J({floorDiv_:K9});function X9(r,e){var t,n=H(r,"a","div"),a=H(e,"b","div");if(t=ye(_r(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return j9(n,a);var i={a:n,b:a},o={};return se.runKernel(PC,i,o)}var vt=J({div_:X9});function Y9(r){var e=H(r,"x","neg"),t={x:e};return se.runKernel(cA,t)}var Jr=J({neg_:Y9});function Bf(r,e,t,n){if(n==null&&(n=o0(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Li(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){YA(e);var a=Xn(e),i=Xn(t);Z(a===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+(a+" values but has "+i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Xn(e.slice(o)):!0;Z(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+("("+t+") does not match the provided ")+("shape ("+e+"). ")})}}return!Li(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?i_(r,n):Hd(r,[],!0),se.makeTensor(r,e,n)}function mt(r,e){if((Li(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Li(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return Bf(r,t,n,e)}function Z9(r){var e=H(r,"x","sqrt","float32"),t={x:e};return se.runKernel(OA,t)}var wa=J({sqrt_:Z9});function Q9(r){var e=H(r,"x","square"),t={};return se.runKernel("Square",{x:e},t)}var ur=J({square_:Q9});function J9(r,e){var t,n=H(r,"a","sub"),a=H(e,"b","sub");t=ye(_r(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return se.runKernel(WA,i)}var lt=J({sub_:J9}),eY={kernelName:cC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){var a=ur(ot(n,"float32")),i=wa(lt(mt(1),a));return Jr(vt(r,i))}}}},tY={kernelName:fC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){var a=wa(lt(ur(ot(n,"float32")),1));return vt(r,a)}}}};function en(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Xt(r,e){for(var t=[],n=Math.max(r.length,e.length),a=0;a<n;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+(r+" and "+e+".");throw Error(s)}else t.unshift(i)}return t}function rY(r,e){var t=H(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return se.runKernel(wA,n,a)}var ge=J({reshape_:rY});function nY(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=H(r,"x","sum");n.dtype==="bool"&&(n=ot(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return se.runKernel(PA,a,i)}var ft=J({sum_:nY}),aY={kernelName:e0,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=Xt(n.shape,a.shape),o=function(){var u=r,l=en(n.shape,i);return l.length>0&&(u=ft(u,l)),ge(u,n.shape)},s=function(){var u=r,l=en(a.shape,i);return l.length>0&&(u=ft(u,l)),ge(u,a.shape)};return{a:o,b:s}}};var iY={kernelName:hC,saveAllInputs:!0,gradFunc:function(r,e){var t={};return e.forEach(function(n,a){t[a]=function(){return r.clone()}}),t}};function oY(r){var e=H(r,"x","zerosLike"),t={x:e};return se.runKernel(qA,t)}var _t=J({zerosLike_:oY}),sY={kernelName:pC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return _t(n)}}}},uY={kernelName:dC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return _t(n)}}}},lY={kernelName:vC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return vt(r,wa(lt(mt(1),ur(ot(n,"float32")))))}}}};function cY(r,e){var t,n=H(r,"a","add"),a=H(e,"b","add");t=ye(_r(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return se.runKernel(e0,i)}var rt=J({add_:cY}),fY={kernelName:mC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){var a=wa(rt(mt(1),ur(ot(n,"float32"))));return vt(r,a)}}}},hY={kernelName:bC,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=Xt(n.shape,a.shape),o=function(){var u=rt(ur(n),ur(a)),l=me(r,vt(a,u)),c=en(n.shape,i);return c.length>0&&(l=ft(l,c)),ge(l,n.shape)},s=function(){var u=rt(ur(n),ur(a)),l=Jr(me(r,vt(n,u))),c=en(a.shape,i);return c.length>0&&(l=ft(l,c)),ge(l,a.shape)};return{a:o,b:s}}},pY={kernelName:gC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return vt(r,rt(ur(ot(n,"float32")),1))}}}},dY={kernelName:yC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return vt(r,lt(mt(1),ur(ot(n,"float32"))))}}}};function vY(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=ye(Sd(e),2),u=s[0],l=s[1],c;if(o==="channelsLast")c=[u,l,r[3],r[3]];else if(o==="channelsFirst")c=[u,l,r[1],r[1]];else throw new Error("Unknown dataFormat "+o);return p0(r,c,t,n,a,i,!1,o)}function p0(r,e,t,n,a,i,o,s){var u,l;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var c=ye([-1,-1,-1,-1],4),f=c[0],h=c[1],p=c[2],d=c[3];if(s==="channelsLast")u=ye(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")l=ye(r,4),f=l[0],d=l[1],h=l[2],p=l[3];else throw new Error("Unknown dataFormat "+s);var v=ye(e,4),m=v[0],g=v[1],y=v[3],b=ye(Sd(t),2),w=b[0],k=b[1],S=ye(Sd(n),2),E=S[0],N=S[1],C=Py(m,E),R=Py(g,N),_=yY(a,h,p,w,k,C,R,i,s),O=_.padInfo,P=_.outHeight,B=_.outWidth,W=o?y*d:y,L;return s==="channelsFirst"?L=[f,W,P,B]:s==="channelsLast"&&(L=[f,P,B,W]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:P,outWidth:B,outChannels:W,padInfo:O,strideHeight:w,strideWidth:k,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:E,dilationWidth:N,inShape:r,outShape:L,filterShape:e}}function mY(r,e,t,n,a){n==null&&(n=gY(r,e,t));var i=r[0],o=r[1],s=Ed((i-e+2*n)/t+1,a),u=Ed((o-e+2*n)/t+1,a);return[s,u]}function gY(r,e,t,n){n===void 0&&(n=1);var a=Py(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Sd(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Py(r,e){return e<=1?r:r+(r-1)*(e-1)}function yY(r,e,t,n,a,i,o,s,u){var l,c,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";l={top:r,bottom:r,left:r,right:r,type:h};var p=mY([e,t],i,n,r,s);c=p[0],f=p[1]}else if(r==="same"){c=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(c-1)*n+i-e),v=Math.max(0,(f-1)*a+o-t),m=Math.floor(d/2),g=d-m,y=Math.floor(v/2),b=v-y;l={top:m,bottom:g,left:y,right:b,type:"SAME"}}else if(r==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var m=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],b=u==="channelsLast"?r[2][1]:r[3][1],h=m===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";l={top:m,bottom:g,left:y,right:b,type:h},c=Ed((e-i+m+g)/n+1,s),f=Ed((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: "+r);return{padInfo:l,outHeight:c,outWidth:f}}function Ed(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function Ws(r){var e=ye(Sd(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function lo(r,e){return Ws(r)||Ws(e)}function An(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+"."));if(typeof e=="number")Z(Ef(e),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){Z(Ef(a),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+a+".")})})});else throw Error("Error in "+r+": Unknown padding parameter: "+e)}}function bY(r,e,t,n,a,i){var o=H(r,"dy","avgPool3dGrad"),s=H(e,"input","avgPool3dGrad"),u=o,l=s,c=!1;s.rank===4&&(c=!0,u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=ge(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Z(u.rank===5,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+(u.rank+".")}),Z(l.rank===5,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+(l.rank+".")}),An("avgPool3dGrad",a,i);var f={dy:u,input:l},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=se.runKernel(K7,f,h);return c?ge(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var wY=J({avgPool3dGrad_:bY}),xY={kernelName:xC,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad,u=t.dimRoundingMode;return{x:function(){return wY(r,a,i,o,s,u)}}}};function kY(r,e,t,n,a){var i=H(r,"dy","avgPoolGrad"),o=H(e,"input","avgPoolGrad");Z(o.rank===i.rank,function(){return"Rank of input ("+o.rank+") does not match rank of dy ("+i.rank+")"});var s=o,u=i,l=!1;o.rank===3&&(l=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Z(u.rank===4,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+(u.rank+".")}),Z(s.rank===4,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+(s.rank+".")});var c={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=se.runKernel(q7,c,f);return l?ge(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var SY=J({avgPoolGrad_:kY}),EY={kernelName:wC,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad;return{x:function(){return SY(r,a,i,o,s)}}}};function TY(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=H(r,"a","matMul"),o=H(e,"b","matMul");a=ye(_r(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return se.runKernel(kC,s,u)}var At=J({matMul_:TY}),IY={kernelName:kC,inputsToSave:["a","b"],gradFunc:function(r,e,t){var n=ye(e,2),a=n[0],i=n[1],o=t.transposeA,s=t.transposeB;return!o&&!s?{a:function(){return At(r,i,!1,!0)},b:function(){return At(a,r,!0,!1)}}:!o&&s?{a:function(){return At(r,i,!1,!1)},b:function(){return At(r,a,!0,!1)}}:o&&!s?{a:function(){return At(i,r,!1,!0)},b:function(){return At(a,r,!1,!1)}}:{a:function(){return At(i,r,!0,!0)},b:function(){return At(r,a,!0,!0)}}}};function NY(r,e,t){var n=H(r,"x","spaceToBatchND");Z(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),Z(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),Z(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()});var a={x:n},i={blockShape:e,paddings:t};return se.runKernel(LA,a,i)}var f_=J({spaceToBatchND_:NY});var CY={kernelName:SC,gradFunc:function(r,e,t){var n=t.blockShape,a=t.crops;return{x:function(){return f_(r,n,a)}}}};var AY={kernelName:X7,gradFunc:function(r,e,t){for(var n=t,a=n.inputShape,i=n.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(a[s]!==1)throw new Error("broadcastTo(): ["+a+"] cannot be broadcast to ["+i+"].");for(var u=[],s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return ft(r,u,!0)}}}};var _Y={kernelName:t0,gradFunc:function(r){return{x:function(){return r.clone()}}}};var DY={kernelName:EC,gradFunc:function(r){return{x:function(){return _t(r)}}}};function FY(r,e){var t,n=H(r,"a","greaterEqual","string_or_numeric"),a=H(e,"b","greaterEqual","string_or_numeric");t=ye(_r(n,a),2),n=t[0],a=t[1],Xt(n.shape,a.shape);var i={a:n,b:a};return se.runKernel(qC,i)}var Kd=J({greaterEqual_:FY});function RY(r,e){var t,n=H(r,"a","lessEqual","string_or_numeric"),a=H(e,"b","lessEqual","string_or_numeric");t=ye(_r(n,a),2),n=t[0],a=t[1],Xt(n.shape,a.shape);var i={a:n,b:a};return se.runKernel(xX,i)}var zf=J({lessEqual_:RY});function MY(r,e){var t=H(r,"a","logicalAnd","bool"),n=H(e,"b","logicalAnd","bool");Xt(t.shape,n.shape);var a={a:t,b:n};return se.runKernel(kX,a)}var Tf=J({logicalAnd_:MY});function OY(r){var e=H(r,"x","clone","string_or_numeric"),t={x:e};return se.runKernel(r0,t)}var xf=J({clone_:OY});function PY(r,e){var t=H(r,"broadcastTo","x"),n=t.shape;if(e.some(function(f){return!(f>0)||f%1!==0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ge(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return xf(t);var l={x:t},c={reps:o};return se.runKernel(n0,l,c)}var gy=J({broadcastTo_:PY});function LY(r,e,t){var n=H(e,"a","where"),a=H(t,"b","where"),i=H(r,"condition","where","bool"),o=Xt(Xt(i.shape,n.shape),a.shape),s=gy(i,o),u=gy(n,o),l=gy(a,o),c={condition:s,t:u,e:l};return se.runKernel(NA,c)}var Ua=J({where_:LY}),BY={kernelName:TC,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.clipValueMin,o=t.clipValueMax;return{x:function(){return Ua(Tf(Kd(a,i),zf(a,o)),r,_t(r))}}}};var zY={kernelName:IC,inputsToSave:["x"],gradFunc:c_.gradFunc};function $Y(r,e,t){t===void 0&&(t=0);var n=H(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return se.runKernel(BA,a,i)}var If=J({split_:$Y});var WY={kernelName:NC,saveAllInputs:!0,gradFunc:function(r,e,t){var n=e.map(function(u){return u.shape}),a=t.axis,i=yi(a,e[0].shape)[0],o=n.map(function(u){return u[i]}),s=If(r,o,i);return s.map(function(u){return function(){return u}})}};function VY(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Z(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+(s.shape+".")}),Z(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+(u.shape+".")}),Z(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+(t+".")});var l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];Z(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must "+("match input depth in filter ("+t[2]+".")}),Z(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must "+("match output depth for filter ("+t[3]+").")}),An("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return se.runKernel(Q7,f,h)}var d0=J({conv2DBackpropFilter_:VY});function UY(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),Z(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var s=r,u=e,l=!1;e.rank===3&&(l=!0,u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),Z(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+(s.length+".")}),Z(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+("rank "+u.rank)}),Z(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+("rank "+t.rank)});var c=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];Z(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must "+("match input depth for filter "+t.shape[2]+".")}),Z(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must "+("match output depth for filter "+t.shape[3]+".")}),An("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=se.runKernel(AC,h,p);return l?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var v0=J({conv2DBackpropInput_:UY}),GY={kernelName:CC,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=ye(e,2),a=n[0],i=n[1],o=t.dilations,s=t.strides,u=t.pad,l=t.dataFormat;return Z(Ws(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+("are not yet supported in gradients. Got dilations '"+o+"'")}),{x:function(){return v0(a.shape,r,i,s,u,l)},filter:function(){return d0(a,r,i.shape,s,u,l)}}}};function HY(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=H(r,"x","conv2d","float32"),u=H(e,"filter","conv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Z(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),Z(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+(u.rank+".")}),An("conv2d",n,o);var f=a==="NHWC"?l.shape[3]:l.shape[1];Z(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match "+("input depth for filter "+u.shape[2]+".")}),Z(lo(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")});var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=se.runKernel(CC,h,p);return c?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var jd=J({conv2d_:HY}),qY={kernelName:AC,inputsToSave:["dy","filter"],gradFunc:function(r,e,t){var n=ye(e,2),a=n[0],i=n[1],o=t.strides,s=t.pad,u=t.dataFormat,l=t.dimRoundingMode;return{dy:function(){return jd(r,i,o,s,u,1,l)},filter:function(){return d0(r,a,i.shape,o,s,u,l)}}}};function KY(r,e,t,n,a){var i=r;r.rank===4&&(i=ge(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));var o=e;o.rank===4&&(o=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Z(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+(i.shape+".")}),Z(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+(o.shape+".")}),Z(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+(t+".")}),Z(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must "+("match input depth in filter ("+t[3]+".")}),Z(o.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must "+("match output depth for filter ("+t[4]+").")});var s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return se.runKernel(J7,s,u)}var jY=J({conv3DBackpropFilter_:KY});function XY(r,e,t,n,a){Z(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],l=o.shape[4];Z(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+(i.length+".")}),Z(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+("rank "+o.rank)}),Z(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+("rank "+t.rank)}),Z(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must "+("match input depth for filter "+t.shape[3]+".")}),Z(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must "+("match output depth for filter "+t.shape[4]+".")});var c={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=se.runKernel(eX,c,f);return s?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var h_=J({conv3DBackpropInput_:XY}),YY={kernelName:_C,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad;Z(Ws(n),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+("not yet supported in gradients. Got dilations '"+n+"'")});var o=ye(e,2),s=o[0],u=o[1];return{x:function(){return h_(s.shape,r,u,a,i)},filter:function(){return jY(s,r,u.shape,a,i)}}}};function ZY(r){var e=H(r,"x","sin","float32"),t={x:e};return se.runKernel(_A,t)}var QY=J({sin_:ZY}),JY={kernelName:DC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(Jr(QY(ot(n,"float32"))),r)}}}};function eZ(r){var e=H(r,"x","sinh"),t={x:e};return se.runKernel(DA,t)}var tZ=J({sinh_:eZ}),rZ={kernelName:FC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(tZ(ot(n,"float32")),r)}}}};function nZ(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function aZ(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function iZ(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function pl(r,e){var t=e.map(function(n){return 1});return aZ(r,t,e)}function p_(r,e){if(nZ(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function m0(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function oZ(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=H(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return se.runKernel(RC,i,o)}var sZ=J({cumsum_:oZ});function Hr(r,e){return se.tidy(r,e)}function Yn(r){var e=s_(r);e.forEach(function(t){return t.dispose()})}function uZ(r){return se.keep(r)}function lZ(r,e){var t=H(r,"real","complex"),n=H(e,"imag","complex");zi(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex().");var a={real:t,imag:n};return se.runKernel(Z7,a)}var dl=J({complex_:lZ});function cZ(r){var e=H(r,"input","imag"),t={input:e};return se.runKernel(bX,t)}var g0=J({imag_:cZ});function fZ(r){var e=H(r,"input","real"),t={input:e};return se.runKernel(BX,t)}var Td=J({real_:fZ});function hZ(r,e,t){var n=H(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),Z(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" "+("must match length of perm "+e+".")}),e.forEach(function(o){Z(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+(" but got "+e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Hr(function(){var o=Td(n),s=g0(n);return o=se.runKernel(cd,{x:o},i),s=se.runKernel(cd,{x:s},i),t&&(s=Jr(s)),dl(o,s)}):se.runKernel(cd,a,i)}var so=J({transpose_:hZ}),pZ={kernelName:RC,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.axis,o=t.exclusive,s=t.reverse;return{x:function(){var u=p_([i],a.rank),l=sZ(r,i,o,!s);return u!=null&&(l=so(l,u)),l}}}};function dZ(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={x:s,dy:u},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return se.runKernel(iX,l,c)}var d_=J({depthwiseConv2dNativeBackpropFilter_:dZ});function vZ(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={dy:s,filter:t},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=se.runKernel(oX,l,c);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var v_=J({depthwiseConv2dNativeBackpropInput_:vZ}),mZ={kernelName:MC,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad,o=t.dimRoundingMode,s=n??[1,1];Z(Ws(s),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+("'"+s+"'")});var u=ye(e,2),l=u[0],c=u[1];return Z(l.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: input must be "+("rank 4, but got rank "+l.rank+".")}),Z(c.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+("rank 4, but got rank "+c.rank+".")}),Z(l.shape[3]===c.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input "+("channels ("+l.shape[3]+") must match the inChannels dimension ")+("in filter "+c.shape[2]+".")}),Z(lo(a,s),function(){return"Error in gradient of depthwiseConv2d: Either strides or "+("dilations must be  1. Got strides "+a+" and dilations ")+("'"+s+"'.")}),An("depthwiseConv2d",i,o),{x:function(){return v_(l.shape,r,c,a,i,s,o)},filter:function(){return d_(l,r,c.shape,a,i,s,o)}}}},gZ={kernelName:OC,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=ye(e,2),a=n[0],i=n[1],o={x:a,filter:i,dy:r},s={x:a,filter:i,dy:r};return{x:function(){return se.runKernel(uX,o,t)},filter:function(){return se.runKernel(lX,s,t)}}}},yZ={kernelName:LC,outputsToSave:[!0],gradFunc:function(r,e){var t=ye(e,1),n=t[0],a={dy:r,y:n};return{x:function(){return se.runKernel(fX,a)}}}};function bZ(r){var e=H(r,"x","exp"),t={x:e};return se.runKernel(zC,t)}var Bi=J({exp_:bZ}),wZ={kernelName:BC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0],a=me(Bi(Jr(ur(n))),2/Math.sqrt(Math.PI));return{x:function(){return me(r,a)}}}},xZ={kernelName:zC,outputsToSave:[!0],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(r,n)}}}},kZ={kernelName:$C,inputsToSave:["input"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{input:function(){return ge(r,n.shape)}}}},SZ={kernelName:WC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(r,Bi(n))}}}};var EZ={kernelName:VC,gradFunc:function(r){return{x:function(){return _t(r)}}}},TZ={kernelName:UC,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=Xt(n.shape,a.shape),o=function(){var u=vt(r,ot(a,"float32")),l=en(n.shape,i);return l.length>0?ge(ft(u,l),n.shape):u},s=function(){var u=me(r,ot(n,"float32")),l=en(a.shape,i);l.length>0&&(u=ge(ft(u,l),a.shape));var c=ur(a);return Jr(vt(u,ot(c,"float32")))};return{a:o,b:s}}};function IZ(r){var e=H(r,"x","rsqrt","float32"),t={x:e};return se.runKernel(IA,t)}var NZ=J({rsqrt_:IZ});function CZ(r,e){var t=H(r,"x","tile","string_or_numeric");Z(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" "+("must match length of reps "+e+".")});var n={x:t},a={reps:e};return se.runKernel(n0,n,a)}var kf=J({tile_:CZ}),AZ={kernelName:GC,inputsToSave:["x","mean","variance","scale"],gradFunc:function(r,e,t){var n=t.varianceEpsilon,a=ye(e,4),i=a[0],o=a[1],s=a[2],u=a[3],l=u??mt(1),c=en(o.shape,i.shape),f=[];if(o.rank===1){for(var h=0;h<i.shape.length-1;++h)f.push(i.shape[h]);f.push(1)}var p=lt(i,o),d=me(r,l),v=NZ(rt(s,mt(n))),m=me(me(me(v,v),v),mt(-.5)),g=function(){return o.rank===1?ge(me(me(r,kf(ge(v,[1,1,1,o.shape[0]]),f)),l),i.shape):ge(me(me(r,v),l),i.shape)},y=function(){var S=me(me(v,mt(-1)),d);return o.rank===1&&(S=ft(S,c)),ge(S,o.shape)},b=function(){var S=me(me(m,p),d);return o.rank===1&&(S=ft(S,c)),ge(S,o.shape)},w=function(){var S=me(p,v),E=me(r,S);return o.rank===1&&(E=ft(E,c)),ge(E,o.shape)},k=function(){var S=r;return o.rank===1&&(S=ft(S,c)),ge(S,o.shape)};return{x:g,mean:y,variance:b,scale:w,offset:k}}};function _Z(r,e,t){var n=H(r,"x","unsortedSegmentSum"),a=H(e,"segmentIds","unsortedSegmentSum","int32");Z(Ef(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return se.runKernel(HA,i,o)}var DZ=J({unsortedSegmentSum_:_Z}),FZ={kernelName:HC,inputsToSave:["x","indices"],gradFunc:function(r,e,t){var n=ye(e,2),a=n[0],i=n[1],o=t.axis,s=yi(o,a.shape)[0],u=function(){var l=a.shape,c=i.size,f=l.slice(0,s),h=f.length,p=l.slice(o,l.length).slice(1),d=p.length,v=gN(0,h),m=gN(h+1,h+1+d),g=yN([f,[c],p]),y=ge(r,g),b=ge(i,[c]),w=yN([[h],v,m]),k=so(y,w),S=DZ(k,b,a.shape[s]),E=m0(w);return S=so(S,E),S};return{x:u,indices:function(){return i}}}};function gN(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function yN(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var RZ={kernelName:qC,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1];return{a:function(){return _t(n)},b:function(){return _t(a)}}}};var MZ={kernelName:r0,gradFunc:function(r){return{x:function(){return ot(r,"float32")}}}};var OZ={kernelName:KC,gradFunc:function(r){return{x:function(){return _t(r)}}}};var PZ={kernelName:jC,gradFunc:function(r){return{x:function(){return _t(r)}}}};var LZ={kernelName:XC,gradFunc:function(r){return{x:function(){return _t(r)}}}};function BZ(r,e){var t,n=H(r,"a","greater","string_or_numeric"),a=H(e,"b","greater","string_or_numeric");t=ye(_r(n,a),2),n=t[0],a=t[1],Xt(n.shape,a.shape);var i={a:n,b:a};return se.runKernel(gX,i)}var Ko=J({greater_:BZ}),zZ={kernelName:YC,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.alpha,o=Ko(a,0);return{x:function(){return Ua(o,r,me(r,i))}}}},$Z={kernelName:QC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return vt(r,rt(n,1))}}}},WZ={kernelName:ZC,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return vt(r,ot(n,"float32"))}}}},VZ={kernelName:TX,inputsToSave:[],outputsToSave:[!0],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.axis;return{logits:function(){var o=!0,s=Bi(a);return lt(r,me(ft(r,i,o),s))}}}};function UZ(r,e,t,n,a,i,o){n===void 0&&(n=5),a===void 0&&(a=1),i===void 0&&(i=1),o===void 0&&(o=.5);var s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return se.runKernel(IX,s,u)}var GZ=J({localResponseNormalizationBackprop_:UZ}),HZ={kernelName:JC,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=ye(e,2),a=n[0],i=n[1],o=t.depthRadius,s=t.bias,u=t.alpha,l=t.beta;return{x:function(){return GZ(a,i,r,o,s,u,l)}}}};function qZ(r,e){var t,n=H(r,"a","equal","string_or_numeric"),a=H(e,"b","equal","string_or_numeric");t=ye(_r(n,a),2),n=t[0],a=t[1],Xt(n.shape,a.shape);var i={a:n,b:a};return se.runKernel(hX,i)}var m_=J({equal_:qZ});function g_(r,e,t,n){return e.rank<t.rank&&(e=ge(e,pl(e.shape,n))),r.rank<t.rank&&(r=ge(r,pl(r.shape,n))),{x:function(){var a=me(r,ot(m_(t,e),r.dtype));return a}}}var bN={kernelName:eA,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.reductionIndices,i=e[0],o=e[1],s=yi(a,i.shape),u=g_(r,o,i,s);return{x:function(){return u.x()}}}};function KZ(r,e){var t,n=H(r,"a","less","string_or_numeric"),a=H(e,"b","less","string_or_numeric");t=ye(_r(n,a),2),n=t[0],a=t[1],Xt(n.shape,a.shape);var i={a:n,b:a};return se.runKernel(wX,i)}var jZ=J({less_:KZ}),XZ={kernelName:tA,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=function(){return me(r,ot(Kd(n,a),"float32"))},o=function(){return me(r,ot(jZ(n,a),"float32"))};return{a:i,b:o}}};function YZ(r,e,t,n,a,i,o){var s=H(r,"dy","maxPool3dGrad"),u=H(e,"input","maxPool3dGrad"),l=H(t,"output","maxPool3dGrad"),c=s,f=u,h=l,p=!1;u.rank===4&&(p=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=ge(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=ge(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),Z(c.rank===5,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+(c.rank+".")}),Z(f.rank===5,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+(f.rank+".")}),Z(h.rank===5,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+(h.rank+".")}),An("maxPool3dGrad",i,o);var d={dy:c,input:f,output:h},v={filterSize:n,strides:a,pad:i,dimRoundingMode:o},m=se.runKernel(CX,d,v);return p?ge(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var ZZ=J({maxPool3dGrad_:YZ}),QZ={kernelName:nA,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=ye(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad,l=t.dimRoundingMode;return{x:function(){return ZZ(r,a,i,o,s,u,l)}}}};function JZ(r,e,t,n,a,i,o){var s=H(r,"dy","maxPoolGrad"),u=H(e,"input","maxPoolGrad"),l=H(t,"output","maxPoolGrad");Z(u.rank===s.rank,function(){return"Rank of input ("+u.rank+") does not match rank of dy "+("("+s.rank+")")}),Z(s.rank===4,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+(s.rank+".")}),Z(u.rank===4,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+(u.rank+".")}),An("maxPoolGrad",i,o);var c={dy:s,input:u,output:l},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return se.runKernel(NX,c,f)}var eQ=J({maxPoolGrad_:JZ}),tQ={kernelName:rA,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=ye(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad;return{x:function(){return eQ(r,a,i,o,s,u)}}}};function vl(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=vl(r,"float32"),n=vl(r,"float32");return dl(t,n)}var a=u0(Xn(r),e);return se.makeTensor(a,r,e)}function $f(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=$f(r,"float32"),n=vl(r,"float32");return dl(t,n)}var a=XA(Xn(r),e);return se.makeTensor(a,r,e)}var rQ={kernelName:aA,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.axis,o=yi(i,a.shape),s=iZ(a.shape,o),u=s[1],l=Xn(u),c=function(){var f=a.shape.slice();o.forEach(function(d){f[d]=1});var h=ge(r,f),p=vt(me(h,$f(a.shape,"float32")),l);return p};return{x:c}}},nQ={kernelName:iA,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.axis,i=ye(e,2),o=i[0],s=i[1],u=yi(a,o.shape),l=g_(r,s,o,u);return{x:function(){return l.x()}}}},aQ={kernelName:oA,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=function(){return me(r,ot(zf(n,a),"float32"))},o=function(){return me(r,ot(Ko(n,a),"float32"))};return{a:i,b:o}}};function iQ(r,e,t){var n=H(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return se.runKernel(AA,a,i)}var Bt=J({slice_:iQ});var oQ={kernelName:sA,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return Bt(r,i,n.shape)}}}};function sQ(r){var e=H(r,"x","floor","float32"),t={x:e};return se.runKernel(VC,t)}var y_=J({floor_:sQ}),uQ={kernelName:uA,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=Xt(n.shape,a.shape),o=function(){var u=en(n.shape,i);return u.length>0?ge(ft(r,u),n.shape):r},s=function(){var u=me(r,Jr(y_(vt(n,a)))),l=en(a.shape,i);return l.length>0?ge(ft(u,l),a.shape):u};return{a:o,b:s}}},lQ={kernelName:lA,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=Xt(n.shape,a.shape),o=function(){var u=me(r,ot(a,"float32")),l=en(n.shape,i);return l.length>0?ge(ft(u,l),n.shape):u},s=function(){var u=me(r,ot(n,"float32")),l=en(a.shape,i);return l.length>0?ge(ft(u,l),a.shape):u};return{a:o,b:s}}};var cQ={kernelName:cA,gradFunc:function(r){return{x:function(){return Jr(r)}}}};var fQ={kernelName:hA,inputsToSave:["indices"],gradFunc:function(r,e){var t=e[0];return{indices:function(){return vl(t.shape,"float32")}}}};var hQ={kernelName:fA,gradFunc:function(r){return{x:function(){return _t(r)}}}};function pQ(r,e){e===void 0&&(e=0);var t=H(r,"x","unstack","string_or_numeric");Z(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"});var n={value:t},a={axis:e};return se.runKernel(GA,n,a)}var y0=J({unstack_:pQ});var dQ={kernelName:pA,saveAllInputs:!0,gradFunc:function(r,e,t){var n=t.axis,a=y0(r,n);return a.map(function(i){return function(){return i}})}};var wN={kernelName:dA,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return Bt(r,i,n.shape)}}}};function vQ(r){var e=H(r,"x","log","float32"),t={x:e};return se.runKernel(ZC,t)}var Nf=J({log_:vQ});function mQ(r,e){var t,n=H(r,"base","pow"),a=H(e,"exp","pow");t=ye(_r(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return se.runKernel(vA,i)}var ml=J({pow_:mQ}),gQ={kernelName:vA,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(r,e){var t=ye(e,3),n=t[0],a=t[1],i=t[2],o=n,s=a,u=Xt(o.shape,s.shape),l=function(){var f=ot(s,"float32"),h=me(r,me(f,ml(o,lt(f,mt(1))))),p=en(o.shape,u);return p.length>0&&(h=ft(h,p)),ge(h,o.shape)},c=function(){var f=Ko(o,0),h=Ua(f,Nf(o),_t(o)),p=me(r,me(i,h)),d=en(s.shape,u);return d.length>0&&(p=ft(p,d)),ge(p,s.shape)};return{a:l,b:c}}},yQ={kernelName:mA,inputsToSave:["x","alpha"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=Ko(n,0);return{x:function(){return Ua(i,r,me(r,a))},alpha:function(){var o=Ua(i,_t(r),me(r,n)),s=en(a.shape,r.shape);return s.length>0&&(o=ft(o,s)),ge(o,a.shape)}}}};function bQ(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Qn=Pr();Qn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Qn.registerFlag("IS_BROWSER",function(){return bQ()});Qn.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});Qn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});Qn.registerFlag("PROD",function(){return!1});Qn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Qn.getBool("DEBUG")});Qn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});Qn.registerFlag("IS_TEST",function(){return!1});Qn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});Qn.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});Qn.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});Qn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});Qn.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function wQ(r,e,t){var n=Lf(r,t);return Bf(r,e,n,t)}var b0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function xN(r){return b0?Buffer.byteLength(r):new Blob([r]).size}function xQ(r){if(b0)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function kQ(r){if(b0){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function SQ(r){if(r.length===1)return r[0];var e=0;r.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(a){t.set(new Uint8Array(a),n),n+=a.byteLength}),t.buffer}function b_(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function EQ(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),n}function TQ(r,e){return Ae(this,void 0,void 0,function(){var t,n,a;return Ce(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=ye.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,EQ(r,t,n)]}})})}function Xd(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:xN(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:xN(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}function IQ(r){var e,t,n=[];try{for(var a=ke(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,pt(o.weights))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var Hs=(function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r})(),NQ="tensorflowjs",CQ=1,yf="models_store",pd="model_info_store";function AQ(){if(!Pr().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function _Q(r){var e=r.result;e.createObjectStore(yf,{keyPath:"modelPath"}),e.createObjectStore(pd,{keyPath:"modelPath"})}var Id=(function(){function r(e){if(this.indexedDB=AQ(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ae(this,void 0,void 0,function(){return Ce(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ae(this,void 0,void 0,function(){return Ce(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(NQ,CQ);o.onupgradeneeded=function(){return _Q(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(yf,"readonly"),l=u.objectStore(yf),c=l.get(n.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));a(c.result.modelArtifacts)},c.onerror=function(m){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var f=Xd(t),h=s.transaction(pd,"readwrite"),p=h.objectStore(pd),d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f}),v;d.onsuccess=function(){v=s.transaction(yf,"readwrite");var m=v.objectStore(yf),g=m.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(pd);var b=p.delete(n.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},d.onerror=function(m){return s.close(),i(d.error)},h.oncomplete=function(){v==null?s.close():v.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r})();Id.URL_SCHEME="indexeddb://";var w_=function(r){return Pr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Id.URL_SCHEME)?DQ(r.slice(Id.URL_SCHEME.length)):null};Hs.registerSaveRouter(w_);Hs.registerLoadRouter(w_);function DQ(r){return new Id(r)}var ff="/",hf="tensorflowjs_models",FQ="info",RQ="model_topology",MQ="weight_specs",OQ="weight_data",PQ="model_metadata";function LQ(r){return{info:[hf,r,FQ].join(ff),topology:[hf,r,RQ].join(ff),weightSpecs:[hf,r,MQ].join(ff),weightData:[hf,r,OQ].join(ff),modelMetadata:[hf,r,PQ].join(ff)}}function BQ(r){var e,t;try{for(var n=ke(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}var Nd=(function(){function r(e){if(!Pr().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=LQ(this.modelPath)}return r.prototype.save=function(e){return Ae(this,void 0,void 0,function(){var t,n,a,i;return Ce(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=Xd(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,xQ(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw BQ(this.keys),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: "+("modelTopologyBytes="+a.modelTopologyBytes+", ")+("weightSpecsBytes="+a.weightSpecsBytes+", ")+("weightDataBytes="+a.weightDataBytes+"."))}return[2]})})},r.prototype.load=function(){return Ae(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Ce(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+("'"+this.modelPath+"' are missing."));return t.weightData=kQ(s),[2,t]})})},r})();Nd.URL_SCHEME="localstorage://";var x_=function(r){return Pr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Nd.URL_SCHEME)?zQ(r.slice(Nd.URL_SCHEME.length)):null};Hs.registerSaveRouter(x_);Hs.registerLoadRouter(x_);function zQ(r){return new Nd(r)}var $Q="model",WQ=".json",VQ=".weights.bin";function kN(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var Cd=(function(){function r(e){if(!Pr().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=$Q),this.modelJsonFileName=e+WQ,this.weightDataFileName=e+VQ}return r.prototype.save=function(e){return Ae(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ce(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=b_(e,n),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,kN(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,kN(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Xd(e)}]}})})},r})();Cd.URL_SCHEME="downloads://";var UQ=function(r){return Pr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Cd.URL_SCHEME)?GQ(r.slice(Cd.URL_SCHEME.length)):null};Hs.registerSaveRouter(UQ);function GQ(r){return r===void 0&&(r="model"),new Cd(r)}function SN(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(l){var c=t+ ++a/r.length*(n-t);return e(c),l}),u};function o(u){Z(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,l){Z(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+("got startFraction "+u)}),Z(l>=0&&l<=1,function(){return"Progress fraction must be in range [0, 1], but "+("got endFraction "+l)}),Z(l>=u,function(){return"startFraction must be no more than endFraction, but "+("got startFraction "+u+" and endFraction ")+(""+l)})}return Promise.all(r.map(i))}function HQ(r,e){return Ae(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return Ce(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Pr().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,SN(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),l=.5,c=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,SN(u,e.onProgress,l,c)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}var qQ="application/octet-stream",KQ="application/json",w0=(function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Z(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Pr().platform.fetch,Z(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Z(e.length===2,function(){return"URL paths for http must have a length of 2, "+("(actual length is "+e.length+").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return Ae(this,void 0,void 0,function(){var t,n,a,i;return Ce(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=b_(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:KQ}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:qQ}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:Xd(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+(i.status+"."))}})})},r.prototype.load=function(){return Ae(this,void 0,void 0,function(){var e,t,n,a,i,o=this;return Ce(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to "+this.path+" failed with status code "+(e.status+". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return[2,TQ(t,function(u){return o.loadWeights(u)})]}})})},r.prototype.loadWeights=function(e){return Ae(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h,p,d,v,m,g,y,b,w,k,S,E;return Ce(this,function(N){switch(N.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=ye(jQ(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=IQ(e),u=[],l=[];try{for(c=ke(e),f=c.next();!f.done;f=c.next()){h=f.value;try{for(p=(S=void 0,ke(h.paths)),d=p.next();!d.done;d=p.next())v=d.value,this.weightUrlConverter!=null?l.push(this.weightUrlConverter(v)):u.push(o+v+i)}catch(C){S={error:C}}finally{try{d&&!d.done&&(E=p.return)&&E.call(p)}finally{if(S)throw S.error}}}}catch(C){w={error:C}}finally{try{f&&!f.done&&(k=c.return)&&k.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(g=(m=u.push).apply,y=[u],[4,Promise.all(l)]):[3,2];case 1:g.apply(m,y.concat([pt.apply(void 0,[N.sent()])])),N.label=2;case 2:return[4,HQ(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return b=N.sent(),[2,[s,SQ(b)]]}})})},r})();w0.URL_SCHEME_REGEX=/^https?:\/\//;function jQ(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function EN(r){return r.match(w0.URL_SCHEME_REGEX)!=null}var k_=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return EN(n)}):t=EN(r),t?XQ(r,e):null};Hs.registerSaveRouter(k_);Hs.registerLoadRouter(k_);function XQ(r,e){return new w0(r,e)}function YQ(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=H(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return se.runKernel(hA,o,s)}var TN=J({oneHot_:YQ});function ZQ(r,e,t){var n=H(r,"labels","confusionMatrix"),a=H(e,"predictions","confusionMatrix");Z(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+("but got "+t)}),Z(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),Z(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+("but got "+a.rank)}),Z(n.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+(n.shape[0]+" vs. "+a.shape[0]+". ")+"Labels and predictions should have the same number of elements."}),Z(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+(""+t)});var i=TN(ot(n,"int32"),t),o=TN(ot(a,"int32"),t),s=so(i),u=At(s,o);return ot(u,"int32")}J({confusionMatrix_:ZQ});function QQ(r,e,t){if(a0(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Lf(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Bf(r,e,n,t)}var Ms;function JQ(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+("but was "+r.constructor.name));var u=Ay(QI,se.backendName);if(u!=null){var l={pixels:r},c={numChannels:e};return se.runKernel(QI,l,c)}var f=ye(a?[r.videoWidth,r.videoHeight]:[r.width,r.height],2),h=f[0],p=f[1],d;if(o)d=r.getContext("2d").getImageData(0,0,h,p).data;else if(n||t)d=r.data;else if(i||a||s){if(Ms==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Ms=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Ms=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Ms.canvas.width=h,Ms.canvas.height=p,Ms.drawImage(r,0,0,h,p),d=Ms.getImageData(0,0,h,p).data}var v;if(e===4)v=new Int32Array(d);else{var m=h*p;v=new Int32Array(m*e);for(var g=0;g<m;g++)for(var y=0;y<e;++y)v[g*e+y]=d[g*4+y]}var b=[p,h,e];return QQ(v,b,"int32")}J({fromPixels_:JQ});function eJ(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+("shape[sliceDim:], got updates.shape: "+t.shape)+(", indices.shape: "+e.shape+", shape: "+r)+(", sliceDim: "+n+", and batchDim: "+a+".");if(t.rank<a)throw new Error(i+(" update.rank < "+a+". "));if(r.length<n+(t.rank-a))throw new Error(i+(" Output shape length < "+(n+(t.rank-a))));if(t.rank!==a+r.length-n)throw new Error(i+(" update.rank != "+(a+r.length-n)));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+(" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+(" updates.shape["+(o+a)+"] ("+t.shape[o+a]+") != shape["+(o+a)+"] ("+r[o+a]+")"))}function tJ(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+(" but the rank was "+e.rank+"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+(" but the rank was "+r.rank+"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}eJ(t,e,r)}function rJ(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=pt([e],new Array(a-1).fill(0)):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){Z(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=pt([t],new Array(a-1).fill(-1)):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(Z(o===-1,function(){return"Negative size values should be exactly -1 but got "+(o+" for the slice() size at index "+s+".")}),r.shape[s]-n[s])}),[n,i]}var nJ=(function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r})(),aJ=(function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r})();function qs(r){Z(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),Z(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),Z(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),aJ.register(r)}function iJ(r){var e=H(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return se.runKernel(IC,t)}else{var t={x:e};return se.runKernel(lC,t)}}var za=J({abs_:iJ});function oJ(r){var e=H(r,"x","acos"),t={x:e};return se.runKernel(cC,t)}J({acos_:oJ});function sJ(r){var e=H(r,"x","acosh"),t={x:e};return se.runKernel(fC,t)}J({acosh_:sJ});function uJ(r){Z(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Z(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+(""+r.length)});var e=r.map(function(a,i){return H(a,"tensors"+i,"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!bl(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return se.runKernel(hC,n)}J({addN_:uJ});function lJ(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=H(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return se.runKernel(G7,a,i)}J({all_:lJ});function cJ(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=H(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return se.runKernel(H7,a,i)}J({any_:cJ});function fJ(r,e){e===void 0&&(e=0);var t=H(r,"x","argMax"),n={x:t},a={axis:e};return se.runKernel(pC,n,a)}J({argMax_:fJ});function hJ(r,e){e===void 0&&(e=0);var t=H(r,"x","argMin"),n={x:t},a={axis:e};return se.runKernel(dC,n,a)}J({argMin_:hJ});function pJ(r){var e=H(r,"x","asin"),t={x:e};return se.runKernel(vC,t)}J({asin_:pJ});function dJ(r){var e=H(r,"x","asinh"),t={x:e};return se.runKernel(mC,t)}J({asinh_:dJ});function vJ(r){var e=H(r,"x","atan"),t={x:e};return se.runKernel(gC,t)}J({atan_:vJ});function mJ(r,e){var t,n=H(r,"a","atan2"),a=H(e,"b","atan2");t=ye(_r(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return se.runKernel(bC,i)}J({atan2_:mJ});function gJ(r){var e=H(r,"x","atanh"),t={x:e};return se.runKernel(yC,t)}J({atanh_:gJ});function yJ(r,e,t,n,a){var i=H(r,"x","avgPool","float32"),o=1;Z(lo(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Z(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),An("avgPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=se.runKernel(wC,l,c);return f=ot(f,i.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var bJ=J({avgPool_:yJ});function wJ(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=H(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Z(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."}),Z(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),An("avgPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=se.runKernel(xC,l,c);return f=ot(f,s.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}J({avgPool3d_:wJ});function xJ(r,e){e===void 0&&(e=0),Z(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=kd(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+i.dtype+". ")}),t.length===1)return xf(t[0]);var n=t,a={axis:e};return se.runKernel(NC,n,a)}var Zn=J({concat_:xJ});function kJ(r){var e=H(r,"x","sigmoid","float32"),t={x:e};return se.runKernel(RA,t)}var ll=J({sigmoid_:kJ});function SJ(r){var e=H(r,"x","tanh","float32"),t={x:e};return se.runKernel(UA,t)}var IN=J({tanh_:SJ});function EJ(r,e,t,n,a,i){var o=H(r,"forgetBias","basicLSTMCell"),s=H(e,"lstmKernel","basicLSTMCell"),u=H(t,"lstmBias","basicLSTMCell"),l=H(n,"data","basicLSTMCell"),c=H(a,"c","basicLSTMCell"),f=H(i,"h","basicLSTMCell"),h=Zn([l,f],1),p=At(h,s),d=rt(p,u),v=d.shape[0],m=d.shape[1]/4,g=[v,m],y=Bt(d,[0,0],g),b=Bt(d,[0,m],g),w=Bt(d,[0,m*2],g),k=Bt(d,[0,m*3],g),S=rt(me(ll(y),IN(b)),me(c,ll(rt(o,w)))),E=me(IN(S),ll(k));return[S,E]}J({basicLSTMCell_:EJ});function TJ(r,e,t){var n=H(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});Z(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),Z(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),Z(n.shape[0]%a===0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of "+("the elements of blockShape "+e.join(" * ")+" === "+a)});var i={x:n},o={blockShape:e,crops:t};return se.runKernel(SC,i,o)}var S_=J({batchToSpaceND_:TJ});function IJ(r){var e;return r.rank===0||r.rank===1?e=ge(r,[1,1,1,r.size]):r.rank===2?e=ge(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function NJ(r,e,t,n,a,i){i==null&&(i=.001);var o=H(r,"x","batchNorm"),s=H(e,"mean","batchNorm"),u=H(t,"variance","batchNorm"),l;a!=null&&(l=H(a,"scale","batchNorm"));var c;n!=null&&(c=H(n,"offset","batchNorm")),Z(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Z(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Z(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=IJ(o),h={x:f,scale:l,offset:c,mean:s,variance:u},p={varianceEpsilon:i},d=se.runKernel(GC,h,p);return ge(d,o.shape)}var x0=J({batchNorm_:NJ});function CJ(r,e,t,n,a,i){var o=H(r,"x","batchNorm"),s=H(e,"mean","batchNorm"),u=H(t,"variance","batchNorm"),l;a!=null&&(l=H(a,"scale","batchNorm"));var c;return n!=null&&(c=H(n,"offset","batchNorm")),Z(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+(o.rank+".")}),Z(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+("got rank "+s.rank+".")}),Z(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&Z(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&Z(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+("but got rank "+c.rank+".")}),x0(o,s,u,c,l,i)}J({batchNorm2d_:CJ});function AJ(r,e,t,n,a,i){var o=H(r,"x","batchNorm"),s=H(e,"mean","batchNorm"),u=H(t,"variance","batchNorm"),l;a!=null&&(l=H(a,"scale","batchNorm"));var c;return n!=null&&(c=H(n,"offset","batchNorm")),Z(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+(o.rank+".")}),Z(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+("got rank "+s.rank+".")}),Z(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&Z(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&Z(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+("but got rank "+c.rank+".")}),x0(o,s,u,c,l,i)}J({batchNorm3d_:AJ});function _J(r,e,t,n,a,i){var o=H(r,"x","batchNorm"),s=H(e,"mean","batchNorm"),u=H(t,"variance","batchNorm"),l;a!=null&&(l=H(a,"scale","batchNorm"));var c;return n!=null&&(c=H(n,"offset","batchNorm")),Z(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+(o.rank+".")}),Z(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+("got rank "+s.rank+".")}),Z(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&Z(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&Z(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+("but got rank "+c.rank+".")}),x0(o,s,u,c,l,i)}J({batchNorm4d_:_J});function DJ(r,e,t){var n=H(r,"x","bincount"),a=H(e,"weights","bincount");Z(n.dtype==="int32",function(){return"Error in bincount: input "+("dtype must be int32, but got "+n.dtype)}),Z(t>=0,function(){return"size must be non-negative, but got "+t+"."}),Z(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+("0-length, but got input shape: "+n.shape+", weights shape: ")+(a.shape+".")});var i={x:n,weights:a},o={size:t};return se.runKernel(j7,i,o)}var FJ=J({bincount_:DJ});function RJ(r,e){var t=H(r,"s0","broadcastArgs","int32"),n=H(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+("Has rank "+t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+("Has rank "+n.rank));var a={s0:t,s1:n};return se.runKernel(Y7,a)}J({broadcastArgs_:RJ});function Wf(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",YA(r),new R9(r,e,t)}function MJ(r){var e=H(r,"x","ceil","float32"),t={x:e};return se.runKernel(EC,t)}J({ceil_:MJ});function Yd(r,e,t){var n={shape:r,value:e,dtype:t};return se.runKernel(dX,{},n)}function OJ(r,e,t){var n=H(r,"x","clipByValue");if(Z(e<=t,function(){return"Error in clip: min ("+e+") must be "+("less than or equal to max ("+t+").")}),e===t)return Yd(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return se.runKernel(TC,a,i)}J({clipByValue_:OJ});function PJ(r){return Zn(r,0)}J({concat1d_:PJ});function LJ(r,e){return Zn(r,e)}J({concat2d_:LJ});function BJ(r,e){return Zn(r,e)}J({concat3d_:BJ});function zJ(r,e){return Zn(r,e)}J({concat4d_:zJ});function $J(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=H(r,"x","conv1d"),u=H(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=ge(s,[1,s.shape[0],s.shape[1]])),Z(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),Z(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+(u.rank+".")}),An("conv1d",n,o),Z(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match "+("input depth for filter "+u.shape[1]+".")}),Z(lo(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+("Got stride "+t+" and dilation '"+i+"'")}),Z(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var f=ge(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ge(l,[l.shape[0],1,l.shape[1],l.shape[2]]),p=[1,t],d=[1,i],v="NHWC",m=jd(h,f,p,n,v,d,o);return c?ge(m,[m.shape[2],m.shape[3]]):ge(m,[m.shape[0],m.shape[2],m.shape[3]])}J({conv1d_:$J});function WJ(r,e,t,n,a,i){var o=H(r,"x","conv2dTranspose"),s=H(e,"filter","conv2dTranspose");return v0(t,o,s,n,a,"NHWC",i)}J({conv2dTranspose_:WJ});function VJ(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=H(r,"x","conv3d"),s=H(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Z(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),Z(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+(s.rank+".")}),Z(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match "+("input depth for filter "+s.shape[3]+".")}),Z(lo(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")}),Z(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var c={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=se.runKernel(_C,c,f);return l?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}J({conv3d_:VJ});function UJ(r,e,t,n,a){var i=H(r,"x","conv3dTranspose"),o=H(e,"filter","conv3dTranspose");return h_(t,i,o,n,a)}J({conv3dTranspose_:UJ});function GJ(r){var e=H(r,"x","cos","float32"),t={x:e};return se.runKernel(DC,t)}var E_=J({cos_:GJ});function HJ(r){var e=H(r,"x","cosh","float32"),t={x:e};return se.runKernel(FC,t)}var qJ=J({cosh_:HJ});function KJ(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=H(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return se.runKernel(tX,i,o)}var NN=J({cumprod_:KJ});function jJ(r,e,t,n){n===void 0&&(n=!1);var a=H(r,"x","denseBincount"),i=H(e,"weights","denseBincount");Z(a.dtype==="int32",function(){return"Error in denseBincount: input "+("dtype must be int32, but got "+a.dtype)}),Z(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+("rank "+a.rank+".")}),Z(t>=0,function(){return"size must be non-negative, but got "+t+"."}),Z(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+("0-length, but got x shape: "+a.shape+", weights shape: ")+(i.shape+".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return se.runKernel(nX,o,s)}J({denseBincount_:jJ});function XJ(r,e,t){t===void 0&&(t="NHWC");var n=H(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];Z(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}),Z(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+a+" and "+e+`  for depthToSpace with input shape
    `+n.shape}),Z(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+i+" and "+e+` for depthToSpace with input shape
        `+n.shape}),Z(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+n.shape});var s={x:n},u={blockSize:e,dataFormat:t};return se.runKernel(aX,s,u)}J({depthToSpace_:XJ});function YJ(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=H(r,"x","depthwiseConv2d","float32"),u=H(e,"filter","depthwiseConv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Z(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+("rank "+l.rank+".")}),Z(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+(u.rank+".")});var f=a==="NHWC"?l.shape[3]:l.shape[1];Z(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+("("+f+") must match the inChannels dimension in ")+("filter "+u.shape[2]+".")}),An("depthwiseConv2d",n,o);var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=se.runKernel(MC,h,p);return c?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var T_=J({depthwiseConv2d_:YJ});function ZJ(r){var e=H(r,"x","diag"),t={x:e};return se.runKernel(sX,t)}J({diag_:ZJ});function QJ(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=H(r,"x","dilation2d"),s=H(e,"filter","dilation2d");Z(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+(o.rank+".")}),Z(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+(s.rank+".")}),Z(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+("but got dataFormat of "+i)});var u=o,l=!1;o.rank===3&&(u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);var c={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=se.runKernel(OC,c,f);return l?ge(h,[h.shape[1],h.shape[2],h.shape[3]]):h}J({dilation2d_:QJ});function JJ(r,e){var t,n=H(r,"a","div"),a=H(e,"b","div");t=ye(_r(n,a),2),n=t[0],a=t[1];var i=vt(n,a),o=_t(i),s=m_(a,o);return Ua(s,o,i)}J({divNoNan_:JJ});function eee(r,e){var t=H(r,"t1","dot"),n=H(e,"t2","dot");Z((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+(t.rank+" and "+n.rank+".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(Z(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+(a+" and "+i+".")}),t.rank===1&&n.rank===1){var o=ge(t,[1,-1]),s=ge(n,[-1,1]),u=At(o,s);return ge(u,[])}else if(t.rank===1&&n.rank===2){var o=ge(t,[1,-1]),s=ge(n,[n.shape[0],n.shape[1]]),u=At(o,s);return ge(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=ge(n,[-1,1]),u=At(t,s);return ge(u,[u.size])}else{var s=ge(n,[n.shape[0],n.shape[1]]),u=At(t,s);return u}}J({dot_:eee});function tee(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return H(i,"tensors"+o,"einsum")}),a={equation:r};return se.runKernel(cX,n,a)}J({einsum_:tee});function ree(r){var e=H(r,"x","elu","float32"),t={x:e};return se.runKernel(LC,t)}var nee=J({elu_:ree});function aee(r){var e=H(r,"x","erf");Z(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=ot(e,"float32"));var t={x:e};return se.runKernel(BC,t)}J({erf_:aee});function iee(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=H(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return se.runKernel(eA,a,i)}var Sf=J({max_:iee});function oee(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=H(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return se.runKernel(iA,a,i)}var CN=J({min_:oee});function see(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=H(r,"x","norm");var a=I_(r,e,t),i=a.shape;if(n){var o=yi(t,r.shape);i=pl(a.shape,o)}return ge(a,i)}function I_(r,e,t){if(t===void 0&&(t=null),r.rank===0)return za(r);if(r.rank!==1&&t===null)return I_(ge(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return ft(za(r),t);if(e===1/0)return Sf(za(r),t);if(e===-1/0)return CN(za(r),t);if(e==="euclidean"||e===2)return wa(ft(ml(za(r),mt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&t.length===2){if(e===1)return Sf(ft(za(r),t[0]),t[1]-1);if(e===1/0)return Sf(ft(za(r),t[1]),t[0]);if(e===-1/0)return CN(ft(za(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return wa(ft(ur(r),t));throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}var k0=J({norm_:see});function uee(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),k0(r,"euclidean",e,t)}J({euclideanNorm_:uee});function lee(r,e){e===void 0&&(e=0);var t=H(r,"x","expandDims","string_or_numeric");Z(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return se.runKernel($C,n,a)}var Os=J({expandDims_:lee});function cee(r){var e=H(r,"x","expm1"),t={x:e};return se.runKernel(WC,t)}J({expm1_:cee});function fee(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=Wf([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=ge(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return kf(Os(s,0),[t[0],1,1]);if(t.length===2)return kf(Os(Os(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return kf(Os(Os(Os(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+("batchShapes, but received "+t.length+"D."))}var hee=J({eye_:fee});function pee(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=H(r,"x","gather"),i=H(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return se.runKernel(HC,o,s)}var dee=J({gather_:pee});function vee(r){var e=H(r,"x","isFinite"),t={x:e};return se.runKernel(KC,t)}J({isFinite_:vee});function mee(r){var e=H(r,"x","isInf"),t={x:e};return se.runKernel(jC,t)}J({isInf_:mee});function gee(r){var e=H(r,"x","isNaN"),t={x:e};return se.runKernel(XC,t)}J({isNaN_:gee});function yee(r,e){e===void 0&&(e=.2);var t=H(r,"x","leakyRelu"),n={x:t},a={alpha:e};return se.runKernel(YC,n,a)}var bee=J({leakyRelu_:yee});function wee(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=H(r,"x","localResponseNormalization");Z(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),Z(Ef(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+("integer but got depthRadius "+e+".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},l={depthRadius:e,bias:t,alpha:n,beta:a},c=se.runKernel(JC,u,l);return s?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}J({localResponseNormalization_:wee});function xee(r){var e=H(r,"x","log1p"),t={x:e};return se.runKernel(QC,t)}var kee=J({log1p_:xee});function See(r,e){Z(Ny(r),function(){return"The f passed in variableGrads(f) must be a function"}),Z(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof xd}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in se.registeredVariables)e.push(se.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),Z(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+("be trainable, but none of the "+i+" variables is ")+"trainable."});var o=!0,s=se.gradients(r,e,null,o),u=s.value,l=s.grads;Z(l.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Z(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+("returned a rank-"+u.rank+" tensor")});var c={};return e.forEach(function(f,h){l[h]!=null&&(c[f.name]=l[h])}),a?.forEach(function(f){return c[f.name]=null}),{value:u,grads:c}}function uo(r){return se.customGrad(r)}function Eee(r){var e=H(r,"x","softplus"),t={x:e};return se.runKernel(MA,t)}var Tee=J({softplus_:Eee});function Iee(r){var e=H(r,"x","logSigmoid"),t=uo(function(n){var a=Jr(Tee(Jr(n))),i=function(o){var s=me(o,ll(Jr(n)));return s};return{value:a,gradFunc:i}});return t(e)}J({logSigmoid_:Iee});function Nee(r,e){e===void 0&&(e=-1);var t=H(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and axis was "+e));var n=uo(function(a,i){var o=!0,s=Sf(a,e,!0),u=lt(a,s),l=lt(ot(u,"float32"),Nf(ft(Bi(u),e,o)));i([l]);var c=function(f,h){var p=ye(h,1),d=p[0],v=!0,m=Bi(d);return lt(f,me(ft(f,e,v),m))};return{value:l,gradFunc:c}});return n(t)}J({logSoftmax_:Nee});function Cee(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=H(r,"x","logSumExp"),a=yi(e,n.shape),i=Sf(n,a,!0),o=lt(n,i),s=Bi(o),u=ft(s,a),l=Nf(u),c=rt(ge(i,l.shape),l);if(t){var f=pl(c.shape,a);return ge(c,f)}return c}var Aee=J({logSumExp_:Cee});function _ee(r){var e=H(r,"x","logicalNot","bool"),t={x:e};return se.runKernel(SX,t)}var N_=J({logicalNot_:_ee});function Dee(r,e){var t=H(r,"a","logicalOr","bool"),n=H(e,"b","logicalOr","bool");Xt(t.shape,n.shape);var a={a:t,b:n};return se.runKernel(EX,a)}var Fee=J({logicalOr_:Dee});function Ree(r,e){var t=H(r,"a","logicalXor","bool"),n=H(e,"b","logicalXor","bool");return Xt(t.shape,n.shape),Tf(Fee(r,e),N_(Tf(r,e)))}J({logicalXor_:Ree});var sd=2147483648;function Mee(r,e,t){t===void 0&&(t="left");var n=H(r,"sortedSequence","searchSorted"),a=H(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=ge(n,[-1,i]),u=ge(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Xn(u.shape)>=sd)throw new Error("values tensor size must less than "+sd);if(s.shape[1]>=sd)throw new Error("trailing dim_size must less than "+sd+" for int32 output type, was "+s.shape[1]);var l={sortedSequence:s,values:u},c={side:t};return se.runKernel(VX,l,c)}J({searchSorted_:Mee});function Oee(r,e,t,n,a){var i=H(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Z(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),Z(lo(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")}),An("maxPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=se.runKernel(rA,l,c);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Pee=J({maxPool_:Oee});function Lee(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=H(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Z(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."}),Z(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),An("maxPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=se.runKernel(nA,l,c);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}J({maxPool3d_:Lee});function Bee(r,e,t,n,a){a===void 0&&(a=!1);var i=H(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=se.runKernel(AX,o,s);return{result:u[0],indexes:u[1]}}J({maxPoolWithArgmax_:Bee});function zee(r,e){var t,n=H(r,"a","maximum"),a=H(e,"b","maximum");t=ye(_r(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=ot(n,"int32"),a=ot(a,"int32")),Xt(n.shape,a.shape);var i={a:n,b:a};return se.runKernel(tA,i)}var C_=J({maximum_:zee});function $ee(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=H(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return se.runKernel(aA,a,i)}var Ly=J({mean_:$ee});function Wee(r,e){var t,n=H(r,"a","minimum"),a=H(e,"b","minimum");t=ye(_r(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=ot(n,"int32"),a=ot(a,"int32")),Xt(n.shape,a.shape);var i={a:n,b:a};return se.runKernel(oA,i)}var Vee=J({minimum_:Wee});function Uee(r,e,t){Z(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+("Got "+t+".")});var n=H(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Z(e.length===n.rank,function(){return"Padding doesn't match input. Must be "+n.rank+". "+("Got "+e.length+".")});for(var a=t==="reflect"?1:0,i=function(l){Z(e[l].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Z(e[l][0]>=0&&e[l][0]<=n.shape[l]-a&&e[l][1]>=0&&e[l][1]<=n.shape[l]-a,function(){return"Padding in dimension "+l+" cannot be greater than or equal "+("to "+(n.shape[l]-a)+" or less than 0 for input of ")+("shape "+n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return se.runKernel(sA,u,s)}J({mirrorPad_:Uee});function Gee(r,e){var t,n=H(r,"a","mod"),a=H(e,"b","mod");t=ye(_r(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return se.runKernel(uA,i)}J({mod_:Gee});function Hee(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=H(r,"x","moments");var n=yi(e,r.shape),a=Ly(r,n,t),i=a.shape;t||(i=pl(a.shape,n));var o=ur(lt(ot(r,"float32"),ge(a,i))),s=Ly(o,n,t);return{mean:a,variance:s}}J({moments_:Hee});function qee(r,e,t,n){for(var a=H(e,"data","multiRNNCell"),i=kd(t,"c","multiRNNCell"),o=kd(n,"h","multiRNNCell"),s=a,u=[],l=0;l<r.length;l++){var c=r[l](s,i[l],o[l]);u.push(c[0]),u.push(c[1]),s=c[1]}for(var f=[],h=[],l=0;l<u.length;l+=2)f.push(u[l]),h.push(u[l+1]);return[f,h]}J({multiRNNCell_:qee});function Kee(r,e,t,n){n===void 0&&(n=!1);var a=H(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+(i+"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var s=o===1?ge(a,[1,-1]):a,u={logits:s},l={numSamples:e,seed:t,normalized:n},c=se.runKernel(_X,u,l);return o===1?ge(c,[c.size]):c}J({multinomial_:Kee});function jee(r,e){var t,n=H(r,"a","notEqual","string_or_numeric"),a=H(e,"b","notEqual","string_or_numeric");t=ye(_r(n,a),2),n=t[0],a=t[1],Xt(n.shape,a.shape);var i={a:n,b:a};return se.runKernel(DX,i)}var Xee=J({notEqual_:jee});function Yee(r){var e=H(r,"x","onesLike"),t={x:e};return se.runKernel(fA,t)}J({onesLike_:Yee});function Zee(r,e){var t=H(r,"v1","outerProduct"),n=H(e,"v2","outerProduct");Z(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+(t.rank+" and "+n.rank+".")});var a=ge(t,[-1,1]),i=ge(n,[1,-1]);return At(a,i)}J({outerProduct_:Zee});function Qee(r,e,t){t===void 0&&(t=0);var n=H(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return se.runKernel(dA,i,a)}var Vf=J({pad_:Qee});function Jee(r,e,t){return t===void 0&&(t=0),Z(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Vf(r,[e],t)}J({pad1d_:Jee});function ete(r,e,t){return t===void 0&&(t=0),Z(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Vf(r,e,t)}J({pad2d_:ete});function tte(r,e,t){return t===void 0&&(t=0),Z(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Vf(r,e,t)}J({pad3d_:tte});function rte(r,e,t){return t===void 0&&(t=0),Z(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Vf(r,e,t)}J({pad4d_:rte});function nte(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=H(r,"x","maxPool"),u=s,l=!1;s.rank===3&&(l=!0,u=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Z(lo(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+("Got strides "+i+" and dilations '"+a+"'")});var c=vY(u.shape,e,i,a,n),f=[c.dilationHeight,c.dilationWidth],h;n==="same"?h=ite([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=ye(ate([c.inHeight,c.inWidth],f,h),2),v=d[0],m=d[1],g=p?n:"valid",y=p?u:f_(u,f,v),b=t==="avg"?function(){return bJ(y,e,i,g,o)}:function(){return Pee(y,e,i,g,o)},w=b(),k=p?w:S_(w,f,m);return l?ge(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function ate(r,e,t){var n=t.map(function(c){return c[0]}),a=t.map(function(c){return c[1]}),i=r.concat(n,a),o=e.map(function(c,f){return(c-i[f]%c)%c}),s=a.map(function(c,f){return c+o[f]}),u=e.map(function(c,f){return[n[f],s[f]]}),l=e.map(function(c,f){return[0,o[f]]});return[u,l]}function ite(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}J({pool_:nte});function ote(r,e){var t=H(r,"x","prelu"),n=H(e,"alpha","prelu"),a={x:t,alpha:n};return se.runKernel(mA,a)}var ste=J({prelu_:ote});function ute(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=H(r,"x","prod");n.dtype==="bool"&&(n=ot(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return se.runKernel(gA,a,i)}J({prod_:ute});function lte(r,e,t,n){var a=r.map(function(c,f){return H(c,"tensors"+f,"raggedGather","int32")}),i=H(e,"paramsDenseValues","raggedGather"),o=H(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},l=se.runKernel(OX,s,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}J({raggedGather_:lte});function cte(r,e,t,n,a){var i=H(r,"shape","raggedTensorToTensor","int32"),o=H(e,"values","raggedTensorToTensor"),s=H(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return H(f,"tensors"+h,"raggedTensorToTensor","int32")}),l={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},c={rowPartitionTypes:a};return se.runKernel(PX,l,c)}J({raggedTensorToTensor_:cte});function fte(r,e,t){var n=Xn(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type "+t);for(var i=0;i<n;i++)a[i]=e();return se.makeTensor(a,r,t)}J({rand_:fte});var Ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hte(r){if(r.__esModule)return r;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(t){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}),e}function js(r){var e={exports:{}};return r(e,e.exports),e.exports}var pte=js(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Ks,r,!1)}),dte=js(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Ks,r,!1)}),vte=js(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Ks,r,!1)}),mte=js(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),c.x=p,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Ks,r,!1)}),gte=js(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=512;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=m,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Ks,r,!1)}),yte=js(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Ks,r,!1)}),bte={},wte={__proto__:null,default:bte},xte=hte(wte),Xs=js(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,k,S){var E=[];k=k==!0?{entropy:!0}:k||{};var N=g(m(k.entropy?[w,b(t)]:w??y(),3),E),C=new d(E),R=function(){for(var _=C.g(i),O=u,P=0;_<l;)_=(_+P)*a,O*=a,P=C.g(1);for(;_>=c;)_/=2,O/=2,P>>>=1;return(_+P)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(b(C.S),t),(k.pass||S||function(_,O,P,B){return B&&(B.S&&v(B,C),_.state=function(){return v(C,{})}),P?(n[s]=_,O):_})(R,N,"global"in k?k.global:this==n,k.state)}function d(w){var k,S=w.length,E=this,N=0,C=E.i=E.j=0,R=E.S=[];for(S||(w=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+w[N%S]+(k=R[N])],R[C]=k;(E.g=function(_){for(var O,P=0,B=E.i,W=E.j,L=E.S;_--;)O=L[B=f&B+1],P=P*a+L[f&(L[B]=L[W=f&W+O])+(L[W]=O)];return E.i=B,E.j=W,P})(a)}function v(w,k){return k.i=w.i,k.j=w.j,k.S=w.S.slice(),k}function m(w,k){var S=[],E=typeof w,N;if(k&&E=="object")for(N in w)try{S.push(m(w[N],k-1))}catch{}return S.length?S:E=="string"?w:w+"\0"}function g(w,k){for(var S=w+"",E,N=0;N<S.length;)k[f&N]=f&(E^=k[f&N]*19)+S.charCodeAt(N++);return b(k)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var k=e.navigator,S=k&&k.plugins;return[+new Date,e,S,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=xte}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Ks,[],Math)});Xs.alea=pte;Xs.xor128=dte;Xs.xorwow=vte;Xs.xorshift7=mte;Xs.xor4096=gte;Xs.tychei=yte;var S0=Xs;var E0=(function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=S0.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r})(),kte=(function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=S0.alea(i.toString()),this.randn=new E0(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r})(),Ste=(function(){function r(e,t,n,a){var i=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=S0.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r})();function Ete(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var i=new kte(e,t,n,a),o=Wf(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}J({randomGamma_:Ete});function Tte(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new E0(e,t,n,!1,a),o=Wf(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Ite=J({randomNormal_:Tte});function Nte(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type "+e);return Ite(r,0,1,e,t)}J({randomStandardNormal_:Nte});function Cte(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var i=Wf(r,n),o=new Ste(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var Ate=J({randomUniform_:Cte});function Ad(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return se.runKernel(LX,{},a)}function _te(r){var e=H(r,"x","reciprocal"),t={x:e};return se.runKernel(yA,t)}J({reciprocal_:_te});function Dte(r){var e=H(r,"x","relu"),t={x:e};return se.runKernel(bA,t)}var T0=J({relu_:Dte});function Fte(r){var e=H(r,"x","relu6"),t={x:e};return se.runKernel(SA,t)}var Rte=J({relu6_:Fte});function Mte(r,e){var t=H(r,"x","reverse"),n={x:t},a={dims:e};return se.runKernel(EA,n,a)}var Vs=J({reverse_:Mte});function Ote(r){var e=H(r,"x","reverse");return Z(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Vs(e,0)}J({reverse1d_:Ote});function Pte(r,e){var t=H(r,"x","reverse");return Z(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Vs(t,e)}J({reverse2d_:Pte});function Lte(r,e){var t=H(r,"x","reverse");return Z(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Vs(t,e)}J({reverse3d_:Lte});function Bte(r,e){var t=H(r,"x","reverse");return Z(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Vs(t,e)}J({reverse4d_:Bte});function zte(r){var e=H(r,"x","round"),t={x:e};return se.runKernel(TA,t)}var $te=J({round_:zte});function Wte(r){var e=H(r,"x","selu"),t={x:e};return se.runKernel(CA,t)}J({selu_:Wte});function Vte(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=H(r,"x","separableConv2d"),u=H(e,"depthwiseFilter","separableConv2d"),l=H(t,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(s.rank===3&&(f=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Z(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+("rank "+c.rank+".")}),Z(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+("got rank "+u.rank+".")}),Z(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+("got rank "+u.rank+".")}),Z(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+(" must be 1, but got "+l.shape[0]+".")}),Z(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+("filter must be 1, but got "+l.shape[1]+".")});var h=u.shape[2],p=u.shape[3];Z(l.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+("must be "+h*p+", ")+("but got "+l.shape[2]+".")});var d=T_(c,u,n,a,o,i),v=1,m=jd(d,l,v,"valid",o);return f?ge(m,[m.shape[1],m.shape[2],m.shape[3]]):m}J({separableConv2d_:Vte});function Ute(r){var e=H(r,"x","sign"),t={x:e};return se.runKernel(FA,t)}J({sign_:Ute});function Gte(r,e,t){var n=H(r,"x","slice1d");return Z(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),Bt(n,[e],[t])}J({slice1d_:Gte});function Hte(r,e,t){var n=H(r,"x","slice2d");return Z(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),Bt(n,e,t)}J({slice2d_:Hte});function qte(r,e,t){var n=H(r,"x","slice3d");return Z(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),Bt(n,e,t)}J({slice3d_:qte});function Kte(r,e,t){var n=H(r,"x","slice4d");return Z(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),Bt(n,e,t)}J({slice4d_:Kte});function jte(r,e){e===void 0&&(e=-1);var t=H(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and dim was "+e));var n={logits:t},a={dim:e};return se.runKernel(zA,n,a)}J({softmax_:jte});function Xte(r){Z(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return se.runKernel(pX,e)}var Yte=J({fft_:Xte});function Zte(r){Z(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return se.runKernel(yX,e)}var AN=J({ifft_:Zte});function Qte(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=ge(r,[t,e]);n=AN(a)}else{var i=[t,2*(e-1)],o=ge(Td(r),[t,e]),s=ge(g0(r),[t,e]),u=Vs(Bt(o,[0,1],[t,e-2]),1),l=me(Vs(Bt(s,[0,1],[t,e-2]),1),mt(-1)),c=Zn([o,u],1),f=Zn([s,l],1),a=ge(dl(c,f),[i[0],i[1]]);n=AN(a)}if(n=Td(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=ge(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}J({irfft_:Qte});function Jte(r,e){Z(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=Bt(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=Zn([r,vl(s)],r.shape.length-1),t=e}else a=r;var u=_t(a),l=ge(dl(a,u),[n,t]),c=Yte(l),f=Math.floor(t/2)+1,h=Td(c),p=g0(c),d=If(h,[f,t-f],h.shape.length-1),v=If(p,[f,t-f],p.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=f,ge(dl(d[0],v[0]),m)}var ere=J({rfft_:Jte});function tre(r,e){var t,n=H(r,"a","squaredDifference"),a=H(e,"b","squaredDifference");t=ye(_r(n,a),2),n=t[0],a=t[1],Xt(n.shape,a.shape);var i={a:n,b:a},o={};return se.runKernel($A,i,o)}var rre=J({squaredDifference_:tre});function nre(r,e){var t=H(r,"x","squeeze","string_or_numeric");return ge(t,o9(t.shape,e).newShape)}var are=J({squeeze_:nre});function ire(r,e){e===void 0&&(e=0);var t=kd(r,"tensors","stack","string_or_numeric");Z(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&Z(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return se.runKernel(pA,n,a)}var Cf=J({stack_:ire});function ore(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var l=H(r,"x","stridedSlice","string_or_numeric"),c={x:l},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return se.runKernel(XX,c,f)}J({stridedSlice_:ore});function sre(r){var e=H(r,"x","tan","float32"),t={x:e};return se.runKernel(VA,t)}J({tan_:sre});function ul(r,e){a0(r);var t=Lf(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return Bf(r,n,t,e)}function dd(r,e,t){if(a0(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Lf(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Bf(r,e,n,t)}function ure(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=H(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got "+e);if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") "+("but got "+e));var i={x:n},o={k:e,sorted:t},s=ye(se.runKernel(JX,i,o),2),u=s[0],l=s[1];return{values:u,indices:l}}J({topk_:ure});function lre(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new E0(e,t,n,!0,a),o=Wf(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}J({truncatedNormal_:lre});function cre(r,e){e===void 0&&(e=0);var t=H(r,"x","unique","string_or_numeric");Z(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=ye(se.runKernel(t9,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}J({unique_:cre});function fre(r,e,t,n,a){a===void 0&&(a=!0);var i=H(r,"v","movingAverage"),o=H(e,"x","movingAverage"),s=H(t,"decay","movingAverage");B9(i,o),Z(bl(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=mt(1),l=lt(u,s),c=me(lt(o,i),l);if(a){Z(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=H(n,"step","movingAverage");c=vt(c,lt(u,ml(s,f)))}return rt(i,c)}J({movingAverage_:fre});function hre(r,e,t){var n=H(r,"indices","scatterND","int32"),a=H(e,"updates","scatterND");tJ(a,n,t);var i={indices:n,updates:a},o={shape:t};return se.runKernel(WX,i,o)}J({scatterND_:hre});function pre(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+(" but the dtype was "+r.dtype+"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+(" but got shape "+r.shape+"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+(" "+t.length+", should be: "+i+"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+(e.shape+", should be [] or ["+a+"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function dre(r,e,t,n){n===void 0&&(n=0);var a=H(r,"sparseIndices","sparseToDense","int32"),i=H(e,"sparseValues","sparseToDense","string_or_numeric"),o=H(n,"defaultValue","sparseToDense",i.dtype);pre(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return se.runKernel(KX,s,u)}J({sparseToDense_:dre});function vre(r,e){var t=H(e,"indices","gatherND","int32"),n=H(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return se.runKernel(mX,a)}J({gatherND_:vre});function mre(r,e){if(e==null)return r.shape.slice();if(bl(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function gre(r,e,t,n){var a=H(r,"x","dropout");if(Z(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+("scaled, but got a "+a.dtype+" tensor instead.")}),Z(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof ba?a.clone():a;var i=mre(a,t),o=1-e,s=vt(y_(rt(Ate(i,0,1,"float32",n),o)),o);return me(a,s)}J({dropout_:gre});function yre(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function A_(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return ul(a,"float32")}function I0(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return me(r,qd(e));throw new Error("Cannot compute gradient for fused activation "+t+".")}function N0(r,e){var t=e,n=en(r.shape,e.shape);return n.length>0&&(t=ft(t,n)),ge(t,r.shape)}function C0(r,e,t,n){if(e==="linear")return r;if(e==="relu")return T0(r);if(e==="elu")return nee(r);if(e==="relu6")return Rte(r);if(e==="prelu")return ste(r,t);if(e==="leakyrelu")return bee(r,n);if(e==="sigmoid")return ll(r);throw new Error("Unknown fused activation "+e+".")}var A0=function(r,e){var t=r>0;return!t||e==="linear"};function bre(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,v=r.leakyreluAlpha;if(p=p||"linear",A0(se.state.gradientDepth,p)===!1){Z(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of "+s+" but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var m=jd(t,n,a,i,s,l,c);return f!=null&&(m=rt(m,f)),C0(m,p,d,v)}var g=H(t,"x","conv2d","float32"),y=H(n,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),Z(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+(b.rank+".")}),Z(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+(y.rank+".")}),An("fused conv2d",i,c);var k=s==="NHWC"?b.shape[3]:b.shape[1];Z(y.shape[2]===k,function(){return"Error in conv2d: depth of input ("+k+") must match "+("input depth for filter "+y.shape[2]+".")}),Z(lo(a,l),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+a+" and dilations '"+l+"'")});var S=p0(b.shape,y.shape,a,l,i,c),E;f!=null&&(E=H(f,"bias","fused conv2d"),e=ye(_r(E,g),1),E=e[0],s==="NHWC"?Xt(S.outShape,E.shape):(Z(E.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+("rank-"+E.shape.length+".")}),Z(E.shape.length===0||E.shape[0]===S.outChannels||E.shape[0]===1,function(){return"Error in fused conv2d: bias shape ("+E.shape+") is not compatible with the number of output channels "+("("+S.outChannels+")")})));var N;if(d!=null){var C=d.shape;if(Z(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+("rank-"+C.length+".")}),C.length===1)Z(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+("("+C+") is not compatible with the number of output ")+("channels ("+S.outChannels+").")});else if(C.length===3)try{Xt(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights ("+C+") is not compatible with the output shape of the conv2d "+("("+S.outShape+").");throw Error(R)}N=H(d,"prelu weights","fused conv2d")}var _=function(L,G){Z(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of "+s+" but only NHWC is currently supported."});var M=ye(G,4),$=M[0],K=M[1],j=M[2],te=M[3],Q=I0(L,j,p);Z(Ws(l),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+("are not yet supported in gradients. Got dilations '"+l+"'")});var ie=v0(K.shape,Q,$,a,i),le=d0(K,Q,$.shape,a,i),de=[ie,le];if(te!=null){var we=N0(te,Q);de.push(we)}return de},O={x:b,filter:y,bias:E,preluActivationWeights:N},P={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:v};if(f==null){var B=uo(function(L,G,M){var $=se.runKernel(eN,O,P);return M([G,L,$]),w&&($=ge($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:_}});return B(b,y)}else{var W=uo(function(L,G,M,$){var K=se.runKernel(eN,O,P);return $([G,L,K,M]),w&&(K=ge(K,[K.shape[1],K.shape[2],K.shape[3]])),{value:K,gradFunc:_}});return W(b,y,E)}}J({fusedConv2d_:bre});function wre(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,v=r.leakyreluAlpha;if(A0(se.state.gradientDepth,p)===!1){var m=T_(t,n,a,i,s,l,c);return f!=null&&(m=rt(m,f)),C0(m,p,d,v)}var g=H(t,"x","depthwiseConv2d","float32"),y=H(n,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),Z(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+("rank "+b.rank+".")}),Z(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+("but got rank "+y.rank+".")}),Z(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+("("+b.shape[3]+") must match the inChannels dimension in ")+("filter "+y.shape[2]+".")}),l==null&&(l=[1,1]),Z(lo(a,l),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+("be 1. Got strides "+a+" and dilations '"+l+"'")}),An("fused depthwiseConv2d",i,c);var k=p0(b.shape,y.shape,a,l,i,c,!0),S;f!=null&&(S=H(f,"bias","fused conv2d"),e=ye(_r(S,g),1),S=e[0],Xt(k.outShape,S.shape));var E;d!=null&&(E=H(d,"prelu weights","fused depthwiseConv2d"));var N=function(P,B){Z(Ws(l),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+("'"+l+"'")});var W=ye(B,4),L=W[0],G=W[1],M=W[2],$=W[3],K=I0(P,M,p),j=v_(G.shape,K,L,a,i,l,c),te=d_(G,K,L.shape,a,i,l,c);if($!=null){var Q=N0(S,K);return[j,te,Q]}return[j,te]},C={x:b,filter:y,bias:S,preluActivationWeights:E},R={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:v};if(f==null){var _=uo(function(P,B,W){var L=se.runKernel(tN,C,R);return W([B,P,L]),w&&(L=ge(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:N}});return _(b,y)}else{var O=uo(function(P,B,W,L){var G=se.runKernel(tN,C,R);return L([B,P,G,W]),w&&(G=ge(G,[G.shape[1],G.shape[2],G.shape[3]])),{value:G,gradFunc:N}});return O(b,y,S)}}J({fusedDepthwiseConv2d_:wre});function xre(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,l=r.bias,c=r.activation,f=c===void 0?"linear":c,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(A0(se.state.gradientDepth,f)===!1){var v=At(n,a,o,u);return l!=null&&(v=rt(v,l)),C0(v,f,h,d)}var m=H(n,"a","fused matMul"),g=H(a,"b","fused matMul");e=ye(_r(m,g),2),m=e[0],g=e[1];var y=o?m.shape[m.rank-2]:m.shape[m.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?m.shape[m.rank-1]:m.shape[m.rank-2],k=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=m.shape.slice(0,-2),E=g.shape.slice(0,-2),N=Xn(S),C=Xn(E);Z(y===b,function(){return"Error in fused matMul: inner shapes ("+y+") and ("+(b+") of Tensors with shapes "+m.shape+" and ")+(g.shape+" and transposeA="+o)+(" and transposeB="+u+" must match.")});var R=Xt(m.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([w,k]),O=o?ge(m,[N,y,w]):ge(m,[N,w,y]),P=u?ge(g,[C,k,b]):ge(g,[C,b,k]),B;l!=null&&(B=H(l,"bias","fused matMul"),t=ye(_r(B,m),1),B=t[0],Xt(_,B.shape));var W;h!=null&&(W=H(h,"prelu weights","fused matMul"));var L=function(j,te){var Q=ye(te,4),ie=Q[0],le=Q[1],de=Q[2],we=Q[3],pe=I0(ge(j,de.shape),de,f),Se,Ee;if(!o&&!u?(Se=At(pe,le,!1,!0),Ee=At(ie,pe,!0,!1)):!o&&u?(Se=At(pe,le,!1,!1),Ee=At(pe,ie,!0,!1)):o&&!u?(Se=At(le,pe,!1,!0),Ee=At(ie,pe,!1,!1)):(Se=At(le,pe,!0,!0),Ee=At(pe,ie,!0,!0)),l!=null){var Ne=N0(we,pe);return[Se,Ee,Ne]}else return[Se,Ee]},G={a:O,b:P,bias:B,preluActivationWeights:W},M={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(l==null){var $=uo(function(j,te,Q){var ie=se.runKernel(JI,G,M);return Q([j,te,ie]),{value:ge(ie,_),gradFunc:L}});return $(O,P)}else{var K=uo(function(j,te,Q,ie){var le=se.runKernel(JI,G,M);return ie([j,te,le,Q]),{value:ge(le,_),gradFunc:L}});return K(O,P,B)}}J({fusedMatMul_:xre});function kre(r){return A_(r,.54,.46)}J({hammingWindow_:kre});function Sre(r){return A_(r,.5,.5)}var Ere=J({hannWindow_:Sre});function Tre(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(Bt(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=Zn([Bt(r,i,e-s),Yd([s],a)]);o.push(u),i+=t}return o.length===0?dd([],[0,e]):ge(Zn(o),[o.length,e])}var Ire=J({frame_:Tre});function Nre(r,e,t,n,a){a===void 0&&(a=Ere),n==null&&(n=yre(e));var i=Ire(r,e,t),o=me(i,a(e));return ere(o,n)}J({stft_:Nre});function Cre(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=H(r,"image","cropAndResize"),s=H(e,"boxes","cropAndResize","float32"),u=H(t,"boxInd","cropAndResize","int32"),l=s.shape[0];Z(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+("but got rank "+o.rank+".")}),Z(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] "+("but had shape "+s.shape+".")}),Z(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] "+("but had shape "+s.shape+".")}),Z(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+("length "+n.length+".")}),Z(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),Z(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a});var c={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=se.runKernel(rX,c,f);return h}J({cropAndResize_:Cre});function Are(r){var e=H(r,"image","flipLeftRight","float32");Z(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+("but got rank "+e.rank+".")});var t={image:e},n=se.runKernel(vX,t,{});return n}J({flipLeftRight_:Are});function _re(r){var e=H(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];Z(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+("but got rank "+e.rank+".")}),Z(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+("should be size 1, but got size "+n+".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,kf(e,a)}J({grayscaleToRGB_:_re});function Dre(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=H(r,"image","rotateWithOffset","float32");Z(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+("but got rank "+a.rank+".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=se.runKernel(r9,i,o);return s}J({rotateWithOffset_:Dre});function _0(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),Z(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),Z(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),Z(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),Z(e.rank===1,function(){return"scores must be a 1D tensor"}),Z(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", "+("but was "+e.shape[0])}),Z(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function Fre(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=H(r,"boxes","nonMaxSuppression","float32"),o=H(e,"scores","nonMaxSuppression","float32"),s=_0(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return se.runKernel(FX,{boxes:i,scores:o},u)}J({nonMaxSuppression_:Fre});function Rre(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=H(r,"boxes","nonMaxSuppression"),s=H(e,"scores","nonMaxSuppression"),u=_0(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var l={boxes:o,scores:s},c={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=se.runKernel(MX,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}J({nonMaxSuppressionWithScore_:Rre});function Mre(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=H(r,"boxes","nonMaxSuppression"),s=H(e,"scores","nonMaxSuppression"),u=_0(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:i},d=se.runKernel(RX,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}J({nonMaxSuppressionPadded_:Mre});function Ore(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=H(r,"images","resizeBilinear");Z(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),Z(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+(e+".")}),Z(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ye(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=se.runKernel(kA,s,u);return o?ge(l,[l.shape[1],l.shape[2],l.shape[3]]):l}J({resizeBilinear_:Ore});function Pre(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=H(r,"images","resizeNearestNeighbor");Z(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),Z(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+(e+".")}),Z(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),Z(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ye(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=se.runKernel(xA,s,u);return o?ge(l,[l.shape[1],l.shape[2],l.shape[3]]):l}J({resizeNearestNeighbor_:Pre});function Lre(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=H(r,"image","threshold"),o=.2989,s=.587,u=.114,l=i.shape[0]*i.shape[1],c=me(ul([n]),255),f,h,p,d;if(Z(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+("but got rank "+i.rank+".")}),Z(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+("but got "+i.shape[2]+".")}),Z(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+("but got dtype "+i.dtype+".")}),Z(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was "+e}),i.shape[2]===3){a=ye(If(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var v=me(f,o),m=me(h,s),g=me(p,u);d=rt(rt(v,m),g)}else d=r;if(e==="otsu"){var y=FJ(ot($te(d),"int32"),wQ([]),256);c=Bre(y,l)}var b=t?zf(d,c):Ko(d,c),w=ot(me(b,255),"int32");return w}function Bre(r,e){for(var t=ul([-1]),n=ul([0]),a=ul([0]),i,o,s,u,l,c,f=0;f<r.size-1;f++){i=Bt(r,0,f+1),o=Bt(r,f+1),l=vt(ft(i),e),c=vt(ft(o),e);var h=ft(me(i,Ad(0,i.size)));s=vt(h,ft(i));var p=Yd(o.shape,i.size),d=rt(Ad(0,o.size),p),v=me(o,d);u=vt(ft(v),ft(o));var m=lt(s,u),g=lt(s,u),y=me(l,c);a=me(me(y,m),g);var b=Ko(a,n);n=Ua(b,a,n),t=Ua(b,ul([f]),t)}return t}J({threshold_:Lre});function zre(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=H(r,"image","transform","float32"),s=H(e,"transforms","transform","float32");Z(o.rank===4,function(){return"Error in transform: image must be rank 4,"+("but got rank "+o.rank+".")}),Z(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),Z(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+("but got "+i+".")});var u={image:o,transforms:s},l={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return se.runKernel(e9,u,l)}J({transform_:zre});function $re(r,e,t){Z(e%1===0,function(){return"bandPart(): numLower must be an integer, got "+e+"."}),Z(t%1===0,function(){return"bandPart(): numUpper must be an integer, got "+t+"."});var n=H(r,"a","bandPart");Z(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got "+n.rank+"."});var a=n.shape,i=ye(n.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+")"+(" must not be greater than the number of rows ("+o+")."));if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+")"+(" must not be greater than the number of columns ("+s+")."));e<0&&(e=o),t<0&&(t=s);var u=ge(Ad(0,o,1,"int32"),[-1,1]),l=Ad(0,s,1,"int32"),c=lt(u,l),f=Tf(zf(c,mt(+e,"int32")),Kd(c,mt(-t,"int32"))),h=vl([o,s],n.dtype);return ge(Cf(y0(ge(n,[-1,o,s])).map(function(p){return Ua(f,p,h)})),a)}J({bandPart_:$re});function Wre(r){var e;if(Array.isArray(r)){e=!1,Z(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){Z(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+("("+r[u].shape[0]+" vs. "+t+")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=If(r,r.shape[0],0).map(function(u){return are(u,[0])});Z(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds "+("number of dimensions ("+r[0].shape[0]+").")});for(var i=[],o=r,s=function(u){i.push(se.tidy(function(){var l=o[u];if(u>0)for(var c=0;c<u;++c){var f=me(ft(me(i[c],l)),i[c]);l=lt(l,f)}return vt(l,k0(l,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?Cf(i,0):i}J({gramSchmidt_:Wre});function Vre(r,e){if(e===void 0&&(e=!1),Z(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+r.rank}),r.rank===2)return _N(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,l){return u*l}),n=y0(ge(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var l=ye(_N(u,e),2),c=l[0],f=l[1];a.push(c),i.push(f)});var o=ge(Cf(a,0),r.shape),s=ge(Cf(i,0),r.shape);return[o,s]}function _N(r,e){return e===void 0&&(e=!1),se.tidy(function(){Z(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor."});for(var t=r.shape[0],n=r.shape[1],a=hee(t),i=xf(r),o=dd([[1]],[1,1]),s=xf(o),u=t>=n?n:t,l=function(f){var h,p=i,d=s,v=a;h=ye(se.tidy(function(){var m=Bt(i,[f,f],[t-f,1]),g=k0(m),y=Bt(i,[f,f],[1,1]),b=Ua(Ko(y,0),dd([[-1]]),dd([[1]])),w=lt(y,me(b,g)),k=vt(m,w);k.shape[0]===1?s=xf(o):s=Zn([o,Bt(k,[1,0],[k.shape[0]-1,k.shape[1]])],0);var S=Jr(vt(At(b,w),g)),E=Bt(i,[f,0],[t-f,n]),N=me(S,s),C=so(s);if(f===0)i=lt(E,At(N,At(C,E)));else{var R=lt(E,At(N,At(C,E)));i=Zn([Bt(i,[0,0],[f,n]),R],0)}var _=so(N),O=Bt(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=lt(O,At(At(O,s),_));else{var P=lt(O,At(At(O,s),_));a=Zn([Bt(a,[0,0],[t,f]),P],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],Yn([p,d,v])},c=0;c<u;++c)l(c);return!e&&t>n&&(a=Bt(a,[0,0],[t,n]),i=Bt(i,[0,0],[n,n])),[a,i]})}J({qr_:Vre});var Nn;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Nn||(Nn={}));function Ure(r,e,t){t===void 0&&(t=Nn.SUM_BY_NONZERO_WEIGHTS);var n=H(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=H(e,"weights","computeWeightedLoss"));var i=a==null?n:me(n,a);if(t===Nn.NONE)return i;if(t===Nn.SUM)return ft(i);if(t===Nn.MEAN){if(a==null)return Ly(i);var o=n.size/a.size,s=vt(ft(i),ft(a));return o>1?vt(s,mt(o)):s}if(t===Nn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return vt(ft(i),mt(n.size));var u=me(a,$f(n.shape)),l=ot(ft(Xee(u,mt(0))),"float32");return vt(ft(i),l)}throw Error("Unknown reduction: "+t)}var jo=J({computeWeightedLoss_:Ure});function Gre(r,e,t,n){n===void 0&&(n=Nn.SUM_BY_NONZERO_WEIGHTS);var a=H(r,"labels","absoluteDifference"),i=H(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=H(t,"weights","absoluteDifference")),zi(a.shape,i.shape,"Error in absoluteDifference: ");var s=za(lt(a,i));return jo(s,o,n)}J({absoluteDifference_:Gre});function Hre(r,e,t,n,a){a===void 0&&(a=Nn.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"labels","cosineDistance"),o=H(e,"predictions","cosineDistance"),s=null;n!=null&&(s=H(n,"weights","cosineDistance")),zi(i.shape,o.shape,"Error in cosineDistance: ");var u=mt(1),l=lt(u,ft(me(i,o),t,!0));return jo(l,s,a)}J({cosineDistance_:Hre});function qre(r,e,t,n){n===void 0&&(n=Nn.SUM_BY_NONZERO_WEIGHTS);var a=H(r,"labels","hingeLoss"),i=H(e,"predictions","hingeLoss"),o=null;t!=null&&(o=H(t,"weights","hingeLoss")),zi(a.shape,i.shape,"Error in hingeLoss: ");var s=mt(1);a=lt(me(mt(2),a),s);var u=T0(lt(s,me(a,i)));return jo(u,o,n)}J({hingeLoss_:qre});function Kre(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=Nn.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"labels","huberLoss"),o=H(e,"predictions","huberLoss"),s=null;t!=null&&(s=H(t,"weights","huberLoss")),zi(i.shape,o.shape,"Error in huberLoss: ");var u=mt(n),l=za(lt(o,i)),c=Vee(l,u),f=lt(l,c),h=rt(me(mt(.5),ur(c)),me(u,f));return jo(h,s,a)}J({huberLoss_:Kre});function jre(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=Nn.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"labels","logLoss"),o=H(e,"predictions","logLoss"),s=null;t!=null&&(s=H(t,"weights","logLoss")),zi(i.shape,o.shape,"Error in logLoss: ");var u=mt(1),l=mt(n),c=Jr(me(i,Nf(rt(o,l)))),f=me(lt(u,i),Nf(rt(lt(u,o),l))),h=lt(c,f);return jo(h,s,a)}J({logLoss_:jre});function Xre(r,e,t,n){n===void 0&&(n=Nn.SUM_BY_NONZERO_WEIGHTS);var a=H(r,"labels","meanSquaredError"),i=H(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=H(t,"weights","meanSquaredError")),zi(a.shape,i.shape,"Error in meanSquaredError: ");var s=rre(a,i);return jo(s,o,n)}J({meanSquaredError_:Xre});function Yre(r,e){var t=H(r,"labels","sigmoidCrossEntropyWithLogits"),n=H(e,"logits","sigmoidCrossEntropyWithLogits");zi(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=T0(n),i=me(n,t),o=kee(Bi(Jr(za(n))));return rt(lt(a,i),o)}function Zre(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Nn.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"multiClassLabels","sigmoidCrossEntropy"),o=H(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=H(t,"weights","sigmoidCrossEntropy")),zi(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=mt(n),l=mt(1),c=mt(.5);i=rt(me(i,lt(l,u)),me(c,u))}var f=Yre(i,o);return jo(f,s,a)}J({sigmoidCrossEntropy_:Zre});function Qre(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+("supported. Labels / logits was rank "+e.rank+" ")+("and dim was "+t));var n=uo(function(a,i,o){var s=!0,u=Aee(i,[t],s),l=lt(ot(i,"float32"),u);o([a,l]);var c=Jr(me(l,a)),f=ft(c,[t]),h=function(p,d){var v=ye(d,2),m=v[0],g=v[1],y=pl(p.shape,[t]);return[me(ge(p,y),lt(ot(m,"float32"),Bi(g))),me(ge(p,y),lt(Bi(g),ot(m,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function Jre(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Nn.SUM_BY_NONZERO_WEIGHTS);var i=H(r,"onehotLabels","softmaxCrossEntropy"),o=H(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=H(t,"weights","softmaxCrossEntropy")),zi(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=mt(n),l=mt(1),c=mt(i.shape[1]);i=rt(me(i,lt(l,u)),vt(u,c))}var f=Qre(i,o);return jo(f,s,a)}J({softmaxCrossEntropy_:Jre});function ene(r,e,t,n){var a=H(r,"indices","sparseFillEmptyRows","int32"),i=H(e,"values","sparseFillEmptyRows"),o=H(t,"denseShape","sparseFillEmptyRows","int32"),s=H(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `+a.shape);if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape "+i.shape);if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape "+o.shape);if(s.rank!==0)throw new Error("Default value should be a scalar but received shape "+s.shape);var u={indices:a,values:i,denseShape:o,defaultValue:s},l=se.runKernel(UX,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}J({sparseFillEmptyRows_:ene});function tne(r,e,t){var n=H(r,"inputIndices","sparseReshape","int32"),a=H(e,"inputShape","sparseReshape","int32"),i=H(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `+n.shape);if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape "+a.shape);if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape "+i.shape);var o={inputIndices:n,inputShape:a,newShape:i},s=se.runKernel(GX,o);return{outputIndices:s[0],outputShape:s[1]}}J({sparseReshape_:tne});function rne(r,e,t){var n=H(r,"data","sparseSegmentMean"),a=H(e,"indices","sparseSegmentMean","int32"),i=H(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `+i.shape);var o={data:n,indices:a,segmentIds:i};return se.runKernel(HX,o)}J({sparseSegmentMean_:rne});function nne(r,e,t){var n=H(r,"data","sparseSegmentSum"),a=H(e,"indices","sparseSegmentSum","int32"),i=H(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `+i.shape);var o={data:n,indices:a,segmentIds:i};return se.runKernel(qX,o)}J({sparseSegmentSum_:nne});function ane(r,e,t,n,a,i,o,s){var u=H(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: "+u.shape);var l=H(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var c={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:l},h=se.runKernel(YX,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}J({stringNGrams_:ane});function ine(r,e,t){t===void 0&&(t=!0);var n=H(r,"input","stringSplit","string"),a=H(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape "+n.shape);if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape "+a.shape);var i={skipEmpty:t},o={input:n,delimiter:a},s=se.runKernel(ZX,o,i);return{indices:s[0],values:s[1],shape:s[2]}}J({stringSplit_:ine});function one(r,e){var t=H(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return se.runKernel(QX,a,n)}J({stringToHashBucketFast_:one});var Ys=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return Yn(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return See(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&Yn(this.iterations_)},e.prototype.saveIterations=function(){return Ae(this,void 0,void 0,function(){return Ce(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:mt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ae(this,void 0,void 0,function(){return Ce(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+(""+this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ae(this,void 0,void 0,function(){var n;return Ce(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e})(nJ);Object.defineProperty(Ys,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var __=(function(r){be(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=se.backend.epsilon()),i}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=se.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:Hr(function(){return _t(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:Hr(function(){return _t(s).variable(u)})});var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;Hr(function(){var h=rt(me(c,n.rho),me(ur(l),1-n.rho)),p=me(vt(wa(rt(f,n.epsilon)),wa(rt(c,n.epsilon))),l),d=rt(me(f,n.rho),me(ur(p),1-n.rho));c.assign(h),f.assign(d);var v=rt(me(p,-n.learningRate),s);s.assign(v)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Yn(this.accumulatedGrads.map(function(t){return t.variable})),Yn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ae(this,void 0,void 0,function(){var t;return Ce(this,function(n){switch(n.label){case 0:return t=pt(this.accumulatedGrads,this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ae(this,void 0,void 0,function(){var n,a;return Ce(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e})(Ys);__.className="Adadelta";qs(__);var D_=(function(r){be(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=se.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:i+"/accumulator",variable:Hr(function(){return Yd(s.shape,n.initialAccumulatorValue).variable(u)})}}var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedGrads[o].variable;Hr(function(){var f=rt(c,ur(l));c.assign(f);var h=rt(me(vt(l,wa(rt(f,se.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Yn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ae(this,void 0,void 0,function(){return Ce(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ae(this,void 0,void 0,function(){var n;return Ce(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e})(Ys);D_.className="Adagrad";qs(D_);var F_=(function(r){be(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Hr(function(){o.accBeta1=mt(n).variable(),o.accBeta2=mt(a).variable()}),i==null&&(o.epsilon=se.backend.epsilon()),o}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Hr(function(){var i=lt(1,n.accBeta1),o=lt(1,n.accBeta2);a.forEach(function(s,u){var l=se.registeredVariables[s],c=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Hr(function(){return _t(l).variable(c)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Hr(function(){return _t(l).variable(c)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=rt(me(h,n.beta1),me(f,1-n.beta1)),v=rt(me(p,n.beta2),me(ur(f),1-n.beta2)),m=vt(d,i),g=vt(v,o);h.assign(d),p.assign(v);var y=rt(me(vt(m,rt(wa(g),n.epsilon)),-n.learningRate),l);l.assign(y)}}),n.accBeta1.assign(me(n.accBeta1,n.beta1)),n.accBeta2.assign(me(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Yn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Yn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ae(this,void 0,void 0,function(){var t;return Ce(this,function(n){switch(n.label){case 0:return t=pt(this.accumulatedFirstMoment,this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ae(this,void 0,void 0,function(){var n,a,i=this;return Ce(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Hr(function(){i.accBeta1.assign(ml(i.beta1,i.iterations_+1)),i.accBeta2.assign(ml(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e})(Ys);F_.className="Adam";qs(F_);var R_=(function(r){be(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Hr(function(){s.iteration=mt(0).variable(),s.accBeta1=mt(n).variable()}),i==null&&(s.epsilon=se.backend.epsilon()),s}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Hr(function(){var i=lt(1,n.accBeta1),o=vt(-n.learningRate,rt(me(n.iteration,n.decay),1));a.forEach(function(s,u){var l=se.registeredVariables[s],c=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:_t(l).variable(c)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:_t(l).variable(c)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=rt(me(h,n.beta1),me(f,1-n.beta1)),v=me(p,n.beta2),m=za(f),g=C_(v,m);h.assign(d),p.assign(g);var y=rt(me(vt(o,i),vt(d,rt(g,n.epsilon))),l);l.assign(y)}}),n.iteration.assign(rt(n.iteration,1)),n.accBeta1.assign(me(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Yn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Yn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ae(this,void 0,void 0,function(){return Ce(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e})(Ys);R_.className="Adamax";qs(R_);var D0=(function(r){be(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=se.registeredVariables[i];Hr(function(){var l=rt(me(n.c,s),u);u.assign(l)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=uZ(mt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ae(this,void 0,void 0,function(){return Ce(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e})(Ys);D0.className="SGD";qs(D0);var M_=(function(r){be(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=mt(i.momentum),i}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=se.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:i+"/momentum",variable:Hr(function(){return _t(s).variable(u)})}}var l=n.accumulations[o].variable,c=Array.isArray(t)?t[o].tensor:t[i];c!=null&&Hr(function(){var f,h=rt(me(n.m,l),c);n.useNesterov?f=rt(me(n.c,rt(c,me(h,n.m))),s):f=rt(me(n.c,h),s),l.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Yn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ae(this,void 0,void 0,function(){return Ce(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ae(this,void 0,void 0,function(){var n;return Ce(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e})(D0);M_.className="Momentum";qs(M_);var O_=(function(r){be(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=se.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=se.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:Hr(function(){return _t(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:i+"/momentum",variable:Hr(function(){return _t(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:Hr(function(){return _t(s).variable(u)})});var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;Hr(function(){var h=rt(me(c,n.decay),me(ur(l),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=rt(me(p,n.decay),me(l,1-n.decay)),v=vt(me(l,n.learningRate),wa(lt(h,rt(ur(d),n.epsilon)))),m=rt(me(f,n.momentum),v);c.assign(h),p.assign(d),f.assign(m);var g=lt(s,m);s.assign(g)}else{var y=rt(me(c,n.decay),me(ur(l),1-n.decay)),m=rt(me(f,n.momentum),vt(me(l,n.learningRate),wa(rt(y,n.epsilon))));c.assign(y),f.assign(m);var g=lt(s,m);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Yn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Yn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Yn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ae(this,void 0,void 0,function(){var t;return Ce(this,function(n){switch(n.label){case 0:return t=pt(this.accumulatedMeanSquares,this.accumulatedMoments),this.centered&&t.push.apply(t,pt(this.accumulatedMeanGrads)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ae(this,void 0,void 0,function(){var n,a;return Ce(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e})(Ys);O_.className="RMSProp";qs(O_);var DN;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(DN||(DN={}));var sne=1.7580993408473768,une=1.0507009873554805;function lne(r,e,t){var n=r.shape.slice();n[t]=1;var a=ge(e,n),i=NN(r,t,!0,!1),o=NN(r,t,!0,!0),s=me(i,o);return me(a,s)}function cne(r,e,t){var n=r.shape.length,a=n-t.length,i=p_(t,n),o=r;i!=null&&(o=so(r,i));var s=o.shape.slice(),u=s.splice(n-t.length,t.length),l=u.reduce(function(p,d){return p*d},1);s.push(l);var c=o.reshape(s),f=lne(c,e,a);if(f=f.reshape(o.shape),i!=null){var h=m0(i);f=so(f,h)}return f}var fne={kernelName:gA,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.axis,o=[];return i==null?o=a.shape.map(function(s,u){return u}):typeof i=="number"?o=[i]:o=i,{x:function(){return cne(a,r,o)}}}},hne={kernelName:PC,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=Xt(n.shape,a.shape),o=function(){var u=vt(r,ot(a,"float32")),l=en(n.shape,i);return l.length>0?ge(ft(u,l),n.shape):u},s=function(){var u=me(r,ot(n,"float32")),l=en(a.shape,i);l.length>0&&(u=ge(ft(u,l),a.shape));var c=ur(a);return Jr(vt(u,ot(c,"float32")))};return{a:o,b:s}}},pne={kernelName:yA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return vt(r,Jr(ur(n)))}}}},dne={kernelName:SA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0],a=me(zf(n,6),qd(n));return{x:function(){return me(r,ot(a,"float32"))}}}},vne={kernelName:bA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(r,ot(qd(n),"float32"))}}}},mne={kernelName:wA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return ge(r,n.shape)}}}},gne={kernelName:kA,inputsToSave:["images"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i={dy:r,images:a},o=function(){return se.runKernel($X,i,t)};return{images:o}}},yne={kernelName:xA,inputsToSave:["images"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i={dy:r,images:a},o=function(){return se.runKernel(zX,i,t)};return{images:o}}};var bne={kernelName:EA,gradFunc:function(r,e,t){var n=t.dims,a=yi(n,r.shape);return{x:function(){return Vs(r,a)}}}};var wne={kernelName:TA,gradFunc:function(r){return{x:function(){return _t(r)}}}},xne={kernelName:IA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return Jr(vt(r,me(ml(n,1.5),2)))}}}},kne={kernelName:NA,inputsToSave:["condition"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{condition:function(){return ot(_t(n),"float32")},t:function(){return me(r,ot(n,r.dtype))},e:function(){return me(r,ot(N_(n),r.dtype))}}}},Sne={kernelName:CA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){var a=Ko(n,mt(0)),i=mt(sne),o=mt(une),s=me(r,o),u=me(me(r,i),Bi(ot(n,"float32")));return Ua(a,s,u)}}}},Ene={kernelName:RA,outputsToSave:[!0],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(r,me(n,lt(mt(1),n)))}}}};var Tne={kernelName:FA,gradFunc:function(r){return{x:function(){return _t(r)}}}},Ine={kernelName:_A,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(E_(ot(n,"float32")),r)}}}},Nne={kernelName:DA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(qJ(ot(n,"float32")),r)}}}},Cne={kernelName:AA,inputsToSave:["x"],gradFunc:function(r,e,t){for(var n=ye(e,1),a=n[0],i=t.begin,o=t.size,s=a.shape,u=ye(rJ(a,i,o),2),l=u[0],c=u[1],f=[],h=0;h<r.rank;h++)f.push([l[h],s[h]-l[h]-c[h]]);return{x:function(){return Vf(r,f)}}}},Ane={kernelName:zA,outputsToSave:[!0],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.dim,o=!0,s=me(r,a);return{logits:function(){return lt(s,me(ft(s,[i],o),a))}}}},_ne={kernelName:MA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(r,ll(n))}}}};var FN={kernelName:LA,gradFunc:function(r,e,t){var n=t.blockShape,a=t.paddings;return{x:function(){return S_(r,n,a)}}}};var RN={kernelName:BA,gradFunc:function(r,e,t){var n=t.axis;return{x:function(){return Zn(r,n)}}}},Dne={kernelName:OA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return vt(r,me(wa(ot(n,"float32")),2))}}}},Fne={kernelName:jX,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(r,me(ot(n,"float32"),2))}}}},Rne={kernelName:$A,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=mt(2),o=function(){return me(r,me(i,lt(n,a)))},s=function(){return me(r,me(i,lt(a,n)))};return{a:o,b:s}}};var Mne={kernelName:KA,gradFunc:function(r){return{x:function(){return _t(r)}}}},One={kernelName:WA,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ye(e,2),n=t[0],a=t[1],i=Xt(n.shape,a.shape),o=function(){var u=r,l=en(n.shape,i);return l.length>0&&(u=ft(u,l)),ge(u,n.shape)},s=function(){var u=r,l=en(a.shape,i);return l.length>0&&(u=ft(u,l)),ge(Jr(u),a.shape)};return{a:o,b:s}}},Pne={kernelName:PA,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=a.shape.slice(),o=t.axis,s=yi(o,a.shape);s.forEach(function(c){i[c]=1});var u=ge(r,i),l=me(u,$f(a.shape,"float32"));return{x:function(){return l}}}},Lne={kernelName:VA,inputsToSave:["x"],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return vt(r,ur(E_(n)))}}}},Bne={kernelName:UA,outputsToSave:[!0],gradFunc:function(r,e){var t=ye(e,1),n=t[0];return{x:function(){return me(lt(mt(1),ur(n)),r)}}}},zne={kernelName:n0,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ye(e,1),a=n[0],i=t.reps,o=function(){var s=_t(a);if(a.rank===1)for(var u=0;u<i[0];++u)s=rt(s,Bt(r,[u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(var u=0;u<i[0];++u)for(var l=0;l<i[1];++l)s=rt(s,Bt(r,[u*a.shape[0],l*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(var u=0;u<i[0];++u)for(var l=0;l<i[1];++l)for(var c=0;c<i[2];++c)s=rt(s,Bt(r,[u*a.shape[0],l*a.shape[1],c*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else if(a.rank===4)for(var u=0;u<i[0];++u)for(var l=0;l<i[1];++l)for(var c=0;c<i[2];++c)for(var f=0;f<i[3];++f)s=rt(s,Bt(r,[u*a.shape[0],l*a.shape[1],c*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));else throw new Error("Gradient for tile operation is not implemented for rank-"+(a.rank+" tensors yet."));return s};return{x:o}}};var $ne={kernelName:cd,gradFunc:function(r,e,t){var n=t,a=n.perm,i=m0(a);return{x:function(){return so(r,i)}}}};var Wne={kernelName:GA,gradFunc:function(r,e,t){var n=t,a=n.axis;return{value:function(){return Cf(r,a)}}}},Vne={kernelName:HA,inputsToSave:["segmentIds"],gradFunc:function(r,e){var t=ye(e,1),n=t[0],a=function(){return Une(r,n)};return{x:a}}};function Une(r,e){for(var t=C_(e,_t(e)),n=dee(r,t),a=Kd(e,mt(0,"int32")),i=n.rank-a.rank,o=0;o<i;++o)a=Os(a,o+1);a=Tf(a,$f(n.shape,"bool"));var s=_t(n);return Ua(a,n,s)}var Gne={kernelName:qA,gradFunc:function(r){return{x:function(){return _t(r)}}}},yy,MN,Hne=[c_,eY,tY,aY,iY,sY,uY,lY,fY,hY,pY,dY,xY,EY,IY,CY,AY,_Y,DY,BY,zY,WY,qY,GY,YY,JY,rZ,pZ,mZ,gZ,hne,yZ,wZ,xZ,kZ,SZ,TZ,EZ,AZ,FZ,RZ,MZ,OZ,PZ,LZ,zZ,$Z,WZ,VZ,HZ,bN,bN,XZ,QZ,tQ,rQ,nQ,aQ,oQ,uQ,lQ,cQ,fQ,hQ,dQ,wN,wN,gQ,yQ,fne,pne,dne,vne,mne,gne,yne,bne,wne,xne,kne,Sne,Ene,Tne,Ine,Nne,Cne,Ane,_ne,FN,FN,RN,RN,Dne,Rne,Fne,Mne,One,Pne,Lne,Bne,zne,$ne,Wne,Vne,Gne];try{for(pf=ke(Hne),al=pf.next();!al.done;al=pf.next())ON=al.value,b9(ON)}catch(r){yy={error:r}}finally{try{al&&!al.done&&(MN=pf.return)&&MN.call(pf)}finally{if(yy)throw yy.error}}var ON,pf,al;function F0(r,e){return z.tidy(function(){return F.sqrt(F.sum(F.mul(r,r),e,!0))})}var Uf=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e})(z.serialization.Serializable),R0=(function(r){be(e,r);function e(t){var n=r.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return z.tidy(function(){var a=F0(t,n.axis),i=F.clipByValue(a,0,n.maxValue);return F.mul(t,F.div(i,F.add(qr(),a)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e})(Uf);R0.className="MaxNorm";z.serialization.registerClass(R0);var M0=(function(r){be(e,r);function e(t){var n=r.call(this)||this;return n.defaultAxis=0,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return z.tidy(function(){return F.div(t,F.add(qr(),F0(t,n.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e})(Uf);M0.className="UnitNorm";z.serialization.registerClass(M0);var O0=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.relu(t)},e})(Uf);O0.className="NonNeg";z.serialization.registerClass(O0);var P0=(function(r){be(e,r);function e(t){var n=r.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=t.minValue!=null?t.minValue:n.defaultMinValue,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.rate=t.rate!=null?t.rate:n.defaultRate,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return z.tidy(function(){var a=F0(t,n.axis),i=F.add(F.mul(n.rate,F.clipByValue(a,n.minValue,n.maxValue)),F.mul(1-n.rate,a));return F.mul(t,F.div(i,F.add(qr(),a)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e})(Uf);P0.className="MinMaxNorm";z.serialization.registerClass(P0);var PN={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Kr(r){return Uy(r)}function LN(r,e){return e===void 0&&(e={}),Ff(r,z.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function jr(r){if(r==null)return null;if(typeof r=="string"){var e=r in PN?PN[r]:r,t={className:e,config:{}};return LN(t)}else return r instanceof Uf?r:LN(r)}function qne(r){return new R0(r)}function Kne(r){return new M0(r)}function jne(){return new O0}function Xne(r){return new P0(r)}var Yne={__proto__:null,maxNorm:qne,unitNorm:Kne,nonNeg:jne,minMaxNorm:Xne};function Zne(){return new qy}function Qne(){return new Ld}function Jne(r){return new Ky(r)}function eae(r){return new jy(r)}function tae(r){return new Xy(r)}function rae(r){return new Yy(r)}function nae(r){return new Zy(r)}function aae(r){return new Cn(r)}function iae(r){return new Bd(r)}function oae(r){return new zd(r)}function sae(r){return new $d(r)}function uae(r){return new Wd(r)}function lae(r){return new Vd(r)}function cae(r){return new Ud(r)}function fae(r){return new Qy(r)}var hae={__proto__:null,zeros:Zne,ones:Qne,constant:Jne,randomUniform:eae,randomNormal:tae,truncatedNormal:rae,identity:nae,varianceScaling:aae,glorotUniform:iae,glorotNormal:oae,heNormal:sae,heUniform:uae,leCunNormal:lae,leCunUniform:cae,orthogonal:fae};function zo(r){return Ae(this,void 0,void 0,function(){var e,t,n,a,i,o,s,u;return Ce(this,function(l){switch(l.label){case 0:if(r==null)return[2];e=[],t=[],n=[];for(a in r)i=r[a],typeof i!="number"&&(o=i,e.push(o.data()),t.push(a),n.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=l.sent(),u=0;u<s.length;++u)r[t[u]]=s[u][0];z.dispose(n),l.label=2;case 2:return[2]}})})}function P_(r){if(r!=null)for(var e in r){var t=r[e];typeof t!="number"&&t.dispose()}}var BN;(function(r){r[r.SILENT=0]="SILENT",r[r.VERBOSE=1]="VERBOSE"})(BN||(BN={}));var pae=125,gl=(function(){function r(){this.validationData=null}return r.prototype.setParams=function(e){this.params=e},r.prototype.onEpochBegin=function(e,t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){return[2]})})},r.prototype.onEpochEnd=function(e,t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){return[2]})})},r.prototype.onBatchBegin=function(e,t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){return[2]})})},r.prototype.onBatchEnd=function(e,t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){return[2]})})},r.prototype.onTrainBegin=function(e){return Ae(this,void 0,void 0,function(){return Ce(this,function(t){return[2]})})},r.prototype.onTrainEnd=function(e){return Ae(this,void 0,void 0,function(){return Ce(this,function(t){return[2]})})},r.prototype.setModel=function(e){},r})(),L_=(function(){function r(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return r.prototype.append=function(e){this.callbacks.push(e)},r.prototype.setParams=function(e){var t,n;try{for(var a=ke(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setParams(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.setModel=function(e){var t,n;try{for(var a=ke(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setModel(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.onEpochBegin=function(e,t){return Ae(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ce(this,function(l){switch(l.label){case 0:t==null&&(t={}),l.label=1;case 1:l.trys.push([1,6,7,8]),n=ke(this.callbacks),a=n.next(),l.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochBegin(e,t)]);case 3:l.sent(),l.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onEpochEnd=function(e,t){return Ae(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ce(this,function(l){switch(l.label){case 0:t==null&&(t={}),l.label=1;case 1:l.trys.push([1,6,7,8]),n=ke(this.callbacks),a=n.next(),l.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochEnd(e,t)]);case 3:l.sent(),l.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchBegin=function(e,t){return Ae(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ce(this,function(l){switch(l.label){case 0:t==null&&(t={}),l.label=1;case 1:l.trys.push([1,6,7,8]),n=ke(this.callbacks),a=n.next(),l.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchBegin(e,t)]);case 3:l.sent(),l.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchEnd=function(e,t){return Ae(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ce(this,function(l){switch(l.label){case 0:t==null&&(t={}),l.label=1;case 1:l.trys.push([1,6,7,8]),n=ke(this.callbacks),a=n.next(),l.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchEnd(e,t)]);case 3:l.sent(),l.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onTrainBegin=function(e){return Ae(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ce(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=ke(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainBegin(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r.prototype.onTrainEnd=function(e){return Ae(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ce(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=ke(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainEnd(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r})(),dae=(function(r){be(e,r);function e(){return r.call(this)||this}return e.prototype.onEpochBegin=function(t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,n){return Ae(this,void 0,void 0,function(){var a,i,o,s,u=this;return Ce(this,function(l){n==null&&(n={}),a=n.size==null?0:n.size,this.seen+=a,i=function(c){var f=n[c];if(typeof f=="number")o.totals.hasOwnProperty(c)||(o.totals[c]=0),o.totals[c]=o.totals[c]+f*a;else{var h=void 0;c in o.totals?h=o.totals[c]:o.totals[c]=0;var p=z.tidy(function(){return z.add(u.totals[c],z.mul(f,a))});o.totals[c]=p,h?.dispose()}},o=this;for(s in n)i(s);return[2]})})},e.prototype.onEpochEnd=function(t,n){return Ae(this,void 0,void 0,function(){var a,i,o,s,u,l,c,f=this;return Ce(this,function(h){if(n!=null){a=function(p){if(i.totals[p]==null)return"continue";typeof i.totals[p]=="number"?n[p]=i.totals[p]/i.seen:z.tidy(function(){var d=z.mul(z.div(1,f.seen),f.totals[p]);n[p]=d,f.totals[p].dispose(),z.keep(n[p])})},i=this;try{for(o=ke(this.params.metrics),s=o.next();!s.done;s=o.next())u=s.value,a(u)}catch(p){l={error:p}}finally{try{s&&!s.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}}return[2]})})},e})(gl),B_=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.onTrainBegin=function(t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,n){return Ae(this,void 0,void 0,function(){var a;return Ce(this,function(i){n==null&&(n={}),this.epoch.push(t);for(a in n)this.history[a]==null&&(this.history[a]=[]),this.history[a].push(n[a]);return[2]})})},e.prototype.syncData=function(){return Ae(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f;return Ce(this,function(h){switch(h.label){case 0:t=[],n=[],a=[];for(i in this.history)for(o=this.history[i],s=0;s<o.length;++s)typeof o[s]!="number"&&(u=o[s],t.push(u.data()),n.push(i),a.push(s));return[4,Promise.all(t)];case 1:for(l=h.sent(),c=0;c<l.length;++c)f=this.history[n[c]][a[c]],f.dispose(),this.history[n[c]][a[c]]=l[c][0];return[2]}})})},e})(gl),z_=(function(r){be(e,r);function e(t,n){var a=r.call(this)||this;if(a.currentEpoch=0,a.nowFunc=t.nowFunc,a.nextFrameFunc=t.nextFrameFunc||z.nextFrame,a.yieldEvery=n||"auto",a.yieldEvery==="auto"&&(a.yieldEvery=pae),a.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return z.util.isNumber(a.yieldEvery)&&(a.maybeWait=f7(a.maybeWait.bind(a),a.yieldEvery,a.nowFunc)),a.trainBegin=t.onTrainBegin,a.trainEnd=t.onTrainEnd,a.epochBegin=t.onEpochBegin,a.epochEnd=t.onEpochEnd,a.batchBegin=t.onBatchBegin,a.batchEnd=t.onBatchEnd,a.yield=t.onYield,a}return e.prototype.maybeWait=function(t,n,a){return Ae(this,void 0,void 0,function(){var i;return Ce(this,function(o){switch(o.label){case 0:return i=[],this.yield==null?[3,2]:[4,zo(a)];case 1:o.sent(),i.push(this.yield(t,n,a)),o.label=2;case 2:return i.push(this.nextFrameFunc()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,n){return Ae(this,void 0,void 0,function(){return Ce(this,function(a){switch(a.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,zo(n)];case 1:return a.sent(),[4,this.epochBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,n){return Ae(this,void 0,void 0,function(){var a;return Ce(this,function(i){switch(i.label){case 0:return a=[],this.epochEnd==null?[3,2]:[4,zo(n)];case 1:i.sent(),a.push(this.epochEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="epoch"&&a.push(this.nextFrameFunc()),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,n){return Ae(this,void 0,void 0,function(){return Ce(this,function(a){switch(a.label){case 0:return this.batchBegin==null?[3,3]:[4,zo(n)];case 1:return a.sent(),[4,this.batchBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,n){return Ae(this,void 0,void 0,function(){var a;return Ce(this,function(i){switch(i.label){case 0:return a=[],this.batchEnd==null?[3,2]:[4,zo(n)];case 1:i.sent(),a.push(this.batchEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="batch"?a.push(this.nextFrameFunc()):z.util.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,n)),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){switch(n.label){case 0:return this.trainBegin==null?[3,3]:[4,zo(t)];case 1:return n.sent(),[4,this.trainBegin(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){switch(n.label){case 0:return this.trainEnd==null?[3,3]:[4,zo(t)];case 1:return n.sent(),[4,this.trainEnd(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e})(gl);function $_(r,e){if(r==null&&(r={}),r instanceof gl)return[r];if(Array.isArray(r)&&r[0]instanceof gl)return r;var t=sr(r);return t.map(function(n){return new z_(n,e)})}var L0=(function(){function r(){}return r.registerCallbackConstructor=function(e,t){z.util.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, "+("but got "+e)}),r.checkForDuplicate(t),r.constructors[e]==null&&(r.constructors[e]=[]),r.constructors[e].push(t)},r.checkForDuplicate=function(e){for(var t in r.constructors){var n=r.constructors[+t];n.forEach(function(a){if(a===e)throw new ce("Duplicate callback constructor.")})}},r.clear=function(){r.constructors={}},r.createCallbacks=function(e){var t=[];for(var n in r.constructors){var a=+n;e>=a&&t.push.apply(t,pt(r.constructors[a]))}return t.map(function(i){return new i})},r})();L0.constructors={};function W_(r,e,t,n,a,i,o,s,u){var l=new B_,c=pt([new dae],L0.createCallbacks(e));r!=null&&c.push.apply(c,pt(r)),c.push(l);var f=new L_(c);return f.setParams({epochs:t,initialEpoch:n,samples:a,steps:i,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:f,history:l}}function pi(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),Ff(r,z.serialization.SerializationMap.getMap().classNameMap,e,"layer",t)}function _d(r,e){return z.tidy(function(){r.dtype!=="float32"&&(r=F.cast(r,"float32"));var t=F.sum(Of(r),e,!0),n=F.fill(t.shape,qr()),a=F.sqrt(F.maximum(t,n));return F.div(r,a)})}function Zs(r,e){return z.tidy(function(){return F.mean(Of(F.sub(e,r)),-1)})}function Zd(r,e){return z.tidy(function(){return F.mean(F.abs(F.sub(e,r)),-1)})}function wl(r,e){return z.tidy(function(){var t=F.sub(r,e),n=F.clipByValue(F.abs(r),qr(),Number.MAX_VALUE),a=F.abs(F.div(t,n));return F.mul(100,F.mean(a,-1))})}function vae(r,e){return z.tidy(function(){var t=F.clipByValue(e,qr(),Number.MAX_VALUE),n=F.log(F.add(1,t)),a=F.clipByValue(r,qr(),Number.MAX_VALUE),i=F.log(F.add(1,a));return F.mean(Of(F.sub(n,i)),-1)})}function mae(r,e){return z.tidy(function(){var t=F.maximum(0,F.sub(1,F.mul(r,e)));return F.mean(Of(t),-1)})}function gae(r,e){return z.tidy(function(){var t=F.maximum(0,F.sub(1,F.mul(r,e)));return F.mean(t,-1)})}function yae(r,e){return z.tidy(function(){var t=F.sum(F.mul(r,e),-1),n=F.max(F.mul(F.sub(1,r),e),-1);return F.maximum(0,F.add(1,F.sub(n,t)))})}function bae(r,e){return z.tidy(function(){var t=Math.log(2),n=F.sub(e,r),a=F.sub(F.add(n,F.softplus(F.mul(-2,n))),t);return F.mean(a,-1)})}function Af(r,e,t){return t===void 0&&(t=!1),z.tidy(function(){if(t)e=F.softmax(e);else{var n=F.sum(e,e.shape.length-1,!0);e=F.div(e,n)}return e=F.clipByValue(e,qr(),1-qr()),F.neg(F.sum(F.mul(F.cast(r,"float32"),F.log(e)),e.shape.length-1))})}function Dd(r,e,t){return t===void 0&&(t=!1),z.tidy(function(){var n=F.cast(F.floor(S7(r)),"int32");e=F.clipByValue(e,qr(),1-qr());var a=e.shape,i=F.reshape(F.oneHot(n,a[a.length-1]),a);return Af(i,e,t)})}function wae(r,e){if(!z.util.arraysEqual(r.shape,e.shape))throw new ce("logits and labels must have the same shape, but got shapes "+(JSON.stringify(r.shape)+" and "+JSON.stringify(e.shape)));return z.tidy(function(){var t=F.relu(e),n=F.neg(F.abs(e));return F.add(F.sub(t,F.mul(e,r)),F.log1p(F.exp(n)))})}function Qd(r,e){return z.tidy(function(){var t;return t=F.clipByValue(e,qr(),1-qr()),t=F.log(F.div(t,F.sub(1,t))),F.mean(wae(r,t),-1)})}function xae(r,e){return z.tidy(function(){var t=F.clipByValue(r,qr(),1),n=F.clipByValue(e,qr(),1);return F.sum(F.mul(r,F.log(F.div(t,n))),-1)})}function kae(r,e){return z.tidy(function(){var t=F.log(F.add(qr(),e));return F.mean(F.sub(e,F.mul(r,t)),-1)})}function B0(r,e){return z.tidy(function(){var t=_d(r,-1),n=_d(e,-1),a=F.mul(t,n);return F.neg(F.sum(a,-1))})}var Fd={meanSquaredError:Zs,meanAbsoluteError:Zd,meanAbsolutePercentageError:wl,meanSquaredLogarithmicError:vae,squaredHinge:mae,hinge:gae,categoricalHinge:yae,logcosh:bae,categoricalCrossentropy:Af,sparseCategoricalCrossentropy:Dd,binaryCrossentropy:Qd,kullbackLeiblerDivergence:xae,poisson:kae,cosineProximity:B0};function by(r){if(typeof r=="string"){if(r in Fd)return Fd[r];var e="Unknown loss "+r;throw r.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss "+r+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new ce(e)}else return r}function z0(r,e){return z.tidy(function(){var t=F.mul(.5,F.onesLike(e)),n=Rf(F.greater(e,t),r.dtype);return F.mean(F.equal(r,n),-1)})}function $0(r,e){return z.tidy(function(){return Rf(F.equal(F.argMax(r,-1),F.argMax(e,-1)),"float32")})}function V_(r,e){return z.tidy(function(){return F.cast(F.sum(F.logicalAnd(F.equal(r,1),F.equal(e,1))),"float32")})}function Sae(r,e){return z.tidy(function(){return F.cast(F.sum(F.logicalAnd(F.equal(r,1),F.equal(e,0))),"float32")})}function Eae(r,e){return z.tidy(function(){return F.cast(F.sum(F.logicalAnd(F.equal(r,0),F.equal(e,1))),"float32")})}function U_(r,e){return z.tidy(function(){var t=V_(r,e),n=Eae(r,e),a=F.add(t,n);return F.cast(F.where(F.greater(a,0),F.div(t,a),0),"float32")})}function Tae(r,e){return z.tidy(function(){var t=V_(r,e),n=Sae(r,e),a=F.add(t,n);return F.cast(F.where(F.greater(a,0),F.div(t,a),0),"float32")})}function G_(r,e){return Qd(r,e)}function H_(r,e){return r.rank===e.rank&&(r=F.squeeze(r,[r.rank-1])),e=F.argMax(e,-1),e.dtype!==r.dtype&&(e=F.cast(e,r.dtype)),F.cast(F.equal(r,e),"float32")}var Iae=Zs,Nae=Zs,Cae=Zd,Aae=Zd,_ae=wl,Dae=wl,W0=Af,Fae=B0,q_=Dd,Rd={binaryAccuracy:z0,categoricalAccuracy:$0,precision:U_,categoricalCrossentropy:W0,sparseCategoricalCrossentropy:q_,mse:Iae,MSE:Nae,mae:Cae,MAE:Aae,mape:_ae,MAPE:Dae,cosine:Fae};function Rae(r){if(typeof r=="string"&&r in Rd)return Rd[r];if(typeof r!="string"&&r!=null)return r;throw new ce("Unknown metric "+r)}function ud(r){var e,t,n,a;if(Ri(r!==null,"Unknown LossOrMetricFn "+r),typeof r=="string")return r;var i=void 0;try{for(var o=ke(Object.keys(Fd)),s=o.next();!s.done;s=o.next()){var u=s.value;if(Fd[u]===r){i=u;break}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(i!==void 0)return i;try{for(var l=ke(Object.keys(Rd)),c=l.next();!c.done;c=l.next()){var u=c.value;if(Rd[u]===r){i=u;break}}}catch(f){n={error:f}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return i!==void 0?i:r.name}function Mae(r){var e={Adagrad:function(){return z.train.adagrad(.01)},Adadelta:function(){return z.train.adadelta(1,.95,qr())},Adam:function(){return z.train.adam(.001,.9,.999,qr())},Adamax:function(){return z.train.adamax(.002,.9,.999,qr(),0)},RMSProp:function(){return z.train.rmsprop(.001,.9,0,qr())},SGD:function(){return z.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,r in e)return e[r]();throw new ce("Unknown Optimizer "+r)}var zN=1*1024*1024;function $N(r,e,t){if(t===void 0&&(t=!1),r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!By(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var n=JSON.stringify(r);n.length>zN&&console.warn('User-defined metadata of model "'+e+'" is too large in '+("size (length="+n.length+" when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+(zN+"."))}}function By(r){var e,t,n,a;if(r===null)return!0;if(typeof r=="object")if(Object.getPrototypeOf(r)===Object.prototype){var i=Object.keys(r);try{for(var o=ke(i),s=o.next();!s.done;s=o.next()){var u=s.value;if(typeof u!="string"||!By(r[u]))return!1}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!0}else if(Array.isArray(r)){try{for(var l=ke(r),c=l.next();!c.done;c=l.next()){var f=c.value;if(!By(f))return!1}}catch(p){n={error:p}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return!0}else return!1;else{var h=typeof r;return h==="string"||h==="number"||h==="boolean"}}function Oae(r,e,t,n){n===void 0&&(n=console.log);var a=Lae(r),i=["Layer (type)","Input Shape","Output shape","Param #"];a?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(function(h){return Math.floor(e*h)}));var o;if(!a){i.push("Receives inputs"),o=[];for(var s in r.nodesByDepth)o.push.apply(o,pt(r.nodesByDepth[s]))}n("_".repeat(e)),Md(i,t,n),n("=".repeat(e));for(var u=r.layers,l=0;l<u.length;++l)a?Bae(u[l],t,n):zae(u[l],t,o,n),n((l===u.length-1?"=":"_").repeat(e));r.checkTrainableWeightsConsistency();var c=Pae(r),f=md(r.nonTrainableWeights);n("Total params: "+(c+f)),n("Trainable params: "+c),n("Non-trainable params: "+f),n("_".repeat(e))}function Pae(r){var e;return r.collectedTrainableWeights!=null?e=md(r.collectedTrainableWeights):e=md(r.trainableWeights),e}function Lae(r){var e,t,n,a,i,o,s=!0,u=[],l=[];for(var c in r.nodesByDepth)u.push(r.nodesByDepth[c]);try{for(var f=ke(u),h=f.next();!h.done;h=f.next()){var p=h.value;if(p.length>1||p.length===1&&p[0].inboundLayers.length>1){s=!1;break}l.push.apply(l,pt(p))}}catch(k){e={error:k}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(s)try{for(var d=ke(r.layers),v=d.next();!v.done;v=d.next()){var m=v.value,g=!1;try{for(var y=(i=void 0,ke(m.inboundNodes)),b=y.next();!b.done;b=y.next()){var w=b.value;if(l.indexOf(w)!==-1)if(g){s=!1;break}else g=!0}}catch(k){i={error:k}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}if(!s)break}}catch(k){n={error:k}}finally{try{v&&!v.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return s}function Md(r,e,t){t===void 0&&(t=console.log);for(var n="",a=0;a<r.length;++a)a>0&&(n=n.slice(0,n.length-1)+" "),n+=r[a],n=n.slice(0,e[a]),n+=" ".repeat(e[a]-n.length);t(n)}function Bae(r,e,t){var n,a;try{a=r.inboundNodes.map(function(u){return JSON.stringify(u.inputShapes)}).join(",")}catch{a="multiple"}try{n=JSON.stringify(r.outputShape)}catch{n="multiple"}var i=r.name,o=r.getClassName(),s=[i+" ("+o+")",a,n,r.countParams().toString()];Md(s,e,t)}function zae(r,e,t,n){var a,i,o,s;try{s=r.inboundNodes.map(function(w){return JSON.stringify(w.inputShapes)}).join(",")}catch{s="multiple"}try{o=JSON.stringify(r.outputShape)}catch{o="multiple"}var u=[];try{for(var l=ke(r.inboundNodes),c=l.next();!c.done;c=l.next()){var f=c.value;if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(var h=0;h<f.inboundLayers.length;++h){var p=f.inboundLayers[h].name,d=f.nodeIndices[h],v=f.tensorIndices[h];u.push(p+"["+d+"]["+v+"]")}}}catch(w){a={error:w}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}var m=r.name,g=r.getClassName(),y=u.length===0?"":u[0],b=[m+" ("+g+")",s,o,r.countParams().toString(),y];Md(b,e,n);for(var h=1;h<u.length;++h)Md(["","","","",u[h]],e,n)}function K_(r,e,t){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&e===0&&typeof t=="string"}function _f(r,e){var t,n;if(r===null)return null;if(typeof r=="string")return Ps(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];K_(e,o,s)?a.push(s):a.push(_f(s,e))}return a}else{var u={};try{for(var l=ke(Object.keys(r)),c=l.next();!c.done;c=l.next()){var f=c.value,h=r[f];if(f==="name"&&typeof h=="string")u[f]=h;else{var p=Ps(f);u[p]=_f(h,p)}}}catch(d){t={error:d}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return u}}function zy(r,e){var t,n;if(r==null)return null;if(typeof r=="string")return io(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];K_(e,o,s)?a.push(s):a.push(zy(s,e))}return a}else{var u={};try{for(var l=ke(Object.keys(r)),c=l.next();!c.done;c=l.next()){var f=c.value,h=r[f],p=io(f);(f==="name"||f==="className")&&typeof h=="string"?u[p]=h:u[p]=zy(h,f)}}catch(d){t={error:d}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return u}}var V0="3.21.0",$ae=(function(r){be(e,r);function e(t){var n,a,i,o,s,u,l,c,f,h,p,d,v,m,g,y,b,w,k,S,E,N,C,R,_=r.call(this,{})||this;if(_.containerNodes=new Set,_.name=t.name,_.name==null){var O=_.getClassName().toLowerCase();_.name=Od(O)}if(_.supportsMasking=!1,_.trainable_=!0,Array.isArray(t.inputs)?_.inputs=t.inputs.slice():_.inputs=[t.inputs],Array.isArray(t.outputs)?_.outputs=t.outputs.slice():_.outputs=[t.outputs],Wo(_.inputs).length!==_.inputs.length)throw new ce("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+(""+_.inputs.map(function(bt){return bt.name})));Wo(_.outputs).length!==_.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+(""+_.outputs.map(function(bt){return bt.name}))),_.inputLayers=[],_.inputLayersNodeIndices=[],_.inputLayersTensorIndices=[],_.outputLayers=[],_.outputLayersNodeIndices=[],_.outputLayersTensorIndices=[],_.layers=[],_.internalContainerRefs=[];try{for(var P=ke(_.outputs),B=P.next();!B.done;B=P.next()){var W=B.value,L=W.sourceLayer,G=W.nodeIndex,M=W.tensorIndex;_.outputLayers.push(L),_.outputLayersNodeIndices.push(G),_.outputLayersTensorIndices.push(M)}}catch(bt){n={error:bt}}finally{try{B&&!B.done&&(a=P.return)&&a.call(P)}finally{if(n)throw n.error}}try{for(var $=ke(_.inputs),K=$.next();!K.done;K=$.next()){var W=K.value,L=W.sourceLayer,G=W.nodeIndex,M=W.tensorIndex;Ri(G===0,"input layer has >1 nodes"),Ri(M===0,"input layer has >1 tensors"),_.inputLayers.push(L),_.inputLayersNodeIndices.push(G),_.inputLayersTensorIndices.push(M)}}catch(bt){i={error:bt}}finally{try{K&&!K.done&&(o=$.return)&&o.call($)}finally{if(i)throw i.error}}_.inputNames=[],_.outputNames=[],_.feedInputShapes=[],_.feedInputNames=[],_.feedOutputNames=[];for(var j=0;j<_.inputLayers.length;j++){var L=_.inputLayers[j];if(!(L instanceof yl))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+("Received inputs: "+t.inputs+". ")+("Input "+j+" (0-based) originates ")+("from layer type "+L.getClassName()+"."));_.inputNames.push(L.name),_.feedInputShapes.push(L.batchInputShape),_.feedInputNames.push(L.name)}try{for(var te=ke(_.outputLayers),Q=te.next();!Q.done;Q=te.next()){var L=Q.value;_.outputNames.push(L.name)}}catch(bt){s={error:bt}}finally{try{Q&&!Q.done&&(u=te.return)&&u.call(te)}finally{if(s)throw s.error}}_.internalInputShapes=_.inputs.map(function(bt){return bt.shape}),_.internalOutputShapes=_.outputs.map(function(bt){return bt.shape});var ie={},le={},de={},we={},pe={},Se=[],Ee=function(bt,_a,ai,Wn,fs,Ik){(Wn==null||fs==null||Ik==null)&&(Wn=bt.sourceLayer,fs=bt.nodeIndex,Ik=bt.tensorIndex);var pa=Wn.inboundNodes[fs];if(ai.indexOf(pa)!==-1)throw new Oi("The tensor "+bt.name+' at layer "'+Wn.name+'" is part of a cycle.');if(_a.indexOf(pa)===-1){_.containerNodes.add(e.nodeKey(Wn,fs)),Wn.id in pe||(pe[Wn.id]=Object.keys(pe).length),ai.indexOf(pa)===-1&&ai.push(pa);for(var Lz=pa.inboundLayers.length,Bu=0;Bu<Lz;Bu++){var Bz=pa.inputTensors[Bu],zz=pa.inboundLayers[Bu],$z=pa.nodeIndices[Bu],Wz=pa.tensorIndices[Bu];Ee(Bz,_a,ai,zz,$z,Wz)}for(_a.push(pa);ai.indexOf(pa)>=0;)ai.splice(ai.indexOf(pa),1);Se.push(pa)}},Ne=[],Ge=[];try{for(var Ke=ke(_.outputs),Ue=Ke.next();!Ue.done;Ue=Ke.next()){var W=Ue.value;Ee(W,Ne,Ge)}}catch(bt){l={error:bt}}finally{try{Ue&&!Ue.done&&(c=Ke.return)&&c.call(Ke)}finally{if(l)throw l.error}}var tt=Se.slice().reverse();try{for(var st=ke(tt),je=st.next();!je.done;je=st.next()){var Xe=je.value;le[Xe.id]=Xe,Xe.id in ie||(ie[Xe.id]=0);var at=ie[Xe.id],it=de[Xe.outboundLayer.id]==null?0:de[Xe.outboundLayer.id];at=Math.max(at,it),de[Xe.outboundLayer.id]=at,we[Xe.outboundLayer.id]=Xe.outboundLayer,ie[Xe.id]=at;for(var j=0;j<Xe.inboundLayers.length;j++){var Kt=Xe.inboundLayers[j],G=Xe.nodeIndices[j],Pe=Kt.inboundNodes[G],xt=ie[Pe.id]==null?0:ie[Pe.id];ie[Pe.id]=Math.max(at+1,xt),le[Pe.id]=Pe}}}catch(bt){f={error:bt}}finally{try{je&&!je.done&&(h=st.return)&&h.call(st)}finally{if(f)throw f.error}}var Mr={};for(var dn in ie){var at=ie[dn];at in Mr||(Mr[at]=[]),Mr[at].push(le[dn])}var Br={};for(var Or in de){var at=de[Or];at in Br||(Br[at]=[]),Br[at].push(we[Or])}var mr=Object.keys(Br).map(function(bt){return parseInt(bt,10)}).sort(ad);_.layers=[];try{for(var zn=ke(mr),vn=zn.next();!vn.done;vn=zn.next()){var at=vn.value,$n=Br[at];$n.sort(function(_a,ai){var Wn=pe[_a.id],fs=pe[ai.id];return Wn<fs?-1:Wn>fs?1:0});try{for(var Cr=(v=void 0,ke($n)),Yi=Cr.next();!Yi.done;Yi=Cr.next()){var L=Yi.value;L instanceof e&&_.internalContainerRefs.push(L),_.layers.push(L)}}catch(_a){v={error:_a}}finally{try{Yi&&!Yi.done&&(m=Cr.return)&&m.call(Cr)}finally{if(v)throw v.error}}}}catch(bt){p={error:bt}}finally{try{vn&&!vn.done&&(d=zn.return)&&d.call(zn)}finally{if(p)throw p.error}}_.layersByDepth=Br,mr=Object.keys(Mr).map(function(bt){return parseInt(bt,10)}).sort(ad);var Pu=_.inputs.slice(),fp=[];try{for(var Zi=ke(mr),cs=Zi.next();!cs.done;cs=Zi.next()){var at=cs.value;try{for(var Lu=(b=void 0,ke(Mr[at])),Dc=Lu.next();!Dc.done;Dc=Lu.next()){var Xe=Dc.value,L=Xe.outboundLayer;if(L!=null){try{for(var hp=(k=void 0,ke(Xe.inputTensors)),Fc=hp.next();!Fc.done;Fc=hp.next()){var W=Fc.value;if(Pu.indexOf(W)===-1)throw new Oi("Graph disconnected: cannot obtain value for tensor "+W+(' at layer "'+L.name+'". ')+"The following previous layers were accessed without "+("issue: "+fp))}}catch(Wn){k={error:Wn}}finally{try{Fc&&!Fc.done&&(S=hp.return)&&S.call(hp)}finally{if(k)throw k.error}}try{for(var pp=(E=void 0,ke(Xe.outputTensors)),Rc=pp.next();!Rc.done;Rc=pp.next()){var W=Rc.value;Pu.push(W)}}catch(Wn){E={error:Wn}}finally{try{Rc&&!Rc.done&&(N=pp.return)&&N.call(pp)}finally{if(E)throw E.error}}fp.push(L.name)}}}catch(_a){b={error:_a}}finally{try{Dc&&!Dc.done&&(w=Lu.return)&&w.call(Lu)}finally{if(b)throw b.error}}}}catch(bt){g={error:bt}}finally{try{cs&&!cs.done&&(y=Zi.return)&&y.call(Zi)}finally{if(g)throw g.error}}_.nodesByDepth=Mr;var jm=_.layers.map(function(bt){return bt.name}),Oz=function(bt){var _a=jm.filter(function(ai){return ai===bt}).length;if(_a!==1)throw new Oi('The name "'+bt+'" is used '+_a+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(jm))};try{for(var dp=ke(jm),Mc=dp.next();!Mc.done;Mc=dp.next()){var Pz=Mc.value;Oz(Pz)}}catch(bt){C={error:bt}}finally{try{Mc&&!Mc.done&&(R=dp.return)&&R.call(dp)}finally{if(C)throw C.error}}return _.outboundNodes=[],_.inboundNodes=[],new Gd({outboundLayer:_,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:_.inputs,outputTensors:_.outputs,inputMasks:_.inputs.map(function(bt){return null}),outputMasks:_.outputs.map(function(bt){return null}),inputShapes:_.inputs.map(function(bt){return bt.shape}),outputShapes:_.outputs.map(function(bt){return bt.shape})}),_.built=!0,_._refCount=1,_}return e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){var t,n,a,i;this.assertNotDisposed();var o={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){try{for(var s=ke(this.layers),u=s.next();!u.done;u=s.next()){var l=u.value;o.numDisposedVariables+=l.dispose().numDisposedVariables}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var c=ke(this.internalContainerRefs),f=c.next();!f.done;f=c.next()){var h=f.value;o.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(p){a={error:p}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}}return o.refCountAfterDispose=this._refCount,o},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(n){n._trainableWeights.forEach(function(a){return a.trainable=t})}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(this._trainableWeights.length>0)throw new ce("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var a=[];try{for(var i=ke(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value;a=a.concat(s.trainableWeights)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=ke(this.layers),u=s.next();!u.done;u=s.next()){var l=u.value;o.push.apply(o,pt(l.nonTrainableWeights))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var c=[];try{for(var f=ke(this.layers),h=f.next();!h.done;h=f.next()){var l=h.value;c.push.apply(c,pt(l.trainableWeights))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return c.concat(o)}return o},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.loadWeights=function(t,n){var a,i,o,s;n===void 0&&(n=!0);var u={},l=0;try{for(var c=ke(this.layers),f=c.next();!f.done;f=c.next()){var h=f.value;try{for(var p=(o=void 0,ke(h.weights)),d=p.next();!d.done;d=p.next()){var v=d.value;if(u[v.originalName]!=null)throw new ce("Duplicate weight name: "+v.originalName);u[v.originalName]=v,l++}}catch(S){o={error:S}}finally{try{d&&!d.done&&(s=p.return)&&s.call(p)}finally{if(o)throw o.error}}}}catch(S){a={error:S}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}var m=[];for(var g in t){var y=g;if(u[g]==null){var b=g.split("/"),w=b.slice(0,-2).concat([b[b.length-1]]);y=w.join("/")}if(u[y]!=null)m.push([u[y],t[g]]);else if(n)throw new ce("Provided weight data has no target variable: "+g);delete u[y]}if(n){var k=[];for(var g in u)k.push(g);if(k.length>0)throw new ce(k.length+" of "+l+" weights are not set: "+(""+k))}Jy(m)},e.prototype.updatedConfig=function(){var t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion="tfjs-layers "+V0,n.backend="TensorFlow.js",n},e.prototype.toJSON=function(t,n){n===void 0&&(n=!0);var a=zy(this.updatedConfig());return n?JSON.stringify(a):a},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){t=sr(t);for(var i=new ol,o=0;o<a.inputs.length;++o)i.add(a.inputs[o],t[o]);return vf(a.outputs,i,n)})},e.prototype.computeMask=function(t,n){var a=this;return z.tidy(function(){t=sr(t);var i;return n==null?i=$s(null,t.length):i=sr(n),a.runInternalGraph(t,i)[1]})},e.prototype.computeOutputShape=function(t){var n,a,i,o,s=vd(t);if(s.length!==this.inputLayers.length)throw new ce("Invalid inputShape argument "+t+": "+("model has "+this.inputLayers.length+" tensor inputs."));for(var u={},l=0;l<s.length;l++){var c=this.inputLayers[l],f=s[l],h=c.name+"_0_0";u[h]=f}var p=Object.keys(this.nodesByDepth).map(function(G){return parseInt(G,10)}).sort(ad);if(p.length>1)try{for(var d=ke(p),v=d.next();!v.done;v=d.next()){var m=v.value,g=this.nodesByDepth[m];try{for(var y=(i=void 0,ke(g)),b=y.next();!b.done;b=y.next()){var w=b.value,c=w.outboundLayer;if(this.inputLayers.map(function(M){return M.id}).indexOf(c.id)===-1){for(var k=[],S=0;S<w.inboundLayers.length;S++){var E=w.inboundLayers[S],N=w.nodeIndices[S],C=w.tensorIndices[S],h=E.name+"_"+N+"_"+C,R=u[h];k.push(R)}for(var _=c.computeOutputShape(In(k)),O=vd(_),P=c.inboundNodes.indexOf(w),S=0;S<O.length;S++){var h=c.name+"_"+P+"_"+S;u[h]=O[S]}}}}catch(G){i={error:G}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(G){n={error:G}}finally{try{v&&!v.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}for(var B=[],W=[],l=0;l<this.outputLayers.length;l++){var c=this.outputLayers[l],P=this.outputLayersNodeIndices[l],C=this.outputLayersTensorIndices[l],h=c.name+"_"+P+"_"+C;W.push(h)}for(var l=0;l<W.length;l++){var L=W[l];Ri(L in u),B.push(u[L])}return In(B)},e.prototype.runInternalGraph=function(t,n){var a,i,o,s,u,l,c,f;n==null&&(n=$s(null,t.length));for(var h={},p=0;p<this.inputs.length;++p){var d=this.inputs[p],v=t[p],m=n[p];h[d.id]=[v,m]}var g=Object.keys(this.nodesByDepth).map(function(Ee){return parseInt(Ee,10)}).sort(ad);try{for(var y=ke(g),b=y.next();!b.done;b=y.next()){var w=b.value,k=this.nodesByDepth[w];try{for(var S=(o=void 0,ke(k)),E=S.next();!E.done;E=S.next()){var N=E.value,C=N.outboundLayer,R=N.inputTensors,_=N.outputTensors,O=new Array;try{for(var P=(u=void 0,ke(R)),B=P.next();!B.done;B=P.next()){var d=B.value;d.id in h&&O.push(h[d.id])}}catch(Ee){u={error:Ee}}finally{try{B&&!B.done&&(l=P.return)&&l.call(P)}finally{if(u)throw u.error}}if(O.length===R.length){var W={},L=void 0,G=void 0,M=void 0,$=void 0;if(N.callArgs!=null&&(W=N.callArgs),O.length===1){var K=ye(O[0],2),j=K[0],te=K[1];W.mask==null&&(W.mask=te),M=sr(C.call(j,W)),$=sr(C.computeMask(j,te)),L=[j],G=[te]}else L=O.map(function(Ee){return Ee[0]}),G=O.map(function(Ee){return Ee[1]}),W.mask==null&&(W.mask=G),M=sr(C.call(L,W)),$=sr(C.computeMask(L,G));if(C.activityRegularizer)throw new wt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var p=0;p<_.length;++p){var d=_[p],v=M[p],m=$[p];h[d.id]=[v,m]}}}}catch(Ee){o={error:Ee}}finally{try{E&&!E.done&&(s=S.return)&&s.call(S)}finally{if(o)throw o.error}}}}catch(Ee){a={error:Ee}}finally{try{b&&!b.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}var Q=[],ie=[],le=[];try{for(var de=ke(this.outputs),we=de.next();!we.done;we=de.next()){var d=we.value;Ri(d.id in h,"Could not compute output "+d.name+" : "+d.id);var pe=ye(h[d.id],2),Se=pe[0],m=pe[1];le.push(Se.shape),Q.push(Se),ie.push(m)}}catch(Ee){c={error:Ee}}finally{try{we&&!we.done&&(f=de.return)&&f.call(de)}finally{if(c)throw c.error}}return[Q,ie,le]},e.prototype.buildNodeConversionMap=function(t){var n,a,i={},o;try{for(var s=ke(this.layers),u=s.next();!u.done;u=s.next()){var l=u.value;o=l instanceof e?1:0;for(var c=0;c<l.inboundNodes.length;c++){var f=e.nodeKey(l,c);this.containerNodes.has(f)&&(i[f]=o,o+=1)}}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return i},e.prototype.getLayer=function(t,n){var a,i;if(n!=null){if(this.layers.length<=n)throw new ce("Was asked to retrieve layer at index "+n+", but model only "+("has "+this.layers.length+" layer(s)."));return this.layers[n]}else if(t==null)throw new ce("Provide either a layer name or layer index");try{for(var o=ke(this.layers),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.name===t)return u}}catch(l){a={error:l}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}throw new ce("No such layer: "+t)},e.prototype.calculateLosses=function(){var t=this;return z.tidy(function(){var n,a,i=[];try{for(var o=ke(t.layers),s=o.next();!s.done;s=o.next())for(var u=s.value,l=0;l<u.inboundNodes.length;++l){var c=e.nodeKey(u,l);t.containerNodes.has(c)&&i.push.apply(i,pt(u.calculateLosses()))}}catch(f){n={error:f}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i})},e.prototype.getConfig=function(){var t,n,a={name:this.name},i=this.buildNodeConversionMap(this.layers),o=[];try{for(var s=ke(this.layers),u=s.next();!u.done;u=s.next()){for(var l=u.value,c=l.getClassName(),f=l.getConfig(),h=[],p=0;p<l.inboundNodes.length;p++){var d=l.inboundNodes[p],v=e.nodeKey(l,p),m={};if(this.containerNodes.has(v)){if(d.callArgs)try{JSON.stringify(d.callArgs),m=d.callArgs}catch{console.warn("Layer "+l.name+" was passed non-serializable keyword arguments: "+(d.callArgs+". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),m={}}if(d.inboundLayers.length>0){for(var g=[],y=0;y<d.inboundLayers.length;y++){var b=d.inboundLayers[y],w=d.nodeIndices[y],k=d.tensorIndices[y],S=e.nodeKey(b,w),E=i[S];E==null&&(E=0),g.push([b.name,E,k,m])}h.push(g)}}}var N={};N.name=l.name,N.className=c,N.config=f,N.inboundNodes=h,o.push(N)}}catch(_){t={error:_}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}a.layers=o;for(var C=[],y=0;y<this.inputLayers.length;y++){var l=this.inputLayers[y],w=this.inputLayersNodeIndices[y],v=e.nodeKey(l,w);if(this.containerNodes.has(v)){var E=i[v];E==null&&(E=0);var k=this.inputLayersTensorIndices[y];C.push([l.name,E,k])}}a.inputLayers=C;for(var R=[],y=0;y<this.outputLayers.length;y++){var l=this.outputLayers[y],w=this.outputLayersNodeIndices[y],v=e.nodeKey(l,w);if(this.containerNodes.has(v)){var E=i[v];E==null&&(E=0);var k=this.outputLayersTensorIndices[y];R.push([l.name,E,k])}}return a.outputLayers=R,a},e.fromConfig=function(t,n,a,i){var o,s,u,l,c,f,h,p,d,v;i===void 0&&(i=!1);var m={},g={};function y(Se,Ee){Se.name in g?g[Se.name].push(Ee):g[Se.name]=[Ee]}function b(Se,Ee){var Ne,Ge,Ke=[],Ue;try{for(var tt=ke(Ee),st=tt.next();!st.done;st=tt.next()){var je=st.value,Xe=je[0],at=je[1],it=je[2];if(Ue=je[3]==null?{}:je[3],!(Xe in m)){y(Se,Ee);return}var Kt=m[Xe];if(Kt.inboundNodes.length<=at){y(Se,Ee);return}var Pe=Kt.inboundNodes[at];Ke.push(Pe.outputTensors[it])}}catch(xt){Ne={error:xt}}finally{try{st&&!st.done&&(Ge=tt.return)&&Ge.call(tt)}finally{if(Ne)throw Ne.error}}Ke.length>0&&Se.apply(In(Ke),Ue)}function w(Se){var Ee=Se.name,Ne=pi(Se,n.customObjects!=null?n.customObjects:{});Ne.setFastWeightInitDuringBuild(i),m[Ee]=Ne;var Ge=Se.inboundNodes;Ge.forEach(function(Ke){if(!(Ke instanceof Array))throw new ce("Corrupted configuration, expected array for nodeData: "+Ke);y(Ne,Ke)})}var k=n.name,S=n.layers;try{for(var E=ke(S),N=E.next();!N.done;N=E.next()){var C=N.value;w(C)}}catch(Se){o={error:Se}}finally{try{N&&!N.done&&(s=E.return)&&s.call(E)}finally{if(o)throw o.error}}for(;!c7(g);)try{for(var R=(u=void 0,ke(S)),_=R.next();!_.done;_=R.next()){var C=_.value,O=m[C.name];if(O.name in g){var P=g[O.name];delete g[O.name];try{for(var B=(c=void 0,ke(P)),W=B.next();!W.done;W=B.next()){var L=W.value;b(O,L)}}catch(Ee){c={error:Ee}}finally{try{W&&!W.done&&(f=B.return)&&f.call(B)}finally{if(c)throw c.error}}}}}catch(Se){u={error:Se}}finally{try{_&&!_.done&&(l=R.return)&&l.call(R)}finally{if(u)throw u.error}}var G=[],M=[],$=n.inputLayers;try{for(var K=ke($),j=K.next();!j.done;j=K.next()){var C=j.value,te=C[0],Q=C[1],ie=C[2];Ri(te in m);var O=m[te],le=O.inboundNodes[Q].outputTensors;G.push(le[ie])}}catch(Se){h={error:Se}}finally{try{j&&!j.done&&(p=K.return)&&p.call(K)}finally{if(h)throw h.error}}var de=n.outputLayers;try{for(var we=ke(de),pe=we.next();!pe.done;pe=we.next()){var C=pe.value,te=C[0],Q=C[1],ie=C[2];Ri(te in m);var O=m[te],le=O.inboundNodes[Q].outputTensors;M.push(le[ie])}}catch(Se){d={error:Se}}finally{try{pe&&!pe.done&&(v=we.return)&&v.call(we)}finally{if(d)throw d.error}}return new t({inputs:G,outputs:M,name:k})},Object.defineProperty(e.prototype,"stateful",{get:function(){var t,n;if(this._stateful)throw new ce("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var a=ke(this.layers),i=a.next();!i.done;i=a.next()){var o=i.value;if(o.stateful)return!0}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){var t=this;z.tidy(function(){t.layers.forEach(function(n){n.stateful&&n.resetStates()})})},e})(Tt);function Wae(r,e,t){var n=e.length;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(i){return null});if(n===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&e[0]in r?[r[e[0]]]:[r];if(Array.isArray(r)){if(r.length!==n)throw new Error("Provided "+t+" is an array of "+r.length+" "+("element(s), but the model has "+n+" outputs. ")+"Make sure a set of weights is provided for each model output.");return r}else if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){var a=[];return e.forEach(function(i){i in r?a.push(r[i]):a.push(null)}),a}else throw new Error("The model has multiple ("+n+") outputs, "+("so "+t+" must be either an array with ")+(n+" elements or an object with "+e+" keys. ")+("Provided "+t+" not understood: "+JSON.stringify(r)))}function j_(r,e){return Wae(r,e,"classWeight")}function X_(r,e,t,n){return Ae(this,void 0,void 0,function(){var a,i,o,s,u;return Ce(this,function(l){switch(l.label){case 0:if(e!=null||n!=null)throw new Error("Support sampleWeight is not implemented yet");return t==null?[3,2]:(a=z.tidy(function(){if(r.shape.length===1)return z.clone(r);if(r.shape.length===2)if(r.shape[1]>1){var c=1;return z.argMax(r,c)}else{if(r.shape[1]===1)return z.reshape(r,[r.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+r.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}else throw new Error("Unexpected rank of target (y) tensor ("+r.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),s=(o=Array).from,[4,a.data()]);case 1:return i=s.apply(o,[l.sent()]),z.dispose(a),u=[],i.forEach(function(c){if(t[c]==null)throw new Error("classWeight must contain all classes in the training data. "+("The class "+c+" exists in the data but not in ")+"classWeight");u.push(t[c])}),[2,z.tensor1d(u,"float32")];case 2:return[2,null]}})})}function Vae(r,e){return z.mul(r,e)}var Uae=32;function Y_(r,e){var t,n,a=e;t=a.xs,n=a.ys,F.util.assert(t!=null&&n!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+(""+e)});var i=WN("input",r.inputNames,t),o=WN("output",r.outputNames,n),s=i[0].shape[0];F.util.assert(i.length===r.inputs.length,function(){return"LayersModel has "+r.inputs.length+" inputs, but the dataset "+("provides "+i.length+" inputs.  (Expected input keys: ")+(JSON.stringify(r.inputNames)+")")}),F.util.assert(o.length===r.outputs.length,function(){return"LayersModel has "+r.outputs.length+" outputs, but the dataset "+("provides "+o.length+" outputs.  (Expected output keys: ")+(JSON.stringify(r.outputNames)+")")});for(var u=function(h){F.util.assert(i[h].shape[0]===s,function(){return"Batch size mismatch: input "+(r.inputNames[h]+" has "+i[h].shape[0]+"; ")+("expected  "+s+" based on input "+r.inputNames[0]+".")})},l=0;l<i.length;l++)u(l);for(var c=function(h){F.util.assert(o[h].shape[0]===s,function(){return"Batch size mismatch: output "+(r.outputNames[h]+" has "+o[h].shape[0]+"; ")+("expected  "+s+" based on input "+r.inputNames[0]+".")})},f=0;f<o.length;f++)c(f);return{xs:i,ys:o}}function WN(r,e,t){var n,a;if(t instanceof F.Tensor)return[t];if(Array.isArray(t))return F.util.assert(t.length===e.length,function(){return"Received an array of "+t.length+" Tensors, but expected "+e.length+" to match the "+r+" keys "+e+"."}),t;var i=[];try{for(var o=ke(e),s=o.next();!s.done;s=o.next()){var u=s.value;if(t[u]==null)throw new ce("The feature data generated by the dataset lacks the required "+(r+" key '"+u+"'."));i.push(t[u])}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}function Gae(r){if(r.length===3)throw new wt("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}function Hae(r,e,t){return Ae(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,v,m,g,y,b,w,k,S,E,N,C,R,_,K,O,P,B,W,K,L,G,M,$,K;return Ce(this,function(j){switch(j.label){case 0:if(n=t.batchesPerEpoch!=null,F.util.assert(r.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),F.util.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),F.util.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive "+("integer, but got "+t.epochs)}),F.util.assert(!n||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+("positive integer if specified, but got "+t.batchesPerEpoch)}),F.util.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,j.label=1;case 1:return j.trys.push([1,,26,27]),a=t.validationData!=null,i=void 0,o=void 0,a&&(VN(t.validationData)?F.util.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+("but got "+t.validationBatches)}):(s=Gae(t.validationData),i=s.xs,o=s.ys)),u=r.makeTrainFunction(),l=r.getDedupedMetricsNames(),c=void 0,a?c=l.slice().concat(l.map(function(te){return"val_"+te})):c=l.slice(),f=$_(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,p=W_(f,h,t.epochs,null,null,qae(e,t),null,a,c),d=p.callbackList,v=p.history,d.setModel(r),r.history=v,[4,d.onTrainBegin()];case 2:return j.sent(),r.stopTraining_=!1,m=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:g=j.sent(),j.label=4;case 4:return m<t.epochs?(y={},[4,d.onEpochBegin(m)]):[3,23];case 5:return j.sent(),b=0,w=0,n?[3,7]:[4,e.iterator()];case 6:g=j.sent(),j.label=7;case 7:return!n||b<t.batchesPerEpoch?[4,g.next()]:[3,21];case 8:return k=j.sent(),n&&k.done?(console.warn("You provided `batchesPerEpoch` as "+(t.batchesPerEpoch+", ")+"but your dataset iterator ran out of data after "+(b+" batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+(t.batchesPerEpoch*t.epochs+" batches). ")+"You may need to use the repeat() function when building your dataset."),[3,21]):k.value==null?[3,15]:(S=Y_(r,k.value),E=S.xs,N=S.ys,C={},C.batch=w,C.size=E[0].shape[0],[4,d.onBatchBegin(w,C)]);case 9:if(j.sent(),R=[],t.classWeight==null)return[3,13];_=j_(t.classWeight,r.outputNames),K=0,j.label=10;case 10:return K<_.length?(P=(O=R).push,[4,X_(N[K],null,_[K])]):[3,13];case 11:P.apply(O,[j.sent()]),j.label=12;case 12:return++K,[3,10];case 13:for(B=E.concat(N).concat(R),W=u(B),F.dispose(B),K=0;K<l.length;++K)L=l[K],G=W[K],C[L]=G,F.keep(G);return[4,d.onBatchEnd(w,C)];case 14:j.sent(),P_(C),w++,b++,j.label=15;case 15:return(n?b>=t.batchesPerEpoch:k.done)?a?(M=void 0,VN(t.validationData)?($=sr,[4,r.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return M=$.apply(void 0,[j.sent()]),[3,18];case 17:M=sr(r.evaluate(i,o,{batchSize:t.validationBatchSize==null?Uae:t.validationBatchSize,verbose:0})),j.label=18;case 18:for(K=0;K<r.metricsNames.length;++K)y["val_"+r.metricsNames[K]]=M[K];j.label=19;case 19:return[3,21];case 20:return r.stopTraining_?[3,21]:[3,7];case 21:return[4,d.onEpochEnd(m,y)];case 22:return j.sent(),m++,r.stopTraining_?[3,23]:[3,4];case 23:return[4,d.onTrainEnd()];case 24:return j.sent(),[4,r.history.syncData()];case 25:return j.sent(),[2,r.history];case 26:return r.isTraining=!1,[7];case 27:return[2]}})})}function qae(r,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(r.size)&&(t=r.size),t}function VN(r){return typeof r.iterator=="function"}function Kae(r){return typeof r.next=="function"}function jae(r,e,t){return Ae(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p;return Ce(this,function(d){switch(d.label){case 0:if(t=t||{},n=t.batches!=null,a=r.testFunction,i=[],t.verbose>0)throw new wt("Verbose mode is not implemented yet.");return F.util.assert(!n||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but "+("received "+JSON.stringify(t.batches))}),Kae(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=d.sent(),d.label=3;case 3:o=s,u=0,l=0,c=function(){var v;return Ce(this,function(m){switch(m.label){case 0:return[4,o.next()];case 1:return v=m.sent(),i=F.tidy(function(){if(v.value){var g=Y_(r,v.value),y=g.xs,b=g.ys,w=y.concat(b),k=F.tidy(function(){return a(w)});if(F.dispose(w),l===0)for(var S=0;S<k.length;++S)i.push(z.scalar(0));for(var E=w[0].shape[0],N=function(C){var R=k[C],_=i[C];i[C]=F.tidy(function(){return F.add(i[C],F.mul(E,R))}),l>0&&F.dispose(_)},S=0;S<k.length;++S)N(S);F.dispose(k),u+=E,++l}return i}),v.done?(n&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+("batches (in this case, "+t.batches+" batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},d.label=4;case 4:return!n||l<t.batches?[5,c()]:[3,6];case 5:return f=d.sent(),f==="break"?[3,6]:[3,4];case 6:for(h=0;h<i.length;++h)p=i[h],i[h]=F.div(i[h],u),F.dispose(p);return[2,In(i)]}})})}function $y(r){F.util.assert(r>0&&Number.isInteger(r),function(){return"batchSize is required to be a positive integer, but got "+r})}function bf(r,e,t){return r==null?[null]:Array.isArray(r)?r.map(function(n){return zs(n,e,t-e)}):zs(r,e,t-e)}function U0(r,e){return F.tidy(function(){return r==null?null:Array.isArray(r)?r.map(function(t){return U0(t,e)}):aC(r,e.dtype==="int32"?e:F.cast(e,"int32"))})}function Wy(r,e){for(var t=[],n=0,a=null;n<r;)a=n+e,a>=r&&(a=r),t.push([n,a]),n=a;return t}function Xae(r,e,t,n,a,i,o,s,u,l,c,f,h,p,d){return Ae(this,void 0,void 0,function(){var v,m,g,y,b,w,k,S,E;return Ce(this,function(N){switch(N.label){case 0:if(a==null&&(a=32),i==null&&(i=1),c==null&&(c=!0),h==null&&(h=0),v=!1,u!=null&&l!=null&&(v=!0),d!=null&&(v=!0,p==null))throw new ce("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return m=r.checkNumSamples(t,a,p,"steps_per_epoch"),m!=null&&(g=vi(0,m)),o==null&&(o=1),y=W_(s,o,i,h,m,p,a,v,f),b=y.callbackList,w=y.history,b.setModel(r),r.history=w,[4,b.onTrainBegin()];case 1:N.sent(),r.stopTraining_=!1,k=function(C){var R,_,O,P,B,W;return Ce(this,function(L){switch(L.label){case 0:return[4,b.onEpochBegin(C)];case 1:if(L.sent(),R={},p==null)return[3,2];throw new wt("stepsPerEpoch mode is not implemented yet.");case 2:if(c==="batch")throw new wt("batch shuffling is not implemneted yet");c&&z.util.shuffle(g),_=z.tensor1d(g),O=Wy(m,a),P=function(G){var M;return Ce(this,function($){switch($.label){case 0:return M={},[4,b.onBatchBegin(G,M)];case 1:return $.sent(),F.tidy(function(){var K=O[G][0],j=O[G][1],te=zs(_,K,j-K);M.batch=G,M.size=j-K;for(var Q=U0(t,te),ie=e(Q),le=0;le<n.length;++le){var de=n[le],we=ie[le];M[de]=we,F.keep(we)}if(G===O.length-1&&v)for(var pe=r.testLoop(u,l,a),le=0;le<n.length;++le){var de=n[le],we=pe[le];F.keep(we),R["val_"+de]=we}}),[4,b.onBatchEnd(G,M)];case 2:return $.sent(),P_(M),r.stopTraining_?[2,"break"]:[2]}})},B=0,L.label=3;case 3:return B<O.length?[5,P(B)]:[3,6];case 4:if(W=L.sent(),W==="break")return[3,6];L.label=5;case 5:return++B,[3,3];case 6:_.dispose(),L.label=7;case 7:return[4,b.onEpochEnd(C,R)];case 8:return L.sent(),r.stopTraining_?[2,"break"]:[2]}})},S=h,N.label=2;case 2:return S<i?[5,k(S)]:[3,5];case 3:if(E=N.sent(),E==="break")return[3,5];N.label=4;case 4:return++S,[3,2];case 5:return[4,b.onTrainEnd()];case 6:return N.sent(),[4,r.history.syncData()];case 7:return N.sent(),[2,r.history]}})})}function Yae(r,e,t,n){return n===void 0&&(n={}),Ae(this,void 0,void 0,function(){var a,i,o,s,u,l,c,f,h,p,d,v,m,g,y,b,w,k,S,E,N,C,R,_,O;return Ce(this,function(P){switch(P.label){case 0:if(r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,P.label=1;case 1:return P.trys.push([1,,7,8]),p=n.batchSize==null?32:n.batchSize,$y(p),d=!1,[4,r.standardizeUserData(e,t,n.sampleWeight,n.classWeight,d,p)];case 2:if(v=P.sent(),a=v[0],i=v[1],h=v[2],m=!1,g=void 0,!(n.validationData!=null&&n.validationData.length>0))return[3,4];if(m=!0,n.validationData.length===2)u=n.validationData[0],l=n.validationData[1];else throw n.validationData.length===3?new wt("validationData including sample weights is not supported yet."):new ce("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+(n.validationData+" is invalid."));return y=!0,[4,r.standardizeUserData(u,l,null,null,y,p)];case 3:return b=P.sent(),c=b[0],f=b[1],g=c.concat(f),[3,5];case 4:n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1?(m=!0,w=Math.floor(a[0].shape[0]*(1-n.validationSplit)),k=a[0].shape[0],c=bf(a,w,k),o=a,a=bf(a,0,w),f=bf(i,w,k),s=i,i=bf(i,0,w),g=c.concat(f)):n.validationSteps!=null&&(m=!0),P.label=5;case 5:return S=a.concat(i).concat(h),r.checkTrainableWeightsConsistency(),E=r.makeTrainFunction(),N=r.getDedupedMetricsNames(),C=void 0,R=void 0,m?(r.makeTestFunction(),C=r.testFunction,R=N.slice().concat(N.map(function(B){return"val_"+B}))):(C=null,g=[],R=N.slice()),_=$_(n.callbacks,n.yieldEvery),[4,Xae(r,E,S,N,p,n.epochs,n.verbose,_,C,g,n.shuffle,R,n.initialEpoch,null,null)];case 6:return O=P.sent(),[2,O];case 7:return r.isTraining=!1,fi(a,e),fi(i,t),fi(o,e),fi(s,t),fi(c,u),fi(f,l),h!=null&&F.dispose(h),[7];case 8:return[2]}})})}function Z_(r){var e=[];r instanceof z.Tensor&&(r=[r]);for(var t=0;t<r.length;++t){var n=r[t];if(n.rank===1)e.push(Mf(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function fi(r,e){if(r!=null){var t=[];if(e instanceof z.Tensor)t.push(e.id);else if(Array.isArray(e))e.forEach(function(s){return t.push(s.id)});else if(e!=null)for(var n in e){var a=e[n];t.push(a.id)}var i=[];if(r instanceof z.Tensor)t.indexOf(r.id)===-1&&i.push(r);else if(Array.isArray(r))r.forEach(function(s){t.indexOf(s.id)===-1&&i.push(s)});else if(r!=null)for(var n in r){var o=r[n];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(function(s){s.isDisposed||s.dispose()})}}function Zae(r){return r instanceof z.Tensor}function Vy(r){return Array.isArray(r)}function UN(r){return!Zae(r)&&!Vy(r)}function GN(r,e,t,n,a){var i,o;if(n===void 0&&(n=!0),a===void 0&&(a=""),e==null||e.length===0){if(r!=null){var s=!1;if(Vy(r)&&r.length>0)s=!0;else if(UN(r)){for(var u in r)if(r.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new ce("Error when checking model "+a+" expected no data, "+("but got "+r))}return[]}if(r==null)return e.map(function(y){return null});var l;if(UN(r)){r=r,l=[];try{for(var c=ke(e),f=c.next();!f.done;f=c.next()){var h=f.value;if(r[h]==null)throw new ce('No data provided for "'+h+'". Need data for each key in: '+(""+e));l.push(r[h])}}catch(y){i={error:y}}finally{try{f&&!f.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}else if(Vy(r)){if(r=r,r.length!==e.length)throw new ce("Error when checking model "+a+": the Array of Tensors that you are passing to your model is not the size the "+("model expected. Expected to see "+e.length+" Tensor(s), but ")+("instead got the following list of Tensor(s): "+r));l=r}else{if(r=r,e.length>1)throw new ce("The model "+a+" expects "+e.length+" Tensor(s), "+("but only received one Tensor. Found: Tensor with shape "+r.shape));l=[r]}if(l=Z_(l),t!=null){for(var p=0;p<e.length;++p)if(t[p]!=null){var d=l[p];if(d.shape.length!==t[p].length)throw new ce("Error when checking "+a+": expected "+e[p]+" "+("to have "+t[p].length+" dimension(s). but got array with ")+("shape "+d.shape));for(var v=0;v<t[p].length;++v)if(!(v===0&&!n)){var m=d.shape[v],g=t[p][v];if(g!=null&&g>=0&&m!==g)throw new ce(a+" expected a batch of elements where each "+("example has shape ["+t[p].slice(1,t[p].length)+"] ")+("(i.e.,tensor shape [*,"+t[p].slice(1,t[p].length)+"])")+(" but the "+a+" received an input with "+d.shape[0])+(" examples, each with shape ["+d.shape.slice(1,d.shape.length)+"]")+(" (tensor shape ["+d.shape+"])"))}}}return l}function Qae(r,e,t){var n=Wo(r.map(function(i){return i.shape[0]}));n.sort();var a=Wo(e.map(function(i){return i.shape[0]}));if(a.sort(),n.length>1)throw new ce("All input Tensors (x) should have the same number of samples. Got array shapes: "+(""+JSON.stringify(r.map(function(i){return i.shape}))));if(a.length>1)throw new ce("All target Tensors (y) should have the same number of samples. Got array shapes: "+(""+JSON.stringify(e.map(function(i){return i.shape}))));if(n.length>0&&a.length>0&&!z.util.arraysEqual(n,a))throw new ce("Input Tensors should have the same number of samples as target "+("Tensors. Found "+n[0]+" input sample(s) and "+a[0]+" target ")+"sample(s).")}function Jae(r,e,t){for(var n=[Zs,Qd,Af],a=0;a<r.length;++a){var i=r[a],o=e[a],s=t[a];if(o!=null){if(o===Af&&i.shape[i.shape.length-1]===1)throw new ce("You are passing a target array of shape "+i.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(n.indexOf(o)!==-1)for(var u=i.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var f=u[c],h=l[c];if(h!=null&&f!==h)throw new ce("A target Tensor with shape "+i.shape+" was passed for an "+("output of shape "+s+", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function HN(r,e,t,n,a){n===void 0&&(n=!0),a===void 0&&(a="");var i;if(Array.isArray(r)){if(r.length!==e.length)throw new ce("Error when checking model "+a+": the Array of Tensors that you are passing to your model is not the size the "+("the model expected. Expected to see "+e.length+" Tensor(s),")+(" but instead got "+r.length+" Tensors(s)."));i=r}else{if(e.length>1)throw new ce("The model expects "+e.length+" "+a+" Tensors, but only received one Tensor. Found: array with shape "+(JSON.stringify(r.shape)+"."));i=[r]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var s=i[o];if(s.shape.length!==t[o].length)throw new ce("Error when checking "+a+": expected "+e[o]+" "+("to have "+t[o].length+" dimension(s), but got array with ")+("shape "+JSON.stringify(s.shape)));for(var u=0;u<t[o].length;++u)if(!(u===0&&!n)){var l=s.shape[u],c=t[o][u];if(c!=null&&c!==l)throw new ce("Error when checking "+a+": expected "+(e[o]+" to have shape "+JSON.stringify(t[o])+" but ")+("got array with shape "+JSON.stringify(s.shape)+"."))}}}}function eie(r,e){var t,n;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(c){return[]});var a;if(typeof r=="string"||typeof r=="function")a=[r];else if(Array.isArray(r)||typeof r=="object")a=r;else throw new TypeError("Type of metrics argument not understood. Expected an string,"+("function, Array, or Object, found: "+r));if(Array.isArray(a))return e.map(function(c){return a});var i=[];try{for(var o=ke(e),s=o.next();!s.done;s=o.next()){var u=s.value,l=a.hasOwnProperty(u)?a[u]:[];Array.isArray(l)||(l=[l]),i.push(l)}}catch(c){t={error:c}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}var tie="layers-model",oo=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.isTraining=!1,n}return e.prototype.summary=function(t,n,a){if(a===void 0&&(a=console.log),!this.built)throw new ce("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Oae(this,t,n,a)},e.prototype.compile=function(t){var n,a,i=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=Mae(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof z.Optimizer))throw new ce("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var o=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(var s in t.loss)if(this.outputNames.indexOf(s)===-1)throw new ce('Unknown entry in loss dictionary: "'+s+'". '+("Only expected the following keys: "+this.outputNames));try{for(var u=ke(this.outputNames),l=u.next();!l.done;l=u.next()){var s=l.value;t.loss[s]==null&&console.warn('Output "'+s+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data '+("to be passed to "+s+" during training")),o.push(by(t.loss[s]))}}catch(g){n={error:g}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new ce("When passing an Array as loss, it should have one entry per "+("model output. The model has "+this.outputs.length+" output(s), ")+("but you passed loss="+t.loss+"."));var c=t.loss;o=c.map(function(g){return by(g)})}else{var f=by(t.loss);this.outputs.forEach(function(g){o.push(f)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var h=0;h<this.outputs.length;++h){var p=this.internalOutputShapes[h],s=this.outputNames[h];this.feedOutputNames.push(s),this.feedOutputShapes.push(p),this.feedLossFns.push(this.lossFunctions[h])}var d=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Bs("loss",function(){for(var g=0;g<i.outputs.length;++g)if(d.indexOf(g)===-1){var y=i.lossFunctions[g];i.outputs.length>1&&(i.metricsTensors.push([y,g]),i.metricsNames.push(i.outputNames[g]+"_loss"))}});var v=eie(t.metrics,this.outputNames),m=function(g,y,b){i.outputNames.length>1&&(y=i.outputNames[g]+"_"+y),i.metricsNames.push(y),i.metricsTensors.push([b,g])};Bs("metric",function(){for(var g=function(b){if(d.indexOf(b)!==-1)return"continue";var w=v[b],k=function(S){var E,N,C="",R,_,O,P=function(G){if(typeof G=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(G)!==-1){var M=i.internalOutputShapes[b];M[M.length-1]===1||i.lossFunctions[b]===Qd?["accuracy","acc"].indexOf(G)!==-1?_=z0:["crossentropy","ce"].indexOf(G)!==-1&&(_=G_):i.lossFunctions[b]===Dd?["accuracy","acc"].indexOf(G)!==-1?_=H_:["crossentropy","ce"].indexOf(G)!==-1&&(_=q_):["accuracy","acc"].indexOf(G)!==-1?_=$0:["crossentropy","ce"].indexOf(G)!==-1&&(_=W0);var $=void 0;["accuracy","acc"].indexOf(G)!==-1?$="acc":["crossentropy","ce"].indexOf(G)!==-1&&($="ce"),O=_,R=C+$}else{var K=Rae(G);O=K,R=C+ud(G)}var j;Bs(R,function(){j=O}),m(b,R,j)};try{for(var B=(E=void 0,ke(S)),W=B.next();!W.done;W=B.next()){var L=W.value;P(L)}}catch(G){E={error:G}}finally{try{W&&!W.done&&(N=B.return)&&N.call(B)}finally{if(E)throw E.error}}};k(w)},y=0;y<i.outputs.length;++y)g(y)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,n,a){a===void 0&&(a={});var i=a.batchSize==null?32:a.batchSize;$y(i);var o=!0,s=this.standardizeUserDataXY(t,n,o,i);try{var u=s[0].concat(s[1]);this.makeTestFunction();var l=this.testFunction,c=this.testLoop(l,u,i,a.verbose,a.steps);return In(c)}finally{fi(s[0],t),fi(s[1],n)}},e.prototype.evaluateDataset=function(t,n){return Ae(this,void 0,void 0,function(){return Ce(this,function(a){return this.makeTestFunction(),[2,jae(this,t,n)]})})},e.prototype.checkNumSamples=function(t,n,a,i){i===void 0&&(i="steps");var o;if(a!=null){if(o=null,n!=null)throw new ce("If "+i+" is set, batchSize must be null or undefined."+("Got batchSize = "+n))}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new ce("Either the input data should have a defined shape, or "+(i+" shoud be specified."));return o},e.prototype.execute=function(t,n){var a,i;if(Array.isArray(n)&&n.length===0)throw new ce("`outputs` is an empty Array, which is not allowed.");var o=Array.isArray(n),s=o?n:[n],u=this.retrieveSymbolicTensors(s),l=new ol;if(t instanceof z.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new ce("The number of inputs provided ("+t.length+") does not match the number of inputs of this model "+("("+this.inputs.length+")."));for(var c=0;c<this.inputs.length;++c)l.add(this.inputs[c],t[c])}else try{for(var f=ke(this.inputs),h=f.next();!h.done;h=f.next()){var p=h.value,d=t[p.name];if(d==null)throw new ce("No value is provided for the model's input "+p.name);l.add(p,d)}}catch(m){a={error:m}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var v=vf(u,l);return o?v:v[0]},e.prototype.retrieveSymbolicTensors=function(t){var n,a,i=$s(null,t.length),o=t.length;try{for(var s=ke(this.layers),u=s.next();!u.done;u=s.next()){for(var l=u.value,c=Array.isArray(l.output)?l.output:[l.output],f=c.map(function(v){return v.name}),h=0;h<t.length;++h){var p=f.indexOf(t[h]);if(p!==-1&&(i[h]=c[p],o--),o===0)break}if(o===0)break}}catch(v){n={error:v}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(o>0){var d=[];throw i.forEach(function(v,m){v==null&&d.push(t[m])}),new ce("Cannot find SymbolicTensors for output name(s): "+(""+JSON.stringify(d)))}return i},e.prototype.predictLoop=function(t,n,a){var i=this;return n===void 0&&(n=32),a===void 0&&(a=!1),F.tidy(function(){var o=i.checkNumSamples(t);if(a)throw new wt("Verbose predictLoop() is not implemented yet.");for(var s=Wy(o,n),u=i.outputs.map(function(f){return[]}),l=function(f){var h=F.tidy(function(){var p=s[f][0],d=s[f][1],v=bf(t,p,d),m=[];if(Array.isArray(v))for(var g=0;g<v.length;++g)m.push({key:i.inputs[g],value:v[g]});else m.push({key:i.inputs[0],value:v});var y=new ol(m);return vf(i.outputs,y)});h.forEach(function(p,d){return u[d].push(p)})},c=0;c<s.length;++c)l(c);return In(u.map(function(f){return F.concat(f,0)}))})},e.prototype.predict=function(t,n){n===void 0&&(n={});var a=Z_(t);HN(a,this.inputNames,this.feedInputShapes,!1);try{var i=n.batchSize==null?32:n.batchSize;return $y(i),this.predictLoop(a,i)}finally{fi(a,t)}},e.prototype.predictOnBatch=function(t){HN(t,this.inputNames,this.feedInputShapes,!0);var n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)},e.prototype.standardizeUserDataXY=function(t,n,a,i){if(this.optimizer_==null)throw new Oi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s],l=this.feedLossFns[s];l===Dd?o.push(u.slice(0,u.length-1).concat([1])):o.push(u)}if(t=GN(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=GN(n,this.feedOutputNames,o,!1,"target"),Qae(t,n),Jae(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new ce("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+(i+". Found: "+t[0].shape[0]+" sample(s)."));return[t,n]},e.prototype.standardizeUserData=function(t,n,a,i,o,s){return o===void 0&&(o=!0),Ae(this,void 0,void 0,function(){var u,l,c,f,h,p,d,v;return Ce(this,function(m){switch(m.label){case 0:if(u=ye(this.standardizeUserDataXY(t,n,o,s),2),l=u[0],c=u[1],a!=null)throw new Error("sample weight is not supported yet.");if(f=null,i==null)return[3,4];h=j_(i,this.outputNames),f=[],p=0,m.label=1;case 1:return p<h.length?(v=(d=f).push,[4,X_(c[p],null,h[p])]):[3,4];case 2:v.apply(d,[m.sent()]),m.label=3;case 3:return++p,[3,1];case 4:return[2,[l,c,f]]}})})},e.prototype.testLoop=function(t,n,a,i,o){var s=this;return i===void 0&&(i=0),F.tidy(function(){var u=s.checkNumSamples(n,a,o,"steps"),l=[];if(i>0)throw new wt("Verbose mode is not implemented yet.");if(o!=null)throw new wt("steps mode in testLoop() is not implemented yet");for(var c=Wy(u,a),f=z.tensor1d(vi(0,u)),h=0;h<c.length;++h){var p=c[h][0],d=c[h][1],v=zs(f,p,d-p),m=U0(n,v),g=t(m);if(h===0)for(var y=0;y<g.length;++y)l.push(z.scalar(0));for(var y=0;y<g.length;++y){var b=g[y];l[y]=F.add(l[y],F.mul(d-p,b))}}for(var y=0;y<l.length;++y)l[y]=F.div(l[y],u);return l})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,n=[],a=0;a<t.length;++a){var i=t[a],o=i;if(HI(t,i)>1){var s=HI(t.slice(0,a),i);o+="_"+s}n.push(o)}return n},e.prototype.makeTrainFunction=function(){var t=this;return function(n){var a=[],i=n.slice(0,t.inputs.length),o=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=n.slice(t.inputs.length+t.outputs.length,t.inputs.length+t.outputs.length*2),u=[],l=function(){for(var p=[],d=0;d<t.inputs.length;++d)p.push({key:t.inputs[d],value:i[d]});for(var v=new ol(p),m=vf(t.outputs,v,{training:!0}),g,d=0;d<t.lossFunctions.length;++d){var y=t.lossFunctions[d],b=y(o[d],m[d]);s[d]!=null&&(b=Vae(b,s[d]));var w=F.mean(b);a.push(w),d===0?g=b:g=F.add(g,b)}for(var d=0;d<t.metricsTensors.length;++d){var k=void 0;if(t.outputs.length>1&&d<t.outputs.length)k=a[d];else{var S=t.metricsTensors[d][0],E=t.metricsTensors[d][1];k=F.mean(S(o[E],m[E]))}F.keep(k),u.push(k)}return g=F.mean(g),t.calculateLosses().forEach(function(N){g=F.add(g,N)}),g},c=t.collectedTrainableWeights.map(function(p){return p.read()}),f=!0,h=t.optimizer_.minimize(l,f,c);return[h].concat(u)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(n){return F.tidy(function(){for(var a=[],i,o=n.slice(0,t.inputs.length),s=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=[],l=0;l<t.inputs.length;++l)u.push({key:t.inputs[l],value:o[l]});for(var c=new ol(u),f=vf(t.outputs,c),l=0;l<t.lossFunctions.length;++l){var h=t.lossFunctions[l],p=F.mean(h(s[l],f[l]));l===0?i=p:i=F.add(i,p),a.push(i)}for(var l=0;l<t.metricsTensors.length;++l){var d=t.metricsTensors[l][0],v=t.metricsTensors[l][1],m=F.mean(d(s[v],f[v]));a.push(m)}return a})}},e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ae(this,void 0,void 0,function(){return Ce(this,function(i){return[2,Yae(this,t,n,a)]})})},e.prototype.fitDataset=function(t,n){return Ae(this,void 0,void 0,function(){return Ce(this,function(a){return[2,Hae(this,t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ae(this,void 0,void 0,function(){var a,i,o,s,u,l,c,f,h,p,d,v,m;return Ce(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(t,n)];case 1:a=g.sent(),i=a[0],o=a[1],s=this.makeTrainFunction(),u=s(i.concat(o)),l=[],g.label=2;case 2:g.trys.push([2,7,8,9]),c=ke(u),f=c.next(),g.label=3;case 3:return f.done?[3,6]:(h=f.value,[4,h.data()]);case 4:p=g.sent(),l.push(p[0]),g.label=5;case 5:return f=c.next(),[3,3];case 6:return[3,9];case 7:return d=g.sent(),v={error:d},[3,9];case 8:try{f&&!f.done&&(m=c.return)&&m.call(c)}finally{if(v)throw v.error}return[7];case 9:return F.dispose(u),fi(a[0],t),fi(a[1],n),[2,In(l)]}})})},e.prototype.getNamedWeights=function(t){for(var n=[],a=t!=null&&t.trainableOnly,i=a?this.trainableWeights:this.weights,o=this.getWeights(a),s=0;s<i.length;++s)a&&!i[s].trainable||n.push({name:i[s].originalName,tensor:o[s]});return n},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=r.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var n=F.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-F.memory().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t,n,a,i,o;if(typeof this.loss=="string")o=io(this.loss);else if(Array.isArray(this.loss)){try{for(var s=ke(this.loss),u=s.next();!u.done;u=s.next()){var l=u.value;if(typeof l!="string")throw new Error("Serialization of non-string loss is not supported.")}}catch(v){t={error:v}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}o=this.loss.map(function(v){return io(v)})}else{var c=Object.keys(this.loss);o={};var f=this.loss;try{for(var h=ke(c),p=h.next();!p.done;p=h.next()){var d=p.value;if(typeof f[d]=="string")o[d]=io(f[d]);else throw new Error("Serialization of non-string loss is not supported.")}}catch(v){a={error:v}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}}return o},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[io(ud(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(a){return io(ud(a))});var t={};for(var n in this.metrics)t[n]=io(ud(this.metrics[n]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var n=_f(t.optimizer_config),a=pi(n),i;if(typeof t.loss=="string")i=Ps(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(function(u){return Ps(u)});else if(t.loss!=null){i={};for(var o in t.loss)i[o]=Ps(t.loss[o])}var s;if(Array.isArray(t.metrics))s=t.metrics.map(function(u){return Ps(u)});else if(t.metrics!=null){s={};for(var o in t.metrics)s[o]=Ps(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:a})},e.prototype.save=function(t,n){return Ae(this,void 0,void 0,function(){var a,i,o,s,u,l,c,f,h,p,d,v,m,g,y;return Ce(this,function(b){switch(b.label){case 0:if(typeof t=="string"){if(a=z.io.getSaveHandlers(t),a.length===0)throw new ce("Cannot find any save handlers for URL '"+t+"'");if(a.length>1)throw new ce("Found more than one ("+a.length+") save handlers for "+("URL '"+t+"'"));t=a[0]}if(t.save==null)throw new ce("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,z.io.encodeWeights(this.getNamedWeights(n))];case 1:return i=b.sent(),o=!1,s=null,u=this.toJSON(s,o),l={modelTopology:u,format:tie,generatedBy:"TensorFlow.js tfjs-layers v"+V0,convertedBy:null},c=n==null?!1:n.includeOptimizer,c&&this.optimizer!=null?(l.trainingConfig=this.getTrainingConfig(),f="optimizer",m=(v=z.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,m.apply(v,[b.sent(),f])];case 3:h=b.sent(),p=h.data,d=h.specs,(y=i.specs).push.apply(y,pt(d)),i.data=z.io.concatenateArrayBuffers([i.data,p]),b.label=4;case 4:return this.userDefinedMetadata!=null&&(g=!0,$N(this.userDefinedMetadata,this.name,g),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=i.data,l.weightSpecs=i.specs,[2,t.save(l)]}})})},e.prototype.setUserDefinedMetadata=function(t){$N(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e})($ae);oo.className="Model";z.serialization.registerClass(oo);var Q_=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(oo);Q_.className="Functional";z.serialization.registerClass(Q_);function rie(r,e){return Ae(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f;return Ce(this,function(h){switch(h.label){case 0:return"modelTopology"in r||(r={modelTopology:r}),r=r,t=r.modelTopology,t.model_config!=null&&(t=t.model_config),n=_f(t),a=pi(n,e),r.weightsManifest==null?[3,2]:[4,z.io.loadWeights(r.weightsManifest,r.pathPrefix,a.weights.map(function(p){return p.originalName}))];case 1:i=h.sent(),o={};try{for(s=ke(a.weights),u=s.next();!u.done;u=s.next())l=u.value,o[l.originalName]=i[l.originalName]}catch(p){c={error:p}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(c)throw c.error}}a.loadWeights(o),z.dispose(i),h.label=2;case 2:return[2,a]}})})}function nie(r,e){return Ae(this,void 0,void 0,function(){var t;return Ce(this,function(n){if(e==null&&(e={}),typeof r=="string"){if(t=z.io.getLoadHandlers(r,e),t.length===0)t.push(z.io.browserHTTPRequest(r,e));else if(t.length>1)throw new ce("Found more than one ("+t.length+") load handlers for "+("URL '"+r+"'"));r=t[0]}return[2,aie(r,void 0,e)]})})}function aie(r,e,t){return Ae(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f;return Ce(this,function(h){switch(h.label){case 0:if(t==null&&(t={}),r.load==null)throw new ce("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,r.load()];case 1:if(n=h.sent(),a=n.modelTopology,a.model_config!=null&&(a=a.model_config),i=t.strict==null?!0:t.strict,o=n.weightData!=null&&n.weightSpecs!=null&&i,s=pi(_f(a),e,o),u=n.trainingConfig,u!=null&&s.loadTrainingConfig(u),n.userDefinedMetadata!=null&&s.setUserDefinedMetadata(n.userDefinedMetadata),n.weightData==null)return[3,4];if(n.weightSpecs==null)throw new ce("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return l=iie(n.weightData,n.weightSpecs),c=l.modelWeights,f=l.optimizerWeights,s.loadWeights(c,i),s.optimizer!=null&&f.length>0?[4,s.optimizer.setWeights(f)]:[3,3];case 2:h.sent(),h.label=3;case 3:z.dispose(c),z.dispose(f.map(function(p){return p.tensor})),h.label=4;case 4:return[2,s]}})})}function iie(r,e){var t=z.io.decodeWeights(r,e),n={},a=[];return e.forEach(function(i){i.group==="optimizer"?a.push({name:i.name,tensor:t[i.name]}):n[i.name]=t[i.name]}),{modelWeights:n,optimizerWeights:a}}var Jd=(function(r){be(e,r);function e(t){var n,a,i=r.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},i.trainable=!0,i.built=!1,i.name=t.name!=null?t.name:Od("sequential_"),t.layers!=null)try{for(var o=ke(t.layers),s=o.next();!s.done;s=o.next()){var u=s.value;i.add(u)}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}return e.prototype.checkShape=function(t){var n=t.inboundNodes[0].outputTensors[0].shape;if(n.some(function(a){return a<0}))throw new ce("Negative dimension size caused by adding layer "+(t.name+" with input shape [")+(t.inboundNodes[0].inputTensors[0].shape+"]"))},e.prototype.add=function(t){var n=t instanceof e||t instanceof oo,a;if(n){if(a=t,a.outputs.length!==1)throw new ce("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(a.inputs.length!==1)throw new ce("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new ce("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=uC({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=a.outputs,this.inputs=a.inputs;else{if(t.inboundNodes.length!==1)throw new ce("A layer added to a Sequential model must not already be "+("connected somewhere else. LayersModel received layer "+t.name+" ")+("which has "+t.inboundNodes.length+" pre-existing inbound ")+"connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new ce("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=sC(this.outputs[0])}this.inboundNodes=[],new Gd({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:$s(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,n){return this.model==null&&this.build(),this.model.call(t,n)},e.prototype.build=function(t){if(zt(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new oo({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),r.prototype.countParams.call(this)},e.prototype.summary=function(t,n,a){a===void 0&&(a=console.log),this.built||this.build(),r.prototype.summary.call(this,t,n,a)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,n,a){if(a===void 0&&(a={}),!this.built)throw new Oi("The model needs to be compiled before being used.");return this.model.evaluate(t,n,a)},e.prototype.evaluateDataset=function(t,n){return Ae(this,void 0,void 0,function(){return Ce(this,function(a){if(!this.built)throw new Oi("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,n)]})})},e.prototype.predict=function(t,n){return n===void 0&&(n={}),this.model==null&&this.build(),this.model.predict(t,n)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!0,configurable:!0}),e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ae(this,void 0,void 0,function(){return Ce(this,function(i){if(!this.built)throw new Oi("The model needs to be compiled before being used.");return[2,this.model.fit(t,n,a)]})})},e.prototype.fitDataset=function(t,n){return Ae(this,void 0,void 0,function(){return Ce(this,function(a){if(!this.built)throw new Oi("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ae(this,void 0,void 0,function(){return Ce(this,function(a){return[2,this.model.trainOnBatch(t,n)]})})},e.fromConfig=function(t,n,a,i){var o,s;i===void 0&&(i=!1);var u,l={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new ce("Legacy serialization format not supported yet.");u=n}else z.util.assert(n.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),u=n.layers,delete n.layers,l=n;var c=new t(l);if(!(c instanceof e))throw new wt("Sequential.fromConfig called on non-Sequential input: "+c);try{for(var f=ke(u),h=f.next();!h.done;h=f.next()){var p=h.value,d=void 0,v=pi(p,d,i);i&&v.setFastWeightInitDuringBuild(!0),c.add(v)}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return c},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new ce("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new ce("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var t,n,a=[];try{for(var i=ke(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value,u={};u.className=s.getClassName(),u.config=s.getConfig(),a.push(u)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return{name:this.name,layers:a}},e})(oo);Jd.className="Sequential";z.serialization.registerClass(Jd);function oie(r){return new oo(r)}function sie(r){return new Jd(r)}function uie(r,e){return e==null&&(e={}),nie(r,e)}function J_(r){return uC(r)}function lie(r,e){L0.registerCallbackConstructor(r,e)}var _n=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e})(z.serialization.Serializable),e3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),T7(t,n)},e})(_n);e3.className="elu";z.serialization.registerClass(e3);var t3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.selu(t)},e})(_n);t3.className="selu";z.serialization.registerClass(t3);var r3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.relu(t)},e})(_n);r3.className="relu";z.serialization.registerClass(r3);var n3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return z.tidy(function(){return F.minimum(6,F.relu(t))})},e})(_n);n3.className="relu6";z.serialization.registerClass(n3);var a3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return t},e})(_n);a3.className="linear";z.serialization.registerClass(a3);var i3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.sigmoid(t)},e})(_n);i3.className="sigmoid";z.serialization.registerClass(i3);var o3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return N7(t)},e})(_n);o3.className="hardSigmoid";z.serialization.registerClass(o3);var s3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.softplus(t)},e})(_n);s3.className="softplus";z.serialization.registerClass(s3);var u3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return I7(t)},e})(_n);u3.className="softsign";z.serialization.registerClass(u3);var l3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tanh(t)},e})(_n);l3.className="tanh";z.serialization.registerClass(l3);var G0=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),F.softmax(t,n)},e})(_n);G0.className="softmax";z.serialization.registerClass(G0);var c3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),F.logSoftmax(t,n)},e})(_n);c3.className="logSoftmax";z.serialization.registerClass(c3);var f3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),z.tidy(function(){return F.mul(F.sigmoid(F.mul(t,n)),t)})},e})(_n);f3.className="swish";z.serialization.registerClass(f3);var h3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return z.tidy(function(){return F.mul(t,F.tanh(F.softplus(t)))})},e})(_n);h3.className="mish";z.serialization.registerClass(h3);function Go(r){return r.getClassName()}function wy(r,e){return e===void 0&&(e={}),Ff(r,z.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function Ho(r){if(r==null){var e={};return e.className="linear",e.config={},wy(e)}if(typeof r=="string"){var e={};return e.className=r,e.config={},wy(e)}else return r instanceof _n?r:wy(r)}function H0(r){if(r!=null&&typeof r!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+("object, but received: "+r))}var p3=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(z.serialization.Serializable),Gf=(function(r){be(e,r);function e(t){var n=r.call(this)||this;return H0(t),n.l1=t==null||t.l1==null?.01:t.l1,n.l2=t==null||t.l2==null?.01:t.l2,n.hasL1=n.l1!==0,n.hasL2=n.l2!==0,n}return e.prototype.apply=function(t){var n=this;return z.tidy(function(){var a=z.zeros([1]);return n.hasL1&&(a=z.add(a,z.sum(F.mul(n.l1,z.abs(t))))),n.hasL2&&(a=z.add(a,z.sum(F.mul(n.l2,Of(t))))),F.reshape(a,[])})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,n){return new t({l1:n.l1,l2:n.l2})},e})(p3);Gf.className="L1L2";z.serialization.registerClass(Gf);function cie(r){return H0(r),new Gf({l1:r!=null?r.l1:null,l2:0})}function fie(r){return H0(r),new Gf({l2:r!=null?r.l2:null,l1:0})}var qN={l1l2:"L1L2"};function Ht(r){return Uy(r)}function KN(r,e){return e===void 0&&(e={}),Ff(r,z.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function wr(r){if(r==null)return null;if(typeof r=="string"){var e=r in qN?qN[r]:r,t={className:e,config:{}};return KN(t)}else return r instanceof p3?r:KN(r)}var q0=(function(r){be(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null&&(n.maxValue=t.maxValue),n}return e.prototype.call=function(t,n){t=gt(t);var a=z.relu(t);return this.maxValue!=null&&(a=z.clipByValue(a,0,this.maxValue)),a},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);q0.className="ReLU";z.serialization.registerClass(q0);var K0=(function(r){be(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_ALPHA=.3,t==null&&(t={}),n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=gt(t);return z.leakyRelu(a,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);K0.className="LeakyReLU";z.serialization.registerClass(K0);var j0=(function(r){be(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),n.supportsMasking=!0,n.alphaInitializer=br(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=wr(t.alphaRegularizer),n.alphaConstraint=jr(t.alphaConstraint),t.sharedAxes==null)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")n.sharedAxes=[t.sharedAxes];else throw new ce("Expected sharedAxes to be a number or an array of numbers, "+("but got "+t.sharedAxes));return n}return e.prototype.build=function(t){var n,a;t=zt(t);var i=t.slice(1);if(this.sharedAxes!=null)try{for(var o=ke(this.sharedAxes),s=o.next();!s.done;s=o.next()){var u=s.value;i[u-1]=1}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}this.alpha=this.addWeight("alpha",i,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var l={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)l[u]=t[u];this.inputSpec=[new Vr({ndim:t.length,axes:l})],this.built=!0},e.prototype.call=function(t,n){return t=gt(t),z.prelu(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:Tr(this.alphaInitializer),alphaRegularizer:Ht(this.alphaRegularizer),alphaConstraint:Kr(this.alphaConstraint),sharedAxes:this.sharedAxes},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);j0.className="PReLU";z.serialization.registerClass(j0);var X0=(function(r){be(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==n.DEFAULT_ALPHA)throw new wt("Non-default alpha value ("+t.alpha+") is not supported by the ELU layer yet.");return n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=gt(t);return z.elu(a)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);X0.className="ELU";z.serialization.registerClass(X0);var Y0=(function(r){be(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_THETA=1,t==null&&(t={}),n.theta=t.theta==null?n.DEFAULT_THETA:t.theta,n}return e.prototype.call=function(t,n){var a=gt(t);return z.mul(a,z.cast(z.greater(a,this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);Y0.className="ThresholdedReLU";z.serialization.registerClass(Y0);var Z0=(function(r){be(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_AXIS=1,t==null&&(t={}),n.softmax=new G0().apply,n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n}return e.prototype.call=function(t,n){var a=gt(t);return this.softmax(a,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);Z0.className="Softmax";z.serialization.registerClass(Z0);function cl(r,e,t){if(typeof r=="number")return $s(r,e);if(r.length!==e)throw new ce("The "+t+" argument must be an integer or tuple of "+e+" integers."+(" Received: "+r.length+" elements."));for(var n=0;n<e;++n){var a=r[n];if(!x7(a))throw new ce("The "+t+" argument must be an integer or tuple of "+e+(" integers. Received: "+JSON.stringify(r)+" including a")+(" non-integer number "+a))}return r}function di(r,e,t,n,a){if(a===void 0&&(a=1),r==null)return r;var i=e+(e-1)*(a-1),o;return t==="same"?o=r:o=r-i+1,Math.floor((o+n-1)/n)}function Mi(r,e,t,n){if(r==null)return null;if(n==="valid")r=r*e+Uo([t-e,0]);else if(n==="same")r=r*e;else throw new ce("Unsupport padding mode: "+n+".");return r}function Q0(r,e){return z.tidy(function(){return Lr(e),e==="channelsFirst"?F.transpose(r,[0,2,3,1]):r})}function d3(r,e){return z.tidy(function(){return Lr(e),e==="channelsFirst"?F.transpose(r,[0,2,3,4,1]):r})}function hie(r,e,t,n,a,i,o){return n===void 0&&(n=1),a===void 0&&(a="valid"),o===void 0&&(o=1),z.tidy(function(){if(i==null&&(i=mi()),Lr(i),r.shape.length!==3)throw new ce("The input of a conv1dWithBias operation should be 3, but is "+(r.shape.length+" instead."));if(e.shape.length!==3)throw new ce("The kernel for a conv1dWithBias operation should be 3, but is "+(e.shape.length+" instead"));if(t!=null&&t.shape.length!==1)throw new ce("The bias for a conv1dWithBias operation should be 1, but is "+(e.shape.length+" instead"));if(i==="channelsFirst"&&(r=F.transpose(r,[0,2,1])),a==="causal")throw new wt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=F.conv1d(r,e,n,a==="same"?"same":"valid","NWC",o);return t!=null&&(s=gi(s,t)),s})}function jN(r,e,t,n,a,i,o,s){return n===void 0&&(n=[1,1]),a===void 0&&(a="valid"),s===void 0&&(s=null),z.tidy(function(){if(i==null&&(i=mi()),Lr(i),r.rank!==3&&r.rank!==4)throw new ce("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+("but received "+r.rank+"."));if(e.rank!==3&&e.rank!==4)throw new ce("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+("but received "+r.rank+"."));var u=Q0(r,i);if(a==="causal")throw new wt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=F.fused.conv2d({x:u,filter:e,strides:n,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:s}),i==="channelsFirst"&&(u=F.transpose(u,[0,3,1,2])),u})}function pie(r,e,t,n,a,i,o){return n===void 0&&(n=[1,1,1]),a===void 0&&(a="valid"),z.tidy(function(){if(i==null&&(i=mi()),Lr(i),r.rank!==4&&r.rank!==5)throw new ce("conv3dWithBias expects input to be of rank 4 or 5, but received "+(r.rank+"."));if(e.rank!==4&&e.rank!==5)throw new ce("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+(r.rank+"."));var s=d3(r,i);if(a==="causal")throw new wt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=F.conv3d(s,e,n,a==="same"?"same":"valid","NDHWC",o),t!=null&&(s=gi(s,t)),i==="channelsFirst"&&(s=F.transpose(s,[0,4,1,2,3])),s})}var v3=(function(r){be(e,r);function e(t,n){var a=r.call(this,n)||this;if(a.bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(n),a.rank=t,Qr(a.rank,"rank"),a.rank!==1&&a.rank!==2&&a.rank!==3)throw new wt("Convolution layer for rank other than 1, 2, or 3 ("+a.rank+") is not implemented yet.");if(a.kernelSize=cl(n.kernelSize,t,"kernelSize"),a.strides=cl(n.strides==null?1:n.strides,t,"strides"),a.padding=n.padding==null?"valid":n.padding,xa(a.padding),a.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Lr(a.dataFormat),a.activation=Ho(n.activation),a.useBias=n.useBias==null?!0:n.useBias,a.biasInitializer=br(n.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=jr(n.biasConstraint),a.biasRegularizer=wr(n.biasRegularizer),a.activityRegularizer=wr(n.activityRegularizer),a.dilationRate=cl(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),a.rank===1&&Array.isArray(a.dilationRate)&&a.dilationRate.length!==1)throw new ce("dilationRate must be a number or an array of a single number for 1D convolution, but received "+(""+JSON.stringify(a.dilationRate)));if(a.rank===2){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==2)throw new ce("dilationRate must be a number or array of two numbers for 2D "+("convolution, but received "+JSON.stringify(a.dilationRate)))}else if(a.rank===3){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==3)throw new ce("dilationRate must be a number or array of three numbers for 3D "+("convolution, but received "+JSON.stringify(a.dilationRate)))}return a}return e.verifyArgs=function(t){if(Ri("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!Gy(t.kernelSize,"number",1,3))throw new ce("BaseConv expects config.kernelSize to be number or number[] with "+("length 1, 2, or 3, but received "+JSON.stringify(t.kernelSize)+"."))},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Go(this.activation),useBias:this.useBias,biasInitializer:Tr(this.biasInitializer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),biasConstraint:Kr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt),ev=(function(r){be(e,r);function e(t,n){var a=r.call(this,t,n)||this;return a.kernel=null,e.verifyArgs(n),a.filters=n.filters,Qr(a.filters,"filters"),a.kernelInitializer=br(n.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=jr(n.kernelConstraint),a.kernelRegularizer=wr(n.kernelRegularizer),a}return e.prototype.build=function(t){var n;t=zt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new ce("The channel dimension of the input should be defined. "+("Found "+t[a]));var i=t[a],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[a]=i,n)}],this.built=!0},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){t=gt(t);var i,o=a.bias==null?null:a.bias.read(),s=QN(a.activation.getClassName());if(s!=null&&a.rank===2)i=jN(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate,s);else{if(a.rank===1)i=hie(t,a.kernel.read(),o,a.strides[0],a.padding,a.dataFormat,a.dilationRate[0]);else if(a.rank===2)i=jN(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else if(a.rank===3)i=pie(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else throw new wt("convolutions greater than 3D are not implemented yet.");a.activation!=null&&(i=a.activation.apply(i))}return i})},e.prototype.computeOutputShape=function(t){t=zt(t);for(var n=[],a=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),i=0;i<a.length;++i){var o=di(a[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}var s=[t[0]];return this.dataFormat==="channelsLast"?(s=s.concat(n),s.push(this.filters)):(s.push(this.filters),s=s.concat(n)),s},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:Tr(this.kernelInitializer),kernelRegularizer:Ht(this.kernelRegularizer),kernelConstraint:Kr(this.kernelConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new ce("Convolution layer expected config.filters to be a 'number' > 0 "+("but got "+JSON.stringify(t.filters)))},e})(v3),tv=(function(r){be(e,r);function e(t){var n=r.call(this,2,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!Gy(t.kernelSize,"number",1,2))throw new ce("Conv2D expects config.kernelSize to be number or number[] with "+("length 1 or 2, but received "+JSON.stringify(t.kernelSize)+"."))},e})(ev);tv.className="Conv2D";z.serialization.registerClass(tv);var rv=(function(r){be(e,r);function e(t){var n=r.call(this,3,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new ce("Conv3D expects config.kernelSize to be number or"+(" [number, number, number], but received "+JSON.stringify(t.kernelSize)+"."))},e})(ev);rv.className="Conv3D";z.serialization.registerClass(rv);var J0=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Vr({ndim:4})],n.padding!=="same"&&n.padding!=="valid")throw new ce("Conv2DTranspose currently supports only padding modes 'same' "+("and 'valid', but received padding mode "+n.padding));return n}return e.prototype.build=function(t){var n;if(t=zt(t),t.length!==4)throw new ce("Input should have rank 4; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new ce("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Vr({ndim:4,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=gt(t);if(i.shape.length!==4)throw new ce("Conv2DTranspose.call() expects input tensor to be rank-4, but "+("received a tensor of rank-"+i.shape.length));var o=i.shape,s=o[0],u,l;a.dataFormat==="channelsFirst"?(u=2,l=3):(u=1,l=2);var c=o[u],f=o[l],h=a.kernelSize[0],p=a.kernelSize[1],d=a.strides[0],v=a.strides[1],m=Mi(c,d,h,a.padding),g=Mi(f,v,p,a.padding),y=[s,m,g,a.filters];a.dataFormat!=="channelsLast"&&(i=F.transpose(i,[0,2,3,1]));var b=F.conv2dTranspose(i,a.kernel.read(),y,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(b=F.transpose(b,[0,3,1,2])),a.bias!=null&&(b=gi(b,a.bias.read(),a.dataFormat)),a.activation!=null&&(b=a.activation.apply(b)),b})},e.prototype.computeOutputShape=function(t){t=zt(t);var n=t.slice(),a,i,o;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3):(a=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[a]=this.filters,n[i]=Mi(n[i],l,s,this.padding),n[o]=Mi(n[o],c,u,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e})(tv);J0.className="Conv2DTranspose";z.serialization.registerClass(J0);var eb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Vr({ndim:5})],n.padding!=="same"&&n.padding!=="valid")throw new ce("Conv3DTranspose currently supports only padding modes 'same' "+("and 'valid', but received padding mode "+n.padding));return n}return e.prototype.build=function(t){var n;if(t=zt(t),t.length!==5)throw new ce("Input should have rank 5; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new ce("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Vr({ndim:5,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=gt(t);if(i.shape.length!==5)throw new ce("Conv3DTranspose.call() expects input tensor to be rank-4, but "+("received a tensor of rank-"+i.shape.length));var o=i.shape,s=o[0],u,l,c;a.dataFormat==="channelsFirst"?(c=2,u=3,l=4):(c=1,u=2,l=3);var f=o[c],h=o[u],p=o[l],d=a.kernelSize[0],v=a.kernelSize[1],m=a.kernelSize[2],g=a.strides[0],y=a.strides[1],b=a.strides[2],w=Mi(f,g,d,a.padding),k=Mi(h,y,v,a.padding),S=Mi(p,b,m,a.padding),E=[s,w,k,S,a.filters];a.dataFormat!=="channelsLast"&&(i=F.transpose(i,[0,2,3,4,1]));var N=F.conv3dTranspose(i,a.kernel.read(),E,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(N=F.transpose(N,[0,4,1,2,3])),a.bias!==null&&(N=gi(N,a.bias.read(),a.dataFormat)),a.activation!==null&&(N=a.activation.apply(N)),N})},e.prototype.computeOutputShape=function(t){t=zt(t);var n=t.slice(),a,i,o,s;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3,s=4):(a=4,i=1,o=2,s=3);var u=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],f=this.strides[0],h=this.strides[1],p=this.strides[2];return n[a]=this.filters,n[i]=Mi(n[i],f,u,this.padding),n[o]=Mi(n[o],h,l,this.padding),n[s]=Mi(n[s],p,c,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e})(rv);eb.className="Conv3DTranspose";z.serialization.registerClass(eb);var m3=(function(r){be(e,r);function e(t,n){var a=r.call(this,t,n)||this;if(a.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,n.filters==null)throw new ce("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new ce("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new ce("SeparableConv"+a.rank+"D supports only padding modes: "+("'same' and 'valid', but received "+JSON.stringify(n.padding)));return a.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,a.depthwiseInitializer=br(n.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=wr(n.depthwiseRegularizer),a.depthwiseConstraint=jr(n.depthwiseConstraint),a.pointwiseInitializer=br(n.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=wr(n.pointwiseRegularizer),a.pointwiseConstraint=jr(n.pointwiseConstraint),a}return e.prototype.build=function(t){var n;if(t=zt(t),t.length<this.rank+2)throw new ce("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2+", but received input shape: ")+(""+JSON.stringify(t)));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null||t[a]<0)throw new ce("The channel dimension of the inputs should be defined, "+("but found "+JSON.stringify(t[a])));for(var i=t[a],o=this.kernelSize.concat([i,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(i*this.depthMultiplier,this.filters);var l=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,l,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,l,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,l,this.biasConstraint):this.bias=null,this.inputSpec=[new Vr({ndim:this.rank+2,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){t=gt(t);var i;if(a.rank===1)throw new wt("1D separable convolution is not implemented yet.");return a.rank===2&&(a.dataFormat==="channelsFirst"&&(t=F.transpose(t,[0,2,3,1])),i=F.separableConv2d(t,a.depthwiseKernel.read(),a.pointwiseKernel.read(),a.strides,a.padding,a.dilationRate,"NHWC")),a.useBias&&(i=gi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),a.dataFormat==="channelsFirst"&&(i=F.transpose(i,[0,3,1,2])),i})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Tr(this.depthwiseInitializer),t.pointwiseInitializer=Tr(this.pointwiseInitializer),t.depthwiseRegularizer=Ht(this.depthwiseRegularizer),t.pointwiseRegularizer=Ht(this.pointwiseRegularizer),t.depthwiseConstraint=Kr(this.depthwiseConstraint),t.pointwiseConstraint=Kr(this.pointwiseConstraint),t},e})(ev);m3.className="SeparableConv";var tb=(function(r){be(e,r);function e(t){return r.call(this,2,t)||this}return e})(m3);tb.className="SeparableConv2D";z.serialization.registerClass(tb);var rb=(function(r){be(e,r);function e(t){var n=r.call(this,1,t)||this;return e.verifyArgs(t),n.inputSpec=[{ndim:3}],n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!Gy(t.kernelSize,"number",1,1))throw new ce("Conv1D expects config.kernelSize to be number or number[] with "+("length 1, but received "+JSON.stringify(t.kernelSize)+"."))},e})(ev);rb.className="Conv1D";z.serialization.registerClass(rb);var nb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return typeof t.cropping=="number"?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){if(t=gt(t),a.dataFormat==="channelsLast"){var i=od(t,a.cropping[0][0],t.shape[1]-a.cropping[0][0]-a.cropping[0][1],2);return od(i,a.cropping[1][0],t.shape[2]-a.cropping[1][1]-a.cropping[1][0],3)}else{var i=od(t,a.cropping[0][0],t.shape[2]-a.cropping[0][0]-a.cropping[0][1],3);return od(i,a.cropping[1][0],t.shape[3]-a.cropping[1][1]-a.cropping[1][0],4)}})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);nb.className="Cropping2D";z.serialization.registerClass(nb);var ab=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=t.size==null?n.DEFAULT_SIZE:t.size,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Lr(n.dataFormat),n.interpolation=t.interpolation==null?"nearest":t.interpolation,y7(n.interpolation),n}return e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var n=t[2]==null?null:this.size[0]*t[2],a=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,a]}else{var n=t[1]==null?null:this.size[0]*t[1],a=t[2]==null?null:this.size[1]*t[2];return[t[0],n,a,t[3]]}},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=gt(t),o=i.shape;if(a.dataFormat==="channelsFirst"){i=F.transpose(i,[0,2,3,1]);var s=a.size[0]*o[2],u=a.size[1]*o[3],l=a.interpolation==="nearest"?F.image.resizeNearestNeighbor(i,[s,u]):F.image.resizeBilinear(i,[s,u]);return F.transpose(l,[0,3,1,2])}else{var s=a.size[0]*o[1],u=a.size[1]*o[2];return a.interpolation==="nearest"?F.image.resizeNearestNeighbor(i,[s,u]):F.image.resizeBilinear(i,[s,u])}})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);ab.className="UpSampling2D";z.serialization.registerClass(ab);function die(r,e,t,n,a,i){return t===void 0&&(t=[1,1]),n===void 0&&(n="valid"),z.tidy(function(){a==null&&(a=mi()),Lr(a);var o=Q0(r,a);if(r.rank!==4)throw new ce("Input for depthwiseConv2d is required to be 4-D, but is instead "+(r.rank+"-D"));if(e.rank!==4)throw new ce("depthwiseKernel is required to be 4-D, but is instead "+(e.rank+"-D"));return o=F.depthwiseConv2d(o,e,t,n==="same"?"same":"valid","NHWC",i),a==="channelsFirst"&&(o=F.transpose(o,[0,3,1,2])),o})}var ib=(function(r){be(e,r);function e(t){var n=r.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,n.depthwiseInitializer=br(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=jr(t.depthwiseConstraint),n.depthwiseRegularizer=wr(t.depthwiseRegularizer),n}return e.prototype.build=function(t){if(t=zt(t),t.length<4)throw new ce("Inputs to DepthwiseConv2D should have rank 4. "+("Received input shape: "+JSON.stringify(t)+"."));var n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new ce("The channel dimension of the inputs to DepthwiseConv2D should "+("be defined, but is not ("+t[n]+")."));var a=t[n],i=[this.kernelSize[0],this.kernelSize[1],a,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[a*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){t=gt(t);var i=die(t,a.depthwiseKernel.read(),a.strides,a.padding,a.dataFormat,null);return a.useBias&&(i=gi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),i})},e.prototype.computeOutputShape=function(t){t=zt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=di(n,this.kernelSize[0],this.padding,this.strides[0]),s=di(a,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,s]:[t[0],o,s,i]},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Tr(this.depthwiseInitializer),t.depthwiseRegularizer=Ht(this.depthwiseRegularizer),t.depthwiseConstraint=Kr(this.depthwiseRegularizer),t},e})(v3);ib.className="DepthwiseConv2D";z.serialization.registerClass(ib);function g3(r,e,t,n){if(Array.isArray(r)){if(e!=null||t!=null)throw new ce("When inputs is an array, neither initialState or constants should be provided");n!=null&&(t=r.slice(r.length-n,r.length),r=r.slice(0,r.length-n)),r.length>1&&(e=r.slice(1,r.length)),r=r[0]}function a(i){return i==null||Array.isArray(i)?i:[i]}return e=a(e),t=a(t),{inputs:r,initialState:e,constants:t}}function y3(r,e,t,n,a,i,o,s){return n===void 0&&(n=!1),o===void 0&&(o=!1),s===void 0&&(s=!1),F.tidy(function(){var u=e.shape.length;if(u<3)throw new ce("Input should be at least 3D, but is "+u+"D.");var l=[1,0].concat(vi(2,u));if(e=F.transpose(e,l),i!=null)throw new wt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=F.cast(F.cast(a,"bool"),"float32"),a.rank===u-1&&(a=F.expandDims(a,-1)),a=F.transpose(a,l)),n&&(e=F.reverse(e,0),a!=null&&(a=F.reverse(a,0)));var c=[],f,h=t,p=e.shape[0],d=F.unstack(e),v;a!=null&&(v=F.unstack(a));for(var m=function(w){var k=d[w],S=F.tidy(function(){return r(k,h)});if(a==null)f=S[0],h=S[1];else{var E=F.tidy(function(){var N=v[w],C=F.sub(F.onesLike(N),N),R=F.add(F.mul(S[0],N),F.mul(h[0],C)),_=h.map(function(O,P){return F.add(F.mul(S[1][P],N),F.mul(O,C))});return{output:R,newStates:_}});f=E.output,h=E.newStates}s&&c.push(f)},g=0;g<p;++g)m(g);var y;if(s){var b=1;y=F.stack(c,b)}return[f,y,h]})}var co=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this,a;if(t.cell==null)throw new ce("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?a=new iv({cells:t.cell}):a=t.cell,a.stateSize==null)throw new ce("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return n.cell=a,n.returnSequences=t.returnSequences==null?!1:t.returnSequences,n.returnState=t.returnState==null?!1:t.returnState,n.goBackwards=t.goBackwards==null?!1:t.goBackwards,n._stateful=t.stateful==null?!1:t.stateful,n.unroll=t.unroll==null?!1:t.unroll,n.supportsMasking=!0,n.inputSpec=[new Vr({ndim:3})],n.stateSpec=null,n.states_=null,n.numConstants=null,n.keptStates=[],n}return e.prototype.getStates=function(){if(this.states_==null){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return vi(0,t).map(function(n){return null})}else return this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){var n,a;Ty(t)&&(t=t[0]),t=t;var i=this.cell.stateSize;Array.isArray(i)||(i=[i]);var o=i[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){var u=[];try{for(var l=ke(i),c=l.next();!c.done;c=l.next()){var f=c.value;u.push([t[0],f])}}catch(h){n={error:h}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return[s].concat(u)}else return s},e.prototype.computeMask=function(t,n){var a=this;return F.tidy(function(){Array.isArray(n)&&(n=n[0]);var i=a.returnSequences?n:null;if(a.returnState){var o=a.states.map(function(s){return null});return[i].concat(o)}else return i})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[],a=0;a<t;++a)n.push(null);return n}else return this.states_},set:function(t){this.states_=t},enumerable:!0,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new wt("Constants support is not implemented in RNN yet.");Ty(t)&&(t=t[0]),t=t;var n=this.stateful?t[0]:null,a=t.slice(2);this.inputSpec[0]=new Vr({shape:pt([n,null],a)});var i=[t[0]].concat(t.slice(2));this.cell.build(i);var o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!z.util.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new ce("An initialState was passed that is not compatible with "+("cell.stateSize. Received stateSpec="+this.stateSpec+"; ")+("However cell.stateSize is "+this.cell.stateSize))}else this.stateSpec=o.map(function(s){return new Vr({shape:[null,s]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),z.tidy(function(){if(!a.stateful)throw new $o("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape[0];if(i==null)throw new ce("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.states_==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(c){return F.zeros([i,c])}):a.states_=[F.zeros([i,a.cell.stateSize])];else if(t==null)F.dispose(a.states_),a.keptStates!=null&&(F.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(c){return F.zeros([i,c])}):a.states_[0]=F.zeros([i,a.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new ce("Layer "+a.name+" expects "+a.states_.length+" state(s), "+("but it received "+t.length+" state value(s). Input ")+("received: "+t));n===!0?a.keptStates.push(a.states_.slice()):F.dispose(a.states_);for(var o=0;o<a.states_.length;++o){var s=t[o],u=Array.isArray(a.cell.stateSize)?a.cell.stateSize[o]:a.cell.stateSize,l=[i,u];if(!z.util.arraysEqual(s.shape,l))throw new ce("State "+o+" is incompatible with layer "+a.name+": "+("expected shape="+l+", received shape="+s.shape));a.states_[o]=s}}a.states_=a.states_.map(function(c){return F.keep(c.clone())})})},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=g3(t,o,s,this.numConstants);t=u.inputs,o=u.initialState,s=u.constants;var l=[],c=[];if(o!=null){n.initialState=o,l=l.concat(o),this.stateSpec=[];try{for(var f=ke(o),h=f.next();!h.done;h=f.next()){var p=h.value;this.stateSpec.push(new Vr({shape:p.shape}))}}catch(b){a={error:b}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}c=c.concat(this.stateSpec)}s!=null&&(n.constants=s,l=l.concat(s),this.numConstants=s.length);var d=l[0]instanceof hi;if(d){var v=[t].concat(l),m=this.inputSpec.concat(c),g=this.inputSpec;this.inputSpec=m;var y=r.prototype.apply.call(this,v,n);return this.inputSpec=g,y}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;t=gt(t),s==null&&(a.stateful?s=a.states_:s=a.getInitialState(t));var u=Array.isArray(a.cell.stateSize)?a.cell.stateSize.length:1;if(s.length!==u)throw new ce("RNN Layer has "+u+" state(s) but was passed "+(s.length+" initial state(s)."));a.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var l={training:o},c=function(m,g){var y=a.cell.call([m].concat(g),l);return[y[0],y.slice(1)]},f=y3(c,t,s,a.goBackwards,i,null,a.unroll,a.returnSequences),h=f[0],p=f[1],d=f[2];a.stateful&&a.resetStates(d,o);var v=a.returnSequences?p:h;return a.returnState?[v].concat(d):v})},e.prototype.getInitialState=function(t){var n=this;return z.tidy(function(){var a=F.zeros(t.shape);return a=F.sum(a,[1,2]),a=Mf(a),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(i){return i>1?Sy(a,[1,i]):a}):n.cell.stateSize>1?[Sy(a,[1,n.cell.stateSize])]:[a]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);var a=this.cell.getConfig();return this.getClassName()===e.className&&(n.cell={className:this.cell.getClassName(),config:a}),Object.assign({},a,t,n)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.cell,o=pi(i,a);return new t(Object.assign(n,{cell:o}))},e})(Tt);co.className="RNN";z.serialization.registerClass(co);var xl=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(Tt),nv=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,Qr(n.units,"units"),n.activation=Ho(t.activation==null?n.DEFAULT_ACTIVATION:t.activation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=br(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=br(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=br(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=wr(t.kernelRegularizer),n.recurrentRegularizer=wr(t.recurrentRegularizer),n.biasRegularizer=wr(t.biasRegularizer),n.kernelConstraint=jr(t.kernelConstraint),n.recurrentConstraint=jr(t.recurrentConstraint),n.biasConstraint=jr(t.biasConstraint),n.dropout=fl([1,Uo([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=fl([1,Uo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=zt(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){if(t=t,t.length!==2)throw new ce("SimpleRNNCell expects 2 input Tensors, got "+t.length+".");var i=t[1];t=t[0];var o=n.training==null?!1:n.training;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=qo({ones:function(){return F.onesLike(t)},rate:a.dropout,training:o,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=qo({ones:function(){return F.onesLike(i)},rate:a.recurrentDropout,training:o,dropoutFunc:a.dropoutFunc}));var s,u=a.dropoutMask,l=a.recurrentDropoutMask;u!=null?s=Pi(F.mul(t,u),a.kernel.read()):s=Pi(t,a.kernel.read()),a.bias!=null&&(s=gi(s,a.bias.read())),l!=null&&(i=F.mul(i,l));var c=F.add(s,Pi(i,a.recurrentKernel.read()));return a.activation!=null&&(c=a.activation.apply(c)),[c,c]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:Go(this.activation),useBias:this.useBias,kernelInitializer:Tr(this.kernelInitializer),recurrentInitializer:Tr(this.recurrentInitializer),biasInitializer:Tr(this.biasInitializer),kernelRegularizer:Ht(this.kernelRegularizer),recurrentRegularizer:Ht(this.recurrentRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Kr(this.kernelConstraint),recurrentConstraint:Kr(this.recurrentConstraint),biasConstraint:Kr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},t,n)},e})(xl);nv.className="SimpleRNNCell";z.serialization.registerClass(nv);var ob=(function(r){be(e,r);function e(t){var n=this;return t.cell=new nv(t),n=r.call(this,t)||this,n}return e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.cell.dropoutMask!=null&&(F.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(F.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return new t(n)},e})(co);ob.className="SimpleRNN";z.serialization.registerClass(ob);var av=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;if(n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new ce("GRUCell does not support reset_after parameter set to true.");return n.units=t.units,Qr(n.units,"units"),n.activation=Ho(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Ho(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=br(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=br(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=br(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=wr(t.kernelRegularizer),n.recurrentRegularizer=wr(t.recurrentRegularizer),n.biasRegularizer=wr(t.biasRegularizer),n.kernelConstraint=jr(t.kernelConstraint),n.recurrentConstraint=jr(t.recurrentConstraint),n.biasConstraint=jr(t.biasConstraint),n.dropout=fl([1,Uo([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=fl([1,Uo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=zt(t);var n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){if(t=t,t.length!==2)throw new ce("GRUCell expects 2 input Tensors (inputs, h, c), got "+(t.length+"."));var i=n.training==null?!1:n.training,o=t[1];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=qo({ones:function(){return F.onesLike(t)},rate:a.dropout,training:i,count:3,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=qo({ones:function(){return F.onesLike(o)},rate:a.recurrentDropout,training:i,count:3,dropoutFunc:a.dropoutFunc}));var s=a.dropoutMask,u=a.recurrentDropoutMask,l,c,f;0<a.dropout&&a.dropout<1&&(t=F.mul(t,s[0]));var h=Pi(t,a.kernel.read());a.useBias&&(h=gi(h,a.bias.read())),0<a.recurrentDropout&&a.recurrentDropout<1&&(o=F.mul(o,u[0]));var p=a.recurrentKernel.read(),d=ye(F.split(p,[2*a.units,a.units],p.rank-1),2),v=d[0],m=d[1],g=Pi(o,v),y=ye(F.split(h,3,h.rank-1),3),b=y[0],w=y[1],k=y[2],S=ye(F.split(g,2,g.rank-1),2),E=S[0],N=S[1];l=a.recurrentActivation.apply(F.add(b,E)),c=a.recurrentActivation.apply(F.add(w,N));var C=Pi(F.mul(c,o),m);f=a.activation.apply(F.add(k,C));var R=F.add(F.mul(l,o),F.mul(F.add(1,F.neg(l)),f));return[R,R]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:Go(this.activation),recurrentActivation:Go(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Tr(this.kernelInitializer),recurrentInitializer:Tr(this.recurrentInitializer),biasInitializer:Tr(this.biasInitializer),kernelRegularizer:Ht(this.kernelRegularizer),recurrentRegularizer:Ht(this.recurrentRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Kr(this.kernelConstraint),recurrentConstraint:Kr(this.recurrentConstraint),biasConstraint:Kr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},t,n)},e})(xl);av.className="GRUCell";z.serialization.registerClass(av);var sb=(function(r){be(e,r);function e(t){var n=this;return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new av(t),n=r.call(this,t)||this,n}return e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.cell.dropoutMask!=null&&(F.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(F.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e})(co);sb.className="GRU";z.serialization.registerClass(sb);var Hf=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,Qr(n.units,"units"),n.activation=Ho(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Ho(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=br(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=br(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=br(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=wr(t.kernelRegularizer),n.recurrentRegularizer=wr(t.recurrentRegularizer),n.biasRegularizer=wr(t.biasRegularizer),n.kernelConstraint=jr(t.kernelConstraint),n.recurrentConstraint=jr(t.recurrentConstraint),n.biasConstraint=jr(t.biasConstraint),n.dropout=fl([1,Uo([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=fl([1,Uo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){var n;t=zt(t);var a=t[t.length-1];this.kernel=this.addWeight("kernel",[a,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,s=this.units;i=new(n=(function(u){be(l,u);function l(){return u!==null&&u.apply(this,arguments)||this}return l.prototype.apply=function(c,f){var h=o.apply([s]),p=new Ld().apply([s]),d=o.apply([s*2]);return KI(KI(h,p),d)},l})(Ga),n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){var i=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new ce("LSTMCell expects 3 input Tensors (inputs, h, c), got "+(t.length+"."));var o=t[1],s=t[2];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=qo({ones:function(){return F.onesLike(t)},rate:a.dropout,training:i,count:4,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=qo({ones:function(){return F.onesLike(o)},rate:a.recurrentDropout,training:i,count:4,dropoutFunc:a.dropoutFunc}));var u=a.dropoutMask,l=a.recurrentDropoutMask,c,f,h,p;0<a.dropout&&a.dropout<1&&(t=F.mul(t,u[0]));var d=Pi(t,a.kernel.read());0<a.recurrentDropout&&a.recurrentDropout<1&&(o=F.mul(o,l[0])),d=F.add(d,Pi(o,a.recurrentKernel.read())),a.useBias&&(d=gi(d,a.bias.read()));var v=ye(F.split(d,4,d.rank-1),4),m=v[0],g=v[1],y=v[2],b=v[3];c=a.recurrentActivation.apply(m),f=a.recurrentActivation.apply(g),h=F.add(F.mul(f,s),F.mul(c,a.activation.apply(y))),p=a.recurrentActivation.apply(b);var w=F.mul(p,a.activation.apply(h));return[w,w,h]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:Go(this.activation),recurrentActivation:Go(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Tr(this.kernelInitializer),recurrentInitializer:Tr(this.recurrentInitializer),biasInitializer:Tr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ht(this.kernelRegularizer),recurrentRegularizer:Ht(this.recurrentRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Kr(this.kernelConstraint),recurrentConstraint:Kr(this.recurrentConstraint),biasConstraint:Kr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},t,n)},e})(xl);Hf.className="LSTMCell";z.serialization.registerClass(Hf);var ub=(function(r){be(e,r);function e(t){var n=this;return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Hf(t),n=r.call(this,t)||this,n}return e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.cell.dropoutMask!=null&&(F.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(F.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e})(co);ub.className="LSTM";z.serialization.registerClass(ub);var iv=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.cells=t.cells,n}return Object.defineProperty(e.prototype,"stateSize",{get:function(){var t,n,a=[];try{for(var i=ke(this.cells.slice().reverse()),o=i.next();!o.done;o=i.next()){var s=o.value;Array.isArray(s.stateSize)?a.push.apply(a,pt(s.stateSize)):a.push(s.stateSize)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!0,configurable:!0}),e.prototype.call=function(t,n){var a=this;return z.tidy(function(){var i,o,s,u;t=t;var l=t.slice(1),c=[];try{for(var f=ke(a.cells.slice().reverse()),h=f.next();!h.done;h=f.next()){var p=h.value;Array.isArray(p.stateSize)?c.push(l.splice(0,p.stateSize.length)):c.push(l.splice(0,1))}}catch(w){i={error:w}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}c.reverse();for(var d=[],v,m=0;m<a.cells.length;++m){var p=a.cells[m];l=c[m],m===0?v=[t[0]].concat(l):v=[v[0]].concat(l),v=p.call(v,n),d.push(v.slice(1))}l=[];try{for(var g=ke(d.slice().reverse()),y=g.next();!y.done;y=g.next()){var b=y.value;l.push.apply(l,pt(b))}}catch(w){s={error:w}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}return[v[0]].concat(l)})},e.prototype.build=function(t){Ty(t)&&(t=t[0]),t=t;var n;this.cells.forEach(function(a,i){Bs("RNNCell_"+i,function(){a.build(t),Array.isArray(a.stateSize)?n=a.stateSize[0]:n=a.stateSize,t=[t[0],n]})}),this.built=!0},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n=function(o){return{className:o.getClassName(),config:o.getConfig()}},a=this.cells.map(n),i={cells:a};return Object.assign({},t,i)},e.fromConfig=function(t,n,a){var i,o;a===void 0&&(a={});var s=[];try{for(var u=ke(n.cells),l=u.next();!l.done;l=u.next()){var c=l.value;s.push(pi(c,a))}}catch(f){i={error:f}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return new t({cells:s})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(!this.trainable)return[];var a=[];try{for(var i=ke(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,pt(s.trainableWeights))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=ke(this.cells),u=s.next();!u.done;u=s.next()){var l=u.value;o.push.apply(o,pt(l.nonTrainableWeights))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var c=[];try{for(var f=ke(this.cells),h=f.next();!h.done;h=f.next()){var l=h.value;c.push.apply(c,pt(l.trainableWeights))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return c.concat(o)}return o},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){var t,n,a=[];try{for(var i=ke(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,pt(s.weights))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return Iy(a)},e.prototype.setWeights=function(t){var n,a,i=[];try{for(var o=ke(this.cells),s=o.next();!s.done;s=o.next())for(var u=s.value,l=u.weights.length,c=t.splice(l),f=0;f<u.weights.length;++f)i.push([u.weights[f],c[f]])}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}Jy(i)},e})(xl);iv.className="StackedRNNCells";z.serialization.registerClass(iv);function qo(r){var e=r.ones,t=r.rate,n=r.training,a=n===void 0?!1:n,i=r.count,o=i===void 0?1:i,s=r.dropoutFunc,u=function(){return s!=null?s(e(),t):iC(e(),t)},l=function(){return Pf(u,e,a)};if(!o||o<=1)return F.keep(l().clone());var c=Array(o).fill(void 0).map(l);return c.map(function(f){return F.keep(f.clone())})}var vie=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t};(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(xl);var b3=(function(r){be(e,r);function e(t){var n=this;if(t.unroll)throw new wt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new wt("It is not possible at the moment to stack convolutional cells.");return n=r.call(this,t)||this,n.inputSpec=[new Vr({ndim:5})],n}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(a.cell.dropoutMask!=null&&(F.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(F.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null),n&&n.constants)throw new ce("ConvRNN2D cell does not support constants");var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.prototype.computeOutputShape=function(t){var n=this.computeSingleOutputShape(t);return this.returnSequences||(n=pt([n[0]],n.slice(2))),this.returnState&&(n=pt([n],Array(2).fill(pt([t[0]],n.slice(-3))))),n},e.prototype.getInitialState=function(t){var n=this;return F.tidy(function(){var a=n.cell.stateSize,i=t.shape,o=n.computeSingleOutputShape(i),s=pt([o[0]],o.slice(2)),u=F.zeros(s);return Array.isArray(a)?Array(a.length).fill(u):[u]})},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),F.tidy(function(){if(!a.stateful)throw new $o("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape,o=a.computeSingleOutputShape(i),s=pt([o[0]],o.slice(2)),u=i[0];if(u==null)throw new ce("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.getStates()==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return F.zeros(s)}):a.states_=[F.zeros(s)];else if(t==null)F.dispose(a.states_),a.keptStates!=null&&(F.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return F.zeros(s)}):a.states_[0]=F.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new ce("Layer "+a.name+" expects "+a.states_.length+" state(s), "+("but it received "+t.length+" state value(s). Input ")+("received: "+t));n?a.keptStates.push(a.states_.slice()):F.dispose(a.states_);for(var l=0;l<a.states_.length;++l){var c=t[l],f=s;if(!z.util.arraysEqual(c.shape,f))throw new ce("State "+l+" is incompatible with layer "+a.name+": "+("expected shape="+f+", received shape="+c.shape));a.states_[l]=c}}a.states_=a.states_.map(function(h){return F.keep(h.clone())})})},e.prototype.computeSingleOutputShape=function(t){var n=this.cell,a=n.dataFormat,i=n.filters,o=n.kernelSize,s=n.padding,u=n.strides,l=n.dilationRate,c=a==="channelsFirst",f=t[c?3:2],h=t[c?4:3],p=di(f,o[0],s,u[0],l[0]),d=di(h,o[1],s,u[1],l[1]),v=pt(t.slice(0,2),c?[i,p,d]:[p,d,i]);return v},e})(co);b3.className="ConvRNN2D";var ov=(function(r){be(e,r);function e(t){var n=this,a=t.filters,i=t.kernelSize,o=t.strides,s=t.padding,u=t.dataFormat,l=t.dilationRate;return n=r.call(this,Object.assign({},t,{units:a}))||this,n.filters=a,Qr(n.filters,"filters"),n.kernelSize=cl(i,2,"kernelSize"),n.kernelSize.forEach(function(c){return Qr(c,"kernelSize")}),n.strides=cl(o||1,2,"strides"),n.strides.forEach(function(c){return Qr(c,"strides")}),n.padding=s||"valid",xa(n.padding),n.dataFormat=u||"channelsLast",Lr(n.dataFormat),n.dilationRate=cl(l||1,2,"dilationRate"),n.dilationRate.forEach(function(c){return Qr(c,"dilationRate")}),n}return e.prototype.build=function(t){var n;t=zt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new ce("The channel dimension of the input should be defined. "+("Found "+t[a]));var i=t[a],o=4,s=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var u=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var l=void 0;if(this.unitForgetBias){var c=this.biasInitializer,f=this.filters;l=new(n=(function(h){be(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.prototype.apply=function(d,v){var m=c.apply([f]),g=F.ones([f]),y=c.apply([f*2]);return Hy([m,g,y])},p})(Ga),n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t.length!==3)throw new ce("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+(t.length+"."));var i=n.training||!1,o=t[0],s=t[1],u=t[2],l=4;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=qo({ones:function(){return F.onesLike(o)},rate:a.dropout,training:i,count:l,dropoutFunc:a.dropoutFunc}));var c=a.dropoutMask,f=function(le,de,we){return!de||!de[we]?le:F.mul(de[we],le)},h=f(o,c,0),p=f(o,c,1),d=f(o,c,2),v=f(o,c,3);0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=qo({ones:function(){return F.onesLike(s)},rate:a.recurrentDropout,training:i,count:l,dropoutFunc:a.dropoutFunc}));var m=a.recurrentDropoutMask,g=f(s,m,0),y=f(s,m,1),b=f(s,m,2),w=f(s,m,3),k=3,S=ye(F.split(a.kernel.read(),l,k),4),E=S[0],N=S[1],C=S[2],R=S[3],_=ye(a.useBias?F.split(a.bias.read(),l):[null,null,null,null],4),O=_[0],P=_[1],B=_[2],W=_[3];h=a.inputConv(h,E,O,a.padding),p=a.inputConv(p,N,P,a.padding),d=a.inputConv(d,C,B,a.padding),v=a.inputConv(v,R,W,a.padding);var L=ye(F.split(a.recurrentKernel.read(),l,k),4),G=L[0],M=L[1],$=L[2],K=L[3];g=a.recurrentConv(g,G),y=a.recurrentConv(y,M),b=a.recurrentConv(b,$),w=a.recurrentConv(w,K);var j=a.recurrentActivation.apply(F.add(h,g)),te=a.recurrentActivation.apply(F.add(p,y)),Q=F.add(F.mul(te,u),F.mul(j,a.activation.apply(F.add(d,b)))),ie=F.mul(a.recurrentActivation.apply(F.add(v,w)),a.activation.apply(Q));return[ie,ie,Q]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);t.units;var n=vie(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,a)},e.prototype.inputConv=function(t,n,a,i){var o=F.conv2d(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return a?gi(o,a,this.dataFormat):o},e.prototype.recurrentConv=function(t,n){var a=1;return F.conv2d(t,n,a,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")},e})(Hf);ov.className="ConvLSTM2DCell";F.serialization.registerClass(ov);var lb=(function(r){be(e,r);function e(t){var n=this,a=new ov(t);return n=r.call(this,Object.assign({},t,{cell:a}))||this,n}return e.fromConfig=function(t,n){return new t(n)},e})(b3);lb.className="ConvLSTM2D";F.serialization.registerClass(lb);var sv=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var n=t.shape,a=[],i=0;i<this.noiseShape.length;++i)a.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return a},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n);var i=gt(t);if(0<a.rate&&a.rate<1){var o=n.training==null?!1:n.training,s=a.getNoiseShape(i),u=Pf(function(){return iC(i,a.rate,s,a.seed)},function(){return i},o);return u}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.dispose=function(){return r.prototype.dispose.call(this)},e})(Tt);sv.className="Dropout";z.serialization.registerClass(sv);var cb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[{ndim:3}],n}return e.prototype.getNoiseShape=function(t){var n=t.shape;return[n[0],1,n[2]]},e})(sv);cb.className="SpatialDropout1D";z.serialization.registerClass(cb);var fb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var a=null;t.batchSize!=null&&(a=t.batchSize),n.batchInputShape=[a,t.inputDim]}return n.units=t.units,Qr(n.units,"units"),n.activation=Ho(t.activation),t.useBias!=null&&(n.useBias=t.useBias),n.kernelInitializer=br(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=br(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=jr(t.kernelConstraint),n.biasConstraint=jr(t.biasConstraint),n.kernelRegularizer=wr(t.kernelRegularizer),n.biasRegularizer=wr(t.biasRegularizer),n.activityRegularizer=wr(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return e.prototype.build=function(t){var n;t=zt(t);var a=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[a,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=a,n)}],this.built=!0},e.prototype.computeOutputShape=function(t){t=zt(t);var n=t.slice();return n[n.length-1]=this.units,n},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n);var i=gt(t),o=QN(a.activation.getClassName()),s;return o!=null?s=Pi(i,a.kernel.read(),o,a.bias?a.bias.read():null):(s=Pi(i,a.kernel.read()),a.bias!=null&&(s=gi(s,a.bias.read())),a.activation!=null&&(s=a.activation.apply(s))),s})},e.prototype.getConfig=function(){var t={units:this.units,activation:Go(this.activation),useBias:this.useBias,kernelInitializer:Tr(this.kernelInitializer),biasInitializer:Tr(this.biasInitializer),kernelRegularizer:Ht(this.kernelRegularizer),biasRegularizer:Ht(this.biasRegularizer),activityRegularizer:Ht(this.activityRegularizer),kernelConstraint:Kr(this.kernelConstraint),biasConstraint:Kr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);fb.className="Dense";z.serialization.registerClass(fb);var hb=(function(r){be(e,r);function e(t){var n=this;return t=t||{},n=r.call(this,t)||this,n.inputSpec=[{minNDim:3}],n.dataFormat=t.dataFormat,n}return e.prototype.computeOutputShape=function(t){var n,a;t=zt(t);try{for(var i=ke(t.slice(1)),o=i.next();!o.done;o=i.next()){var s=o.value;if(s==null)throw new ce('The shape of the input to "Flatten" is not fully defined '+("(got "+t.slice(1)+"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}return[t[0],Vo(t,1)]},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n);var i=gt(t);if(a.dataFormat==="channelsFirst"&&i.rank>1){for(var o=[0],s=2;s<i.rank;++s)o.push(s);o.push(1),i=z.transpose(i,o)}return E7(i)})},e.prototype.getConfig=function(){var t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);var n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);hb.className="Flatten";z.serialization.registerClass(hb);var pb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.activation=Ho(t.activation),n}return e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n);var i=gt(t);return a.activation.apply(i)})},e.prototype.getConfig=function(){var t={activation:Go(this.activation)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);pb.className="Activation";z.serialization.registerClass(pb);var db=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){return t=gt(t),k7(t,a.n)})},e.prototype.getConfig=function(){var t={n:this.n},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);db.className="RepeatVector";z.serialization.registerClass(db);var vb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;n.targetShape=t.targetShape;for(var a=0;a<n.targetShape.length;++a)n.isUnknown(n.targetShape[a])&&(n.targetShape[a]=null);return n}return e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,n){for(var a="Total size of new array must be unchanged.",i=n.slice(),o=1,s=null,u=0;u<i.length;++u){var l=i[u];if(this.isUnknown(l))if(s===null)s=u;else throw new ce("Can only specifiy one unknown dimension.");else o*=l}var c=Vo(t);if(s!==null){if(o===0||c%o!==0)throw new ce(a);i[s]=c/o}else if(c!==o)throw new ce(a);return i},e.prototype.computeOutputShape=function(t){for(var n=!1,a=0;a<t.length;++a)if(this.isUnknown(t[a])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n);var i=gt(t),o=i.shape,s=o.slice(0,1).concat(a.fixUnknownDimension(o.slice(1),a.targetShape));return z.reshape(i,s)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);vb.className="Reshape";z.serialization.registerClass(vb);var mb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+(t.dims+" instead."));var a=vi(1,t.dims.length+1);if(!z.util.arraysEqual(t.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new Vr({ndim:n.dims.length+1})],n}return e.prototype.computeOutputShape=function(t){t=zt(t);var n=t.slice();return this.dims.forEach(function(a,i){n[i+1]=t[a]}),n},e.prototype.call=function(t,n){return z.transpose(gt(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);mb.className="Permute";z.serialization.registerClass(mb);var gb=(function(r){be(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null?n.maskValue=t.maskValue==null?0:t.maskValue:n.maskValue=0,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},e.prototype.computeMask=function(t,n){var a=gt(t),i=-1;return z.any(z.notEqual(a,this.maskValue),i)},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n);var i=gt(t),o=-1,s=!0,u=z.any(z.notEqual(i,a.maskValue),o,s),l=z.mul(i,z.cast(u,i.dtype));return l})},e})(Tt);gb.className="Masking";z.serialization.registerClass(gb);var yb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var a=null;t.batchSize!=null&&(a=t.batchSize),t.inputLength==null?n.batchInputShape=[a,null]:n.batchInputShape=[a].concat(sr(t.inputLength))}return n.inputDim=t.inputDim,Qr(n.inputDim,"inputDim"),n.outputDim=t.outputDim,Qr(n.outputDim,"outputDim"),n.embeddingsInitializer=br(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=wr(t.embeddingsRegularizer),n.activityRegularizer=wr(t.activityRegularizer),n.embeddingsConstraint=jr(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,n){var a=this;return z.tidy(function(){return a.maskZero?(t=gt(t),z.notEqual(t,z.zerosLike(t))):null})},e.prototype.computeOutputShape=function(t){if(t=zt(t),this.inputLength==null)return pt(t,[this.outputDim]);var n=sr(this.inputLength);if(n.length!==t.length-1)throw new ce('"inputLength" is '+this.inputLength+", but received "+("input shape has shape "+t));for(var a=0,i=0;i<n.length;++i){var o=n[i],s=t[i+1];if(o!=null&&s!=null&&o!==s)throw new ce('"inputLength" is '+this.inputLength+", but received "+("input shape has shape "+t));o==null&&(n[a]=s),a++}return pt([t[0]],n,[this.outputDim])},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n);var i=gt(t);i.dtype!=="int32"&&(i=Rf(i,"int32"));var o=aC(a.embeddings.read(),z.reshape(i,[i.size]));return z.reshape(o,zt(a.computeOutputShape(i.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Tr(this.embeddingsInitializer),embeddingsRegularizer:Ht(this.embeddingsRegularizer),activityRegularizer:Ht(this.activityRegularizer),embeddingsConstraint:Kr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);yb.className="Embedding";z.serialization.registerClass(yb);var Qs=(function(r){be(e,r);function e(t){var n=r.call(this,t||{})||this;return n.supportsMasking=!0,n}return e.prototype.mergeFunction=function(t){throw new wt},e.prototype.computeElementwiseOpOutputShape=function(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;for(var a=t.slice(0,t.length-n.length),i=0;i<n.length;++i){var o=t[t.length-n.length+i],s=n[i];if(o==null||s==null||o<0||s<0)a.push(null);else if(o===1)a.push(s);else if(s===1)a.push(o);else{if(o!==s)throw new ce("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));a.push(o)}}return a},e.prototype.build=function(t){var n,a;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[zt(t)]),t=t,t.length<2)throw new ce("A merge layer should be called on an Array of at least 2 inputs."+(" Got "+t.length+" input(s)."));var i=[];try{for(var o=ke(t),s=o.next();!s.done;s=o.next()){var u=s.value;u!=null&&u[0]!==null&&i.push(u[0])}}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}if(i=Wo(i),i.length>1)throw new ce("Can not merge tensors with different batch sizes. "+("Got tensors with shapes: "+JSON.stringify(t)+"."));for(var l=t[0]==null?null:t[0].slice(1),c=1;c<t.length;++c){var u=t[c]==null?null:t[c].slice(1);l=this.computeElementwiseOpOutputShape(l,u)}var f=t.map(function(h){return h.length});t.indexOf(null)===-1&&Wo(f).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){var i,o,s,u;if(t=t,a.reshapeRequired){var l=[],c=t.map(function(P){return P.rank});if(c.indexOf(null)===-1){var f=Uo(c);try{for(var h=ke(t),p=h.next();!p.done;p=h.next()){for(var d=p.value,v=d.rank,m=0;m<f-v;++m)d=Mf(d,1);l.push(d)}}catch(P){i={error:P}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a.mergeFunction(l)}else{var g=!1;try{for(var y=ke(t),b=y.next();!b.done;b=y.next()){var d=b.value,v=d.rank;if(v==null){var w=d.shape,k=w[0],S=w.slice(1).concat([k]),E=F.reshape(d,[k].concat(Vo(w.slice(1))));E=F.transpose(E,[1,0]),E=F.reshape(E,S),l.push(E),g=!0}else if(v>1){var N=vi(1,v).concat([0]);l.push(F.transpose(d,N)),g=!0}else l.push(d)}}catch(P){s={error:P}}finally{try{b&&!b.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}var C=a.mergeFunction(l),R=C.rank;if(g){if(R==null){var _=C.shape,O=_.length,k=_[O-1],S=[k].concat(_.slice(0,_.length-1));C=F.reshape(F.transpose(F.reshape(C,[-1,k]),[1,0]),S)}else if(R>1){var N=[R-1].concat(vi(0,R-1));C=F.transpose(C,N)}}return C}}else return a.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var n,a;t=t;var i;t[0]==null?i=null:i=t[0].slice(1);for(var o=1;o<t.length;++o){var s=t[o]==null?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=[];try{for(var l=ke(t),c=l.next();!c.done;c=l.next()){var s=c.value;s!=null&&s[0]!==null&&u.push(s[0])}}catch(f){n={error:f}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return u=Wo(u),u.length===1?i=u.concat(i):i=[null].concat(i),i},e.prototype.computeMask=function(t,n){return F.tidy(function(){if(n==null)return null;if(!Array.isArray(n))throw new ce("`mask` should be an Array");if(!Array.isArray(t))throw new ce("`inputs` should be an Array");if(n.length!==t.length)throw new ce("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+("("+t.length+" vs "+n.length+")"));if(n.every(function(o){return o==null}))return null;n=n.map(function(o){return o==null?o:F.expandDims(o,0)});for(var a=n[0],i=1;i<n.length-1;++i)a=F.logicalAnd(a,n[i]);return a})},e})(Tt),bb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return z.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=F.add(n,t[a]);return n})},e})(Qs);bb.className="Add";z.serialization.registerClass(bb);var wb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return z.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=F.mul(n,t[a]);return n})},e})(Qs);wb.className="Multiply";z.serialization.registerClass(wb);var xb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return z.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=F.add(n,t[a]);return F.mul(1/t.length,n)})},e})(Qs);xb.className="Average";z.serialization.registerClass(xb);var kb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return z.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=F.maximum(n,t[a]);return n})},e})(Qs);kb.className="Maximum";z.serialization.registerClass(kb);var Sb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return z.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=F.minimum(n,t[a]);return n})},e})(Qs);Sb.className="Minimum";z.serialization.registerClass(Sb);var Eb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_AXIS=-1,t==null&&(t={}),n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){var n,a,i,o;if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new ce("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var s=!0;try{for(var u=ke(t),l=u.next();!l.done;l=u.next()){var c=l.value;if(c!=null){s=!1;break}}}catch(g){n={error:g}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}if(!s){for(var f=[],h=0;h<t.length;++h){var p=t[h].slice();p.splice(this.axis,1);var d=!1;try{for(var v=(i=void 0,ke(f)),m=v.next();!m.done;m=v.next()){var c=m.value;if(z.util.arraysEqual(c,p)){d=!0;break}}}catch(g){i={error:g}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}d||f.push(p)}if(f.length>1)throw new ce("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var n=this;return z.tidy(function(){return Hy(t,n.axis)})},e.prototype.computeOutputShape=function(t){var n,a;if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new ce("A `Concatenate` layer should be called on a list of inputs.");var i=t,o=i[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;try{for(var u=ke(i.slice(1)),l=u.next();!l.done;l=u.next()){var c=l.value;if(o[s]==null||c[s]==null){o[s]=null;break}o[s]+=c[s]}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}return o},e.prototype.computeMask=function(t,n){var a=this;if(n==null)return null;if(!Array.isArray(n))throw new ce("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new ce("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new ce("Mismatch in the length of mask ("+n.length+") "+("and the legnth of inputs ("+t.length+")"));return F.tidy(function(){var i=!0;if(n.forEach(function(l){if(l!=null){i=!1;return}}),i)return null;for(var o=[],s=0;s<t.length;++s)n[s]==null?o.push(F.cast(F.onesLike(t[s]),"bool")):n[s].rank<t[s].rank?o.push(F.expandDims(n[s],-1)):o.push(n[s]);var u=F.concat(o,a.axis);return F.all(u,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Qs);Eb.className="Concatenate";z.serialization.registerClass(Eb);function df(r,e){for(;r<0;)r+=e;return r}function mie(r,e,t){if(r.shape.length>3||e.shape.length>3)throw new wt("batchDot is not implemented for tensors of 4D or higher rank yet");if(F.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, "+("but got "+r.shape.length)}),F.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, "+("but got "+e.shape.length)}),typeof t=="number"&&(t=[t,t]),r.dtype==="complex64"||e.dtype==="complex64")throw new wt("batchDot is not implemented for complex64-type Tensors yet.");var n=r.shape.length,a=e.shape.length;t==null&&(t=[n-1,a-2]);var i=t;return F.tidy(function(){var o;if(n>a){o=n-a;for(var s=[],u=0;u<o;++u)s.push(1);e=F.reshape(e,e.shape.concat(s))}else if(a>n){o=a-n;for(var s=[],u=0;u<o;++u)s.push(1);r=F.reshape(r,r.shape.concat(s))}else o=0;var l;if(r.shape.length===2&&e.shape.length===2)i[0]===i[1]?l=F.sum(F.mul(r,e),i[0]):l=F.sum(F.mul(F.transpose(r,[1,0]),e),i[1]);else{var c=i[0]!==r.shape.length-1,f=i[1]===e.shape.length-1;l=F.matMul(r,e,c,f)}if(o>0){var h=void 0;n>a?h=n+a-3:h=n-1;for(var p=[],u=h;u<h+o;++u)p.push(u);l=F.squeeze(l,p)}return l.shape.length===1&&(l=F.expandDims(l,1)),l})}var Tb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.axes=t.axes,n.normalize=t.normalize==null?!1:t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){F.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0],a=t[1];if(n.length>3||a.length>3)throw new wt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);if(n[i[0]]!==a[i[1]])throw new ce("Dimension incompatibility: "+(n[i[0]]+" !== "+a[i[1]]))},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new ce("A `Dot` layer must be called on exactly 2 inputs, "+("but received "+t.length+" input(s)."));var n=t[0],a=t[1],i;return Array.isArray(this.axes)?i=this.axes.map(function(o,s){return df(o,t[s].shape.length)}):i=[df(this.axes,n.shape.length),df(this.axes,a.shape.length)],this.normalize&&(n=_d(n,i[0]),a=_d(a,i[1])),mie(n,a,i)},e.prototype.interpretAxes=function(t,n){var a;return Array.isArray(this.axes)?a=this.axes:a=[df(this.axes,t.length),df(this.axes,n.length)],a},e.prototype.computeOutputShape=function(t){F.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0].slice(),a=t[1].slice();if(n.length>3||a.length>3)throw new wt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);n.splice(i[0],1),a.splice(i[1],1),a.splice(0,1);var o=n.concat(a);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,n){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Qs);Tb.className="Dot";z.serialization.registerClass(Tb);var Ib=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n);var i=gt(t),o=function(){return z.add(Pd(i.shape,0,a.stddev),i)},s=Pf(o,function(){return i},n.training||!1);return s})},e})(Tt);Ib.className="GaussianNoise";z.serialization.registerClass(Ib);var Nb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n);var i=gt(t);if(a.rate>0&&a.rate<1){var o=function(){var s=Math.sqrt(a.rate/(1-a.rate));return z.mul(i,Pd(i.shape,1,s))};return Pf(o,function(){return i},n.training||!1)}return i})},e})(Tt);Nb.className="GaussianDropout";z.serialization.registerClass(Nb);var Cb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return e.prototype._getNoiseShape=function(t){return this.noiseShape||gt(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){if(a.rate<1&&a.rate>0){var i=a._getNoiseShape(t),o=function(){var s=gt(t),u=1.6732632423543772,l=1.0507009873554805,c=-u*l,f=z.greaterEqual(z.randomUniform(i),a.rate);f=Rf(f,"float32");var h=Math.pow((1-a.rate)*(1+a.rate*Math.pow(c,2)),-.5),p=-h*c*a.rate,d=z.add(z.mul(s,f),z.mul(z.add(f,-1),c));return z.add(z.mul(d,h),p)};return Pf(o,function(){return gt(t)},n.training||!1)}return t})},e})(Tt);Cb.className="AlphaDropout";z.serialization.registerClass(Cb);function Df(r,e,t,n,a,i){i===void 0&&(i=.001);var o;if(r.rank===2)o=F.batchNorm2d(r,e,t,n,a,i);else if(r.rank===3)o=F.batchNorm3d(r,e,t,n,a,i);else if(r.rank===4)o=F.batchNorm4d(r,e,t,n,a,i);else throw new wt("batchNormalization is not implemented for array of rank "+r.rank+" yet");return o}function gie(r,e,t,n,a){return a===void 0&&(a=.001),z.tidy(function(){var i=F.moments(r,n),o=i.mean,s=i.variance,u=Df(r,o,s,t,e,a);return[u,o,s]})}function yie(r,e,t,n,a){return a===void 0&&(a=.001),z.tidy(function(){var i,o,s=F.moments(r,n),u=s.mean,l=s.variance,c=[];try{for(var f=ke(vi(0,r.rank)),h=f.next();!h.done;h=f.next()){var p=h.value;n.indexOf(p)!==-1?c.push(1):c.push(r.shape[p])}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}var d=z.reshape(u,c),v=z.reshape(l,c),m=e==null?null:z.reshape(e,c),g=t==null?null:z.reshape(t,c),y=Df(r,d,v,g,m,a);return[y,u,l]})}function bie(r,e,t,n,a){return a===void 0&&(a=.001),z.util.arraysEqual(n.slice().sort(),vi(0,r.rank-1))?gie(r,e,t,n,a):yie(r,e,t,n,a)}var Ab=(function(r){be(e,r);function e(t){var n=this;return t==null&&(t={}),n=r.call(this,t)||this,n.supportsMasking=!0,n.axis=t.axis==null?-1:t.axis,n.momentum=t.momentum==null?.99:t.momentum,n.epsilon=t.epsilon==null?.001:t.epsilon,n.center=t.center==null?!0:t.center,n.scale=t.scale==null?!0:t.scale,n.betaInitializer=br(t.betaInitializer||"zeros"),n.gammaInitializer=br(t.gammaInitializer||"ones"),n.movingMeanInitializer=br(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=br(t.movingVarianceInitializer||"ones"),n.betaConstraint=jr(t.betaConstraint),n.gammaConstraint=jr(t.gammaConstraint),n.betaRegularizer=wr(t.betaRegularizer),n.gammaRegularizer=wr(t.gammaRegularizer),n}return e.prototype.build=function(t){var n;t=zt(t);var a=this.axis>=0?this.axis:this.axis+t.length,i=t[a];if(i==null)throw new ce("Axis "+a+" of input tensor should have a defined dimension but the layer received an input with shape "+(JSON.stringify(t)+"."));this.inputSpec=[new Vr({ndim:t.length,axes:(n={},n[a]=i,n)})];var o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){var i=n.training==null?!1:n.training,o=gt(t),s=o.shape,u=s.length,l=vi(0,u),c=a.axis>=0?a.axis:a.axis+u;l.splice(c,1);var f=$s(1,u);f[c]=s[c];var h=l.slice();h.sort();var p=!z.util.arraysEqual(h,vi(0,u).slice(0,u-1)),d=function(){if(p){var k=z.reshape(a.movingMean.read(),f),S=z.reshape(a.movingVariance.read(),f),E=a.center?z.reshape(a.beta.read(),f):null,N=a.scale?z.reshape(a.gamma.read(),f):null;return Df(o,k,S,E,N,a.epsilon)}else return Df(o,a.movingMean.read(),a.movingVariance.read(),a.beta==null?null:a.beta.read(),a.gamma==null?null:a.gamma.read(),a.epsilon)};if(!i)return d();var v=ye(bie(o,a.gamma.read(),a.beta.read(),l,a.epsilon),3),m=v[0],g=v[1],y=v[2],b=function(k,S,E){F.tidy(function(){var N=1-E,C=k.read(),R=F.mul(F.sub(C,S),N);k.write(F.sub(C,R))})},w=function(){b(a.movingMean,g,a.momentum),b(a.movingVariance,y,a.momentum)};return w(),m})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Tr(this.betaInitializer),gammaInitializer:Tr(this.gammaInitializer),movingMeanInitializer:Tr(this.movingMeanInitializer),movingVarianceInitializer:Tr(this.movingVarianceInitializer),betaRegularizer:Ht(this.betaRegularizer),gammaRegularizer:Ht(this.gammaRegularizer),betaConstraint:Kr(this.betaConstraint),gammaConstraint:Kr(this.gammaConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);Ab.className="BatchNormalization";z.serialization.registerClass(Ab);var _b=(function(r){be(e,r);function e(t){var n,a,i=this;if(t==null&&(t={}),i=r.call(this,t)||this,i.axis=t.axis==null?-1:t.axis,typeof i.axis=="number"){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received "+i.axis)}else if(Array.isArray(i.axis))try{for(var o=ke(i.axis),s=o.next();!s.done;s=o.next()){var u=s.value;if(!Number.isInteger(u))throw new Error("Expected axis to be an array of integers, "+("but received "+JSON.stringify(i.axis)))}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}else throw new Error("Expected axis to be an integer or an array of integers, "+("but received "+JSON.stringify(i.axis)));return i.epsilon=t.epsilon==null?.001:t.epsilon,i.center=t.center==null?!0:t.center,i.scale=t.scale==null?!0:t.scale,i.betaInitializer=br(t.betaInitializer||"zeros"),i.gammaInitializer=br(t.gammaInitializer||"ones"),i.betaRegularizer=wr(t.betaRegularizer),i.gammaRegularizer=wr(t.gammaRegularizer),i.supportsMasking=!0,i}return e.prototype.build=function(t){var n,a;t=zt(t);var i=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=i);try{for(var s=ke(this.axis),u=s.next();!u.done;u=s.next()){var l=u.value;if(l<0||l>=i)throw new Error("Invalid axis: "+l)}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(this.axis.length!==Wo(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var c=this.axis.map(function(h){return t[h]}),f=!0;this.scale?this.gamma=this.addWeight("gamma",c,"float32",this.gammaInitializer,this.gammaRegularizer,f):this.gamma=null,this.center?this.beta=this.addWeight("beta",c,"float32",this.betaInitializer,this.betaRegularizer,f):this.beta=null,this.built=!0},e.prototype.call=function(t,n){var a=this,i=gt(t),o=i.shape,s=o.length;return z.tidy(function(){var u,l,c=!0,f=z.moments(i,a.axis,c),h=f.mean,p=f.variance,d=$s(1,s);try{for(var v=ke(a.axis),m=v.next();!m.done;m=v.next()){var g=m.value;d[g]=o[g]}}catch(N){u={error:N}}finally{try{m&&!m.done&&(l=v.return)&&l.call(v)}finally{if(u)throw u.error}}for(var y=function(N){return N!=null&&N.shape.length!==s?F.reshape(N,d):N},b=a.scale?y(a.gamma.read()):null,w=a.center?y(a.beta.read()):null,k=[],S=[],E=0;E<s;++E)a.axis.indexOf(E)!==-1?(k.push(o[E]),S.push(1)):(k.push(1),S.push(o[E]));return h=F.tile(h,k),p=F.tile(p,k),b!=null&&(b=F.tile(b,S)),w!=null&&(w=F.tile(w,S)),Df(i,h,p,w,b,a.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Tr(this.betaInitializer),gammaInitializer:Tr(this.gammaInitializer),betaRegularizer:Ht(this.betaRegularizer),gammaRegularizer:Ht(this.gammaRegularizer)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);_b.className="LayerNormalization";z.serialization.registerClass(_b);function wie(r,e,t){return z.tidy(function(){if(r.rank!==4)throw new ce("temporalPadding expects input tensor to be 4-D, but received a "+(r.rank+"-D tensor."));if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new ce("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=mi()),t!=="channelsLast"&&t!=="channelsFirst")throw new ce("Unknown data format: "+t+". Supported data formats are 'channelsLast' and 'channelsFirst.");var n;return t==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],F.pad(r,n)})}var Db=(function(r){be(e,r);function e(t){var n=this;if(t==null&&(t={}),n=r.call(this,t)||this,n.dataFormat=t.dataFormat==null?mi():t.dataFormat,t.padding==null)n.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new ce("ZeroPadding2D expects padding to be a length-2 array, but "+("received a length-"+t.padding.length+" array."));var a=void 0,i=void 0;if(typeof t.padding[0]=="number")a=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new ce("ZeroPadding2D expects height padding to be a length-2 array, "+("but received a length-"+t.padding[0].length+" array."));if(a=t.padding[0],t.padding[1].length!==2)throw new ce("ZeroPadding2D expects width padding to be a length-2 array, "+("but received a length-"+t.padding[1].length+" array."));i=t.padding[1]}n.padding=[a,i]}return n.inputSpec=[new Vr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=zt(t);var n,a;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?a=t[3]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],t[1],n,a]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?a=t[2]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],n,a,t[3]])},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){return wie(gt(t),a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt);Db.className="ZeroPadding2D";z.serialization.registerClass(Db);function uv(r,e,t,n,a,i){return z.tidy(function(){Lr(a),eC(i),xa(n),t==null&&(t=[1,1]),n==null&&(n="valid"),a==null&&(a=mi()),i==null&&(i="max"),r=Q0(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=F.maxPool(r,e,t,s):o=F.avgPool(r,e,t,s),a==="channelsFirst"&&(o=F.transpose(o,[0,3,1,2])),o})}function w3(r,e,t,n,a,i){return z.tidy(function(){Lr(a),eC(i),xa(n),t==null&&(t=[1,1,1]),n==null&&(n="valid"),a==null&&(a=mi()),i==null&&(i="max"),r=d3(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=F.maxPool3d(r,e,t,s):o=F.avgPool3d(r,e,t,s),a==="channelsFirst"&&(o=F.transpose(o,[0,4,1,2,3])),o})}var x3=(function(r){be(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=2),n=r.call(this,t)||this,typeof t.poolSize=="number")n.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")n.poolSize=t.poolSize;else throw new ce("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+(""+JSON.stringify(t.poolSize)));if(Qr(n.poolSize,"poolSize"),t.strides==null)n.strides=n.poolSize;else if(typeof t.strides=="number")n.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")n.strides=t.strides;else throw new ce("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+(""+JSON.stringify(t.strides)));return Qr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,xa(n.padding),n.inputSpec=[new Vr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){t=zt(t);var n=di(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){a.invokeCallHook(t,n),t=Mf(gt(t),2);var i=a.poolingFunction(gt(t),[a.poolSize[0],1],[a.strides[0],1],a.padding,"channelsLast");return F.squeeze(i,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt),Fb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Lr(o),xa(i),uv(t,n,a,i,o,"max")},e})(x3);Fb.className="MaxPooling1D";z.serialization.registerClass(Fb);var Rb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Lr(o),xa(i),uv(t,n,a,i,o,"avg")},e})(x3);Rb.className="AveragePooling1D";z.serialization.registerClass(Rb);var k3=(function(r){be(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new ce("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+(t.strides.length+"."));n.strides=t.strides}else n.strides=[t.strides,t.strides];return Qr(n.poolSize,"poolSize"),Qr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Lr(n.dataFormat),xa(n.padding),n.inputSpec=[new Vr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=zt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=di(n,this.poolSize[0],this.padding,this.strides[0]),a=di(a,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a]:[t[0],n,a,t[3]]},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(gt(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt),Mb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Lr(o),xa(i),uv(t,n,a,i,o,"max")},e})(k3);Mb.className="MaxPooling2D";z.serialization.registerClass(Mb);var Ob=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Lr(o),xa(i),uv(t,n,a,i,o,"avg")},e})(k3);Ob.className="AveragePooling2D";z.serialization.registerClass(Ob);var S3=(function(r){be(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new ce("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+(t.strides.length+"."));n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return Qr(n.poolSize,"poolSize"),Qr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Lr(n.dataFormat),xa(n.padding),n.inputSpec=[new Vr({ndim:5})],n}return e.prototype.computeOutputShape=function(t){t=zt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=di(n,this.poolSize[0],this.padding,this.strides[0]),a=di(a,this.poolSize[1],this.padding,this.strides[1]),i=di(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a,i]:[t[0],n,a,i,t[4]]},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(gt(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt),Pb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Lr(o),xa(i),w3(t,n,a,i,o,"max")},e})(S3);Pb.className="MaxPooling3D";z.serialization.registerClass(Pb);var Lb=(function(r){be(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Lr(o),xa(i),w3(t,n,a,i,o,"avg")},e})(S3);Lb.className="AveragePooling3D";z.serialization.registerClass(Lb);var E3=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[new Vr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,n){throw new wt},e})(Tt),Bb=(function(r){be(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return z.tidy(function(){var a=gt(t);return F.mean(a,1)})},e})(E3);Bb.className="GlobalAveragePooling1D";z.serialization.registerClass(Bb);var zb=(function(r){be(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return z.tidy(function(){var a=gt(t);return F.max(a,1)})},e})(E3);zb.className="GlobalMaxPooling1D";z.serialization.registerClass(zb);var T3=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Lr(n.dataFormat),n.inputSpec=[new Vr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,n){throw new wt},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(Tt),$b=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return z.tidy(function(){var i=gt(t);return a.dataFormat==="channelsLast"?F.mean(i,[1,2]):F.mean(i,[2,3])})},e})(T3);$b.className="GlobalAveragePooling2D";z.serialization.registerClass($b);var Wb=(function(r){be(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return z.tidy(function(){var i=gt(t);return a.dataFormat==="channelsLast"?F.max(i,[1,2]):F.max(i,[2,3])})},e})(T3);Wb.className="GlobalMaxPooling2D";z.serialization.registerClass(Wb);var I3=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.layer=t.layer,n}return e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null?this.layer.trainable:!1},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.layer,o=pi(i,a);delete n.layer;var s={layer:o};return Object.assign(s,n),new t(s)},e})(Tt),Vb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n}return e.prototype.build=function(t){if(t=zt(t),t.length<3)throw new ce("TimeDistributed layer expects an input shape >= 3D, but received "+("input shape "+JSON.stringify(t)));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),r.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){t=zt(t);var n=[t[0]].concat(t.slice(2)),a=this.layer.computeOutputShape(n),i=t[1];return[a[0],i].concat(a.slice(1))},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){t=gt(t);var i=function(u,l){var c=gt(a.layer.call(u,n));return[c,[]]},o=y3(i,t,[],!1,null,null,!1,!0),s=o[1];return s})},e})(I3);Vb.className="TimeDistributed";z.serialization.registerClass(Vb);function xie(r){Us(g7,"BidirectionalMergeMode",r)}var kie="concat",Ub=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this,a=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=a,n.forwardLayer=pi(i),a.goBackwards=a.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=a,n.backwardLayer=pi(o),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=t.mergeMode===void 0?kie:t.mergeMode,xie(n.mergeMode),t.weights)throw new wt("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var n=t.length,a=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,a)),this.backwardLayer.setWeights(t.slice(a))},e.prototype.computeOutputShape=function(t){var n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;var a,i,o;return this.returnState&&(o=n.slice(1)),a=n[0],a=a,this.mergeMode==="concat"?(a[a.length-1]*=2,i=[a]):this.mergeMode==null?i=[a,a.slice()]:i=[a],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[a].concat(o).concat(o.slice()):In(i)},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=g3(t,o,s,this.numConstants);if(t=u.inputs,o=u.initialState,s=u.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return r.prototype.apply.call(this,t,n);var l=[],c=[];if(o!=null){var f=o.length;if(f%2>0)throw new ce("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=o,l.push.apply(l,pt(o));var h=o.map(function(k){return new Vr({shape:k.shape})});this.forwardLayer.stateSpec=h.slice(0,f/2),this.backwardLayer.stateSpec=h.slice(f/2),c.push.apply(c,pt(h))}if(s!=null)throw new wt("Support for constants in Bidirectional layers is not implemented yet.");var p=l[0]instanceof hi;try{for(var d=ke(l),v=d.next();!v.done;v=d.next()){var m=v.value;if(m instanceof hi!==p)throw new ce("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(k){a={error:k}}finally{try{v&&!v.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}if(p){var g=[t].concat(l),y=this.inputSpec.concat(c),b=this.inputSpec;this.inputSpec=y;var w=r.prototype.apply.call(this,g,n);return this.inputSpec=b,w}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){var i=n.initialState,o,s;if(i==null)o=a.forwardLayer.call(t,n),s=a.backwardLayer.call(t,n);else{var u=i.slice(0,i.length/2),l=i.slice(i.length/2);o=a.forwardLayer.call(t,Object.assign(n,{initialState:u})),s=a.backwardLayer.call(t,Object.assign(n,{initialState:l}))}var c;a.returnState&&(Array.isArray(o)&&(c=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),a.returnSequences&&(s=F.reverse(s,1));var f;return a.mergeMode==="concat"?f=Hy([o,s]):a.mergeMode==="sum"?f=F.add(o,s):a.mergeMode==="ave"?f=F.mul(.5,F.add(o,s)):a.mergeMode==="mul"?f=F.mul(o,s):a.mergeMode==null&&(f=[o,s]),a.returnState?a.mergeMode==null?f.concat(c):[f].concat(c):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var n=this;Bs(this.forwardLayer.name,function(){n.forwardLayer.build(t)}),Bs(this.backwardLayer.name,function(){n.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,n){Array.isArray(n)&&(n=n[0]);var a;if(this.returnSequences?this.mergeMode==null?a=[n,n]:a=n:this.mergeMode==null?a=[null,null]:a=null,this.returnState){var i=this.forwardLayer.states,o=i.map(function(s){return null});return Array.isArray(a)?a.concat(o).concat(o):[a].concat(o).concat(o)}else return a},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.fromConfig=function(t,n){var a=pi(n.layer);if(delete n.layer,n.numConstants!=null)throw new wt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=n;return i.layer=a,new t(i)},e})(I3);Ub.className="Bidirectional";z.serialization.registerClass(Ub);var Gb=(function(r){be(e,r);function e(t){var n=r.call(this,t)||this;return n.scale=t.scale,t.offset?n.offset=t.offset:n.offset=0,n}return e.prototype.getConfig=function(){var t={scale:this.scale,offset:this.offset},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return z.tidy(function(){return t=gt(t),t.dtype!=="float32"&&(t=Rf(t,"float32")),z.add(z.mul(t,a.scale),a.offset)})},e})(Tt);Gb.className="Rescaling";z.serialization.registerClass(Gb);function Sie(r){return new yl(r)}function Eie(r){return new X0(r)}function Tie(r){return new q0(r)}function Iie(r){return new K0(r)}function Nie(r){return new j0(r)}function Cie(r){return new Z0(r)}function Aie(r){return new Y0(r)}function _ie(r){return new rb(r)}function Die(r){return new tv(r)}function Fie(r){return new J0(r)}function Rie(r){return new rv(r)}function Mie(r){return new eb(r)}function Oie(r){return new tb(r)}function Pie(r){return new nb(r)}function Lie(r){return new ab(r)}function Bie(r){return new ib(r)}function zie(r){return new pb(r)}function $ie(r){return new fb(r)}function Wie(r){return new sv(r)}function Vie(r){return new cb(r)}function Uie(r){return new hb(r)}function Gie(r){return new db(r)}function Hie(r){return new vb(r)}function qie(r){return new mb(r)}function Kie(r){return new yb(r)}function jie(r){return new bb(r)}function Xie(r){return new xb(r)}function Yie(r){return new Eb(r)}function Zie(r){return new kb(r)}function Qie(r){return new Sb(r)}function Jie(r){return new wb(r)}function eoe(r){return new Tb(r)}function toe(r){return new Ab(r)}function roe(r){return new _b(r)}function noe(r){return new Db(r)}function Hb(r){return new Rb(r)}function aoe(r){return Hb(r)}function ioe(r){return Hb(r)}function qb(r){return new Ob(r)}function ooe(r){return qb(r)}function soe(r){return qb(r)}function Kb(r){return new Lb(r)}function uoe(r){return Kb(r)}function loe(r){return Kb(r)}function coe(r){return new Bb(r)}function foe(r){return new $b(r)}function N3(r){return new zb(r)}function C3(r){return new Wb(r)}function A3(r){return new Fb(r)}function _3(r){return new Mb(r)}function hoe(r){return new Pb(r)}function poe(r){return new sb(r)}function doe(r){return new av(r)}function voe(r){return new ub(r)}function moe(r){return new Hf(r)}function goe(r){return new ob(r)}function yoe(r){return new nv(r)}function boe(r){return new lb(r)}function woe(r){return new ov(r)}function xoe(r){return new co(r)}function koe(r){return new iv(r)}function Soe(r){return new Ub(r)}function Eoe(r){return new Vb(r)}var Toe=N3,Ioe=C3,Noe=A3,Coe=_3;function Aoe(r){return new Ib(r)}function _oe(r){return new Nb(r)}function Doe(r){return new Cb(r)}function Foe(r){return new gb(r)}function Roe(r){return new Gb(r)}var Moe={__proto__:null,inputLayer:Sie,elu:Eie,reLU:Tie,leakyReLU:Iie,prelu:Nie,softmax:Cie,thresholdedReLU:Aie,conv1d:_ie,conv2d:Die,conv2dTranspose:Fie,conv3d:Rie,conv3dTranspose:Mie,separableConv2d:Oie,cropping2D:Pie,upSampling2d:Lie,depthwiseConv2d:Bie,activation:zie,dense:$ie,dropout:Wie,spatialDropout1d:Vie,flatten:Uie,repeatVector:Gie,reshape:Hie,permute:qie,embedding:Kie,add:jie,average:Xie,concatenate:Yie,maximum:Zie,minimum:Qie,multiply:Jie,dot:eoe,batchNormalization:toe,layerNormalization:roe,zeroPadding2d:noe,averagePooling1d:Hb,avgPool1d:aoe,avgPooling1d:ioe,averagePooling2d:qb,avgPool2d:ooe,avgPooling2d:soe,averagePooling3d:Kb,avgPool3d:uoe,avgPooling3d:loe,globalAveragePooling1d:coe,globalAveragePooling2d:foe,globalMaxPooling1d:N3,globalMaxPooling2d:C3,maxPooling1d:A3,maxPooling2d:_3,maxPooling3d:hoe,gru:poe,gruCell:doe,lstm:voe,lstmCell:moe,simpleRNN:goe,simpleRNNCell:yoe,convLstm2d:boe,convLstm2dCell:woe,rnn:xoe,stackedRNNCells:koe,bidirectional:Soe,timeDistributed:Eoe,globalMaxPool1d:Toe,globalMaxPool2d:Ioe,maxPool1d:Noe,maxPool2d:Coe,Layer:Tt,RNN:co,RNNCell:xl,input:J_,gaussianNoise:Aoe,gaussianDropout:_oe,alphaDropout:Doe,masking:Foe,rescaling:Roe};function Ooe(r,e){return z0(r,e)}function Poe(r,e){return G_(r,e)}function Loe(r,e){return H_(r,e)}function Boe(r,e){return $0(r,e)}function zoe(r,e){return W0(r,e)}function $oe(r,e){return U_(r,e)}function Woe(r,e){return Tae(r,e)}function Voe(r,e){return B0(r,e)}function Uoe(r,e){return Zd(r,e)}function Goe(r,e){return wl(r,e)}function Hoe(r,e){return wl(r,e)}function qoe(r,e){return wl(r,e)}function Koe(r,e){return Zs(r,e)}function joe(r,e){return Zs(r,e)}function Xoe(r,e){return Zs(r,e)}var Yoe={__proto__:null,binaryAccuracy:Ooe,binaryCrossentropy:Poe,sparseCategoricalAccuracy:Loe,categoricalAccuracy:Boe,categoricalCrossentropy:zoe,precision:$oe,recall:Woe,cosineProximity:Voe,meanAbsoluteError:Uoe,meanAbsolutePercentageError:Goe,MAPE:Hoe,mape:qoe,meanSquaredError:Koe,MSE:joe,mse:Xoe};var Zoe={__proto__:null,modelFromJSON:rie};function Qoe(r){return new Gf(r)}function Joe(r){return cie(r)}function ese(r){return fie(r)}var tse={__proto__:null,l1l2:Qoe,l1:Joe,l2:ese},D3=(function(r){be(e,r);function e(){var t=r.apply(this,pt(arguments))||this;return t.model=null,t}return e.prototype.setModel=function(t){if(!(t instanceof oo))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e})(gl);function ld(r,e){return r<e}function XN(r,e){return r>e}var F3=(function(r){be(e,r);function e(t){var n=r.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new wt("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,["auto","min","max"].indexOf(n.mode)===-1&&(console.warn("EarlyStopping mode '"+n.mode+"' is invalid. Falling back to mode 'auto'."),n.mode="auto"),n.mode==="min"?n.monitorFunc=ld:n.mode==="max"||n.monitor.indexOf("acc")!==-1?n.monitorFunc=XN:n.monitorFunc=ld,n.monitorFunc===ld&&(n.minDelta*=-1),n}return e.prototype.onTrainBegin=function(t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===ld?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,n){return Ae(this,void 0,void 0,function(){var a;return Ce(this,function(i){switch(i.label){case 0:return[4,zo(n)];case 1:return i.sent(),a=this.getMonitorValue(n),a==null?[2]:(this.monitorFunc(a-this.minDelta,this.best)?(this.best=a,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return Ae(this,void 0,void 0,function(){return Ce(this,function(n){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var n=t[this.monitor];return n==null&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. "+("Available metrics are: "+Object.keys(t))),n},e})(D3);function rse(r){return new F3(r)}var nse={earlyStopping:rse};fr.Callback=D3;fr.CallbackList=L_;fr.CustomCallback=z_;fr.EarlyStopping=F3;fr.History=B_;fr.InputSpec=Vr;fr.LayerVariable=oC;fr.LayersModel=oo;fr.RNN=co;fr.Sequential=Jd;fr.SymbolicTensor=hi;fr.callbacks=nse;fr.constraints=Yne;fr.initializers=hae;fr.input=J_;fr.layers=Moe;fr.loadLayersModel=uie;fr.metrics=Yoe;fr.model=oie;fr.models=Zoe;fr.registerCallbackConstructor=lie;fr.regularizers=tse;fr.sequential=sie;fr.version_layers=V0});var gF=gr(Jo=>{"use strict";Object.defineProperty(Jo,"__esModule",{value:!0});var $e=Ds();function ase(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var M3=ase($e);var ise=$e.env();ise.registerFlag("KEEP_INTERMEDIATE_TENSORS",function(){return!1},function(r){r&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var Jb=function(r,e){return Jb=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Jb(r,e)};function ose(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Jb(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function qt(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function Ut(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function dv(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ze(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function sn(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(ze(arguments[e]));return r}var Ha;(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_QINT16=15]="DT_QINT16",r[r.DT_QUINT16=16]="DT_QUINT16",r[r.DT_UINT16=17]="DT_UINT16",r[r.DT_COMPLEX128=18]="DT_COMPLEX128",r[r.DT_HALF=19]="DT_HALF",r[r.DT_RESOURCE=20]="DT_RESOURCE",r[r.DT_VARIANT=21]="DT_VARIANT",r[r.DT_UINT32=22]="DT_UINT32",r[r.DT_UINT64=23]="DT_UINT64",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",r[r.DT_QINT16_REF=115]="DT_QINT16_REF",r[r.DT_QUINT16_REF=116]="DT_QUINT16_REF",r[r.DT_UINT16_REF=117]="DT_UINT16_REF",r[r.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",r[r.DT_HALF_REF=119]="DT_HALF_REF",r[r.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",r[r.DT_VARIANT_REF=121]="DT_VARIANT_REF",r[r.DT_UINT32_REF=122]="DT_UINT32_REF",r[r.DT_UINT64_REF=123]="DT_UINT64_REF"})(Ha||(Ha={}));var O3;(function(r){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))})(O3||(O3={}));var E1={};function sse(r,e){var t={tfOpName:r,category:"custom",inputs:[],attrs:[],customExecutor:e};E1[r]=t}function hD(r){return E1[r]}function use(r){delete E1[r]}function A(r,e,t,n,a){var i=e.inputParams[r];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,s=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd;if(i.type==="tensor")return yn(e.inputNames[i.inputIndexStart],t,n,a);if(i.type==="tensors"){var u=e.inputNames.slice(o,s);return u.map(function(h){return yn(h,t,n,a)})}var l=yn(e.inputNames.slice(o)[0],t,n,a),c=l.dataSync();return i.type==="number"?c[0]:$e.util.toNestedArray(l.shape,c)}var f=e.attrParams[r];return f&&f.value}function yn(r,e,t,n){var a=ze(ea(r),2),i=a[0],o=a[1];if(n!=null){var s=n.getHashTableHandleByName(i);if(s!=null)return s}var u=t.currentContextIds.find(function(l){return!!e[vv(i,l)]});return u!==void 0?e[vv(i,u)][o]:void 0}function lse(r,e,t){return e[vv(r,t.currentContextId)]}function $i(r,e){var t=ze(ea(r),3),n=t[0],a=t[1],i=t[2];return[vv(n,e&&e.currentContextId),a,i]}function vv(r,e){return e?r+"-"+e:r}function ea(r){var e=r.split(":");if(e.length===1)return[r,0,void 0];var t=e[0],n=e.length===3?e[1]:void 0,a=Number(e[e.length-1]);return[t,a,n]}function cv(r,e,t){var n=A("pad",r,e,t);if(n==="explicit"){n=A("explicitPaddings",r,e,t);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=n[i*2],a[i][1]=n[i*2+1];return a}return n}function fo(r){return r.kept?r:$e.clone(r)}var cse=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],fse={__proto__:null,json:cse};var hse=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],pse={__proto__:null,json:hse};var dse=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],vse={__proto__:null,json:dse};var mse=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],gse={__proto__:null,json:mse};var yse=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],bse={__proto__:null,json:yse};var wse=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],xse={__proto__:null,json:wse};var kse=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Sse={__proto__:null,json:kse};var Ese=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Tse={__proto__:null,json:Ese};var Ise=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],Nse={__proto__:null,json:Ise};var Cse=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Ase={__proto__:null,json:Cse};var _se=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Dse={__proto__:null,json:_se};var Fse=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],Rse={__proto__:null,json:Fse};var Mse=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],Ose={__proto__:null,json:Mse};var Pse=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Lse={__proto__:null,json:Pse};var Bse=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],zse={__proto__:null,json:Bse};var $se=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Wse={__proto__:null,json:$se};var Vse=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Use={__proto__:null,json:Vse};var Gse=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Hse={__proto__:null,json:Gse};var qse=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Kse={__proto__:null,json:qse},P3=(function(){function r(){var e=[fse,pse,vse,gse,bse,xse,Sse,Tse,Nse,Ase,Dse,Rse,Ose,Lse,zse,Wse,Use,Hse,Kse],t=[].concat.apply([],sn(e.map(function(n){return n.json})));this.opMappers=t.reduce(function(n,a){return n[a.tfOpName]=a,n},{})}return Object.defineProperty(r,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),r.prototype.transformGraph=function(e,t){var n=this;t===void 0&&(t={});var a=e.node,i=[],o=[],s=[],u=a.reduce(function(m,g){return m[g.name]=n.mapNode(g),g.op.startsWith("Placeholder")?i.push(m[g.name]):g.op==="Const"?o.push(m[g.name]):(g.input==null||g.input.length===0)&&s.push(m[g.name]),m},{}),l=[],c=[],f={},h={};t!=null&&(f=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));var p=Object.keys(u);p.forEach(function(m){var g=u[m];g.inputNames.forEach(function(y,b){var w=ze($i(y),3),k=w[0],S=w[2],E=u[k];if(E.outputs!=null){var N=E.outputs.indexOf(S);if(N!==-1){var C=k+":"+N;g.inputNames[b]=C}}g.inputs.push(E),E.children.push(g)})}),Object.keys(h).length===0?p.forEach(function(m){var g=u[m];g.children.length===0&&c.push(g)}):Object.keys(h).forEach(function(m){var g=ze($i(m),1),y=g[0],b=u[y];b!=null&&(b.signatureKey=h[m],c.push(b))}),Object.keys(f).length>0?Object.keys(f).forEach(function(m){var g=ze($i(m),1),y=g[0],b=u[y];b&&(b.signatureKey=f[m],l.push(b))}):l=i;var d={};e.library!=null&&e.library.function!=null&&(d=e.library.function.reduce(function(m,g){return m[g.signature.name]=n.mapFunction(g),m},{}));var v={nodes:u,inputs:l,outputs:c,weights:o,placeholders:i,signature:t,functions:d};return s.length>0&&(v.initNodes=s),v},r.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,n){return t[e[n].name]=n,t},{})},r.prototype.mapNode=function(e){var t=hD(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(a){return a.startsWith("^")?a.slice(1):a}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce(function(a,i){return a[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},a},{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce(function(a,i){var o=i.type,s=void 0;switch(i.type){case"string":s=e1(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=e1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":s=s1(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=s1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":s=r1(e.attr,i.tfName,i.defaultValue||0),s===void 0&&i.tfDeprecatedName&&(s=r1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":s=o1(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=o1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":s=t1(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=t1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":s=l1(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=l1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":s=i1(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=i1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":s=u1(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=u1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":s=n1(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=n1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":s=a1(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=a1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":s=L3(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=L3(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+i.type+" for op: "+e.op)}return a[i.name]={value:s,type:o},a},{})),n},r.prototype.mapFunction=function(e){var t=this,n=e.nodeDef,a=[],i=[],o={};n!=null&&(o=n.reduce(function(h,p){return h[p.name]=t.mapNode(p),p.op==="Const"&&i.push(h[p.name]),h},{}));var s=[],u=[];e.signature.inputArg.forEach(function(h){var p=ze($i(h.name),1),d=p[0],v={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:T1(h.type),type:"dtype"}},children:[]};v.signatureKey=h.name,s.push(v),o[d]=v});var l=Object.keys(o);l.forEach(function(h){var p=o[h];p.inputNames.forEach(function(d,v){var m=ze($i(d),3),g=m[0],y=m[2],b=o[g];if(b.outputs!=null){var w=b.outputs.indexOf(y);if(w!==-1){var k=g+":"+w;p.inputNames[v]=k}}p.inputs.push(b),b.children.push(p)})});var c=e.ret;e.signature.outputArg.forEach(function(h){var p=ze($i(c[h.name]),2),d=p[0],v=p[1],m=o[d];m!=null&&(m.defaultOutput=v,u.push(m))});var f=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:u,weights:i,placeholders:a,signature:f}},r.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a),n},{}),outputs:e.signature.outputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a,e.ret),n},{})}},r.prototype.mapArgToTensorInfo=function(e,t){var n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}},r})();function jse(r){var e=$e.env().global;if(typeof e.atob<"u")return e.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function pD(r,e){var t=Array.isArray(r)?String.fromCharCode.apply(null,r):jse(r);return e?t:t.toLowerCase()}function e1(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a!=null?pD(a.s,n):t}function t1(r,e,t){var n=r[e];return n?n.b:t}function r1(r,e,t){var n=r[e]||{},a=n.i!=null?n.i:n.f!=null?n.f:t;return typeof a=="number"?a:parseInt(a,10)}function T1(r){switch(typeof r=="string"&&(r=Ha[r]),r){case Ha.DT_FLOAT:case Ha.DT_HALF:return"float32";case Ha.DT_INT32:case Ha.DT_INT64:case Ha.DT_INT8:case Ha.DT_UINT8:return"int32";case Ha.DT_BOOL:return"bool";case Ha.DT_DOUBLE:return"float32";case Ha.DT_STRING:return"string";default:return null}}function L3(r,e,t){var n=r[e];return n&&n.func?n.func.name:t}function n1(r,e,t){var n=r[e];return n&&n.type?T1(n.type):t}function a1(r,e,t){var n=r[e];return n&&n.list&&n.list.type?n.list.type.map(function(a){return T1(a)}):t}function dD(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function i1(r,e,t){var n=r[e];return n&&n.shape?dD(n.shape):t}function o1(r,e,t){var n=r[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(function(a){return typeof a=="number"?a:parseInt(a,10)}):t}function s1(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a&&a.list&&a.list.s?a.list.s.map(function(i){return pD(i,n)}):t}function u1(r,e,t){var n=r[e];return n&&n.list&&n.list.shape?n.list.shape.map(function(a){return dD(a)}):t}function l1(r,e,t){var n=r[e];return n&&n.list&&n.list.b?n.list.b:t}var Xse=(function(){function r(e,t,n){var a=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(i){return a.getInput(i)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(i,o){return i[o]=a.getAttr(o),i},{}))}return r.prototype.getInput=function(e){return yn(e,this.tensorMap,this.context)},r.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(n.tensor!=null)return yn(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return r1(this.node.rawAttrs,e,t);if(n.s!=null)return e1(this.node.rawAttrs,e,t);if(n.b!=null)return t1(this.node.rawAttrs,e,t);if(n.shape!=null)return i1(this.node.rawAttrs,e,t);if(n.type!=null)return n1(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return o1(this.node.rawAttrs,e,t);if(n.list.s!=null)return s1(this.node.rawAttrs,e,t);if(n.list.shape!=null)return u1(this.node.rawAttrs,e,t);if(n.list.b!=null)return l1(this.node.rawAttrs,e,t);if(n.list.type!=null)return a1(this.node.rawAttrs,e,t)}return t},r})();var Yse=1e-7,Zse=1e-4,Qse=(function(){function r(){}return r.prototype.refCount=function(e){return ka("refCount")},r.prototype.incRef=function(e){return ka("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return ka("time")},r.prototype.read=function(e){return ka("read")},r.prototype.readSync=function(e){return ka("readSync")},r.prototype.readToGPU=function(e,t){return ka("readToGPU")},r.prototype.numDataIds=function(){return ka("numDataIds")},r.prototype.disposeData=function(e,t){return ka("disposeData")},r.prototype.write=function(e,t,n){return ka("write")},r.prototype.move=function(e,t,n,a,i){return ka("move")},r.prototype.memory=function(){return ka("memory")},r.prototype.floatPrecision=function(){return ka("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Yse:Zse},r.prototype.dispose=function(){return ka("dispose")},r})();function ka(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen")}function oe(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Qa(r,e,t){t===void 0&&(t=""),oe(_l(r,e),function(){return t+(" Shapes "+r+" and "+e+" must match")})}function Al(r){oe(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Tv(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||Wi(r)&&!t)for(var n=0;n<r.length;++n)Tv(r[n],e,t);else e.push(r);return e}function Rn(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function _l(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function eh(r){return r%1===0}function fv(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Iv(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),oe(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but "+("got axis "+r)}),oe(r.every(function(n){return eh(n)}),function(){return"All values in axis param must be integers but "+("got axis "+r)}),r.map(function(n){return n<0?t+n:n})}function Jse(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Iv(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function eue(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type "+r);return t}function tue(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type "+r);return t}function rue(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function nue(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Wi(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function B3(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function aue(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function I1(r){return typeof r=="string"||r instanceof String}function iue(r){return typeof r=="boolean"}function oue(r){return typeof r=="number"}function N1(r){return Array.isArray(r)?N1(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":oue(r)?"float32":I1(r)?"string":iue(r)?"bool":"float32"}function z3(r){return!!(r&&r.constructor&&r.call&&r.apply)}function C1(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function vD(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(c,f){return c*f})*(n?2:1),o=0;o<i;o++)a[o]=vD(r+o*u,s,t,n);return a}function $3(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("["+r+"] does not match the input size "+e.length+(t?" for a complex tensor":"")+".");return vD(0,r,e,t)}function mD(r,e){for(var t=A1(r,e),n=0;n<t.length;n++)t[n]=1;return t}function A1(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function gD(r){r.forEach(function(e){oe(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+("shape ["+r+"].")})})}function yD(r){return r&&r.then&&typeof r.then=="function"}var W3="tfjsflags",sue=(function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=uue,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(ja().getBool("IS_TEST")||ja().getBool("PROD")||console.warn("Platform "+this.platformName+" has already been set. "+("Overwriting the platform with "+e+"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];ja().getBool("IS_TEST")||ja().getBool("PROD")||console.warn("Setting feature override from URL "+e+": "+a+"."),this.set(e,a)}},r.prototype.getAsync=function(e){return qt(this,void 0,void 0,function(){var t,n;return Ut(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(yD(t))throw new Error("Flag "+e+" cannot be synchronously evaluated. Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(W3 in t){var n=t[W3].split(",");n.forEach(function(a){var i=ze(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=cue(o,s)})}}},r})();function uue(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return lue(e,n[0],n[1]),n.join("=")}),e}function lue(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function cue(r,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+r+".")}function ja(){return bD}var bD=null;function fue(r){bD=r}var jb;function wD(){if(jb==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");jb=r}return jb}function hue(){var r=wD();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function _1(r,e){var t=hue();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var pue="Abs",due="Acos",vue="Acosh",xD="Add",mue="AddN",gue="All",yue="Any",bue="ArgMax",wue="ArgMin",xue="Asin",kue="Asinh",Sue="Atan",Eue="Atanh",Tue="Atan2",Iue="AvgPool",Nue="AvgPool3D",Cue="BatchMatMul",Aue="BatchToSpaceND",_ue="Bincount",Due="BroadcastArgs",kD="Cast",Fue="Ceil",Rue="ClipByValue",Mue="Complex",Oue="ComplexAbs",Pue="Concat",Lue="Conv2D",Bue="Conv2DBackpropFilter",zue="Conv2DBackpropInput",$ue="Conv3D",Wue="Conv3DBackpropInputV2",Vue="Cos",Uue="Cosh",Gue="Cumprod",Hue="Cumsum",que="CropAndResize",Kue="DenseBincount",jue="DepthToSpace",Xue="DepthwiseConv2dNative",Yue="DepthwiseConv2dNativeBackpropFilter",Zue="DepthwiseConv2dNativeBackpropInput",Que="Diag",Jue="Dilation2D",ele="RealDiv",tle="Einsum",rle="Elu",nle="Erf",ale="Equal",ile="Exp",ole="ExpandDims",sle="Expm1",ule="FFT",lle="Fill",cle="FlipLeftRight",fle="Floor",hle="FloorDiv",ple="FusedBatchNorm",dle="GatherV2",vle="GatherNd",mle="Greater",gle="GreaterEqual",SD="Identity",yle="IFFT",ble="Imag",wle="IsFinite",xle="IsInf",kle="IsNan",Sle="LeakyRelu",Ele="Less",Tle="LessEqual",Ile="LinSpace",Nle="Log",Cle="Log1p",Ale="LogicalAnd",_le="LogicalNot",Dle="LogicalOr",Fle="LRN",Rle="Max",Mle="Maximum",Ole="MaxPool",Ple="MaxPool3D",Lle="MaxPoolWithArgmax",Ble="Mean",zle="Min",$le="Minimum",Wle="MirrorPad",Vle="Mod",Ule="Multinomial",Gle="Multiply",Hle="Neg",qle="NotEqual",Kle="NonMaxSuppressionV3",jle="NonMaxSuppressionV4",Xle="NonMaxSuppressionV5",Yle="OnesLike",Zle="OneHot",Qle="Pack",Jle="PadV2",ece="Pow",tce="Prelu",rce="Prod",nce="RaggedGather",ace="RaggedTensorToTensor",ice="Range",oce="Real",sce="Reciprocal",uce="Relu",lce="Reshape",cce="ResizeNearestNeighbor",fce="ResizeBilinear",hce="Relu6",pce="Reverse",dce="Round",vce="Rsqrt",mce="ScatterNd",gce="SearchSorted",yce="Select",bce="Selu",wce="Slice",xce="Sin",kce="Sinh",Sce="Sign",Ece="Sigmoid",Tce="Softplus",Ice="Sqrt",Nce="Sum",Cce="SpaceToBatchND",Ace="SplitV",_ce="Softmax",Dce="SparseFillEmptyRows",Fce="SparseReshape",Rce="SparseSegmentMean",Mce="SparseSegmentSum",Oce="SparseToDense",Pce="SquaredDifference",Lce="StridedSlice",Bce="StringNGrams",zce="StringSplit",$ce="StringToHashBucketFast",Wce="Sub",Vce="Tan",Uce="Tanh",ED="Tile",Gce="TopK",Hce="Transform",Xb="Transpose",qce="Unique",Kce="Unpack",jce="UnsortedSegmentSum",Xce="ZerosLike",Yce="Step",Zce="RotateWithOffset",V3="_FusedMatMul",U3="FusedConv2D",G3="FusedDepthwiseConv2D";function qf(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];ja().getBool("IS_TEST")||ja().getBool("PROD")||console.warn.apply(console,sn(r))}var TD=_1("kernelRegistry",function(){return new Map}),Qce=_1("gradRegistry",function(){return new Map});function H3(r,e){var t=Jce(r,e);return TD.get(t)}function q3(r){return Qce.get(r)}function K3(r){for(var e=TD.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=ze(i,2),s=o[0],u=o[1],l=ze(s.split("_"),1),c=l[0];c===r&&t.push(u)}return t}function Jce(r,e){return e+"_"+r}var c1=pr,Xa=null;try{Xa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function pr(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}pr.prototype.__isLong__;Object.defineProperty(pr.prototype,"__isLong__",{value:!0});function na(r){return(r&&r.__isLong__)===!0}pr.isLong=na;var j3={},X3={};function iu(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=X3[r],n)?n:(t=dr(r,(r|0)<0?-1:0,!0),a&&(X3[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=j3[r],n)?n:(t=dr(r,r<0?-1:0,!1),a&&(j3[r]=t),t))}pr.fromInt=iu;function Ya(r,e){if(isNaN(r))return e?eu:Za;if(e){if(r<0)return eu;if(r>=ID)return AD}else{if(r<=-Z3)return ta;if(r+1>=Z3)return CD}return r<0?Ya(-r,e).neg():dr(r%Il|0,r/Il|0,e)}pr.fromNumber=Ya;function dr(r,e,t){return new pr(r,e,t)}pr.fromBits=dr;var mv=Math.pow;function D1(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Za;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return D1(r.substring(1),e,t).neg();for(var a=Ya(mv(t,8)),i=Za,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var l=Ya(mv(t,s));i=i.mul(l).add(Ya(u))}else i=i.mul(a),i=i.add(Ya(u))}return i.unsigned=e,i}pr.fromString=D1;function ki(r,e){return typeof r=="number"?Ya(r,e):typeof r=="string"?D1(r,e):dr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}pr.fromValue=ki;var Y3=65536,efe=1<<24,Il=Y3*Y3,ID=Il*Il,Z3=ID/2,Q3=iu(efe),Za=iu(0);pr.ZERO=Za;var eu=iu(0,!0);pr.UZERO=eu;var kl=iu(1);pr.ONE=kl;var ND=iu(1,!0);pr.UONE=ND;var f1=iu(-1);pr.NEG_ONE=f1;var CD=dr(-1,2147483647,!1);pr.MAX_VALUE=CD;var AD=dr(-1,-1,!0);pr.MAX_UNSIGNED_VALUE=AD;var ta=dr(0,-2147483648,!1);pr.MIN_VALUE=ta;var Re=pr.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*Il+(this.low>>>0):this.high*Il+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ta)){var t=Ya(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ya(mv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),l=o.sub(u.mul(i)).toInt()>>>0,c=l.toString(e);if(o=u,o.isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ta)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return na(e)||(e=ki(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(na(e)||(e=ki(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(ta)?ta:this.not().add(kl)};Re.neg=Re.negate;Re.add=function(e){na(e)||(e=ki(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,l=e.low&65535,c=0,f=0,h=0,p=0;return p+=i+l,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,c+=f>>>16,f&=65535,c+=t+o,c&=65535,dr(h<<16|p,c<<16|f,this.unsigned)};Re.subtract=function(e){return na(e)||(e=ki(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return Za;if(na(e)||(e=ki(e)),Xa){var t=Xa.mul(this.low,this.high,e.low,e.high);return dr(t,Xa.get_high(),this.unsigned)}if(e.isZero())return Za;if(this.eq(ta))return e.isOdd()?ta:Za;if(e.eq(ta))return this.isOdd()?ta:Za;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Q3)&&e.lt(Q3))return Ya(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,l=e.low>>>16,c=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*c,p+=d>>>16,d&=65535,p+=i*c,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,h+=a*c,f+=h>>>16,h&=65535,h+=i*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*c+a*l+i*u+o*s,f&=65535,dr(p<<16|d,f<<16|h,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(na(e)||(e=ki(e)),e.isZero())throw Error("division by zero");if(Xa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Xa.div_u:Xa.div_s)(this.low,this.high,e.low,e.high);return dr(t,Xa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?eu:Za;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return eu;if(e.gt(this.shru(1)))return ND;i=eu}else{if(this.eq(ta)){if(e.eq(kl)||e.eq(f1))return ta;if(e.eq(ta))return kl;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Za)?e.isNegative()?kl:f1:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(ta))return this.unsigned?eu:Za;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Za}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:mv(2,s-48),l=Ya(n),c=l.mul(e);c.isNegative()||c.gt(a);)n-=u,l=Ya(n,this.unsigned),c=l.mul(e);l.isZero()&&(l=kl),i=i.add(l),a=a.sub(c)}return i};Re.div=Re.divide;Re.modulo=function(e){if(na(e)||(e=ki(e)),Xa){var t=(this.unsigned?Xa.rem_u:Xa.rem_s)(this.low,this.high,e.low,e.high);return dr(t,Xa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return dr(~this.low,~this.high,this.unsigned)};Re.and=function(e){return na(e)||(e=ki(e)),dr(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return na(e)||(e=ki(e)),dr(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return na(e)||(e=ki(e)),dr(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return na(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?dr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):dr(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return na(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?dr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):dr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(na(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return dr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?dr(t,0,this.unsigned):dr(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?dr(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:dr(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};pr.fromBytes=function(e,t,n){return n?pr.fromBytesLE(e,t):pr.fromBytesBE(e,t)};pr.fromBytesLE=function(e,t){return new pr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};pr.fromBytesBE=function(e,t){return new pr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var tfe=Object.assign(Object.create(null),c1,{default:c1}),rfe=c1||tfe;function F1(r){return rfe.fromString(r,!0,16)}F1("c3a5c85c97cb3127");F1("b492b66fbe98f273");F1("9ae16a3b2f90404f");function nfe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function _D(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Tv(r)),ja().getBool("DEBUG")&&rue(r,e),nfe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type "+e)}function gv(){return ja().platform.now()}function afe(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ja().platform.encode(r,e)}function J3(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ja().platform.decode(r,e)}var ife=(function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new sfe)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,l=gv();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var c=dv(o),f=c.next();!f.done;f=c.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:gv()-l})}if(ja().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(m){var g=o[m];g.data().then(function(y){ofe(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(l){t.logger.logKernelProfile(n,u,l[0],l[1],o,l[2])})})},r})();function ofe(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found "+a+" in the result of '"+t+"'"),!0}return!1}var sfe=(function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?fv(a+"ms",9):a.error,u=fv(e,25),l=t.rank,c=t.size,f=fv(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var v=d.shape||t.shape,m=v.length;h+=p+": "+m+"D "+(m>0?v:"")+" "}}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+f+"	%c"+c+"	%c"+h+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r})();function ufe(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var l=s[u],c=!1,f=0;f<e.length;f++)if(n[l.id]){o.outputs.forEach(function(b){return n[b.id]=!0}),c=!0,a[o.id]=!0;break}if(c)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];n[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,d.push(g)}}return d}function lfe(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+("for "+s.kernelName+"."));var l=s.gradient(u),c=function(h){if(!(h in l))throw new Error("Cannot backprop through input "+h+". "+("Available gradients found: "+Object.keys(l)+"."));var p=t(function(){return l[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+(h+" must have 'float32' dtype, but has '"+p.dtype+"'"));var d=s.inputs[h];if(!_l(p.shape,d.shape))throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+("'"+h+"' has shape '"+p.shape+"', which does not match ")+("the shape of the input '"+d.shape+"'"));if(r[d.id]==null)r[d.id]=p;else{var v=r[d.id];r[d.id]=n(v,p),v.dispose()}};for(var f in s.inputs)c(f)},i=e.length-1;i>=0;i--)a(i)}var eD=20,Kf=3,Yb=7;function cfe(r,e,t,n){var a=C1(e),i=ffe(r,e,t,a),o=e.length,s=hv(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function ffe(r,e,t,n){var a=Rn(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Zf(r):r;if(s>1)for(var l=0;l<a/i;l++)for(var c=l*i,f=0;f<i;f++)o[f]=Math.max(o[f],Yf(u[c+f],0,t).length);return o}function Yf(r,e,t){var n;return Array.isArray(r)?n=parseFloat(r[0].toFixed(Yb))+" + "+(parseFloat(r[1].toFixed(Yb))+"j"):I1(r)?n="'"+r+"'":t==="bool"?n=DD(r):n=parseFloat(r.toFixed(Yb)).toString(),fv(n,e)}function DD(r){return r===0?"false":"true"}function hv(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var l=Zf(r);return[Yf(l[0],0,t)]}return t==="bool"?[DD(r[0])]:[r[0].toString()]}if(u===1){if(s>eD){var c=Kf*o,f=Array.from(r.slice(0,c)),h=Array.from(r.slice((s-Kf)*o,s*o));return t==="complex64"&&(f=Zf(f),h=Zf(h)),["["+f.map(function(E,N){return Yf(E,a[N],t)}).join(", ")+", ..., "+h.map(function(E,N){return Yf(E,a[s-Kf+N],t)}).join(", ")+"]"]}var p=t==="complex64"?Zf(r):Array.from(r);return["["+p.map(function(E,N){return Yf(E,a[N],t)}).join(", ")+"]"]}var d=e.slice(1),v=n.slice(1),m=n[0]*o,g=[];if(s>eD){for(var y=0;y<Kf;y++){var b=y*m,w=b+m;g.push.apply(g,sn(hv(r.slice(b,w),d,t,v,a,!1)))}g.push("...");for(var y=s-Kf;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,sn(hv(r.slice(b,w),d,t,v,a,y===s-1)))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,sn(hv(r.slice(b,w),d,t,v,a,y===s-1)))}var k=u===2?",":"";g[0]="["+g[0]+k;for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+k;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function Zf(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var h1=(function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Rn(e),n!=null){var i=n.length;oe(i===this.size,function(){return"Length of values '"+i+"' does not match the size "+("inferred by the shape '"+a.size+"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||tue(t,this.size),this.strides=C1(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),oe(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must "+("match the rank ("+t.rank+")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=dv(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var l="Requested out of range element at "+n+". "+("  Buffer shape="+this.shape);throw new Error(l)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=n[n.length-1],f=0;f<n.length-1;++f)c+=this.strides[f]*n[f];return this.values[c]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return wi().makeTensor(this.values,this.shape,this.dtype)},r})(),wi=null,jf=null;function hfe(r){wi=r}var Dn=(function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Rn(e),this.strides=C1(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return qt(this,void 0,void 0,function(){var e;return Ut(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,jf.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return jf.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return qt(this,void 0,void 0,function(){var e;return Ut(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,$3(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return $3(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return qt(this,void 0,void 0,function(){var e,t;return Ut(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=wi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return J3(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),wi().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=wi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return J3(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return qt(this,void 0,void 0,function(){var e;return Ut(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,wi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(wi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),jf.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),jf.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return cfe(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),jf.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),wi().makeVariable(this,e,t,n)},r})();Object.defineProperty(Dn,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function pfe(){return _1("Tensor",function(){return Dn})}pfe();var p1=(function(r){ose(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and "+("previous value ("+this.dtype+") must match"));if(!_l(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and "+("previous value ("+this.shape+") must match"));wi().disposeTensor(this),this.dataId=t.dataId,wi().incRef(this,null)},e.prototype.dispose=function(){wi().disposeVariable(this),this.isDisposedInternal=!0},e})(Dn);Object.defineProperty(p1,Symbol.hasInstance,{value:function(r){return r instanceof Dn&&r.assign!=null&&r.assign instanceof Function}});var tD;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(tD||(tD={}));var d1;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(d1||(d1={}));var v1;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(v1||(v1={}));var m1;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(m1||(m1={}));var g1;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(g1||(g1={}));var dfe={float32:m1,int32:d1,bool:v1,complex64:g1};function vfe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return dfe[r][e]}function Dr(r,e){if(r.dtype===e.dtype)return[r,e];var t=vfe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function mfe(r,e){oe(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and"+(" second("+e.dtype+") input must match")})}function FD(r){var e=[],t=new Set;return RD(r,e,t),e}function RD(r,e,t){if(r!=null){if(r instanceof Dn){e.push(r);return}if(gfe(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),RD(i,e,t))}}}}function gfe(r){return Array.isArray(r)||typeof r=="object"}function Zb(r){return r.kernelName!=null}var rD=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r})(),R1=(function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new rD}return r.prototype.ready=function(){return qt(this,void 0,void 0,function(){var e,t,n,a;return Ut(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(qf(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return qt(this,void 0,void 0,function(){var t,n,a,i,o;return Ut(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ife(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=K3(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=K3(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var a=n.factory();if(a&&!(a instanceof Qse)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,qf("Initialization of backend "+e+" failed"),qf(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return qf("Initialization of backend "+e+" failed"),qf(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=fe.runKernel(SD,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},l={dtype:s};return fe.runKernel(kD,u,l)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=H3(e,this.backendName)!=null;if(!a)throw new Error("Kernel '"+e+"' not registered for backend '"+this.backendName+"'");return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak "+("("+s+" data ids) after running '"+e+"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var l,c=Zb(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Zb(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=H3(f,this.backendName);oe(d!=null,function(){return"Cannot find registered kernel '"+f+"' for backend '"+t.backendName+"'"}),u=function(){var k=t.backend.numDataIds();l=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(l)?l:[l];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,k,S);var E=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var N=t.getTensorsForGradient(f,h,E);a=t.saveTensorsForBackwardMode(N)}return E}}else{var v=e.forwardFunc,m=function(k){i&&(a=k.map(function(S){return t.keep(t.clone(S))}))};u=function(){var k=t.backend.numDataIds();l=t.tidy(function(){return v(t.backend,m)});var S=Array.isArray(l)?l:[l];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(c,k,S),S}}var g=e.inputs,y=e.attrs,b=Zb(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(w=t.profiler.profileKernel(c,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),n=w.outputs)}),i&&this.addTapeNode(c,g,n,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(k){return g[k]!=null?g[k].shape:null}),outputShapes:n.map(function(k){return k.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(l)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=q3(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(oe(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(l){return t[l]})):s=i.map(function(l){return t[l]});var u=n.filter(function(l,c){return o[c]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&I1(e[0])&&(i=e.map(function(c){return afe(c)}));var o=a.write(i,t,n),s=new Dn(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),l=aue(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Dn(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new p1(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*B3(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof p1||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*B3(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return qt(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return Ut(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,sn(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=dv(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),l=s,[4,s.extraInfo];case 5:l.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return c=p.sent(),f={error:c},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},l=q3(e);l!=null&&(a=l.gradFunc),a!=null&&(u.gradient=function(c){return c=c.map(function(f,h){if(f==null){var p=n[h],d=A1(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(c.length>1?c:c[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=FD(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),oe(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});oe(o instanceof Dn,function(){return"The result y returned by f() must be a tensor."});var s=ufe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??yfe(o.shape),lfe(u,s,function(c){return i.tidy(c)},wfe);var l=t.map(function(c){return u[c.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(c){var f,h;try{for(var p=dv(c.saved),d=p.next();!d.done;d=p.next()){var v=d.value;v.dispose()}}catch(m){f={error:m}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:l}})},r.prototype.customGrad=function(e){var t=this;return oe(z3(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];oe(n.every(function(l){return l instanceof Dn}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(l,c){o[c]=l});var s=function(l,c){return i=e.apply(void 0,sn(n,[c])),oe(i.value instanceof Dn,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),oe(z3(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(l,c){var f=i.gradFunc(l,c),h=Array.isArray(f)?f:[f];oe(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),oe(h.every(function(d){return d instanceof Dn}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,v){p[v]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return qt(this,void 0,void 0,function(){var t,n;return Ut(this,function(a){switch(a.label){case 0:return t=gv(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=gv()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new rD;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r})();R1.nextTensorId=0;R1.nextVariableId=0;function yfe(r){var e=mD(Rn(r),"float32");return fe.makeTensor(e,r,"float32")}function bfe(){var r=wD();if(r._tfengine==null){var e=new sue(r);r._tfengine=new R1(e)}return fue(r._tfengine.ENV),hfe(function(){return r._tfengine}),r._tfengine}var fe=bfe();function wfe(r,e){var t={a:r,b:e};return fe.runKernel(xD,t)}function Yo(r,e){var t=r;if(Wi(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||Wi(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&ja().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&MD(r,n,[]),n}function MD(r,e,t){if(t=t||[],!Array.isArray(r)&&!Wi(r)){oe(e.length===0,function(){return"Element arr["+t.join("][")+"] is a primitive, "+("but should be an array/TypedArray of "+e[0]+" elements")});return}oe(e.length>0,function(){return"Element arr["+t.join("][")+"] should be a primitive, "+("but is an array of "+r.length+" elements")}),oe(r.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" "+("elements, but has "+r.length+" elements")});for(var n=e.slice(1),a=0;a<r.length;++a)MD(r[a],n,t.concat(a))}function nD(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '"+t+"' passed to '"+n+"' must "+("be "+r+" tensor, but got "+e+" tensor"))}}function U(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof Dn)return nD(n,r.dtype,e,t),r;var a=N1(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),nD(n,a,e,t),r==null||!Wi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a "+("Tensor or TensorLike, but got '"+i+"'"))}var o=Yo(r,a);!Wi(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?_D(r,a):Tv(r,[],s);return fe.makeTensor(u,o,a)}function yv(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return U(i,e+"["+o+"]",t,n)})}var OD="__op";function ae(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+(e.length+" keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+OD;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];fe.startScope(t);try{var s=n.apply(void 0,sn(i));return yD(s)&&console.error("Cannot return a Promise inside of tidy."),fe.endScope(s),s}catch(u){throw fe.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function xfe(r){var e=U(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return fe.runKernel(Oue,t)}else{var t={x:e};return fe.runKernel(pue,t)}}var qa=ae({abs_:xfe});function kfe(r){var e=U(r,"x","acos"),t={x:e};return fe.runKernel(due,t)}var Sfe=ae({acos_:kfe});function Efe(r){var e=U(r,"x","acosh"),t={x:e};return fe.runKernel(vue,t)}var Tfe=ae({acosh_:Efe});function Ife(r,e){var t,n=U(r,"a","add"),a=U(e,"b","add");t=ze(Dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return fe.runKernel(xD,i)}var tn=ae({add_:Ife});function Nfe(r){oe(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),oe(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+(""+r.length)});var e=r.map(function(a,i){return U(a,"tensors"+i,"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!_l(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return fe.runKernel(mue,n)}var Cfe=ae({addN_:Nfe});function Afe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=U(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return fe.runKernel(gue,a,i)}var _fe=ae({all_:Afe});function Dfe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=U(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return fe.runKernel(yue,a,i)}var Ffe=ae({any_:Dfe});function Rfe(r,e){e===void 0&&(e=0);var t=U(r,"x","argMax"),n={x:t},a={axis:e};return fe.runKernel(bue,n,a)}var Mfe=ae({argMax_:Rfe});function Ofe(r,e){e===void 0&&(e=0);var t=U(r,"x","argMin"),n={x:t},a={axis:e};return fe.runKernel(wue,n,a)}var Pfe=ae({argMin_:Ofe});function Lfe(r){var e=U(r,"x","asin"),t={x:e};return fe.runKernel(xue,t)}var Bfe=ae({asin_:Lfe});function zfe(r){var e=U(r,"x","asinh"),t={x:e};return fe.runKernel(kue,t)}var $fe=ae({asinh_:zfe});function Wfe(r){var e=U(r,"x","atan"),t={x:e};return fe.runKernel(Sue,t)}var Vfe=ae({atan_:Wfe});function Ufe(r,e){var t,n=U(r,"a","atan2"),a=U(e,"b","atan2");t=ze(Dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return fe.runKernel(Tue,i)}var Gfe=ae({atan2_:Ufe});function Hfe(r){var e=U(r,"x","atanh"),t={x:e};return fe.runKernel(Eue,t)}var qfe=ae({atanh_:Hfe});function Kfe(r,e){var t=U(r,"x","cast");if(!nue(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return fe.runKernel(kD,n,a)}var un=ae({cast_:Kfe});function jfe(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=ze(bv(e),2),u=s[0],l=s[1],c;if(o==="channelsLast")c=[u,l,r[3],r[3]];else if(o==="channelsFirst")c=[u,l,r[1],r[1]];else throw new Error("Unknown dataFormat "+o);return M1(r,c,t,n,a,i,!1,o)}function M1(r,e,t,n,a,i,o,s){var u,l;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var c=ze([-1,-1,-1,-1],4),f=c[0],h=c[1],p=c[2],d=c[3];if(s==="channelsLast")u=ze(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")l=ze(r,4),f=l[0],d=l[1],h=l[2],p=l[3];else throw new Error("Unknown dataFormat "+s);var v=ze(e,4),m=v[0],g=v[1],y=v[3],b=ze(bv(t),2),w=b[0],k=b[1],S=ze(bv(n),2),E=S[0],N=S[1],C=y1(m,E),R=y1(g,N),_=Zfe(a,h,p,w,k,C,R,i,s),O=_.padInfo,P=_.outHeight,B=_.outWidth,W=o?y*d:y,L;return s==="channelsFirst"?L=[f,W,P,B]:s==="channelsLast"&&(L=[f,P,B,W]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:P,outWidth:B,outChannels:W,padInfo:O,strideHeight:w,strideWidth:k,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:E,dilationWidth:N,inShape:r,outShape:L,filterShape:e}}function Xfe(r,e,t,n,a){n==null&&(n=Yfe(r,e,t));var i=r[0],o=r[1],s=wv((i-e+2*n)/t+1,a),u=wv((o-e+2*n)/t+1,a);return[s,u]}function Yfe(r,e,t,n){n===void 0&&(n=1);var a=y1(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function bv(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function y1(r,e){return e<=1?r:r+(r-1)*(e-1)}function Zfe(r,e,t,n,a,i,o,s,u){var l,c,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";l={top:r,bottom:r,left:r,right:r,type:h};var p=Xfe([e,t],i,n,r,s);c=p[0],f=p[1]}else if(r==="same"){c=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(c-1)*n+i-e),v=Math.max(0,(f-1)*a+o-t),m=Math.floor(d/2),g=d-m,y=Math.floor(v/2),b=v-y;l={top:m,bottom:g,left:y,right:b,type:"SAME"}}else if(r==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var m=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],b=u==="channelsLast"?r[2][1]:r[3][1],h=m===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";l={top:m,bottom:g,left:y,right:b,type:h},c=wv((e-i+m+g)/n+1,s),f=wv((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: "+r);return{padInfo:l,outHeight:c,outWidth:f}}function wv(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function xv(r){var e=ze(bv(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function Zo(r,e){return xv(r)||xv(e)}function Si(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+"."));if(typeof e=="number")oe(eh(e),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){oe(eh(a),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+a+".")})})});else throw Error("Error in "+r+": Unknown padding parameter: "+e)}}function Qfe(r,e){var t=U(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return fe.runKernel(lce,n,a)}var Ie=ae({reshape_:Qfe});function Jfe(r,e,t,n,a){var i=U(r,"x","avgPool","float32"),o=1;oe(Zo(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=Ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),oe(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),Si("avgPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=fe.runKernel(Iue,l,c);return f=un(f,i.dtype),u?Ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var PD=ae({avgPool_:Jfe});function ehe(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=U(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=Ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),oe(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."}),oe(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Si("avgPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=fe.runKernel(Nue,l,c);return f=un(f,s.dtype),u?Ie(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var the=ae({avgPool3d_:ehe});function rhe(r){var e=U(r,"x","clone","string_or_numeric"),t={x:e};return fe.runKernel(SD,t)}var Sl=ae({clone_:rhe});function nhe(r,e){e===void 0&&(e=0),oe(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=yv(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+i.dtype+". ")}),t.length===1)return Sl(t[0]);var n=t,a={axis:e};return fe.runKernel(Pue,n,a)}var ra=ae({concat_:nhe});function ahe(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=U(r,"a","matMul"),o=U(e,"b","matMul");a=ze(Dr(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return fe.runKernel(Cue,s,u)}var Vt=ae({matMul_:ahe});function ihe(r,e){var t,n=U(r,"a","mul"),a=U(e,"b","mul");t=ze(Dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return fe.runKernel(Gle,i)}var St=ae({mul_:ihe});function ohe(r){var e=U(r,"x","sigmoid","float32"),t={x:e};return fe.runKernel(Ece,t)}var El=ae({sigmoid_:ohe});function she(r,e,t){var n=U(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return fe.runKernel(wce,a,i)}var xr=ae({slice_:she});function uhe(r){var e=U(r,"x","tanh","float32"),t={x:e};return fe.runKernel(Uce,t)}var b1=ae({tanh_:uhe});function lhe(r,e,t,n,a,i){var o=U(r,"forgetBias","basicLSTMCell"),s=U(e,"lstmKernel","basicLSTMCell"),u=U(t,"lstmBias","basicLSTMCell"),l=U(n,"data","basicLSTMCell"),c=U(a,"c","basicLSTMCell"),f=U(i,"h","basicLSTMCell"),h=ra([l,f],1),p=Vt(h,s),d=tn(p,u),v=d.shape[0],m=d.shape[1]/4,g=[v,m],y=xr(d,[0,0],g),b=xr(d,[0,m],g),w=xr(d,[0,m*2],g),k=xr(d,[0,m*3],g),S=tn(St(El(y),b1(b)),St(c,El(tn(o,w)))),E=St(b1(S),El(k));return[S,E]}var che=ae({basicLSTMCell_:lhe});function fhe(r,e,t){var n=U(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});oe(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),oe(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),oe(n.shape[0]%a===0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of "+("the elements of blockShape "+e.join(" * ")+" === "+a)});var i={x:n},o={blockShape:e,crops:t};return fe.runKernel(Aue,i,o)}var LD=ae({batchToSpaceND_:fhe});function hhe(r){var e;return r.rank===0||r.rank===1?e=Ie(r,[1,1,1,r.size]):r.rank===2?e=Ie(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=Ie(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function phe(r,e,t,n,a,i){i==null&&(i=.001);var o=U(r,"x","batchNorm"),s=U(e,"mean","batchNorm"),u=U(t,"variance","batchNorm"),l;a!=null&&(l=U(a,"scale","batchNorm"));var c;n!=null&&(c=U(n,"offset","batchNorm")),oe(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),oe(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),oe(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=hhe(o),h={x:f,scale:l,offset:c,mean:s,variance:u},p={varianceEpsilon:i},d=fe.runKernel(ple,h,p);return Ie(d,o.shape)}var Nv=ae({batchNorm_:phe});function dhe(r,e,t,n,a,i){var o=U(r,"x","batchNorm"),s=U(e,"mean","batchNorm"),u=U(t,"variance","batchNorm"),l;a!=null&&(l=U(a,"scale","batchNorm"));var c;return n!=null&&(c=U(n,"offset","batchNorm")),oe(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+(o.rank+".")}),oe(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+("got rank "+s.rank+".")}),oe(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&oe(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&oe(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+("but got rank "+c.rank+".")}),Nv(o,s,u,c,l,i)}var vhe=ae({batchNorm2d_:dhe});function mhe(r,e,t,n,a,i){var o=U(r,"x","batchNorm"),s=U(e,"mean","batchNorm"),u=U(t,"variance","batchNorm"),l;a!=null&&(l=U(a,"scale","batchNorm"));var c;return n!=null&&(c=U(n,"offset","batchNorm")),oe(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+(o.rank+".")}),oe(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+("got rank "+s.rank+".")}),oe(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&oe(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&oe(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+("but got rank "+c.rank+".")}),Nv(o,s,u,c,l,i)}var ghe=ae({batchNorm3d_:mhe});function yhe(r,e,t,n,a,i){var o=U(r,"x","batchNorm"),s=U(e,"mean","batchNorm"),u=U(t,"variance","batchNorm"),l;a!=null&&(l=U(a,"scale","batchNorm"));var c;return n!=null&&(c=U(n,"offset","batchNorm")),oe(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+(o.rank+".")}),oe(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+("got rank "+s.rank+".")}),oe(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&oe(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&oe(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+("but got rank "+c.rank+".")}),Nv(o,s,u,c,l,i)}var bhe=ae({batchNorm4d_:yhe});function whe(r,e,t){var n=U(r,"x","bincount"),a=U(e,"weights","bincount");oe(n.dtype==="int32",function(){return"Error in bincount: input "+("dtype must be int32, but got "+n.dtype)}),oe(t>=0,function(){return"size must be non-negative, but got "+t+"."}),oe(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+("0-length, but got input shape: "+n.shape+", weights shape: ")+(a.shape+".")});var i={x:n,weights:a},o={size:t};return fe.runKernel(_ue,i,o)}var BD=ae({bincount_:whe});function xhe(r,e){var t=U(r,"s0","broadcastArgs","int32"),n=U(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+("Has rank "+t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+("Has rank "+n.rank));var a={s0:t,s1:n};return fe.runKernel(Due,a)}var khe=ae({broadcastArgs_:xhe});function She(r,e){var t=U(r,"broadcastTo","x"),n=t.shape;if(e.some(function(f){return!(f>0)||f%1!==0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Ie(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return Sl(t);var l={x:t},c={reps:o};return fe.runKernel(ED,l,c)}var pv=ae({broadcastTo_:She});function Xo(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",gD(r),new h1(r,e,t)}function Ehe(r){var e=U(r,"x","ceil","float32"),t={x:e};return fe.runKernel(Fue,t)}var The=ae({ceil_:Ehe});function Cv(r,e,t){var n={shape:r,value:e,dtype:t};return fe.runKernel(lle,{},n)}function Ihe(r,e,t){var n=U(r,"x","clipByValue");if(oe(e<=t,function(){return"Error in clip: min ("+e+") must be "+("less than or equal to max ("+t+").")}),e===t)return Cv(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return fe.runKernel(Rue,a,i)}var Nhe=ae({clipByValue_:Ihe});function Che(r,e){var t=U(r,"real","complex"),n=U(e,"imag","complex");Qa(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex().");var a={real:t,imag:n};return fe.runKernel(Mue,a)}var ru=ae({complex_:Che});function Ahe(r){return ra(r,0)}var _he=ae({concat1d_:Ahe});function Dhe(r,e){return ra(r,e)}var Fhe=ae({concat2d_:Dhe});function Rhe(r,e){return ra(r,e)}var Mhe=ae({concat3d_:Rhe});function Ohe(r,e){return ra(r,e)}var Phe=ae({concat4d_:Ohe});function Lhe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=U(r,"x","conv2d","float32"),u=U(e,"filter","conv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=Ie(s,[1,s.shape[0],s.shape[1],s.shape[2]])),oe(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),oe(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+(u.rank+".")}),Si("conv2d",n,o);var f=a==="NHWC"?l.shape[3]:l.shape[1];oe(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match "+("input depth for filter "+u.shape[2]+".")}),oe(Zo(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")});var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=fe.runKernel(Lue,h,p);return c?Ie(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Av=ae({conv2d_:Lhe});function Bhe(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=U(r,"x","conv1d"),u=U(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=Ie(s,[1,s.shape[0],s.shape[1]])),oe(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),oe(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+(u.rank+".")}),Si("conv1d",n,o),oe(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match "+("input depth for filter "+u.shape[1]+".")}),oe(Zo(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+("Got stride "+t+" and dilation '"+i+"'")}),oe(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var f=Ie(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=Ie(l,[l.shape[0],1,l.shape[1],l.shape[2]]),p=[1,t],d=[1,i],v="NHWC",m=Av(h,f,p,n,v,d,o);return c?Ie(m,[m.shape[2],m.shape[3]]):Ie(m,[m.shape[0],m.shape[2],m.shape[3]])}var zhe=ae({conv1d_:Bhe});function $he(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),oe(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var s=r,u=e,l=!1;e.rank===3&&(l=!0,u=Ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),oe(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+(s.length+".")}),oe(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+("rank "+u.rank)}),oe(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+("rank "+t.rank)});var c=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];oe(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must "+("match input depth for filter "+t.shape[2]+".")}),oe(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must "+("match output depth for filter "+t.shape[3]+".")}),Si("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=fe.runKernel(zue,h,p);return l?Ie(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var zD=ae({conv2DBackpropInput_:$he});function Whe(r,e,t,n,a,i){var o=U(r,"x","conv2dTranspose"),s=U(e,"filter","conv2dTranspose");return zD(t,o,s,n,a,"NHWC",i)}var Vhe=ae({conv2dTranspose_:Whe});function Uhe(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=U(r,"x","conv3d"),s=U(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=Ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),oe(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),oe(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+(s.rank+".")}),oe(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match "+("input depth for filter "+s.shape[3]+".")}),oe(Zo(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")}),oe(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var c={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=fe.runKernel($ue,c,f);return l?Ie(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Ghe=ae({conv3d_:Uhe});function Hhe(r,e,t,n,a){oe(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=Ie(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],l=o.shape[4];oe(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+(i.length+".")}),oe(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+("rank "+o.rank)}),oe(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+("rank "+t.rank)}),oe(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must "+("match input depth for filter "+t.shape[3]+".")}),oe(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must "+("match output depth for filter "+t.shape[4]+".")});var c={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=fe.runKernel(Wue,c,f);return s?Ie(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var qhe=ae({conv3DBackpropInput_:Hhe});function Khe(r,e,t,n,a){var i=U(r,"x","conv3dTranspose"),o=U(e,"filter","conv3dTranspose");return qhe(t,i,o,n,a)}var jhe=ae({conv3dTranspose_:Khe});function Xhe(r){var e=U(r,"x","cos","float32"),t={x:e};return fe.runKernel(Vue,t)}var Yhe=ae({cos_:Xhe});function Zhe(r){var e=U(r,"x","cosh","float32"),t={x:e};return fe.runKernel(Uue,t)}var Qhe=ae({cosh_:Zhe});function Jhe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=U(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return fe.runKernel(Gue,i,o)}var epe=ae({cumprod_:Jhe});function tpe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=U(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return fe.runKernel(Hue,i,o)}var rpe=ae({cumsum_:tpe});function npe(r,e,t,n){n===void 0&&(n=!1);var a=U(r,"x","denseBincount"),i=U(e,"weights","denseBincount");oe(a.dtype==="int32",function(){return"Error in denseBincount: input "+("dtype must be int32, but got "+a.dtype)}),oe(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+("rank "+a.rank+".")}),oe(t>=0,function(){return"size must be non-negative, but got "+t+"."}),oe(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+("0-length, but got x shape: "+a.shape+", weights shape: ")+(i.shape+".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return fe.runKernel(Kue,o,s)}var ape=ae({denseBincount_:npe});function ipe(r,e,t){t===void 0&&(t="NHWC");var n=U(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];oe(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}),oe(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+a+" and "+e+`  for depthToSpace with input shape
    `+n.shape}),oe(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+i+" and "+e+` for depthToSpace with input shape
        `+n.shape}),oe(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+n.shape});var s={x:n},u={blockSize:e,dataFormat:t};return fe.runKernel(jue,s,u)}var ope=ae({depthToSpace_:ipe});function spe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=U(r,"x","depthwiseConv2d","float32"),u=U(e,"filter","depthwiseConv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=Ie(s,[1,s.shape[0],s.shape[1],s.shape[2]])),oe(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+("rank "+l.rank+".")}),oe(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+(u.rank+".")});var f=a==="NHWC"?l.shape[3]:l.shape[1];oe(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+("("+f+") must match the inChannels dimension in ")+("filter "+u.shape[2]+".")}),Si("depthwiseConv2d",n,o);var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=fe.runKernel(Xue,h,p);return c?Ie(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var O1=ae({depthwiseConv2d_:spe});function upe(r){var e=U(r,"x","diag"),t={x:e};return fe.runKernel(Que,t)}var lpe=ae({diag_:upe});function cpe(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=U(r,"x","dilation2d"),s=U(e,"filter","dilation2d");oe(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+(o.rank+".")}),oe(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+(s.rank+".")}),oe(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+("but got dataFormat of "+i)});var u=o,l=!1;o.rank===3&&(u=Ie(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);var c={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=fe.runKernel(Jue,c,f);return l?Ie(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var fpe=ae({dilation2d_:cpe});function hpe(r,e){var t,n=U(r,"a","floorDiv"),a=U(e,"b","floorDiv");t=ze(Dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return fe.runKernel(hle,i)}var $D=ae({floorDiv_:hpe});function ppe(r,e){var t,n=U(r,"a","div"),a=U(e,"b","div");if(t=ze(Dr(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return $D(n,a);var i={a:n,b:a},o={};return fe.runKernel(ele,i,o)}var bn=ae({div_:ppe});function dpe(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function rn(r,e){for(var t=[],n=Math.max(r.length,e.length),a=0;a<n;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+(r+" and "+e+".");throw Error(s)}else t.unshift(i)}return t}function vpe(r,e){var t,n=U(r,"a","equal","string_or_numeric"),a=U(e,"b","equal","string_or_numeric");t=ze(Dr(n,a),2),n=t[0],a=t[1],rn(n.shape,a.shape);var i={a:n,b:a};return fe.runKernel(ale,i)}var WD=ae({equal_:vpe});function mpe(r,e,t){var n=U(e,"a","where"),a=U(t,"b","where"),i=U(r,"condition","where","bool"),o=rn(rn(i.shape,n.shape),a.shape),s=pv(i,o),u=pv(n,o),l=pv(a,o),c={condition:s,t:u,e:l};return fe.runKernel(yce,c)}var Nl=ae({where_:mpe});function gpe(r){var e=U(r,"x","zerosLike"),t={x:e};return fe.runKernel(Xce,t)}var P1=ae({zerosLike_:gpe});function ype(r,e){var t,n=U(r,"a","div"),a=U(e,"b","div");t=ze(Dr(n,a),2),n=t[0],a=t[1];var i=bn(n,a),o=P1(i),s=WD(a,o);return Nl(s,o,i)}var bpe=ae({divNoNan_:ype});function wpe(r,e){var t=U(r,"t1","dot"),n=U(e,"t2","dot");oe((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+(t.rank+" and "+n.rank+".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(oe(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+(a+" and "+i+".")}),t.rank===1&&n.rank===1){var o=Ie(t,[1,-1]),s=Ie(n,[-1,1]),u=Vt(o,s);return Ie(u,[])}else if(t.rank===1&&n.rank===2){var o=Ie(t,[1,-1]),s=Ie(n,[n.shape[0],n.shape[1]]),u=Vt(o,s);return Ie(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=Ie(n,[-1,1]),u=Vt(t,s);return Ie(u,[u.size])}else{var s=Ie(n,[n.shape[0],n.shape[1]]),u=Vt(t,s);return u}}var xpe=ae({dot_:wpe});function kpe(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return U(i,"tensors"+o,"einsum")}),a={equation:r};return fe.runKernel(tle,n,a)}var Spe=ae({einsum_:kpe});function Epe(r){var e=U(r,"x","elu","float32"),t={x:e};return fe.runKernel(rle,t)}var VD=ae({elu_:Epe});function Tpe(r){var e=U(r,"x","erf");oe(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=un(e,"float32"));var t={x:e};return fe.runKernel(nle,t)}var Ipe=ae({erf_:Tpe});function Npe(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function _v(r,e){var t=e.map(function(n){return 1});return Npe(r,t,e)}function Cpe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=U(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return fe.runKernel(Rle,a,i)}var Tl=ae({max_:Cpe});function Ape(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=U(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return fe.runKernel(zle,a,i)}var w1=ae({min_:Ape});function _pe(r,e){var t,n=U(r,"base","pow"),a=U(e,"exp","pow");t=ze(Dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return fe.runKernel(ece,i)}var L1=ae({pow_:_pe});function Qo(r,e,t,n){if(n==null&&(n=N1(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Wi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){gD(e);var a=Rn(e),i=Rn(t);oe(a===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+(a+" values but has "+i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Rn(e.slice(o)):!0;oe(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+("("+t+") does not match the provided ")+("shape ("+e+"). ")})}}return!Wi(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?_D(r,n):Tv(r,[],!0),fe.makeTensor(r,e,n)}function Ir(r,e){if((Wi(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Wi(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return Qo(r,t,n,e)}function Dpe(r){var e=U(r,"x","sqrt","float32"),t={x:e};return fe.runKernel(Ice,t)}var x1=ae({sqrt_:Dpe});function Fpe(r){var e=U(r,"x","square"),t={};return fe.runKernel("Square",{x:e},t)}var Dv=ae({square_:Fpe});function Rpe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=U(r,"x","sum");n.dtype==="bool"&&(n=un(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return fe.runKernel(Nce,a,i)}var hr=ae({sum_:Rpe});function Mpe(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=U(r,"x","norm");var a=UD(r,e,t),i=a.shape;if(n){var o=Iv(t,r.shape);i=_v(a.shape,o)}return Ie(a,i)}function UD(r,e,t){if(t===void 0&&(t=null),r.rank===0)return qa(r);if(r.rank!==1&&t===null)return UD(Ie(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return hr(qa(r),t);if(e===1/0)return Tl(qa(r),t);if(e===-1/0)return w1(qa(r),t);if(e==="euclidean"||e===2)return x1(hr(L1(qa(r),Ir(2,"int32")),t));throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&t.length===2){if(e===1)return Tl(hr(qa(r),t[0]),t[1]-1);if(e===1/0)return Tl(hr(qa(r),t[1]),t[0]);if(e===-1/0)return w1(hr(qa(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return x1(hr(Dv(r),t));throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}var Fv=ae({norm_:Mpe});function Ope(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),Fv(r,"euclidean",e,t)}var Ppe=ae({euclideanNorm_:Ope});function Lpe(r){var e=U(r,"x","exp"),t={x:e};return fe.runKernel(ile,t)}var nu=ae({exp_:Lpe});function Bpe(r,e){e===void 0&&(e=0);var t=U(r,"x","expandDims","string_or_numeric");oe(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return fe.runKernel(ole,n,a)}var Js=ae({expandDims_:Bpe});function zpe(r){var e=U(r,"x","expm1"),t={x:e};return fe.runKernel(sle,t)}var $pe=ae({expm1_:zpe});function Wpe(r,e){var t=U(r,"x","tile","string_or_numeric");oe(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" "+("must match length of reps "+e+".")});var n={x:t},a={reps:e};return fe.runKernel(ED,n,a)}var Qf=ae({tile_:Wpe});function Vpe(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=Xo([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=Ie(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return Qf(Js(s,0),[t[0],1,1]);if(t.length===2)return Qf(Js(Js(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Qf(Js(Js(Js(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+("batchShapes, but received "+t.length+"D."))}var GD=ae({eye_:Vpe});function Upe(r){var e=U(r,"x","floor","float32"),t={x:e};return fe.runKernel(fle,t)}var HD=ae({floor_:Upe});function Gpe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=U(r,"x","gather"),i=U(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return fe.runKernel(dle,o,s)}var qD=ae({gather_:Gpe});function Hpe(r,e){var t,n=U(r,"a","greater","string_or_numeric"),a=U(e,"b","greater","string_or_numeric");t=ze(Dr(n,a),2),n=t[0],a=t[1],rn(n.shape,a.shape);var i={a:n,b:a};return fe.runKernel(mle,i)}var Rv=ae({greater_:Hpe});function qpe(r,e){var t,n=U(r,"a","greaterEqual","string_or_numeric"),a=U(e,"b","greaterEqual","string_or_numeric");t=ze(Dr(n,a),2),n=t[0],a=t[1],rn(n.shape,a.shape);var i={a:n,b:a};return fe.runKernel(gle,i)}var KD=ae({greaterEqual_:qpe});function Kpe(r){var e=U(r,"input","imag"),t={input:e};return fe.runKernel(ble,t)}var Mv=ae({imag_:Kpe});function jpe(r){var e=U(r,"x","isFinite"),t={x:e};return fe.runKernel(wle,t)}var Xpe=ae({isFinite_:jpe});function Ype(r){var e=U(r,"x","isInf"),t={x:e};return fe.runKernel(xle,t)}var Zpe=ae({isInf_:Ype});function Qpe(r){var e=U(r,"x","isNaN"),t={x:e};return fe.runKernel(kle,t)}var Jpe=ae({isNaN_:Qpe});function ede(r,e){e===void 0&&(e=.2);var t=U(r,"x","leakyRelu"),n={x:t},a={alpha:e};return fe.runKernel(Sle,n,a)}var jD=ae({leakyRelu_:ede});function tde(r,e){var t,n=U(r,"a","less","string_or_numeric"),a=U(e,"b","less","string_or_numeric");t=ze(Dr(n,a),2),n=t[0],a=t[1],rn(n.shape,a.shape);var i={a:n,b:a};return fe.runKernel(Ele,i)}var rde=ae({less_:tde});function nde(r,e){var t,n=U(r,"a","lessEqual","string_or_numeric"),a=U(e,"b","lessEqual","string_or_numeric");t=ze(Dr(n,a),2),n=t[0],a=t[1],rn(n.shape,a.shape);var i={a:n,b:a};return fe.runKernel(Tle,i)}var B1=ae({lessEqual_:nde});function ade(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return fe.runKernel(Ile,{},n)}function ide(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=U(r,"x","localResponseNormalization");oe(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),oe(eh(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+("integer but got depthRadius "+e+".")});var o=i,s=!1;i.rank===3&&(s=!0,o=Ie(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},l={depthRadius:e,bias:t,alpha:n,beta:a},c=fe.runKernel(Fle,u,l);return s?Ie(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var ode=ae({localResponseNormalization_:ide});function sde(r){var e=U(r,"x","log","float32"),t={x:e};return fe.runKernel(Nle,t)}var th=ae({log_:sde});function ude(r){var e=U(r,"x","log1p"),t={x:e};return fe.runKernel(Cle,t)}var XD=ae({log1p_:ude});function po(r){return fe.customGrad(r)}function lde(r){var e=U(r,"x","neg"),t={x:e};return fe.runKernel(Hle,t)}var ho=ae({neg_:lde});function cde(r){var e=U(r,"x","softplus"),t={x:e};return fe.runKernel(Tce,t)}var YD=ae({softplus_:cde});function fde(r){var e=U(r,"x","logSigmoid"),t=po(function(n){var a=ho(YD(ho(n))),i=function(o){var s=St(o,El(ho(n)));return s};return{value:a,gradFunc:i}});return t(e)}var hde=ae({logSigmoid_:fde});function pde(r,e){var t,n=U(r,"a","sub"),a=U(e,"b","sub");t=ze(Dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return fe.runKernel(Wce,i)}var Dt=ae({sub_:pde});function dde(r,e){e===void 0&&(e=-1);var t=U(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and axis was "+e));var n=po(function(a,i){var o=!0,s=Tl(a,e,!0),u=Dt(a,s),l=Dt(un(u,"float32"),th(hr(nu(u),e,o)));i([l]);var c=function(f,h){var p=ze(h,1),d=p[0],v=!0,m=nu(d);return Dt(f,St(hr(f,e,v),m))};return{value:l,gradFunc:c}});return n(t)}var vde=ae({logSoftmax_:dde});function mde(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=U(r,"x","logSumExp"),a=Iv(e,n.shape),i=Tl(n,a,!0),o=Dt(n,i),s=nu(o),u=hr(s,a),l=th(u),c=tn(Ie(i,l.shape),l);if(t){var f=_v(c.shape,a);return Ie(c,f)}return c}var ZD=ae({logSumExp_:mde});function gde(r,e){var t=U(r,"a","logicalAnd","bool"),n=U(e,"b","logicalAnd","bool");rn(t.shape,n.shape);var a={a:t,b:n};return fe.runKernel(Ale,a)}var kv=ae({logicalAnd_:gde});function yde(r){var e=U(r,"x","logicalNot","bool"),t={x:e};return fe.runKernel(_le,t)}var QD=ae({logicalNot_:yde});function bde(r,e){var t=U(r,"a","logicalOr","bool"),n=U(e,"b","logicalOr","bool");rn(t.shape,n.shape);var a={a:t,b:n};return fe.runKernel(Dle,a)}var JD=ae({logicalOr_:bde});function wde(r,e){var t=U(r,"a","logicalXor","bool"),n=U(e,"b","logicalXor","bool");return rn(t.shape,n.shape),kv(JD(r,e),QD(kv(r,e)))}var xde=ae({logicalXor_:wde});var lv=2147483648;function kde(r,e,t){t===void 0&&(t="left");var n=U(r,"sortedSequence","searchSorted"),a=U(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=Ie(n,[-1,i]),u=Ie(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Rn(u.shape)>=lv)throw new Error("values tensor size must less than "+lv);if(s.shape[1]>=lv)throw new Error("trailing dim_size must less than "+lv+" for int32 output type, was "+s.shape[1]);var l={sortedSequence:s,values:u},c={side:t};return fe.runKernel(gce,l,c)}var z1=ae({searchSorted_:kde});function Sde(r,e){return z1(r,e,"left")}function Ede(r,e,t,n,a){var i=U(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=Ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),oe(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),oe(Zo(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")}),Si("maxPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=fe.runKernel(Ole,l,c);return u?Ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var eF=ae({maxPool_:Ede});function Tde(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=U(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=Ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),oe(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."}),oe(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Si("maxPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=fe.runKernel(Ple,l,c);return u?Ie(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Ide=ae({maxPool3d_:Tde});function Nde(r,e,t,n,a){a===void 0&&(a=!1);var i=U(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=fe.runKernel(Lle,o,s);return{result:u[0],indexes:u[1]}}var Cde=ae({maxPoolWithArgmax_:Nde});function Ade(r,e){var t,n=U(r,"a","maximum"),a=U(e,"b","maximum");t=ze(Dr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=un(n,"int32"),a=un(a,"int32")),rn(n.shape,a.shape);var i={a:n,b:a};return fe.runKernel(Mle,i)}var _de=ae({maximum_:Ade});function Dde(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=U(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return fe.runKernel(Ble,a,i)}var Sv=ae({mean_:Dde});function Cl(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Cl(r,"float32"),n=Cl(r,"float32");return ru(t,n)}var a=A1(Rn(r),e);return fe.makeTensor(a,r,e)}function tu(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=tu(r,"float32"),n=Cl(r,"float32");return ru(t,n)}var a=mD(Rn(r),e);return fe.makeTensor(a,r,e)}function Fde(r,e,t){var n=(t===void 0?{}:t).indexing,a=n===void 0?"xy":n;if(a!=="xy"&&a!=="ij")throw new TypeError(a+" is not a valid third argument to meshgrid");if(r===void 0)return[];var i=U(r,"x","meshgrid",r instanceof Dn?r.dtype:"float32");if(e===void 0)return[i];var o=U(e,"y","meshgrid",e instanceof Dn?e.dtype:"float32"),s=Rn(i.shape),u=Rn(o.shape);return a==="xy"?(i=Ie(i,[1,-1]),o=Ie(o,[-1,1]),[Vt(tu([u,1],i.dtype),i),Vt(o,tu([1,s],o.dtype))]):(i=Ie(i,[-1,1]),o=Ie(o,[1,-1]),[Vt(i,tu([1,u],i.dtype)),Vt(tu([s,1],o.dtype),o)])}function Rde(r,e){var t,n=U(r,"a","minimum"),a=U(e,"b","minimum");t=ze(Dr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=un(n,"int32"),a=un(a,"int32")),rn(n.shape,a.shape);var i={a:n,b:a};return fe.runKernel($le,i)}var tF=ae({minimum_:Rde});function Mde(r,e,t){oe(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+("Got "+t+".")});var n=U(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");oe(e.length===n.rank,function(){return"Padding doesn't match input. Must be "+n.rank+". "+("Got "+e.length+".")});for(var a=t==="reflect"?1:0,i=function(l){oe(e[l].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),oe(e[l][0]>=0&&e[l][0]<=n.shape[l]-a&&e[l][1]>=0&&e[l][1]<=n.shape[l]-a,function(){return"Padding in dimension "+l+" cannot be greater than or equal "+("to "+(n.shape[l]-a)+" or less than 0 for input of ")+("shape "+n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return fe.runKernel(Wle,u,s)}var Ode=ae({mirrorPad_:Mde});function Pde(r,e){var t,n=U(r,"a","mod"),a=U(e,"b","mod");t=ze(Dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return fe.runKernel(Vle,i)}var Lde=ae({mod_:Pde});function Bde(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=U(r,"x","moments");var n=Iv(e,r.shape),a=Sv(r,n,t),i=a.shape;t||(i=_v(a.shape,n));var o=Dv(Dt(un(r,"float32"),Ie(a,i))),s=Sv(o,n,t);return{mean:a,variance:s}}var zde=ae({moments_:Bde});function $de(r,e,t,n){for(var a=U(e,"data","multiRNNCell"),i=yv(t,"c","multiRNNCell"),o=yv(n,"h","multiRNNCell"),s=a,u=[],l=0;l<r.length;l++){var c=r[l](s,i[l],o[l]);u.push(c[0]),u.push(c[1]),s=c[1]}for(var f=[],h=[],l=0;l<u.length;l+=2)f.push(u[l]),h.push(u[l+1]);return[f,h]}var Wde=ae({multiRNNCell_:$de});function Vde(r,e,t,n){n===void 0&&(n=!1);var a=U(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+(i+"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var s=o===1?Ie(a,[1,-1]):a,u={logits:s},l={numSamples:e,seed:t,normalized:n},c=fe.runKernel(Ule,u,l);return o===1?Ie(c,[c.size]):c}var Ude=ae({multinomial_:Vde});function Gde(r,e){var t,n=U(r,"a","notEqual","string_or_numeric"),a=U(e,"b","notEqual","string_or_numeric");t=ze(Dr(n,a),2),n=t[0],a=t[1],rn(n.shape,a.shape);var i={a:n,b:a};return fe.runKernel(qle,i)}var rF=ae({notEqual_:Gde});function Hde(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=U(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return fe.runKernel(Zle,o,s)}var qde=ae({oneHot_:Hde});function Kde(r){var e=U(r,"x","onesLike"),t={x:e};return fe.runKernel(Yle,t)}var jde=ae({onesLike_:Kde});function Xde(r,e){var t=U(r,"v1","outerProduct"),n=U(e,"v2","outerProduct");oe(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+(t.rank+" and "+n.rank+".")});var a=Ie(t,[-1,1]),i=Ie(n,[1,-1]);return Vt(a,i)}var Yde=ae({outerProduct_:Xde});function Zde(r,e,t){t===void 0&&(t=0);var n=U(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return fe.runKernel(Jle,i,a)}var oh=ae({pad_:Zde});function Qde(r,e,t){return t===void 0&&(t=0),oe(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),oh(r,[e],t)}var Jde=ae({pad1d_:Qde});function eve(r,e,t){return t===void 0&&(t=0),oe(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),oh(r,e,t)}var tve=ae({pad2d_:eve});function rve(r,e,t){return t===void 0&&(t=0),oe(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),oh(r,e,t)}var nve=ae({pad3d_:rve});function ave(r,e,t){return t===void 0&&(t=0),oe(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),oh(r,e,t)}var ive=ae({pad4d_:ave});function ove(r,e,t){var n=U(r,"x","spaceToBatchND");oe(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),oe(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),oe(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()});var a={x:n},i={blockShape:e,paddings:t};return fe.runKernel(Cce,a,i)}var nF=ae({spaceToBatchND_:ove});function sve(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=U(r,"x","maxPool"),u=s,l=!1;s.rank===3&&(l=!0,u=Ie(s,[1,s.shape[0],s.shape[1],s.shape[2]])),oe(Zo(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+("Got strides "+i+" and dilations '"+a+"'")});var c=jfe(u.shape,e,i,a,n),f=[c.dilationHeight,c.dilationWidth],h;n==="same"?h=lve([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=ze(uve([c.inHeight,c.inWidth],f,h),2),v=d[0],m=d[1],g=p?n:"valid",y=p?u:nF(u,f,v),b=t==="avg"?function(){return PD(y,e,i,g,o)}:function(){return eF(y,e,i,g,o)},w=b(),k=p?w:LD(w,f,m);return l?Ie(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function uve(r,e,t){var n=t.map(function(c){return c[0]}),a=t.map(function(c){return c[1]}),i=r.concat(n,a),o=e.map(function(c,f){return(c-i[f]%c)%c}),s=a.map(function(c,f){return c+o[f]}),u=e.map(function(c,f){return[n[f],s[f]]}),l=e.map(function(c,f){return[0,o[f]]});return[u,l]}function lve(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var cve=ae({pool_:sve});function fve(r,e){var t=U(r,"x","prelu"),n=U(e,"alpha","prelu"),a={x:t,alpha:n};return fe.runKernel(tce,a)}var aF=ae({prelu_:fve});function hve(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}function pve(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=U(r,"x","prod");n.dtype==="bool"&&(n=un(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return fe.runKernel(rce,a,i)}var dve=ae({prod_:pve});function vve(r,e,t,n){var a=r.map(function(c,f){return U(c,"tensors"+f,"raggedGather","int32")}),i=U(e,"paramsDenseValues","raggedGather"),o=U(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},l=fe.runKernel(nce,s,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}var mve=ae({raggedGather_:vve});function gve(r,e,t,n,a){var i=U(r,"shape","raggedTensorToTensor","int32"),o=U(e,"values","raggedTensorToTensor"),s=U(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return U(f,"tensors"+h,"raggedTensorToTensor","int32")}),l={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},c={rowPartitionTypes:a};return fe.runKernel(ace,l,c)}var yve=ae({raggedTensorToTensor_:gve});function bve(r,e,t){var n=Rn(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type "+t);for(var i=0;i<n;i++)a[i]=e();return fe.makeTensor(a,r,t)}var wve=ae({rand_:bve}),ou=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xve(r){if(r.__esModule)return r;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(t){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}),e}function su(r){var e={exports:{}};return r(e,e.exports),e.exports}var kve=su(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(ou,r,!1)}),Sve=su(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(ou,r,!1)}),Eve=su(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(ou,r,!1)}),Tve=su(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),c.x=p,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(ou,r,!1)}),Ive=su(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=512;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=m,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(ou,r,!1)}),Nve=su(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(ou,r,!1)}),Cve={},Ave={__proto__:null,default:Cve},_ve=xve(Ave),uu=su(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,k,S){var E=[];k=k==!0?{entropy:!0}:k||{};var N=g(m(k.entropy?[w,b(t)]:w??y(),3),E),C=new d(E),R=function(){for(var _=C.g(i),O=u,P=0;_<l;)_=(_+P)*a,O*=a,P=C.g(1);for(;_>=c;)_/=2,O/=2,P>>>=1;return(_+P)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(b(C.S),t),(k.pass||S||function(_,O,P,B){return B&&(B.S&&v(B,C),_.state=function(){return v(C,{})}),P?(n[s]=_,O):_})(R,N,"global"in k?k.global:this==n,k.state)}function d(w){var k,S=w.length,E=this,N=0,C=E.i=E.j=0,R=E.S=[];for(S||(w=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+w[N%S]+(k=R[N])],R[C]=k;(E.g=function(_){for(var O,P=0,B=E.i,W=E.j,L=E.S;_--;)O=L[B=f&B+1],P=P*a+L[f&(L[B]=L[W=f&W+O])+(L[W]=O)];return E.i=B,E.j=W,P})(a)}function v(w,k){return k.i=w.i,k.j=w.j,k.S=w.S.slice(),k}function m(w,k){var S=[],E=typeof w,N;if(k&&E=="object")for(N in w)try{S.push(m(w[N],k-1))}catch{}return S.length?S:E=="string"?w:w+"\0"}function g(w,k){for(var S=w+"",E,N=0;N<S.length;)k[f&N]=f&(E^=k[f&N]*19)+S.charCodeAt(N++);return b(k)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var k=e.navigator,S=k&&k.plugins;return[+new Date,e,S,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=_ve}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:ou,[],Math)});uu.alea=kve;uu.xor128=Sve;uu.xorwow=Eve;uu.xorshift7=Tve;uu.xor4096=Ive;uu.tychei=Nve;var $1=uu;var W1=(function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=$1.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r})(),Dve=(function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=$1.alea(i.toString()),this.randn=new W1(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r})(),Fve=(function(){function r(e,t,n,a){var i=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=$1.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r})();function Rve(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var i=new Dve(e,t,n,a),o=Xo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Mve=ae({randomGamma_:Rve});function Ove(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new W1(e,t,n,!1,a),o=Xo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var iF=ae({randomNormal_:Ove});function Pve(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type "+e);return iF(r,0,1,e,t)}var Lve=ae({randomStandardNormal_:Pve});function Bve(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var i=Xo(r,n),o=new Fve(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var oF=ae({randomUniform_:Bve});function rh(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return fe.runKernel(ice,{},a)}function zve(r){var e=U(r,"input","real"),t={input:e};return fe.runKernel(oce,t)}var nh=ae({real_:zve});function $ve(r){var e=U(r,"x","reciprocal"),t={x:e};return fe.runKernel(sce,t)}var Wve=ae({reciprocal_:$ve});function Vve(r){var e=U(r,"x","relu"),t={x:e};return fe.runKernel(uce,t)}var Ov=ae({relu_:Vve});function Uve(r){var e=U(r,"x","relu6"),t={x:e};return fe.runKernel(hce,t)}var sF=ae({relu6_:Uve});function Gve(r,e){var t=U(r,"x","reverse"),n={x:t},a={dims:e};return fe.runKernel(pce,n,a)}var au=ae({reverse_:Gve});function Hve(r){var e=U(r,"x","reverse");return oe(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),au(e,0)}var qve=ae({reverse1d_:Hve});function Kve(r,e){var t=U(r,"x","reverse");return oe(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),au(t,e)}var jve=ae({reverse2d_:Kve});function Xve(r,e){var t=U(r,"x","reverse");return oe(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),au(t,e)}var Yve=ae({reverse3d_:Xve});function Zve(r,e){var t=U(r,"x","reverse");return oe(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),au(t,e)}var Qve=ae({reverse4d_:Zve});function Jve(r){var e=U(r,"x","round"),t={x:e};return fe.runKernel(dce,t)}var uF=ae({round_:Jve});function eme(r){var e=U(r,"x","rsqrt","float32"),t={x:e};return fe.runKernel(vce,t)}var tme=ae({rsqrt_:eme});function rme(r){var e=U(r,"x","selu"),t={x:e};return fe.runKernel(bce,t)}var nme=ae({selu_:rme});function ame(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=U(r,"x","separableConv2d"),u=U(e,"depthwiseFilter","separableConv2d"),l=U(t,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(s.rank===3&&(f=!0,c=Ie(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");oe(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+("rank "+c.rank+".")}),oe(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+("got rank "+u.rank+".")}),oe(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+("got rank "+u.rank+".")}),oe(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+(" must be 1, but got "+l.shape[0]+".")}),oe(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+("filter must be 1, but got "+l.shape[1]+".")});var h=u.shape[2],p=u.shape[3];oe(l.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+("must be "+h*p+", ")+("but got "+l.shape[2]+".")});var d=O1(c,u,n,a,o,i),v=1,m=Av(d,l,v,"valid",o);return f?Ie(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var ime=ae({separableConv2d_:ame});function ome(r,e){return qt(this,void 0,void 0,function(){var t,n,a,i,o,s,c,u,l,c,f;return Ut(this,function(h){switch(h.label){case 0:return t=U(r,"x","setdiff1d"),n=U(e,"y","setdiff1d"),oe(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),oe(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),oe(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,c=0;c<a.length;c++)o.has(a[c])||s++;for(u=new h1([s],t.dtype),l=new h1([s],"int32"),c=0,f=0;c<a.length;c++)o.has(a[c])||(u.values[f]=a[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})}var sme=ome;function ume(r){var e=U(r,"x","sign"),t={x:e};return fe.runKernel(Sce,t)}var lme=ae({sign_:ume});function cme(r){var e=U(r,"x","sin","float32"),t={x:e};return fe.runKernel(xce,t)}var fme=ae({sin_:cme});function hme(r){var e=U(r,"x","sinh"),t={x:e};return fe.runKernel(kce,t)}var pme=ae({sinh_:hme});function dme(r,e,t){var n=U(r,"x","slice1d");return oe(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),xr(n,[e],[t])}var vme=ae({slice1d_:dme});function mme(r,e,t){var n=U(r,"x","slice2d");return oe(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),xr(n,e,t)}var gme=ae({slice2d_:mme});function yme(r,e,t){var n=U(r,"x","slice3d");return oe(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),xr(n,e,t)}var bme=ae({slice3d_:yme});function wme(r,e,t){var n=U(r,"x","slice4d");return oe(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),xr(n,e,t)}var xme=ae({slice4d_:wme});function kme(r,e){e===void 0&&(e=-1);var t=U(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and dim was "+e));var n={logits:t},a={dim:e};return fe.runKernel(_ce,n,a)}var Sme=ae({softmax_:kme});function Eme(r){oe(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return fe.runKernel(ule,e)}var V1=ae({fft_:Eme});function Tme(r){oe(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return fe.runKernel(yle,e)}var Ev=ae({ifft_:Tme});function Ime(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=Ie(r,[t,e]);n=Ev(a)}else{var i=[t,2*(e-1)],o=Ie(nh(r),[t,e]),s=Ie(Mv(r),[t,e]),u=au(xr(o,[0,1],[t,e-2]),1),l=St(au(xr(s,[0,1],[t,e-2]),1),Ir(-1)),c=ra([o,u],1),f=ra([s,l],1),a=Ie(ru(c,f),[i[0],i[1]]);n=Ev(a)}if(n=nh(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=Ie(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var lF=ae({irfft_:Ime});function Nme(r,e,t){t===void 0&&(t=0);var n=U(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return fe.runKernel(Ace,a,i)}var ah=ae({split_:Nme});function Cme(r,e){oe(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=xr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=ra([r,Cl(s)],r.shape.length-1),t=e}else a=r;var u=P1(a),l=Ie(ru(a,u),[n,t]),c=V1(l),f=Math.floor(t/2)+1,h=nh(c),p=Mv(c),d=ah(h,[f,t-f],h.shape.length-1),v=ah(p,[f,t-f],p.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=f,Ie(ru(d[0],v[0]),m)}var U1=ae({rfft_:Cme});function Ame(r,e){var t,n=U(r,"a","squaredDifference"),a=U(e,"b","squaredDifference");t=ze(Dr(n,a),2),n=t[0],a=t[1],rn(n.shape,a.shape);var i={a:n,b:a},o={};return fe.runKernel(Pce,i,o)}var cF=ae({squaredDifference_:Ame});function _me(r,e){var t=U(r,"x","squeeze","string_or_numeric");return Ie(t,Jse(t.shape,e).newShape)}var G1=ae({squeeze_:_me});function Dme(r,e){e===void 0&&(e=0);var t=yv(r,"tensors","stack","string_or_numeric");oe(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&oe(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return fe.runKernel(Qle,n,a)}var ih=ae({stack_:Dme});function Fme(r,e){e===void 0&&(e=0);var t=U(r,"x","step"),n={x:t},a={alpha:e};return fe.runKernel(Yce,n,a)}var fF=ae({step_:Fme});function Rme(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var l=U(r,"x","stridedSlice","string_or_numeric"),c={x:l},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return fe.runKernel(Lce,c,f)}var Mme=ae({stridedSlice_:Rme});function Ome(r){var e=U(r,"x","tan","float32"),t={x:e};return fe.runKernel(Vce,t)}var Pme=ae({tan_:Ome});function H1(r,e,t){var n=Yo(r,t);return Qo(r,e,n,t)}function xi(r,e){Al(r);var t=Yo(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return Qo(r,n,t,e)}function Jf(r,e,t){if(Al(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Yo(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Qo(r,e,n,t)}function Lme(r,e,t){if(Al(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Yo(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Qo(r,e,n,t)}function Bme(r,e,t){if(Al(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Yo(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Qo(r,e,n,t)}function zme(r,e,t){if(Al(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Yo(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Qo(r,e,n,t)}function $me(r,e,t){if(Al(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Yo(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,Qo(r,e,n,t)}function Wme(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=U(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got "+e);if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") "+("but got "+e));var i={x:n},o={k:e,sorted:t},s=ze(fe.runKernel(Gce,i,o),2),u=s[0],l=s[1];return{values:u,indices:l}}var Vme=ae({topk_:Wme});function Ume(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new W1(e,t,n,!0,a),o=Xo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Gme=ae({truncatedNormal_:Ume});function Hme(r,e){e===void 0&&(e=0);var t=U(r,"x","unique","string_or_numeric");oe(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=ze(fe.runKernel(qce,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var qme=ae({unique_:Hme});function Kme(r,e,t){var n=U(r,"x","unsortedSegmentSum"),a=U(e,"segmentIds","unsortedSegmentSum","int32");oe(eh(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return fe.runKernel(jce,i,o)}var jme=ae({unsortedSegmentSum_:Kme});function Xme(r,e){e===void 0&&(e=0);var t=U(r,"x","unstack","string_or_numeric");oe(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"});var n={value:t},a={axis:e};return fe.runKernel(Kce,n,a)}var q1=ae({unstack_:Xme});function Yme(r,e){return z1(r,e,"right")}function Zme(r,e,t,n){return e===void 0&&(e=!0),fe.makeVariable(r,e,t,n)}function Qme(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=Xo(r,"int32"),i=Xo([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function Jme(r){return qt(this,void 0,void 0,function(){var e,t,n;return Ut(this,function(a){switch(a.label){case 0:return e=U(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=Qme(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var hF=Jme;function ege(r,e,t){return qt(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,v;return Ut(this,function(m){switch(m.label){case 0:for(n=U(r,"tensor","boolMask"),a=U(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,oe(o>0,function(){return"mask cannot be scalar"}),Qa(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=i;l<i+o;l++)u*=s[l];return c=s.slice(0,i).concat([u],s.slice(i+o)),f=Ie(n,c),h=Ie(a,[-1]),[4,hF(h)];case 1:return p=m.sent(),d=G1(p,[1]),v=qD(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,v]}})})}var tge=ege;function rge(r,e){return fe.tidy(r,e)}function nge(r){var e=FD(r);e.forEach(function(t){return t.dispose()})}function age(r,e,t){var n=U(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),oe(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" "+("must match length of perm "+e+".")}),e.forEach(function(o){oe(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+(" but got "+e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?rge(function(){var o=nh(n),s=Mv(n);return o=fe.runKernel(Xb,{x:o},i),s=fe.runKernel(Xb,{x:s},i),t&&(s=ho(s)),ru(o,s)}):fe.runKernel(Xb,a,i)}var k1=ae({transpose_:age});function ige(r,e,t,n,a){a===void 0&&(a=!0);var i=U(r,"v","movingAverage"),o=U(e,"x","movingAverage"),s=U(t,"decay","movingAverage");mfe(i,o),oe(_l(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Ir(1),l=Dt(u,s),c=St(Dt(o,i),l);if(a){oe(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=U(n,"step","movingAverage");c=bn(c,Dt(u,L1(s,f)))}return tn(i,c)}var oge=ae({movingAverage_:ige});function sge(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+("shape[sliceDim:], got updates.shape: "+t.shape)+(", indices.shape: "+e.shape+", shape: "+r)+(", sliceDim: "+n+", and batchDim: "+a+".");if(t.rank<a)throw new Error(i+(" update.rank < "+a+". "));if(r.length<n+(t.rank-a))throw new Error(i+(" Output shape length < "+(n+(t.rank-a))));if(t.rank!==a+r.length-n)throw new Error(i+(" update.rank != "+(a+r.length-n)));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+(" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+(" updates.shape["+(o+a)+"] ("+t.shape[o+a]+") != shape["+(o+a)+"] ("+r[o+a]+")"))}function uge(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+(" but the rank was "+e.rank+"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+(" but the rank was "+r.rank+"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}sge(t,e,r)}function lge(r,e,t){var n=U(r,"indices","scatterND","int32"),a=U(e,"updates","scatterND");uge(a,n,t);var i={indices:n,updates:a},o={shape:t};return fe.runKernel(mce,i,o)}var cge=ae({scatterND_:lge});function fge(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+(" but the dtype was "+r.dtype+"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+(" but got shape "+r.shape+"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+(" "+t.length+", should be: "+i+"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+(e.shape+", should be [] or ["+a+"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function hge(r,e,t,n){n===void 0&&(n=0);var a=U(r,"sparseIndices","sparseToDense","int32"),i=U(e,"sparseValues","sparseToDense","string_or_numeric"),o=U(n,"defaultValue","sparseToDense",i.dtype);fge(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return fe.runKernel(Oce,s,u)}var pge=ae({sparseToDense_:hge});function dge(r,e){var t=U(e,"indices","gatherND","int32"),n=U(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return fe.runKernel(vle,a)}var vge=ae({gatherND_:dge});function mge(r,e){if(e==null)return r.shape.slice();if(_l(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function gge(r,e,t,n){var a=U(r,"x","dropout");if(oe(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+("scaled, but got a "+a.dtype+" tensor instead.")}),oe(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof Dn?a.clone():a;var i=mge(a,t),o=1-e,s=bn(HD(tn(oF(i,0,1,"float32",n),o)),o);return St(a,s)}var yge=ae({dropout_:gge});function pF(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function K1(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return xi(a,"float32")}function bge(r,e,t){return t===void 0&&(t=1),qt(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,v,m,m;return Ut(this,function(g){switch(g.label){case 0:return n=U(r,"predictions","inTopK"),a=U(e,"targets","inTopK"),oe(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+("but got "+n.rank)}),oe(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+(n.rank+" and targets rank "+a.rank)}),Qa(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],oe(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+("dimension ("+i+"), but got "+t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=ze([o.length/i,i],2),l=u[0],c=u[1],f=eue("bool",l),h=0;h<l;h++){for(p=h*c,d=o.subarray(p,p+c),v=[],m=0;m<d.length;m++)v.push({value:d[m],index:m});for(v.sort(function(y,b){return b.value-y.value}),f[h]=0,m=0;m<t;m++)if(v[m].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,H1(f,a.shape,"bool")]}})})}var wge=bge;function xge(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=Ie(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Ie(e,[1,e.shape[0],e.shape[1],e.shape[2]])),oe(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+(s.shape+".")}),oe(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+(u.shape+".")}),oe(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+(t+".")});var l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];oe(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must "+("match input depth in filter ("+t[2]+".")}),oe(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must "+("match output depth for filter ("+t[3]+").")}),Si("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return fe.runKernel(Bue,f,h)}var kge=ae({conv2DBackpropFilter_:xge});function j1(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return St(r,fF(e));throw new Error("Cannot compute gradient for fused activation "+t+".")}function X1(r,e){var t=e,n=dpe(r.shape,e.shape);return n.length>0&&(t=hr(t,n)),Ie(t,r.shape)}function Y1(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Ov(r);if(e==="elu")return VD(r);if(e==="relu6")return sF(r);if(e==="prelu")return aF(r,t);if(e==="leakyrelu")return jD(r,n);if(e==="sigmoid")return El(r);throw new Error("Unknown fused activation "+e+".")}var Z1=function(r,e){var t=r>0;return!t||e==="linear"};function Sge(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,v=r.leakyreluAlpha;if(p=p||"linear",Z1(fe.state.gradientDepth,p)===!1){oe(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of "+s+" but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var m=Av(t,n,a,i,s,l,c);return f!=null&&(m=tn(m,f)),Y1(m,p,d,v)}var g=U(t,"x","conv2d","float32"),y=U(n,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=Ie(g,[1,g.shape[0],g.shape[1],g.shape[2]])),oe(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+(b.rank+".")}),oe(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+(y.rank+".")}),Si("fused conv2d",i,c);var k=s==="NHWC"?b.shape[3]:b.shape[1];oe(y.shape[2]===k,function(){return"Error in conv2d: depth of input ("+k+") must match "+("input depth for filter "+y.shape[2]+".")}),oe(Zo(a,l),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+a+" and dilations '"+l+"'")});var S=M1(b.shape,y.shape,a,l,i,c),E;f!=null&&(E=U(f,"bias","fused conv2d"),e=ze(Dr(E,g),1),E=e[0],s==="NHWC"?rn(S.outShape,E.shape):(oe(E.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+("rank-"+E.shape.length+".")}),oe(E.shape.length===0||E.shape[0]===S.outChannels||E.shape[0]===1,function(){return"Error in fused conv2d: bias shape ("+E.shape+") is not compatible with the number of output channels "+("("+S.outChannels+")")})));var N;if(d!=null){var C=d.shape;if(oe(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+("rank-"+C.length+".")}),C.length===1)oe(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+("("+C+") is not compatible with the number of output ")+("channels ("+S.outChannels+").")});else if(C.length===3)try{rn(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights ("+C+") is not compatible with the output shape of the conv2d "+("("+S.outShape+").");throw Error(R)}N=U(d,"prelu weights","fused conv2d")}var _=function(L,G){oe(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of "+s+" but only NHWC is currently supported."});var M=ze(G,4),$=M[0],K=M[1],j=M[2],te=M[3],Q=j1(L,j,p);oe(xv(l),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+("are not yet supported in gradients. Got dilations '"+l+"'")});var ie=zD(K.shape,Q,$,a,i),le=kge(K,Q,$.shape,a,i),de=[ie,le];if(te!=null){var we=X1(te,Q);de.push(we)}return de},O={x:b,filter:y,bias:E,preluActivationWeights:N},P={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:v};if(f==null){var B=po(function(L,G,M){var $=fe.runKernel(U3,O,P);return M([G,L,$]),w&&($=Ie($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:_}});return B(b,y)}else{var W=po(function(L,G,M,$){var K=fe.runKernel(U3,O,P);return $([G,L,K,M]),w&&(K=Ie(K,[K.shape[1],K.shape[2],K.shape[3]])),{value:K,gradFunc:_}});return W(b,y,E)}}var Ege=ae({fusedConv2d_:Sge});function Tge(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=Ie(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={x:s,dy:u},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return fe.runKernel(Yue,l,c)}var Ige=ae({depthwiseConv2dNativeBackpropFilter_:Tge});function Nge(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={dy:s,filter:t},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=fe.runKernel(Zue,l,c);return u?Ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Cge=ae({depthwiseConv2dNativeBackpropInput_:Nge});function Age(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,v=r.leakyreluAlpha;if(Z1(fe.state.gradientDepth,p)===!1){var m=O1(t,n,a,i,s,l,c);return f!=null&&(m=tn(m,f)),Y1(m,p,d,v)}var g=U(t,"x","depthwiseConv2d","float32"),y=U(n,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=Ie(g,[1,g.shape[0],g.shape[1],g.shape[2]])),oe(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+("rank "+b.rank+".")}),oe(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+("but got rank "+y.rank+".")}),oe(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+("("+b.shape[3]+") must match the inChannels dimension in ")+("filter "+y.shape[2]+".")}),l==null&&(l=[1,1]),oe(Zo(a,l),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+("be 1. Got strides "+a+" and dilations '"+l+"'")}),Si("fused depthwiseConv2d",i,c);var k=M1(b.shape,y.shape,a,l,i,c,!0),S;f!=null&&(S=U(f,"bias","fused conv2d"),e=ze(Dr(S,g),1),S=e[0],rn(k.outShape,S.shape));var E;d!=null&&(E=U(d,"prelu weights","fused depthwiseConv2d"));var N=function(P,B){oe(xv(l),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+("'"+l+"'")});var W=ze(B,4),L=W[0],G=W[1],M=W[2],$=W[3],K=j1(P,M,p),j=Cge(G.shape,K,L,a,i,l,c),te=Ige(G,K,L.shape,a,i,l,c);if($!=null){var Q=X1(S,K);return[j,te,Q]}return[j,te]},C={x:b,filter:y,bias:S,preluActivationWeights:E},R={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:v};if(f==null){var _=po(function(P,B,W){var L=fe.runKernel(G3,C,R);return W([B,P,L]),w&&(L=Ie(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:N}});return _(b,y)}else{var O=po(function(P,B,W,L){var G=fe.runKernel(G3,C,R);return L([B,P,G,W]),w&&(G=Ie(G,[G.shape[1],G.shape[2],G.shape[3]])),{value:G,gradFunc:N}});return O(b,y,S)}}var _ge=ae({fusedDepthwiseConv2d_:Age});function Dge(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,l=r.bias,c=r.activation,f=c===void 0?"linear":c,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(Z1(fe.state.gradientDepth,f)===!1){var v=Vt(n,a,o,u);return l!=null&&(v=tn(v,l)),Y1(v,f,h,d)}var m=U(n,"a","fused matMul"),g=U(a,"b","fused matMul");e=ze(Dr(m,g),2),m=e[0],g=e[1];var y=o?m.shape[m.rank-2]:m.shape[m.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?m.shape[m.rank-1]:m.shape[m.rank-2],k=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=m.shape.slice(0,-2),E=g.shape.slice(0,-2),N=Rn(S),C=Rn(E);oe(y===b,function(){return"Error in fused matMul: inner shapes ("+y+") and ("+(b+") of Tensors with shapes "+m.shape+" and ")+(g.shape+" and transposeA="+o)+(" and transposeB="+u+" must match.")});var R=rn(m.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([w,k]),O=o?Ie(m,[N,y,w]):Ie(m,[N,w,y]),P=u?Ie(g,[C,k,b]):Ie(g,[C,b,k]),B;l!=null&&(B=U(l,"bias","fused matMul"),t=ze(Dr(B,m),1),B=t[0],rn(_,B.shape));var W;h!=null&&(W=U(h,"prelu weights","fused matMul"));var L=function(j,te){var Q=ze(te,4),ie=Q[0],le=Q[1],de=Q[2],we=Q[3],pe=j1(Ie(j,de.shape),de,f),Se,Ee;if(!o&&!u?(Se=Vt(pe,le,!1,!0),Ee=Vt(ie,pe,!0,!1)):!o&&u?(Se=Vt(pe,le,!1,!1),Ee=Vt(pe,ie,!0,!1)):o&&!u?(Se=Vt(le,pe,!1,!0),Ee=Vt(ie,pe,!1,!1)):(Se=Vt(le,pe,!0,!0),Ee=Vt(pe,ie,!0,!0)),l!=null){var Ne=X1(we,pe);return[Se,Ee,Ne]}else return[Se,Ee]},G={a:O,b:P,bias:B,preluActivationWeights:W},M={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(l==null){var $=po(function(j,te,Q){var ie=fe.runKernel(V3,G,M);return Q([j,te,ie]),{value:Ie(ie,_),gradFunc:L}});return $(O,P)}else{var K=po(function(j,te,Q,ie){var le=fe.runKernel(V3,G,M);return ie([j,te,le,Q]),{value:Ie(le,_),gradFunc:L}});return K(O,P,B)}}var Fge=ae({fusedMatMul_:Dge});var Rge={__proto__:null,conv2d:Ege,depthwiseConv2d:_ge,matMul:Fge};function Mge(r){return K1(r,.54,.46)}var Oge=ae({hammingWindow_:Mge});function Pge(r){return K1(r,.5,.5)}var dF=ae({hannWindow_:Pge});function Lge(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(xr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=ra([xr(r,i,e-s),Cv([s],a)]);o.push(u),i+=t}return o.length===0?Jf([],[0,e]):Ie(ra(o),[o.length,e])}var vF=ae({frame_:Lge});function Bge(r,e,t,n,a){a===void 0&&(a=dF),n==null&&(n=pF(e));var i=vF(r,e,t),o=St(i,a(e));return U1(o,n)}var zge=ae({stft_:Bge});function $ge(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=U(r,"image","cropAndResize"),s=U(e,"boxes","cropAndResize","float32"),u=U(t,"boxInd","cropAndResize","int32"),l=s.shape[0];oe(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+("but got rank "+o.rank+".")}),oe(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] "+("but had shape "+s.shape+".")}),oe(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] "+("but had shape "+s.shape+".")}),oe(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+("length "+n.length+".")}),oe(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),oe(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a});var c={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=fe.runKernel(que,c,f);return h}var Wge=ae({cropAndResize_:$ge});function Vge(r){var e=U(r,"image","flipLeftRight","float32");oe(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+("but got rank "+e.rank+".")});var t={image:e},n=fe.runKernel(cle,t,{});return n}var Uge=ae({flipLeftRight_:Vge});function Gge(r){var e=U(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];oe(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+("but got rank "+e.rank+".")}),oe(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+("should be size 1, but got size "+n+".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Qf(e,a)}var Hge=ae({grayscaleToRGB_:Gge});function qge(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=U(r,"image","rotateWithOffset","float32");oe(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+("but got rank "+a.rank+".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=fe.runKernel(Zce,i,o);return s}var Kge=ae({rotateWithOffset_:qge});function Dl(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),oe(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),oe(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),oe(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),oe(e.rank===1,function(){return"scores must be a 1D tensor"}),oe(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", "+("but was "+e.shape[0])}),oe(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function jge(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=U(r,"boxes","nonMaxSuppression","float32"),o=U(e,"scores","nonMaxSuppression","float32"),s=Dl(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return fe.runKernel(Kle,{boxes:i,scores:o},u)}var Xge=ae({nonMaxSuppression_:jge});function Yge(r,e,t){var n=Zge(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function Zge(r,e,t){return Jge(r,e,t||Qge)}function Qge(r,e){return r>e?1:r<e?-1:0}function Jge(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function eye(r,e,t,n,a){return Q1(r,e,t,n,a,0)}function tye(r,e,t,n,a,i){return Q1(r,e,t,n,a,0,!1,i,!0)}function rye(r,e,t,n,a,i){return Q1(r,e,t,n,a,i,!0)}function Q1(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var l=[],c=0;c<e.length;c++)e[c]>a&&l.push({score:e[c],boxIndex:c,suppressBeginIndex:0});l.sort(aD);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&l.length>0;){var d=l.pop(),v=d.score,m=d.boxIndex,g=d.suppressBeginIndex;if(v<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=nye(r,m,h[b]);if(w>=n){y=!0;break}if(d.score=d.score*aye(n,f,w),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===v?(h.push(m),p.push(d.score)):d.score>a&&Yge(l,d,aD))}var k=h.length,S=t-k;s&&S>0&&(h.push.apply(h,sn(new Array(S).fill(0))),p.push.apply(p,sn(new Array(S).fill(0))));var E={selectedIndices:h};return o&&(E.selectedScores=p),u&&(E.validOutputs=k),E}function nye(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-l)*(h-c);if(p<=0||d<=0)return 0;var v=Math.max(i,l),m=Math.max(o,c),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(p+d-b)}function aye(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function aD(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function iye(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),qt(this,void 0,void 0,function(){var i,o,s,u,l,c,f;return Ut(this,function(h){switch(h.label){case 0:return i=U(r,"boxes","nonMaxSuppressionAsync"),o=U(e,"scores","nonMaxSuppressionAsync"),s=Dl(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),l=u[0],c=u[1],f=eye(l,c,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,xi(f,"int32")]}})})}var oye=iye;function sye(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=U(r,"boxes","nonMaxSuppression"),s=U(e,"scores","nonMaxSuppression"),u=Dl(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var l={boxes:o,scores:s},c={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=fe.runKernel(Xle,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}var uye=ae({nonMaxSuppressionWithScore_:sye});function lye(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),qt(this,void 0,void 0,function(){var o,s,u,l,c,f,h,p,d;return Ut(this,function(v){switch(v.label){case 0:return o=U(r,"boxes","nonMaxSuppressionAsync"),s=U(e,"scores","nonMaxSuppressionAsync"),u=Dl(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return l=v.sent(),c=l[0],f=l[1],h=rye(c,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:xi(p,"int32"),selectedScores:xi(d)}]}})})}var cye=lye;function fye(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=U(r,"boxes","nonMaxSuppression"),s=U(e,"scores","nonMaxSuppression"),u=Dl(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:i},d=fe.runKernel(jle,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var hye=ae({nonMaxSuppressionPadded_:fye});function pye(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),qt(this,void 0,void 0,function(){var o,s,u,l,c,f,h,p,d,v,m,g;return Ut(this,function(y){switch(y.label){case 0:return o=U(r,"boxes","nonMaxSuppressionAsync"),s=U(e,"scores","nonMaxSuppressionAsync"),u=Dl(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=ze.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],v=tye(p,d,l,c,f,i),m=v.selectedIndices,g=v.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:xi(m,"int32"),validOutputs:Ir(g,"int32")}]}})})}var dye=pye;function vye(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=U(r,"images","resizeBilinear");oe(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),oe(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+(e+".")}),oe(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=Ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ze(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=fe.runKernel(fce,s,u);return o?Ie(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var mye=ae({resizeBilinear_:vye});function gye(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=U(r,"images","resizeNearestNeighbor");oe(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),oe(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+(e+".")}),oe(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),oe(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=Ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ze(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=fe.runKernel(cce,s,u);return o?Ie(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var yye=ae({resizeNearestNeighbor_:gye});function bye(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=U(r,"image","threshold"),o=.2989,s=.587,u=.114,l=i.shape[0]*i.shape[1],c=St(xi([n]),255),f,h,p,d;if(oe(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+("but got rank "+i.rank+".")}),oe(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+("but got "+i.shape[2]+".")}),oe(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+("but got dtype "+i.dtype+".")}),oe(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was "+e}),i.shape[2]===3){a=ze(ah(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var v=St(f,o),m=St(h,s),g=St(p,u);d=tn(tn(v,m),g)}else d=r;if(e==="otsu"){var y=BD(un(uF(d),"int32"),H1([]),256);c=wye(y,l)}var b=t?B1(d,c):Rv(d,c),w=un(St(b,255),"int32");return w}function wye(r,e){for(var t=xi([-1]),n=xi([0]),a=xi([0]),i,o,s,u,l,c,f=0;f<r.size-1;f++){i=xr(r,0,f+1),o=xr(r,f+1),l=bn(hr(i),e),c=bn(hr(o),e);var h=hr(St(i,rh(0,i.size)));s=bn(h,hr(i));var p=Cv(o.shape,i.size),d=tn(rh(0,o.size),p),v=St(o,d);u=bn(hr(v),hr(o));var m=Dt(s,u),g=Dt(s,u),y=St(l,c);a=St(St(y,m),g);var b=Rv(a,n);n=Nl(b,a,n),t=Nl(b,xi([f]),t)}return t}var xye=ae({threshold_:bye});function kye(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=U(r,"image","transform","float32"),s=U(e,"transforms","transform","float32");oe(o.rank===4,function(){return"Error in transform: image must be rank 4,"+("but got rank "+o.rank+".")}),oe(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),oe(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+("but got "+i+".")});var u={image:o,transforms:s},l={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return fe.runKernel(Hce,u,l)}var Sye=ae({transform_:kye});function Eye(r,e,t){oe(e%1===0,function(){return"bandPart(): numLower must be an integer, got "+e+"."}),oe(t%1===0,function(){return"bandPart(): numUpper must be an integer, got "+t+"."});var n=U(r,"a","bandPart");oe(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got "+n.rank+"."});var a=n.shape,i=ze(n.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+")"+(" must not be greater than the number of rows ("+o+")."));if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+")"+(" must not be greater than the number of columns ("+s+")."));e<0&&(e=o),t<0&&(t=s);var u=Ie(rh(0,o,1,"int32"),[-1,1]),l=rh(0,s,1,"int32"),c=Dt(u,l),f=kv(B1(c,Ir(+e,"int32")),KD(c,Ir(-t,"int32"))),h=Cl([o,s],n.dtype);return Ie(ih(q1(Ie(n,[-1,o,s])).map(function(p){return Nl(f,p,h)})),a)}var Tye=ae({bandPart_:Eye});function Iye(r){var e;if(Array.isArray(r)){e=!1,oe(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){oe(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+("("+r[u].shape[0]+" vs. "+t+")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=ah(r,r.shape[0],0).map(function(u){return G1(u,[0])});oe(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds "+("number of dimensions ("+r[0].shape[0]+").")});for(var i=[],o=r,s=function(u){i.push(fe.tidy(function(){var l=o[u];if(u>0)for(var c=0;c<u;++c){var f=St(hr(St(i[c],l)),i[c]);l=Dt(l,f)}return bn(l,Fv(l,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?ih(i,0):i}var Nye=ae({gramSchmidt_:Iye});function Cye(r,e){if(e===void 0&&(e=!1),oe(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+r.rank}),r.rank===2)return iD(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,l){return u*l}),n=q1(Ie(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var l=ze(iD(u,e),2),c=l[0],f=l[1];a.push(c),i.push(f)});var o=Ie(ih(a,0),r.shape),s=Ie(ih(i,0),r.shape);return[o,s]}function iD(r,e){return e===void 0&&(e=!1),fe.tidy(function(){oe(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor."});for(var t=r.shape[0],n=r.shape[1],a=GD(t),i=Sl(r),o=Jf([[1]],[1,1]),s=Sl(o),u=t>=n?n:t,l=function(f){var h,p=i,d=s,v=a;h=ze(fe.tidy(function(){var m=xr(i,[f,f],[t-f,1]),g=Fv(m),y=xr(i,[f,f],[1,1]),b=Nl(Rv(y,0),Jf([[-1]]),Jf([[1]])),w=Dt(y,St(b,g)),k=bn(m,w);k.shape[0]===1?s=Sl(o):s=ra([o,xr(k,[1,0],[k.shape[0]-1,k.shape[1]])],0);var S=ho(bn(Vt(b,w),g)),E=xr(i,[f,0],[t-f,n]),N=St(S,s),C=k1(s);if(f===0)i=Dt(E,Vt(N,Vt(C,E)));else{var R=Dt(E,Vt(N,Vt(C,E)));i=ra([xr(i,[0,0],[f,n]),R],0)}var _=k1(N),O=xr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=Dt(O,Vt(Vt(O,s),_));else{var P=Dt(O,Vt(Vt(O,s),_));a=ra([xr(a,[0,0],[t,f]),P],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],nge([p,d,v])},c=0;c<u;++c)l(c);return!e&&t>n&&(a=xr(a,[0,0],[t,n]),i=xr(i,[0,0],[n,n])),[a,i]})}var Aye=ae({qr_:Cye});var Fn;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Fn||(Fn={}));function _ye(r,e,t){t===void 0&&(t=Fn.SUM_BY_NONZERO_WEIGHTS);var n=U(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=U(e,"weights","computeWeightedLoss"));var i=a==null?n:St(n,a);if(t===Fn.NONE)return i;if(t===Fn.SUM)return hr(i);if(t===Fn.MEAN){if(a==null)return Sv(i);var o=n.size/a.size,s=bn(hr(i),hr(a));return o>1?bn(s,Ir(o)):s}if(t===Fn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return bn(hr(i),Ir(n.size));var u=St(a,tu(n.shape)),l=un(hr(rF(u,Ir(0))),"float32");return bn(hr(i),l)}throw Error("Unknown reduction: "+t)}var vo=ae({computeWeightedLoss_:_ye});function Dye(r,e,t,n){n===void 0&&(n=Fn.SUM_BY_NONZERO_WEIGHTS);var a=U(r,"labels","absoluteDifference"),i=U(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=U(t,"weights","absoluteDifference")),Qa(a.shape,i.shape,"Error in absoluteDifference: ");var s=qa(Dt(a,i));return vo(s,o,n)}var Fye=ae({absoluteDifference_:Dye});function Rye(r,e,t,n,a){a===void 0&&(a=Fn.SUM_BY_NONZERO_WEIGHTS);var i=U(r,"labels","cosineDistance"),o=U(e,"predictions","cosineDistance"),s=null;n!=null&&(s=U(n,"weights","cosineDistance")),Qa(i.shape,o.shape,"Error in cosineDistance: ");var u=Ir(1),l=Dt(u,hr(St(i,o),t,!0));return vo(l,s,a)}var Mye=ae({cosineDistance_:Rye});function Oye(r,e,t,n){n===void 0&&(n=Fn.SUM_BY_NONZERO_WEIGHTS);var a=U(r,"labels","hingeLoss"),i=U(e,"predictions","hingeLoss"),o=null;t!=null&&(o=U(t,"weights","hingeLoss")),Qa(a.shape,i.shape,"Error in hingeLoss: ");var s=Ir(1);a=Dt(St(Ir(2),a),s);var u=Ov(Dt(s,St(a,i)));return vo(u,o,n)}var Pye=ae({hingeLoss_:Oye});function Lye(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=Fn.SUM_BY_NONZERO_WEIGHTS);var i=U(r,"labels","huberLoss"),o=U(e,"predictions","huberLoss"),s=null;t!=null&&(s=U(t,"weights","huberLoss")),Qa(i.shape,o.shape,"Error in huberLoss: ");var u=Ir(n),l=qa(Dt(o,i)),c=tF(l,u),f=Dt(l,c),h=tn(St(Ir(.5),Dv(c)),St(u,f));return vo(h,s,a)}var Bye=ae({huberLoss_:Lye});function zye(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=Fn.SUM_BY_NONZERO_WEIGHTS);var i=U(r,"labels","logLoss"),o=U(e,"predictions","logLoss"),s=null;t!=null&&(s=U(t,"weights","logLoss")),Qa(i.shape,o.shape,"Error in logLoss: ");var u=Ir(1),l=Ir(n),c=ho(St(i,th(tn(o,l)))),f=St(Dt(u,i),th(tn(Dt(u,o),l))),h=Dt(c,f);return vo(h,s,a)}var $ye=ae({logLoss_:zye});function Wye(r,e,t,n){n===void 0&&(n=Fn.SUM_BY_NONZERO_WEIGHTS);var a=U(r,"labels","meanSquaredError"),i=U(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=U(t,"weights","meanSquaredError")),Qa(a.shape,i.shape,"Error in meanSquaredError: ");var s=cF(a,i);return vo(s,o,n)}var Vye=ae({meanSquaredError_:Wye});function Uye(r,e){var t=U(r,"labels","sigmoidCrossEntropyWithLogits"),n=U(e,"logits","sigmoidCrossEntropyWithLogits");Qa(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Ov(n),i=St(n,t),o=XD(nu(ho(qa(n))));return tn(Dt(a,i),o)}function Gye(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Fn.SUM_BY_NONZERO_WEIGHTS);var i=U(r,"multiClassLabels","sigmoidCrossEntropy"),o=U(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=U(t,"weights","sigmoidCrossEntropy")),Qa(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=Ir(n),l=Ir(1),c=Ir(.5);i=tn(St(i,Dt(l,u)),St(c,u))}var f=Uye(i,o);return vo(f,s,a)}var Hye=ae({sigmoidCrossEntropy_:Gye});function qye(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+("supported. Labels / logits was rank "+e.rank+" ")+("and dim was "+t));var n=po(function(a,i,o){var s=!0,u=ZD(i,[t],s),l=Dt(un(i,"float32"),u);o([a,l]);var c=ho(St(l,a)),f=hr(c,[t]),h=function(p,d){var v=ze(d,2),m=v[0],g=v[1],y=_v(p.shape,[t]);return[St(Ie(p,y),Dt(un(m,"float32"),nu(g))),St(Ie(p,y),Dt(nu(g),un(m,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function Kye(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Fn.SUM_BY_NONZERO_WEIGHTS);var i=U(r,"onehotLabels","softmaxCrossEntropy"),o=U(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=U(t,"weights","softmaxCrossEntropy")),Qa(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=Ir(n),l=Ir(1),c=Ir(i.shape[1]);i=tn(St(i,Dt(l,u)),bn(u,c))}var f=qye(i,o);return vo(f,s,a)}var jye=ae({softmaxCrossEntropy_:Kye});function Xye(r,e,t,n){var a=U(r,"indices","sparseFillEmptyRows","int32"),i=U(e,"values","sparseFillEmptyRows"),o=U(t,"denseShape","sparseFillEmptyRows","int32"),s=U(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `+a.shape);if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape "+i.shape);if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape "+o.shape);if(s.rank!==0)throw new Error("Default value should be a scalar but received shape "+s.shape);var u={indices:a,values:i,denseShape:o,defaultValue:s},l=fe.runKernel(Dce,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}var Yye=ae({sparseFillEmptyRows_:Xye});function Zye(r,e,t){var n=U(r,"inputIndices","sparseReshape","int32"),a=U(e,"inputShape","sparseReshape","int32"),i=U(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `+n.shape);if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape "+a.shape);if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape "+i.shape);var o={inputIndices:n,inputShape:a,newShape:i},s=fe.runKernel(Fce,o);return{outputIndices:s[0],outputShape:s[1]}}var Qye=ae({sparseReshape_:Zye});function Jye(r,e,t){var n=U(r,"data","sparseSegmentMean"),a=U(e,"indices","sparseSegmentMean","int32"),i=U(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `+i.shape);var o={data:n,indices:a,segmentIds:i};return fe.runKernel(Rce,o)}var e0e=ae({sparseSegmentMean_:Jye});function t0e(r,e,t){var n=U(r,"data","sparseSegmentSum"),a=U(e,"indices","sparseSegmentSum","int32"),i=U(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `+i.shape);var o={data:n,indices:a,segmentIds:i};return fe.runKernel(Mce,o)}var r0e=ae({sparseSegmentSum_:t0e});function n0e(r,e,t,n,a,i,o,s){var u=U(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: "+u.shape);var l=U(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var c={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:l},h=fe.runKernel(Bce,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}var a0e=ae({stringNGrams_:n0e});function i0e(r,e,t){t===void 0&&(t=!0);var n=U(r,"input","stringSplit","string"),a=U(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape "+n.shape);if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape "+a.shape);var i={skipEmpty:t},o={input:n,delimiter:a},s=fe.runKernel(zce,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var o0e=ae({stringSplit_:i0e});function s0e(r,e){var t=U(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return fe.runKernel($ce,a,n)}var u0e=ae({stringToHashBucketFast_:s0e});var l0e={fft:V1,ifft:Ev,rfft:U1,irfft:lF},c0e={hammingWindow:Oge,hannWindow:dF,frame:vF,stft:zge},f0e={flipLeftRight:Uge,grayscaleToRGB:Hge,resizeNearestNeighbor:yye,resizeBilinear:mye,rotateWithOffset:Kge,cropAndResize:Wge,nonMaxSuppression:Xge,nonMaxSuppressionAsync:oye,nonMaxSuppressionWithScore:uye,nonMaxSuppressionWithScoreAsync:cye,nonMaxSuppressionPadded:hye,nonMaxSuppressionPaddedAsync:dye,threshold:xye,transform:Sye},h0e={bandPart:Tye,gramSchmidt:Nye,qr:Aye},p0e={absoluteDifference:Fye,computeWeightedLoss:vo,cosineDistance:Mye,hingeLoss:Pye,huberLoss:Bye,logLoss:$ye,meanSquaredError:Vye,sigmoidCrossEntropy:Hye,softmaxCrossEntropy:jye},d0e={sparseFillEmptyRows:Yye,sparseReshape:Qye,sparseSegmentMean:e0e,sparseSegmentSum:r0e},v0e={stringNGrams:a0e,stringSplit:o0e,stringToHashBucketFast:u0e};var hn={__proto__:null,abs:qa,acos:Sfe,acosh:Tfe,add:tn,addN:Cfe,all:_fe,any:Ffe,argMax:Mfe,argMin:Pfe,asin:Bfe,asinh:$fe,atan:Vfe,atan2:Gfe,atanh:qfe,avgPool:PD,avgPool3d:the,basicLSTMCell:che,batchToSpaceND:LD,batchNorm:Nv,batchNorm2d:vhe,batchNorm3d:ghe,batchNorm4d:bhe,bincount:BD,broadcastArgs:khe,broadcastTo:pv,buffer:Xo,cast:un,ceil:The,clipByValue:Nhe,clone:Sl,complex:ru,concat:ra,concat1d:_he,concat2d:Fhe,concat3d:Mhe,concat4d:Phe,conv1d:zhe,conv2d:Av,conv2dTranspose:Vhe,conv3d:Ghe,conv3dTranspose:jhe,cos:Yhe,cosh:Qhe,cumprod:epe,cumsum:rpe,denseBincount:ape,depthToSpace:ope,depthwiseConv2d:O1,diag:lpe,dilation2d:fpe,div:bn,divNoNan:bpe,dot:xpe,einsum:Spe,elu:VD,equal:WD,erf:Ipe,euclideanNorm:Ppe,exp:nu,expandDims:Js,expm1:$pe,eye:GD,fill:Cv,floor:HD,floorDiv:$D,gather:qD,greater:Rv,greaterEqual:KD,imag:Mv,isFinite:Xpe,isInf:Zpe,isNaN:Jpe,leakyRelu:jD,less:rde,lessEqual:B1,linspace:ade,localResponseNormalization:ode,log:th,log1p:XD,logSigmoid:hde,logSoftmax:vde,logSumExp:ZD,logicalAnd:kv,logicalNot:QD,logicalOr:JD,logicalXor:xde,lowerBound:Sde,matMul:Vt,max:Tl,maxPool:eF,maxPool3d:Ide,maxPoolWithArgmax:Cde,maximum:_de,mean:Sv,meshgrid:Fde,min:w1,minimum:tF,mirrorPad:Ode,mod:Lde,moments:zde,mul:St,multiRNNCell:Wde,multinomial:Ude,neg:ho,notEqual:rF,oneHot:qde,ones:tu,onesLike:jde,outerProduct:Yde,pad:oh,pad1d:Jde,pad2d:tve,pad3d:nve,pad4d:ive,pool:cve,pow:L1,prelu:aF,print:hve,prod:dve,raggedGather:mve,raggedTensorToTensor:yve,rand:wve,randomGamma:Mve,randomNormal:iF,randomStandardNormal:Lve,randomUniform:oF,range:rh,real:nh,reciprocal:Wve,relu:Ov,relu6:sF,reshape:Ie,reverse:au,reverse1d:qve,reverse2d:jve,reverse3d:Yve,reverse4d:Qve,round:uF,rsqrt:tme,scalar:Ir,selu:nme,separableConv2d:ime,setdiff1dAsync:sme,sigmoid:El,sign:lme,sin:fme,sinh:pme,slice:xr,slice1d:vme,slice2d:gme,slice3d:bme,slice4d:xme,softmax:Sme,softplus:YD,spaceToBatchND:nF,fft:V1,ifft:Ev,irfft:lF,rfft:U1,split:ah,sqrt:x1,square:Dv,squaredDifference:cF,squeeze:G1,stack:ih,step:fF,stridedSlice:Mme,sub:Dt,sum:hr,tan:Pme,tanh:b1,tensor:H1,tensor1d:xi,tensor2d:Jf,tensor3d:Lme,tensor4d:Bme,tensor5d:zme,tensor6d:$me,tile:Qf,topk:Vme,truncatedNormal:Gme,unique:qme,unsortedSegmentSum:jme,unstack:q1,upperBound:Yme,variable:Zme,where:Nl,whereAsync:hF,zeros:Cl,zerosLike:P1,op:ae,OP_SCOPE_SUFFIX:OD,booleanMaskAsync:tge,transpose:k1,norm:Fv,movingAverage:oge,scatterND:cge,searchSorted:z1,sparseToDense:pge,gatherND:vge,dropout:yge,enclosingPowerOfTwo:pF,cosineWindow:K1,inTopKAsync:wge,image:f0e,linalg:h0e,losses:p0e,spectral:l0e,fused:Rge,signal:c0e,sparse:d0e,string:v0e};var m0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"BiasAdd":case"AddV2":case"Add":return[n.add(A("a",r,e,t),A("b",r,e,t))];case"AddN":return[n.addN(A("tensors",r,e,t))];case"FloorMod":case"Mod":return[n.mod(A("a",r,e,t),A("b",r,e,t))];case"Mul":return[n.mul(A("a",r,e,t),A("b",r,e,t))];case"RealDiv":case"Div":return[n.div(A("a",r,e,t),A("b",r,e,t))];case"DivNoNan":return[n.divNoNan(A("a",r,e,t),A("b",r,e,t))];case"FloorDiv":return[n.floorDiv(A("a",r,e,t),A("b",r,e,t))];case"Sub":return[n.sub(A("a",r,e,t),A("b",r,e,t))];case"Minimum":return[n.minimum(A("a",r,e,t),A("b",r,e,t))];case"Maximum":return[n.maximum(A("a",r,e,t),A("b",r,e,t))];case"Pow":return[n.pow(A("a",r,e,t),A("b",r,e,t))];case"SquaredDifference":return[n.squaredDifference(A("a",r,e,t),A("b",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};var g0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"Abs":case"ComplexAbs":return[n.abs(A("x",r,e,t))];case"Acos":return[n.acos(A("x",r,e,t))];case"Acosh":return[n.acosh(A("x",r,e,t))];case"Asin":return[n.asin(A("x",r,e,t))];case"Asinh":return[n.asinh(A("x",r,e,t))];case"Atan":return[n.atan(A("x",r,e,t))];case"Atan2":return[n.atan2(A("x",r,e,t),A("y",r,e,t))];case"Atanh":return[n.atanh(A("x",r,e,t))];case"Ceil":return[n.ceil(A("x",r,e,t))];case"Complex":return[n.complex(A("real",r,e,t),A("imag",r,e,t))];case"Cos":return[n.cos(A("x",r,e,t))];case"Cosh":return[n.cosh(A("x",r,e,t))];case"Elu":return[n.elu(A("x",r,e,t))];case"Erf":return[n.erf(A("x",r,e,t))];case"Exp":return[n.exp(A("x",r,e,t))];case"Expm1":return[n.expm1(A("x",r,e,t))];case"Floor":return[n.floor(A("x",r,e,t))];case"Log":return[n.log(A("x",r,e,t))];case"Log1p":return[n.log1p(A("x",r,e,t))];case"Imag":return[n.imag(A("x",r,e,t))];case"Neg":return[n.neg(A("x",r,e,t))];case"Reciprocal":return[n.reciprocal(A("x",r,e,t))];case"Real":return[n.real(A("x",r,e,t))];case"Relu":return[n.relu(A("x",r,e,t))];case"Round":return[n.round(A("x",r,e,t))];case"Selu":return[n.selu(A("x",r,e,t))];case"Sigmoid":return[n.sigmoid(A("x",r,e,t))];case"Sin":return[n.sin(A("x",r,e,t))];case"Sign":return[n.sign(A("x",r,e,t))];case"Sinh":return[n.sinh(A("x",r,e,t))];case"Softplus":return[n.softplus(A("x",r,e,t))];case"Sqrt":return[n.sqrt(A("x",r,e,t))];case"Square":return[n.square(A("x",r,e,t))];case"Tanh":return[n.tanh(A("x",r,e,t))];case"Tan":return[n.tan(A("x",r,e,t))];case"ClipByValue":return[n.clipByValue(A("x",r,e,t),A("clipValueMin",r,e,t),A("clipValueMax",r,e,t))];case"Relu6":return[n.relu6(A("x",r,e,t))];case"Rsqrt":return[n.rsqrt(yn(r.inputNames[0],e,t))];case"Prod":return[n.prod(A("x",r,e,t),A("axes",r,e,t))];case"LeakyRelu":return[n.leakyRelu(A("x",r,e,t),A("alpha",r,e,t))];case"Prelu":return[n.prelu(A("x",r,e,t),A("alpha",r,e,t))];case"IsNan":return[n.isNaN(yn(r.inputNames[0],e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};function Ka(r,e,t){if(t===void 0&&(t=""),!(typeof r=="number"||typeof e=="number")){$e.util.assert(r.length===e.length,function(){return t+(" Shapes "+r+" and "+e+" must match")});for(var n=0;n<r.length;n++){var a=r[n],i=e[n];$e.util.assert(a<0||i<0||a===i,function(){return t+(" Shapes "+r+" and "+e+" must match")})}}}function oD(r){return!(typeof r=="number"||r.some(function(e){return e<0}))}function Xf(r,e,t){var n=S1(r,t),a=!oD(n);if(a&&e.length===0)throw new Error("Tried to calculate elements of an empty list"+(" with non-fully-defined elementShape: "+n));if(a&&e.forEach(function(i){n=S1(i.shape,n)}),!oD(n))throw new Error("Non-fully-defined elementShape: "+n);return n}function S1(r,e){if(typeof r=="number")return e;if(typeof e=="number")return r;if(r.length!==e.length)throw new Error("Incompatible ranks during merge: "+r+" vs. "+e);for(var t=[],n=0;n<r.length;++n){var a=r[n],i=e[n];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: "+r+" vs. "+e);t[n]=a>=0?a:i}return t}var y0e=(function(){function r(e,t,n,a,i,o,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=$e.scalar(0),$e.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.size())throw new Error("Tried to read from index "+e+", but array size is: "+this.size());var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},r.prototype.readMany=function(e){var t=this;return e.map(function(n){return t.read(n)})},r.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+`,
          because the value dtype is `+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Ka(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");n.tensor=t,$e.keep(t),n.written=!0,this.tensors[e]=n},r.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,"+("because the index size: "+e.length+" is not the same as tensors size: "+t.length+"."));e.forEach(function(a,i){return n.write(a,t[i])})},r.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(e.length===0)return $e.tensor([],[0].concat(this.elementShape));var a=this.readMany(e);return Ka(this.elementShape,a[0].shape,"TensorArray shape mismatch: "),$e.stack(a,0)},r.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(this.size()===0)return $e.tensor([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var a=this.readMany(t);return Ka(this.elementShape,a[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+a[0].shape+")"),$e.concat(a,0)},r.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var n=Math.max.apply(Math,sn(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(e,$e.unstack(t,0))},r.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var a=0,i=e.map(function(c){return a+=c,a});if(a!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+a+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+e.length+"), and the TensorArray is not marked as dynamically resizeable");var o=a===0?0:t.size/a,s=[];$e.tidy(function(){t=$e.reshape(t,[1,a,o]);for(var c=0;c<e.length;++c){var f=c===0?0:i[c-1],h=[0,f,0],p=[1,e[c],o];s[c]=$e.reshape($e.slice(t,h,p),n.elementShape)}return s});for(var u=[],l=0;l<e.length;l++)u[l]=l;this.writeMany(u,s)},r})(),Pv=(function(){function r(e,t,n,a){a===void 0&&(a=-1),this.tensors=e,this.elementShape=t,this.elementDtype=n,e?.forEach(function(i){if(n!==i.dtype)throw new Error("Invalid data types; op elements "+n+", but list elements "+i.dtype);Ka(t,i.shape,"TensorList shape mismatch: "),$e.keep(i)}),this.idTensor=$e.scalar(0),this.maxNumElements=a,$e.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!0,configurable:!0}),r.prototype.copy=function(){return new r(sn(this.tensors),this.elementShape,this.elementDtype)},r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.stack=function(e,t,n){var a=this;if(n===void 0&&(n=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements "+t+", but list elements "+this.elementDtype);if(n!==-1&&this.tensors.length!==n)throw new Error("Operation expected a list with "+n+" elements but got a list with "+this.tensors.length+" elements.");Ka(e,this.elementShape,"TensorList shape mismatch: ");var i=Xf(this.elementShape,this.tensors,e);return $e.tidy(function(){var o=a.tensors.map(function(s){return $e.reshape(s,i)});return $e.stack(o,0)})},r.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements "+t+", but list elements "+this.elementDtype);if(this.size()===0)throw new Error("Trying to pop from an empty list.");var n=Xf(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,Ka(a.shape,e,"TensorList shape mismatch: "),$e.reshape(a,n)},r.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements "+e.dtype+", but list elements "+this.elementDtype);if(Ka(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");$e.keep(e),this.tensors.push(e)},r.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: "+e);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error("TensorListResize input size "+e+" is greater maxNumElement "+this.maxNumElements+".");var t=new r([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(var n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t},r.prototype.getItem=function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements "+n+", but list elements "+this.elementDtype);if(e<0||e>this.tensors.length)throw new Error("Trying to access element "+e+" in a list with "+this.tensors.length+" elements.");if(this.tensors[e]==null)throw new Error("element at index "+e+" is null.");Ka(this.tensors[e].shape,t,"TensorList shape mismatch: ");var a=Xf(this.elementShape,this.tensors,t);return $e.reshape(this.tensors[e],a)},r.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements "+t.dtype+", but list elements "+this.elementDtype);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error("Trying to set element "+e+" in a list with max "+this.maxNumElements+" elements.");Ka(this.elementShape,t.shape,"TensorList shape mismatch: "),$e.keep(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t},r.prototype.gather=function(e,t,n){var a=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements "+t+", but list elements "+this.elementDtype);Ka(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=Xf(this.elementShape,this.tensors,n);return e.length===0?$e.tensor([],[0].concat(i)):$e.tidy(function(){var o=e.map(function(s){return $e.reshape(a.tensors[s],i)});return $e.stack(o,0)})},r.prototype.concat=function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is "+this.elementDtype+" but concat requested dtype "+e);Ka(this.elementShape,t,"TensorList shape mismatch: ");var a=Xf(this.elementShape,this.tensors,t);return this.size()===0?$e.tensor([],[0].concat(a)):$e.tidy(function(){var i=n.tensors.map(function(o){return $e.reshape(o,a)});return $e.concat(i,0)})},r})();function b0e(r,e,t){var n=r.dtype;if(r.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: "+r.shape);if(r.dtype!==t)throw new Error("Invalid data types; op elements "+r.dtype+", but list elements "+t);var a=r.shape.slice(1);Ka(a,e,"TensorList shape mismatch: ");var i=$e.unstack(r);return new Pv(i,e,n)}function w0e(r,e,t,n){return new Pv([],r,e,n)}function x0e(r,e,t,n){if(e.length!==r.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+r.shape[0]);var a=Math.max.apply(Math,sn(e));if(n!=null&&n!==-1&&a>=n)throw new Error("Max index must be < array size ("+a+"  vs. "+n+")");var i=new Pv([],t,r.dtype,n),o=$e.unstack(r,0);return e.forEach(function(s,u){i.setItem(s,o[u])}),i}function k0e(r,e,t){var n=0,a=e.map(function(f){return n+=f,n});if(n!==r.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+n+", and tensor's shape is: "+r.shape);for(var i=r.shape.slice(1),o=S1(i,t),s=n===0?0:r.size/n,u=$e.tidy(function(){var f=[];r=$e.reshape(r,[1,n,s]);for(var h=0;h<e.length;++h){var p=h===0?0:a[h-1],d=[0,p,0],v=[1,e[h],s];f[h]=$e.reshape($e.slice(r,d,v),o)}return r.dispose(),f}),l=new Pv([],t,r.dtype,e.length),c=0;c<u.length;c++)l.setItem(c,u[c]);return l}var S0e=void 0,E0e=function(r,e,t){return qt(S0e,void 0,void 0,function(){var n,a,i,o,l,h,s,u,l,c,f,h,p,d,v,v,y,m,y,g,y,y,y,Mr,b,it,w,k,S,E,N,C,ie,je,R,_,le,O,Ee,Ne,P,B,W,de,we,L,tt,G,st,M,at,Kt,$,K,j,te,Q,xt,ie,je,Pe,xt,le,it,Xe,Pe,de,we,it,Ge,Pe,it,Ue,pe,Ge,Se,Pe,Ee,Ne,it,Ue,Pe,xt,it,Ue,Ge,Pe,Ke,it,Ue,Pe,tt,Pe,st,it,xt,je,Pe,xt,it,Xe,Pe,at,it,Kt,Pe,xt,Pe,xt,Mr,dn,Br;return Ut(this,function(Or){switch(Or.label){case 0:switch(n=r.op,n){case"If":return[3,1];case"StatelessIf":return[3,1];case"While":return[3,3];case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":return[3,27];case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"EmptyTensorList":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListConcatV2":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35];case"TensorListLength":return[3,36];case"TensorListResize":return[3,37]}return[3,38];case 1:return a=A("thenBranch",r,e,t),i=A("elseBranch",r,e,t),o=A("cond",r,e,t),l=A("args",r,e,t),[4,o.data()];case 2:return h=Or.sent(),h[0]?[2,t.functionMap[a].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap)]:[2,t.functionMap[i].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap)];case 3:return s=A("body",r,e,t),u=A("cond",r,e,t),l=A("args",r,e,t),[4,t.functionMap[u].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap)];case 4:return c=Or.sent(),f=l.map(function(mr){return mr.id}),[4,c[0].data()];case 5:h=Or.sent(),c.forEach(function(mr){!mr.kept&&f.indexOf(mr.id)===-1&&mr.dispose()}),p=l,d=function(){var mr,zn,vn;return Ut(this,function($n){switch($n.label){case 0:return mr=p,[4,t.functionMap[s].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 1:return p=$n.sent(),zn=p.map(function(Cr){return Cr.id}),mr.forEach(function(Cr){!Cr.kept&&f.indexOf(Cr.id)===-1&&zn.indexOf(Cr.id)===-1&&Cr.dispose()}),[4,t.functionMap[u].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 2:return vn=$n.sent(),[4,vn[0].data()];case 3:return h=$n.sent(),vn.forEach(function(Cr){!Cr.kept&&f.indexOf(Cr.id)===-1&&zn.indexOf(Cr.id)===-1&&Cr.dispose()}),[2]}})},Or.label=6;case 6:return h[0]?[5,d()]:[3,8];case 7:return Or.sent(),[3,6];case 8:return[2,p];case 9:return v=A("pred",r,e,t),[2,[fo(v)]];case 10:return v=A("pred",r,e,t),y=A("data",r,e,t),y.kept||(y=fo(y)),[4,v.data()];case 11:return[2,Or.sent()[0]?[void 0,y]:[y,void 0]];case 12:return m=r.inputNames.find(function(mr){return yn(mr,e,t)!==void 0}),m?(y=yn(m,e,t),[2,[fo(y)]]):[2,void 0];case 13:return g=A("frameName",r,e,t),y=A("tensor",r,e,t),t.enterFrame(g),[2,[fo(y)]];case 14:return y=A("tensor",r,e,t),t.exitFrame(),[2,[fo(y)]];case 15:return y=A("tensor",r,e,t),t.nextIteration(),[2,[fo(y)]];case 16:return Mr=A("size",r,e,t),b=A("dtype",r,e,t),it=A("elementShape",r,e,t),w=A("dynamicSize",r,e,t),k=A("clearAfterRead",r,e,t),S=A("identicalElementShapes",r,e,t),E=A("name",r,e,t),N=new y0e(E,b,Mr,it,S,w,k),t.addTensorArray(N),[2,[N.idTensor,$e.scalar(1)]];case 17:return C=A("tensorArrayId",r,e,t),ie=A("index",r,e,t),je=A("tensor",r,e,t),R=t.getTensorArray(C.id),R.write(ie,je),[2,[R.idTensor]];case 18:return _=A("tensorArrayId",r,e,t),le=A("index",r,e,t),O=t.getTensorArray(_.id),[2,[O.read(le)]];case 19:return Ee=A("tensorArrayId",r,e,t),Ne=A("indices",r,e,t),P=A("dtype",r,e,t),B=t.getTensorArray(Ee.id),[2,[B.gather(Ne,P)]];case 20:return W=A("tensorArrayId",r,e,t),de=A("indices",r,e,t),we=A("tensor",r,e,t),L=t.getTensorArray(W.id),L.scatter(de,we),[2,[L.idTensor]];case 21:return tt=A("tensorArrayId",r,e,t),G=t.getTensorArray(tt.id),st=A("dtype",r,e,t),[2,[G.concat(st)]];case 22:return M=A("tensorArrayId",r,e,t),at=A("tensor",r,e,t),Kt=A("lengths",r,e,t),$=t.getTensorArray(M.id),$.split(Kt,at),[2,[$.idTensor]];case 23:return K=A("tensorArrayId",r,e,t),j=t.getTensorArray(K.id),[2,[$e.scalar(j.size(),"int32")]];case 24:return te=A("tensorArrayId",r,e,t),Q=t.getTensorArray(te.id),Q.clearAndClose(),[2,[Q.idTensor]];case 25:return xt=A("tensorListId",r,e,t),ie=A("index",r,e,t),je=A("tensor",r,e,t),Pe=t.getTensorList(xt.id),Pe.setItem(ie,je),[2,[Pe.idTensor]];case 26:return xt=A("tensorListId",r,e,t),le=A("index",r,e,t),it=A("elementShape",r,e,t),Xe=A("elementDType",r,e,t),Pe=t.getTensorList(xt.id),[2,[Pe.getItem(le,it,Xe)]];case 27:return de=A("indices",r,e,t),we=A("tensor",r,e,t),it=A("elementShape",r,e,t),Ge=A("numElements",r,e,t),Pe=x0e(we,de,it,Ge),t.addTensorList(Pe),[2,[Pe.idTensor]];case 28:return it=A("elementShape",r,e,t),Ue=A("elementDType",r,e,t),pe=void 0,r.op==="TensorListReserve"?pe="numElements":pe="maxNumElements",Ge=A(pe,r,e,t),Se=r.op==="TensorListReserve"?-1:Ge,Pe=w0e(it,Ue,Ge,Se),t.addTensorList(Pe),[2,[Pe.idTensor]];case 29:return Ee=A("tensorListId",r,e,t),Ne=A("indices",r,e,t),it=A("elementShape",r,e,t),Ue=A("elementDType",r,e,t),Pe=t.getTensorList(Ee.id),[2,[Pe.gather(Ne,Ue,it)]];case 30:return xt=A("tensorListId",r,e,t),it=A("elementShape",r,e,t),Ue=A("elementDType",r,e,t),Ge=A("numElements",r,e,t),Pe=t.getTensorList(xt.id),[2,[Pe.stack(it,Ue,Ge)]];case 31:return Ke=A("tensor",r,e,t),it=A("elementShape",r,e,t),Ue=A("elementDType",r,e,t),Pe=b0e(Ke,it,Ue),t.addTensorList(Pe),[2,[Pe.idTensor]];case 32:return tt=A("tensorListId",r,e,t),Pe=t.getTensorList(tt.id),st=A("dtype",r,e,t),it=A("elementShape",r,e,t),[2,[Pe.concat(st,it)]];case 33:return xt=A("tensorListId",r,e,t),je=A("tensor",r,e,t),Pe=t.getTensorList(xt.id),Pe.pushBack(je),[2,[Pe.idTensor]];case 34:return xt=A("tensorListId",r,e,t),it=A("elementShape",r,e,t),Xe=A("elementDType",r,e,t),Pe=t.getTensorList(xt.id),[2,[Pe.popBack(it,Xe)]];case 35:return at=A("tensor",r,e,t),it=A("elementShape",r,e,t),Kt=A("lengths",r,e,t),Pe=k0e(at,Kt,it),t.addTensorList(Pe),[2,[Pe.idTensor]];case 36:return xt=A("tensorListId",r,e,t),Pe=t.getTensorList(xt.id),[2,[$e.scalar(Pe.size(),"int32")]];case 37:return xt=A("tensorListId",r,e,t),Mr=A("size",r,e,t),dn=t.getTensorList(xt.id),Br=dn.resize(Mr),t.addTensorList(Br),[2,[Br.idTensor]];case 38:throw TypeError("Node type "+r.op+" is not implemented")}})})};function sD(r,e,t){var n=ze(A("fusedOps",r,e,t),2),a=n[0],i=n[1],o=a==="biasadd",s=!o,u=i==="prelu",l=a==="fusedbatchnorm",c=A("numArgs",r,e,t);if(o){if(u&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=A("strides",r,e,t),h=cv(r,e,t),p=A("dataFormat",r,e,t).toUpperCase(),d=A("dilations",r,e,t),v=ze(A("args",r,e,t),2),m=v[0],g=v[1];s&&(g=m,m=void 0);var y=A("leakyreluAlpha",r,e,t);return{stride:f,pad:h,dataFormat:p,dilations:d,biasArg:m,preluArg:g,activationFunc:i,leakyreluAlpha:y}}var T0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"Conv1D":{var a=A("stride",r,e,t),i=A("pad",r,e,t),o=A("dataFormat",r,e,t).toUpperCase(),s=A("dilation",r,e,t);return[n.conv1d(A("x",r,e,t),A("filter",r,e,t),a,i,o,s)]}case"Conv2D":{var a=A("strides",r,e,t),i=cv(r,e,t),o=A("dataFormat",r,e,t).toUpperCase(),u=A("dilations",r,e,t);return[n.conv2d(A("x",r,e,t),A("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"_FusedConv2D":{var l=sD(r,e,t),a=l.stride,i=l.pad,o=l.dataFormat,u=l.dilations,c=l.biasArg,f=l.preluArg,h=l.activationFunc,p=l.leakyreluAlpha;return[n.fused.conv2d({x:A("x",r,e,t),filter:A("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:c,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{var d=sD(r,e,t),a=d.stride,i=d.pad,o=d.dataFormat,u=d.dilations,c=d.biasArg,f=d.preluArg,h=d.activationFunc,p=d.leakyreluAlpha;return[n.fused.depthwiseConv2d({x:A("x",r,e,t),filter:A("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:c,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{var v=A("outputShape",r,e,t),a=A("strides",r,e,t),i=cv(r,e,t);return[n.conv2dTranspose(A("x",r,e,t),A("filter",r,e,t),v,[a[1],a[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{var a=A("strides",r,e,t),i=cv(r,e,t),u=A("dilations",r,e,t),o=A("dataFormat",r,e,t).toUpperCase();return[n.depthwiseConv2d(A("input",r,e,t),A("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"Conv3D":{var a=A("strides",r,e,t),i=A("pad",r,e,t),o=A("dataFormat",r,e,t).toUpperCase(),u=A("dilations",r,e,t);return[n.conv3d(A("x",r,e,t),A("filter",r,e,t),[a[1],a[2],a[3]],i,o,[u[1],u[2],u[3]])]}case"AvgPool":{var a=A("strides",r,e,t),i=A("pad",r,e,t),m=A("kernelSize",r,e,t);return[n.avgPool(A("x",r,e,t),[m[1],m[2]],[a[1],a[2]],i)]}case"MaxPool":{var a=A("strides",r,e,t),i=A("pad",r,e,t),m=A("kernelSize",r,e,t);return[n.maxPool(A("x",r,e,t),[m[1],m[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{var a=A("strides",r,e,t),i=A("pad",r,e,t),m=A("kernelSize",r,e,t),g=A("includeBatchInIndex",r,e,t),y=n.maxPoolWithArgmax(A("x",r,e,t),[m[1],m[2]],[a[1],a[2]],i,g),b=y.result,w=y.indexes;return[b,w]}case"AvgPool3D":{var a=A("strides",r,e,t),i=A("pad",r,e,t),m=A("kernelSize",r,e,t);return[n.avgPool3d(A("x",r,e,t),[m[1],m[2],m[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{var a=A("strides",r,e,t),i=A("pad",r,e,t),m=A("kernelSize",r,e,t);return[n.maxPool3d(A("x",r,e,t),[m[1],m[2],m[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{var k=A("strides",r,e,t),i=A("pad",r,e,t),u=A("dilations",r,e,t),S=k[1],E=k[2],N=u[1],C=u[2];return[n.dilation2d(A("x",r,e,t),A("filter",r,e,t),[S,E],i,[N,C],"NHWC")]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var I0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"Fill":{var a=A("shape",r,e,t),i=A("dtype",r,e,t),o=A("value",r,e,t);return[n.fill(a,o,i)]}case"LinSpace":{var s=A("start",r,e,t),u=A("stop",r,e,t),l=A("num",r,e,t);return[n.linspace(s,u,l)]}case"Multinomial":{var c=A("logits",r,e,t),f=A("numSamples",r,e,t),h=A("seed",r,e,t);return[n.multinomial(c,f,h)]}case"OneHot":{var p=A("indices",r,e,t),d=A("depth",r,e,t),v=A("onValue",r,e,t),m=A("offValue",r,e,t),i=A("dtype",r,e,t);return[n.oneHot(p,d,v,m,i)]}case"Ones":return[n.ones(A("shape",r,e,t),A("dtype",r,e,t))];case"OnesLike":return[n.onesLike(A("x",r,e,t))];case"RandomStandardNormal":return[n.randomStandardNormal(A("shape",r,e,t),A("dtype",r,e,t),A("seed",r,e,t))];case"RandomUniform":return[n.randomUniform(A("shape",r,e,t),A("minval",r,e,t),A("maxval",r,e,t),A("dtype",r,e,t))];case"Range":{var s=A("start",r,e,t),u=A("stop",r,e,t),g=A("step",r,e,t);return[n.range(s,u,g,A("dtype",r,e,t))]}case"TruncatedNormal":{var a=A("shape",r,e,t),y=A("mean",r,e,t),b=A("stdDev",r,e,t),h=A("seed",r,e,t);return[n.truncatedNormal(a,y,b,A("dtype",r,e,t),h)]}case"Zeros":return[n.zeros(A("shape",r,e,t),A("dtype",r,e,t))];case"ZerosLike":return[n.zerosLike(A("x",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},N0e=void 0;function Qb(r,e,t){var n=A("boxes",r,e,t),a=A("scores",r,e,t),i=A("maxOutputSize",r,e,t),o=A("iouThreshold",r,e,t),s=A("scoreThreshold",r,e,t),u=A("softNmsSigma",r,e,t);return{boxes:n,scores:a,maxOutputSize:i,iouThreshold:o,scoreThreshold:s,softNmsSigma:u}}var C0e=function(r,e,t,n,a){return a===void 0&&(a=hn),qt(N0e,void 0,void 0,function(){var i,o,f,h,p,d,v,s,g,u,f,h,p,d,v,l,g,c,f,h,p,d,v,m,g;return Ut(this,function(y){switch(y.label){case 0:switch(i=r.op,i){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":return[3,5];case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return o=Qb(r,e,t),f=o.boxes,h=o.scores,p=o.maxOutputSize,d=o.iouThreshold,v=o.scoreThreshold,s=o.softNmsSigma,[4,a.image.nonMaxSuppressionWithScoreAsync(f,h,p,d,v,s)];case 2:return g=y.sent(),[2,[g.selectedIndices,g.selectedScores]];case 3:return u=Qb(r,e,t),f=u.boxes,h=u.scores,p=u.maxOutputSize,d=u.iouThreshold,v=u.scoreThreshold,l=A("padToMaxOutputSize",r,e,t),[4,a.image.nonMaxSuppressionPaddedAsync(f,h,p,d,v,l)];case 4:return g=y.sent(),[2,[g.selectedIndices,g.validOutputs]];case 5:return c=Qb(r,e,t),f=c.boxes,h=c.scores,p=c.maxOutputSize,d=c.iouThreshold,v=c.scoreThreshold,[4,a.image.nonMaxSuppressionAsync(f,h,p,d,v)];case 6:return[2,[y.sent()]];case 7:return m=a.cast(A("condition",r,e,t),"bool"),[4,a.whereAsync(m)];case 8:return g=[y.sent()],m.dispose(),[2,g];case 9:return[2,a.setdiff1dAsync(A("x",r,e,t),A("y",r,e,t))];case 10:throw TypeError("Node type "+r.op+" is not implemented")}})})};var A0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"LowerBound":{var a=A("sortedSequence",r,e,t),i=A("values",r,e,t);return[n.lowerBound(a,i)]}case"TopKV2":{var o=A("x",r,e,t),s=A("k",r,e,t),u=A("sorted",r,e,t),l=n.topk(o,s,u);return[l.values,l.indices]}case"UpperBound":{var a=A("sortedSequence",r,e,t),i=A("values",r,e,t);return[n.upperBound(a,i)]}case"Unique":{var o=A("x",r,e,t),l=n.unique(o);return[l.values,l.indices]}case"UniqueV2":{var o=A("x",r,e,t),c=A("axis",r,e,t),l=n.unique(o,c);return[l.values,l.indices]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var _0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"Const":return e[r.name];case"PlaceholderWithDefault":var a=A("default",r,e,t);return[yn(r.name,e,t)||a];case"Placeholder":return[yn(r.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{var i=A("x",r,e,t);return[fo(i)]}case"IdentityN":return A("x",r,e,t).map(function(h){return fo(h)});case"Snapshot":var o=A("x",r,e,t);return[fo(o)];case"Shape":return[n.tensor1d(A("x",r,e,t).shape,"int32")];case"ShapeN":return A("x",r,e,t).map(function(h){return n.tensor1d(h.shape)});case"Size":return[n.scalar(A("x",r,e,t).size,"int32")];case"Rank":return[n.scalar(A("x",r,e,t).rank,"int32")];case"NoOp":return[n.scalar(1)];case"Print":var s=A("x",r,e,t),u=A("data",r,e,t),l=A("message",r,e,t),c=A("summarize",r,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(var f=0;f<u.length;f++)console.log(Array.prototype.slice.call(u[f].dataSync()).slice(0,c));return[s];default:throw TypeError("Node type "+r.op+" is not implemented")}},D0e=(function(){function r(e,t){this.keyDType=e,this.valueDType=t,this.handle=$e.scalar(0),this.tensorMap=new Map,$e.keep(this.handle)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.handle.id},enumerable:!0,configurable:!0}),r.prototype.clearAndClose=function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()},r.prototype.size=function(){return this.tensorMap.size},r.prototype.tensorSize=function(){return Ir(this.size(),"int32")},r.prototype.import=function(e,t){return qt(this,void 0,void 0,function(){var n,a=this;return Ut(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),this.tensorMap.forEach(function(o){return o.dispose()}),this.tensorMap.clear(),[2,$e.tidy(function(){var o=$e.unstack(t),s=n.length,u=o.length;$e.util.assert(s===u,function(){return"The number of elements doesn't match, keys has "+(s+" elements, the values has "+u+" ")+"elements."});for(var l=0;l<s;l++){var c=n[l],f=o[l];$e.keep(f),a.tensorMap.set(c,f)}return a.handle})]}})})},r.prototype.find=function(e,t){return qt(this,void 0,void 0,function(){var n,a=this;return Ut(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),[2,$e.tidy(function(){for(var o=[],s=0;s<n.length;s++){var u=n[s],l=a.findWithDefault(u,t);o.push(l)}return $e.stack(o)})]}})})},r.prototype.findWithDefault=function(e,t){var n=this.tensorMap.get(e);return n??t},r.prototype.checkKeyAndValueTensor=function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype "+this.keyDType+", but got "+(""+e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype "+this.valueDType+", but got "+(""+t.dtype))},r})(),F0e=void 0,R0e=function(r,e,t,n){return qt(F0e,void 0,void 0,function(){var a,i,o,f,c,u,s,f,c,u,l,f,c,f;return Ut(this,function(h){switch(h.label){case 0:switch(a=r.op,a){case"HashTable":return[3,1];case"HashTableV2":return[3,1];case"LookupTableImport":return[3,2];case"LookupTableImportV2":return[3,2];case"LookupTableFind":return[3,4];case"LookupTableFindV2":return[3,4];case"LookupTableSize":return[3,6];case"LookupTableSizeV2":return[3,6]}return[3,7];case 1:return i=A("keyDType",r,e,t),o=A("valueDType",r,e,t),f=new D0e(i,o),n.addHashTable(r.name,f),[2,[f.handle]];case 2:return c=A("tableHandle",r,e,t,n),u=A("keys",r,e,t),s=A("values",r,e,t),f=n.getHashTableById(c.id),[4,f.import(u,s)];case 3:return[2,[h.sent()]];case 4:return c=A("tableHandle",r,e,t,n),u=A("keys",r,e,t),l=A("defaultValue",r,e,t),f=n.getHashTableById(c.id),[4,f.find(u,l)];case 5:return[2,[h.sent()]];case 6:return c=A("tableHandle",r,e,t,n),f=n.getHashTableById(c.id),[2,[f.tensorSize()]];case 7:throw TypeError("Node type "+r.op+" is not implemented")}})})};var M0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"ResizeBilinear":{var a=A("images",r,e,t),i=A("size",r,e,t),o=A("alignCorners",r,e,t),s=A("halfPixelCenters",r,e,t);return[n.image.resizeBilinear(a,[i[0],i[1]],o,s)]}case"ResizeNearestNeighbor":{var a=A("images",r,e,t),i=A("size",r,e,t),o=A("alignCorners",r,e,t),s=A("halfPixelCenters",r,e,t);return[n.image.resizeNearestNeighbor(a,[i[0],i[1]],o,s)]}case"CropAndResize":{var u=A("image",r,e,t),l=A("boxes",r,e,t),c=A("boxInd",r,e,t),f=A("cropSize",r,e,t),h=A("method",r,e,t),p=A("extrapolationValue",r,e,t);return[n.image.cropAndResize(u,l,c,f,h,p)]}case"ImageProjectiveTransformV3":{var a=A("images",r,e,t),d=A("transforms",r,e,t),v=A("outputShape",r,e,t),m=A("fillValue",r,e,t),g=A("interpolation",r,e,t),y=A("fillMode",r,e,t);return[n.image.transform(a,d,g.toLowerCase(),y.toLowerCase(),m,v)]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var O0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"Equal":return[n.equal(A("a",r,e,t),A("b",r,e,t))];case"NotEqual":return[n.notEqual(A("a",r,e,t),A("b",r,e,t))];case"Greater":return[n.greater(A("a",r,e,t),A("b",r,e,t))];case"GreaterEqual":return[n.greaterEqual(A("a",r,e,t),A("b",r,e,t))];case"Less":return[n.less(A("a",r,e,t),A("b",r,e,t))];case"LessEqual":return[n.lessEqual(A("a",r,e,t),A("b",r,e,t))];case"LogicalAnd":return[n.logicalAnd(A("a",r,e,t),A("b",r,e,t))];case"LogicalNot":return[n.logicalNot(A("a",r,e,t))];case"LogicalOr":return[n.logicalOr(A("a",r,e,t),A("b",r,e,t))];case"Select":case"SelectV2":return[n.where(A("condition",r,e,t),A("a",r,e,t),A("b",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},P0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[n.matMul(A("a",r,e,t),A("b",r,e,t),A("transposeA",r,e,t),A("transposeB",r,e,t))];case"Einsum":return[n.einsum.apply(n,sn([A("equation",r,e,t)],A("tensors",r,e,t)))];case"Transpose":return[n.transpose(A("x",r,e,t),A("perm",r,e,t))];case"_FusedMatMul":var a=ze(A("fusedOps",r,e,t),2),i=a[0],o=a[1],s=i==="biasadd",u=o==="prelu",l=A("numArgs",r,e,t),c=A("leakyreluAlpha",r,e,t);if(s){if(u&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=ze(A("args",r,e,t),2),h=f[0],p=f[1];return[n.fused.matMul({a:A("a",r,e,t),b:A("b",r,e,t),transposeA:A("transposeA",r,e,t),transposeB:A("transposeB",r,e,t),bias:h,activation:o,preluActivationWeights:p,leakyreluAlpha:c})];default:throw TypeError("Node type "+r.op+" is not implemented")}};var L0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"EuclideanNorm":return[n.euclideanNorm(A("x",r,e,t),A("axis",r,e,t),A("keepDims",r,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[n.batchNorm(A("x",r,e,t),A("mean",r,e,t),A("variance",r,e,t),A("offset",r,e,t),A("scale",r,e,t),A("epsilon",r,e,t))];case"FusedBatchNormV3":return[n.batchNorm(A("x",r,e,t),A("mean",r,e,t),A("variance",r,e,t),A("offset",r,e,t),A("scale",r,e,t),A("epsilon",r,e,t))];case"LRN":return[n.localResponseNormalization(A("x",r,e,t),A("radius",r,e,t),A("bias",r,e,t),A("alpha",r,e,t),A("beta",r,e,t))];case"Softmax":return[n.softmax(A("x",r,e,t))];case"LogSoftmax":return[n.logSoftmax(A("x",r,e,t))];case"SparseToDense":return[n.sparseToDense(A("sparseIndices",r,e,t),A("outputShape",r,e,t),A("sparseValues",r,e,t),A("defaultValue",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};var B0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"Max":{var a=A("axis",r,e,t),i=A("keepDims",r,e,t);return[n.max(A("x",r,e,t),a,i)]}case"Mean":{var a=A("axis",r,e,t),i=A("keepDims",r,e,t);return[n.mean(A("x",r,e,t),a,i)]}case"Min":{var a=A("axis",r,e,t),i=A("keepDims",r,e,t);return[n.min(A("x",r,e,t),a,i)]}case"Sum":{var a=A("axis",r,e,t),i=A("keepDims",r,e,t);return[n.sum(A("x",r,e,t),a,i)]}case"All":{var a=A("axis",r,e,t),i=A("keepDims",r,e,t);return[n.all(A("x",r,e,t),a,i)]}case"Any":{var a=A("axis",r,e,t),i=A("keepDims",r,e,t);return[n.any(A("x",r,e,t),a,i)]}case"ArgMax":{var a=A("axis",r,e,t);return[n.argMax(A("x",r,e,t),a)]}case"ArgMin":{var a=A("axis",r,e,t);return[n.argMin(A("x",r,e,t),a)]}case"Prod":{var a=A("axis",r,e,t),i=A("keepDims",r,e,t);return[n.prod(A("x",r,e,t),a,i)]}case"Cumprod":{var a=A("axis",r,e,t),o=A("exclusive",r,e,t),s=A("reverse",r,e,t);return[n.cumprod(A("x",r,e,t),a,o,s)]}case"Cumsum":{var a=A("axis",r,e,t),o=A("exclusive",r,e,t),s=A("reverse",r,e,t);return[n.cumsum(A("x",r,e,t),a,o,s)]}case"Bincount":var u=A("x",r,e,t),l=A("weights",r,e,t),c=A("size",r,e,t);return[n.bincount(u,l,c)];case"DenseBincount":{var f=A("x",r,e,t),h=A("weights",r,e,t),p=A("size",r,e,t),d=A("binaryOutput",r,e,t);return[n.denseBincount(f,h,p,d)]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var z0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"ConcatV2":case"Concat":{var a=A("n",r,e,t),i=A("axis",r,e,t),o=A("tensors",r,e,t);return o=o.slice(0,a),[n.concat(o,i)]}case"Gather":{var s=A("x",r,e,t),u=A("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),0)]}case"GatherV2":{var i=A("axis",r,e,t),l=A("batchDims",r,e,t),s=A("x",r,e,t),u=A("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),i,l)]}case"Reverse":{for(var c=A("dims",r,e,t),i=[],f=0;f<c.length;f++)c[f]&&i.push(f);var s=A("x",r,e,t);return[n.reverse(s,i)]}case"ReverseV2":{var i=A("axis",r,e,t),s=A("x",r,e,t);return[n.reverse(s,i)]}case"Slice":{var h=A("begin",r,e,t),p=A("size",r,e,t);return[n.slice(A("x",r,e,t),h,p)]}case"StridedSlice":{var h=A("begin",r,e,t),d=A("end",r,e,t),v=A("strides",r,e,t),m=A("beginMask",r,e,t),g=A("endMask",r,e,t),y=A("ellipsisMask",r,e,t),b=A("newAxisMask",r,e,t),w=A("shrinkAxisMask",r,e,t),k=A("x",r,e,t);return[n.stridedSlice(k,h,d,v,m,g,y,b,w)]}case"Pack":return $e.tidy(function(){var P=A("axis",r,e,t),B=A("tensors",r,e,t),W=B[0].shape,L=n.squeeze(B[0]).shape,G=B.map(function(M){var $=$e.util.arraysEqual(M.shape,W);if(!$&&!$e.util.arraysEqual(n.squeeze(M).shape,L))throw new Error("the input tensors shape does not match");return $?M:n.reshape(M,W)});return[n.stack(G,P)]});case"Unpack":{var i=A("axis",r,e,t),k=A("tensor",r,e,t);return n.unstack(k,i)}case"Tile":{var S=A("reps",r,e,t);return[n.tile(A("x",r,e,t),S)]}case"Split":case"SplitV":{var i=A("axis",r,e,t),E=A("numOrSizeSplits",r,e,t),k=A("x",r,e,t);return n.split(k,E,i)}case"ScatterNd":{var u=A("indices",r,e,t),N=A("values",r,e,t),C=A("shape",r,e,t);return[n.scatterND(u,N,C)]}case"GatherNd":{var R=A("x",r,e,t),u=A("indices",r,e,t);return[n.gatherND(R,u)]}case"SparseToDense":{var u=A("sparseIndices",r,e,t),C=A("outputShape",r,e,t),_=A("sparseValues",r,e,t),O=A("defaultValue",r,e,t);return[n.sparseToDense(u,_,C,_.dtype===O.dtype?O:n.cast(O,_.dtype))]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var $0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"SparseFillEmptyRows":{var a=n.sparse.sparseFillEmptyRows(A("indices",r,e,t),A("values",r,e,t),A("denseShape",r,e,t),A("defaultValue",r,e,t)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u]}case"SparseReshape":{var l=n.sparse.sparseReshape(A("inputIndices",r,e,t),A("inputShape",r,e,t),A("newShape",r,e,t)),i=l.outputIndices,c=l.outputShape;return[i,c]}case"SparseSegmentMean":{var f=n.sparse.sparseSegmentMean(A("data",r,e,t),A("indices",r,e,t),A("segmentIds",r,e,t));return[f]}case"SparseSegmentSum":{var f=n.sparse.sparseSegmentSum(A("data",r,e,t),A("indices",r,e,t),A("segmentIds",r,e,t));return[f]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var W0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"FFT":return[n.fft(A("x",r,e,t))];case"IFFT":return[n.ifft(A("x",r,e,t))];case"RFFT":return[n.rfft(A("x",r,e,t))];case"IRFFT":return[n.irfft(A("x",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};var V0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"StringNGrams":{var a=n.string.stringNGrams(A("data",r,e,t),A("dataSplits",r,e,t),A("separator",r,e,t),A("nGramWidths",r,e,t),A("leftPad",r,e,t),A("rightPad",r,e,t),A("padWidth",r,e,t),A("preserveShortSequences",r,e,t)),i=a.nGrams,o=a.nGramsSplits;return[i,o]}case"StringSplit":{var s=n.string.stringSplit(A("input",r,e,t),A("delimiter",r,e,t),A("skipEmpty",r,e,t)),u=s.indices,l=s.values,c=s.shape;return[u,l,c]}case"StringToHashBucketFast":{var f=n.string.stringToHashBucketFast(A("input",r,e,t),A("numBuckets",r,e,t));return[f]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var U0e=function(r,e,t,n){switch(n===void 0&&(n=hn),r.op){case"Cast":return[n.cast(A("x",r,e,t),A("dtype",r,e,t))];case"ExpandDims":{var a=A("axis",r,e,t);return[n.expandDims(A("x",r,e,t),a)]}case"Squeeze":{var a=A("axis",r,e,t);return[n.squeeze(A("x",r,e,t),a)]}case"Reshape":return[n.reshape(A("x",r,e,t),A("shape",r,e,t))];case"MirrorPad":return[n.mirrorPad(A("x",r,e,t),A("padding",r,e,t),A("mode",r,e,t))];case"PadV2":case"Pad":return[n.pad(A("x",r,e,t),A("padding",r,e,t),A("constantValue",r,e,t))];case"SpaceToBatchND":{var i=A("blockShape",r,e,t),o=A("paddings",r,e,t);return[n.spaceToBatchND(A("x",r,e,t),i,o)]}case"BatchToSpaceND":{var i=A("blockShape",r,e,t),s=A("crops",r,e,t);return[n.batchToSpaceND(A("x",r,e,t),i,s)]}case"DepthToSpace":{var u=A("blockSize",r,e,t),l=A("dataFormat",r,e,t).toUpperCase();return[n.depthToSpace(A("x",r,e,t),u,l)]}case"BroadcastTo":return[n.broadcastTo(A("x",r,e,t),A("shape",r,e,t))];case"BroadcastArgs":return[n.broadcastArgs(A("s0",r,e,t),A("s1",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};function uD(r,e,t,n,a){a===void 0&&(a=M3.tidy);var i=(function(o,s,u){switch(o.category){case"arithmetic":return a(function(){return m0e(o,s,u)});case"basic_math":return a(function(){return g0e(o,s,u)});case"control":return E0e(o,s,u);case"convolution":return a(function(){return T0e(o,s,u)});case"creation":return a(function(){return I0e(o,s,u)});case"dynamic":return C0e(o,s,u);case"evaluation":return a(function(){return A0e(o,s,u)});case"image":return a(function(){return M0e(o,s,u)});case"graph":return a(function(){return _0e(o,s,u)});case"logical":return a(function(){return O0e(o,s,u)});case"matrices":return a(function(){return P0e(o,s,u)});case"normalization":return a(function(){return L0e(o,s,u)});case"reduction":return a(function(){return B0e(o,s,u)});case"slice_join":return a(function(){return z0e(o,s,u)});case"sparse":return a(function(){return $0e(o,s,u)});case"spectral":return a(function(){return W0e(o,s,u)});case"string":return a(function(){return V0e(o,s,u)});case"transformation":return a(function(){return U0e(o,s,u)});case"hash_table":return R0e(o,s,u,n);case"custom":var l=hD(o.op);if(l&&l.customExecutor)return l.customExecutor(new Xse(o,s,u));throw TypeError("Custom op "+o.op+" is not registered.");default:throw TypeError("Unknown op '"+o.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}})(r,e,t);return M3.util.isPromise(i)?i.then(function(o){return[].concat(o)}):[].concat(i)}var lD=(function(){function r(e,t,n,a){e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n={}),a===void 0&&(a={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return r.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(r.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),r.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},r.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":t.frameName+"-"+t.iterationId}).join("/"):""},r.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},r.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")},r.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")},r.prototype.getWeight=function(e){return this.weightMap[e]},r.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},r.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},r.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},r.prototype.getTensorList=function(e){return this.tensorListMap[e]},r.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},r})();function cD(r,e,t,n){var a=new Set,i=[],o=null,s=null,u=new Set,l=Object.keys(r).map(function(p){return ea(p)[0]}),c=[];n!=null&&(c=n.map(function(p){return ea(p.name)[0]}));for(var f=sn(e);f.length>0;){var h=f.pop();if((mF(h)||j0e(h)||X0e(h))&&o==null&&(o=h,s=o.children.map(function(p){return p.name}).filter(function(p){return a.has(p)})),a.add(h.name),t[h.name]==null&&l.indexOf(h.name)===-1&&c.indexOf(h.name)===-1){if(h.inputs.length===0){i.push(h.name);continue}h.inputs.forEach(function(p){u.has(p.name)||(u.add(p.name),f.push(p))})}}return{inputs:r,outputs:e,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function G0e(r,e,t){var n=t.usedNodes,a=t.inputs,i=[],o=Object.keys(a).map(function(f){return ea(f)[0]}).map(function(f){return r.nodes[f]}),s=r.initNodes;o.forEach(function(f){n.has(f.name)&&i.push(f)}),r.weights.forEach(function(f){n.has(f.name)&&i.push(f)}),s?.forEach(function(f){n.has(f.name)&&i.push(f)});for(var u=new Set,l=[];i.length>0;){var c=i.pop();u.add(c.name),e[c.name]||l.push(c),c.children.forEach(function(f){!u.has(f.name)&&n.has(f.name)&&f.inputs.every(function(h){return u.has(h.name)})&&i.push(f)})}return l}var H0e=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],q0e=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],K0e=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function mF(r){return H0e.indexOf(r.op)>=0}function j0e(r){return q0e.indexOf(r.op)>=0}function X0e(r){return K0e.indexOf(r.op)>=0}var fD=(function(){function r(e,t){var n=this;this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(function(a){n._functionExecutorMap[a]=new r(e.functions[a],n)})}return Object.defineProperty(r.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(n){return e[n].map(function(a){return a.id})});this._weightIds=[].concat.apply([],sn(t)),this._weightMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"resourceManager",{set:function(e){this._resourceManager=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?t+":"+e.defaultOutput:t})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,n){return t[n]=e._functions[n].signature,t},{})},enumerable:!0,configurable:!0}),r.prototype.getCompilationKey=function(e,t){var n=e.map(function(i){return i.name}).sort(),a=t.map(function(i){return i.name}).sort();return n.join(this.SEPERATOR)+"--"+a.join(this.SEPERATOR)},r.prototype.compile=function(e,t){var n=cD(e,t,this.weightMap,this._initNodes),a=n.missingInputs,i=n.dynamicNode,o=n.syncInputs;if(i!=null)throw new Error("This execution contains the node '"+i.name+"', which has "+("the dynamic op '"+i.op+"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+("dynamic ops, specify the inputs ["+o+"]"));if(a.length>0){var s=t.map(function(l){return l.name}),u=Object.keys(e);throw new Error("Cannot compute the outputs ["+s+"] from the provided inputs "+("["+u+"]. Missing the following inputs: ["+a+"]"))}return G0e(this.graph,this.weightMap,n)},r.prototype.execute=function(e,t){var n=this;e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(h){return n.graph.nodes[ea(h)[0]]}),o=t.map(function(h){return ea(h)[0]}),s=o.map(function(h){return n.graph.nodes[h]});this.resetIntermediateTensors(),s.length===0&&(s=this._outputs);var u=this.getCompilationKey(i,s),l=this.compiledMap.get(u);l==null&&(l=this.compile(e,s),this.compiledMap.set(u,l));var c={},f={};return $e.tidy(function(){var h=new lD(n.weightMap,c,f,n.functionExecutorMap),p=Object.assign({},n.weightMap);Object.keys(e).forEach(function(b){var w=ze(ea(b),2),k=w[0],S=w[1],E=[];E[S]=e[b],p[k]=E});for(var d=n.getFrozenTensorIds(p),v={},m=0;m<l.length;m++){var g=l[m];if(!p[g.name]){var y=uD(g,p,h,n._resourceManager);if($e.util.isPromise(y))throw new Error("The execution of the op '"+g.op+"' returned a promise. Please use model.executeAsync() instead.");p[g.name]=y,n.checkTensorForDisposal(g.name,g,p,h,d,o,v)}}return n.parent==null&&h.dispose(d),t.map(function(b){return yn(b,p,h)})})},r.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(n){return e[n]}).map(function(n){return n.map(function(a){return a.id})}));return new Set(t)},r.prototype.checkTensorForDisposal=function(e,t,n,a,i,o,s){var u=this;t.category==="control"||o.indexOf(e)!==-1||(n[e].forEach(function(l){l!=null&&(s[l.id]=(s[l.id]||0)+t.children.length)}),t.inputs.forEach(function(l){if(l.category!=="control"){var c=lse(l.name,n,a);c?.forEach(function(f){if(f&&!f.kept&&!i.has(f.id)){var h=s[f.id];if(h===1){if(!u.keepTensorForDebug)f.dispose();else{var p=ze($i(t.name,a),2),d=p[0],v=p[1];u.intermediateTensors[d]||(u.intermediateTensors[d]=[]),u.intermediateTensors[d][v]=f}delete s[f.id]}else h!=null&&s[f.id]--}})}}))},r.prototype.executeAsync=function(e,t){return qt(this,void 0,void 0,function(){return Ut(this,function(n){return[2,this._executeAsync(e,t)]})})},r.prototype.disposeIntermediateTensors=function(){var e=this;this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach(function(t){return e.intermediateTensors[t].forEach(function(n){return n.dispose()})}),this.disposeTensorsMap())},r.prototype.disposeTensorsMap=function(){var e=this;this.tensorsMap&&Object.keys(this.tensorsMap).forEach(function(t){var n=e.tensorsMap[t];n.forEach(function(a){a&&!a.kept&&!a.isDisposed&&!e.keepIds.has(a.id)&&a.dispose()})})},r.prototype.getIntermediateTensors=function(){return this.tensorsMap},r.prototype.resetIntermediateTensors=function(){for(var e in this.intermediateTensors)this.intermediateTensors[e].forEach(function(t){return t.dispose()}),delete this.intermediateTensors[e]},r.prototype._executeAsync=function(e,t,n,a,i){return n===void 0&&(n=!1),a===void 0&&(a={}),i===void 0&&(i={}),qt(this,void 0,void 0,function(){var o,s,u,l,c,f=this;return Ut(this,function(h){switch(h.label){case 0:n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepTensorForDebug=$e.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){console.warn(p.message)}return this.resetIntermediateTensors(),o=new lD(this.weightMap,a,i,this.functionExecutorMap),s=this,[4,this.executeWithControlFlow(e,o,t,n)];case 1:return s.tensorsMap=h.sent(),u=t.map(function(p){return yn(p,f.tensorsMap,o)}),l=u.map(function(p){return p.id}),c=Object.keys(e).map(function(p){return e[p].id}),this.keepIds=new Set(sn(l,c,this.weightIds)),this.keepTensorForDebug||this.disposeTensorsMap(),this.parent==null&&o.dispose(this.keepIds),[2,u]}})})},r.prototype.executeFunctionAsync=function(e,t,n){return qt(this,void 0,void 0,function(){var a,i=this;return Ut(this,function(o){return a=e.reduce(function(s,u,l){return s[i.inputs[l].name]=u,s},{}),[2,this._executeAsync(a,this.outputNodes,!0,t,n)]})})},r.prototype.executeWithControlFlow=function(e,t,n,a){return qt(this,void 0,void 0,function(){var i,o,s,u,l,c,f,h,p,d,v,m,g,y,b,w,k,S=this;return Ut(this,function(E){switch(E.label){case 0:i=Object.keys(e),o=i.map(function(N){return S.graph.nodes[ea(N)[0]]}),s=n.map(function(N){return ea(N)[0]}),u=s.map(function(N){return S.graph.nodes[N]}),u.length===0&&(u=this._outputs),l=cD(e,u,this.weightMap,this._initNodes),c=l.usedNodes,f=l.missingInputs,h=l.dynamicNode,p=l.syncInputs,d=sn(o,this.graph.weights,this._initNodes||[]).map(function(N){return{node:N,contexts:t.currentContext}}),v=Object.assign({},this.weightMap),Object.keys(e).forEach(function(N){var C=ze(ea(N),2),R=C[0],_=C[1],O=[];O[_]=e[N],v[R]=O}),m={},g=this.getFrozenTensorIds(v),y={},E.label=1;case 1:return d.length>0?(b=this.processStack(o,d,t,v,y,g,s,m,c),[4,Promise.all(b)]):[3,3];case 2:return E.sent(),[3,1];case 3:if(h==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),w=u.filter(function(N){return!mF(N)&&!yn(N.name,v,t)}).map(function(N){return N.name}),w.length>0)throw k="",h!=null&&(k="Alternatively, to avoid the dynamic ops, use model.execute() "+("and specify the inputs ["+p+"]")),new Error("Cannot compute the outputs ["+w+"] from the provided "+("inputs ["+i+"]. Consider providing the following inputs: ")+("["+f+"]. "+k));return[2,v]}})})},r.prototype.processStack=function(e,t,n,a,i,o,s,u,l){for(var c=this,f=[],h=function(){var d,v,m=t.pop();n.currentContext=m.contexts;var g="";if(m.node.op==="Enter"&&A("isConstant",m.node,a,n)&&(d=ze($i(m.node.name,n),1),g=d[0]),a[m.node.name]==null){var y=uD(m.node,a,n,p._resourceManager);g||(v=ze($i(m.node.name,n),1),g=v[0]);var b=n.currentContext;$e.util.isPromise(y)?f.push(y.then(function(w){return a[g]=w,n.currentContext=b,c.checkTensorForDisposal(g,m.node,a,n,o,s,u),c.processChildNodes(m.node,t,n,a,i,l),w})):(a[g]=y,p.checkTensorForDisposal(g,m.node,a,n,o,s,u),p.processChildNodes(m.node,t,n,a,i,l))}else p.processChildNodes(m.node,t,n,a,i,l)},p=this;t.length>0;)h();return f},r.prototype.processChildNodes=function(e,t,n,a,i,o){e.children.forEach(function(s){var u=ze($i(s.name,n),1),l=u[0];i[l]||!o.has(s.name)||(s.op==="Merge"?s.inputNames.some(function(c){return!!yn(c,a,n)})&&(i[l]=!0,t.push({contexts:n.currentContext,node:s})):s.inputNames.every(function(c){return!!yn(c,a,n)})&&(i[l]=!0,t.push({contexts:n.currentContext,node:s})))})},r.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(n){return n.dispose()})})},r.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(n){var a=e[n],i=ze(ea(n),1),o=i[0],s=t.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){var u=s.attrParams.shape.value,l=u.length===a.shape.length&&a.shape.every(function(c,f){return u[f]===-1||u[f]===c});$e.util.assert(l,function(){return"The shape of dict['"+s.name+"'] provided in "+("model.execute(dict) must be ["+u+"], but was ")+("["+a.shape+"]")})}s.attrParams.dtype&&s.attrParams.dtype.value&&$e.util.assert(a.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['"+s.name+"'] provided in model.execute(dict) must be "+(s.attrParams.dtype.value+", but was "+a.dtype)})})},r.prototype.mapInputs=function(e){var t={};for(var n in e)if(this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[n]!=null){var a=this._signature.inputs[n];t[a.name]=e[n]}else t[n]=e[n];return t},r.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter(function(a){var i=ze(ea(a),1),o=i[0];return t.graph.nodes[o]==null});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+("keys: ["+n+"] that are not part of graph"))},r.prototype.mapOutputs=function(e){var t=this;return e.map(function(n){if(t._signature!=null&&t._signature.outputs!=null&&t._signature.outputs[n]!=null){var a=t._signature.outputs[n];return a.name}return n},{})},r.prototype.checkOutputs=function(e){var t=this;e.forEach(function(n){var a=ze(ea(n),1),i=a[0];if(!t.graph.nodes[i])throw new Error("The output '"+n+"' is not found in the graph")})},r})(),Y0e=(function(){function r(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.hashTableNameToHandle=e,this.hashTableMap=t}return r.prototype.addHashTable=function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t},r.prototype.getHashTableHandleByName=function(e){return this.hashTableNameToHandle[e]},r.prototype.getHashTableById=function(e){return this.hashTableMap[e]},r.prototype.dispose=function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]},r})(),Z0e="?tfjs-format=file",Q0e="model.json",J1=(function(){function r(e,t,n){t===void 0&&(t={}),n===void 0&&(n=$e.io),this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new Y0e}return Object.defineProperty(r.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"metadata",{get:function(){return this.artifacts.userDefinedMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"modelSignature",{get:function(){return this.signature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"modelStructuredOutputKeys",{get:function(){return this.structuredOutputKeys},enumerable:!0,configurable:!0}),r.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for "+("URL '"+[e]+"'"));this.handler=t[0]}},r.prototype.load=function(){var e=this;if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return $e.util.isPromise(t)?t.then(function(n){return e.loadSync(n)}):this.loadSync(t)},r.prototype.loadSync=function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){var a=this.artifacts.userDefinedMetadata;a.signature!=null&&(n=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}this.signature=n,this.version=t.versions.producer+"."+t.versions.minConsumer;var i=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new fD(P3.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(i),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){var o=P3.Instance.transformGraph(e.modelInitializer);this.initializer=new fD(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0},r.prototype.save=function(e,t){return qt(this,void 0,void 0,function(){var n;return Ut(this,function(a){if(typeof e=="string"){if(n=this.io.getSaveHandlers(e),n.length===0)throw new Error("Cannot find any save handlers for URL '"+e+"'");if(n.length>1)throw new Error("Found more than one ("+n.length+") save handlers for "+("URL '"+e+"'"));e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},r.prototype.predict=function(e,t){var n=this,a=this.execute(e,this.outputNodes);if(this.structuredOutputKeys){var i=a instanceof $e.Tensor?[a]:a,o={};return i.forEach(function(s,u){return o[n.structuredOutputKeys[u]]=s}),o}return a},r.prototype.normalizeInputs=function(e){if(!(e instanceof $e.Tensor)&&!Array.isArray(e))return e;if(e=Array.isArray(e)?e:[e],e.length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,"+("the graph model has "+this.inputNodes.length+" placeholders, ")+("while there are "+e.length+" input tensors."));return this.inputNodes.reduce(function(t,n,a){return t[n]=e[a],t},{})},r.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},r.prototype.execute=function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},r.prototype.executeAsync=function(e,t){return qt(this,void 0,void 0,function(){var n;return Ut(this,function(a){switch(a.label){case 0:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 1:return n=a.sent(),[2,n.length>1?n:n[0]]}})})},r.prototype.getIntermediateTensors=function(){return this.executor.getIntermediateTensors()},r.prototype.disposeIntermediateTensors=function(){this.executor.disposeIntermediateTensors()},r.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,n){return t[n]=[e[n]],t},{})},r.prototype.dispose=function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()},r})();function J0e(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=$e.io),qt(this,void 0,void 0,function(){var n;return Ut(this,function(a){switch(a.label){case 0:if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&typeof r=="string"&&(r=tbe(r)),n=new J1(r,e,t),[4,n.load()];case 1:return a.sent(),[2,n]}})})}function ebe(r){if(r==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var e;if(r instanceof Array){var t=ze(r,2),n=t[0],a=t[1];if(!n)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");var i=$e.io.getWeightSpecs(n.weightsManifest),o=$e.io.getModelArtifactsForJSONSync(n,i,a);e=$e.io.fromMemorySync(o)}else if("load"in r)e=r;else if("modelTopology"in r&&"weightSpecs"in r&&"weightData"in r)e=$e.io.fromMemorySync(r);else throw new Error("Unknown model format");var s=new J1(e);return s.load(),s}function tbe(r){return r.endsWith("/")||(r=r+"/"),""+r+Q0e+Z0e}var rbe="3.21.0";Jo.GraphModel=J1;Jo.deregisterOp=use;Jo.loadGraphModel=J0e;Jo.loadGraphModelSync=ebe;Jo.registerOp=sse;Jo.version_converter=rbe});var ew=gr(()=>{});var yF=gr(()=>{});var zF=gr(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});var Nr=Ds();function nbe(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var kr=nbe(Nr),rw=function(r,e){return rw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},rw(r,e)};function Mt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");rw(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Le(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function Be(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function lu(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function abe(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function ibe(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(abe(arguments[e]));return r}var cu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function obe(r){if(r.__esModule)return r;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(t){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}),e}function fu(r){var e={exports:{}};return r(e,e.exports),e.exports}var sbe=fu(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(cu,r,!1)}),ube=fu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(cu,r,!1)}),lbe=fu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(cu,r,!1)}),cbe=fu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),c.x=p,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(cu,r,!1)}),fbe=fu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=512;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=m,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(cu,r,!1)}),hbe=fu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(cu,r,!1)}),pbe={},dbe={__proto__:null,default:pbe},vbe=obe(dbe),hu=fu(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,k,S){var E=[];k=k==!0?{entropy:!0}:k||{};var N=g(m(k.entropy?[w,b(t)]:w??y(),3),E),C=new d(E),R=function(){for(var _=C.g(i),O=u,P=0;_<l;)_=(_+P)*a,O*=a,P=C.g(1);for(;_>=c;)_/=2,O/=2,P>>>=1;return(_+P)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(b(C.S),t),(k.pass||S||function(_,O,P,B){return B&&(B.S&&v(B,C),_.state=function(){return v(C,{})}),P?(n[s]=_,O):_})(R,N,"global"in k?k.global:this==n,k.state)}function d(w){var k,S=w.length,E=this,N=0,C=E.i=E.j=0,R=E.S=[];for(S||(w=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+w[N%S]+(k=R[N])],R[C]=k;(E.g=function(_){for(var O,P=0,B=E.i,W=E.j,L=E.S;_--;)O=L[B=f&B+1],P=P*a+L[f&(L[B]=L[W=f&W+O])+(L[W]=O)];return E.i=B,E.j=W,P})(a)}function v(w,k){return k.i=w.i,k.j=w.j,k.S=w.S.slice(),k}function m(w,k){var S=[],E=typeof w,N;if(k&&E=="object")for(N in w)try{S.push(m(w[N],k-1))}catch{}return S.length?S:E=="string"?w:w+"\0"}function g(w,k){for(var S=w+"",E,N=0;N<S.length;)k[f&N]=f&(E^=k[f&N]*19)+S.charCodeAt(N++);return b(k)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var k=e.navigator,S=k&&k.plugins;return[+new Date,e,S,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=vbe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:cu,[],Math)});hu.alea=sbe;hu.xor128=ube;hu.xorwow=lbe;hu.xorshift7=cbe;hu.xor4096=fbe;hu.tychei=hbe;var kF=hu;function mbe(r,e){return zv(r,e)}function zv(r,e,t,n){if(t===void 0&&(t=new Map),n===void 0&&(n=new Set),r==null)return null;if(typeof Blob=="function"&&r instanceof Blob)return r.slice();if(n.has(r))throw new Error("Circular references are not supported.");if(t.has(r))return t.get(r);var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(Fl(r)){var i=Array.isArray(r)?[]:{};n.add(r);for(var o in r){var s=r[o],u=zv(s,e,t,n);i[o]=u}return n.delete(r),r.__proto__&&(i.__proto__=r.__proto__),i}else throw new Error("Can't recurse into non-iterable type: "+r);else return t.set(r,a.value),a.value}function gbe(r,e){return e===void 0&&(e=EF),SF(r,e)}function SF(r,e,t){t===void 0&&(t=new Set);var n=r[0];if(t.has(n))throw new Error("Circular references are not supported.");var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(Fl(n)){var i=Array.isArray(n)?[]:{};t.add(n);var o=function(u){var l=r.map(function(f){return f[u]}),c=SF(l,e,t);i[u]=c};for(var s in n)o(s);return t.delete(n),i}else throw new Error("Can't recurse into non-iterable type: "+n);else return a.value}function EF(r){return r===null?null:Fl(r[0])?{value:null,recurse:!0}:{value:r,recurse:!1}}function TF(r,e){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f;return Be(this,function(h){switch(h.label){case 0:t=new Map,zv(r,e,t),h.label=1;case 1:h.trys.push([1,6,7,8]),n=lu(Array.from(t.keys())),a=n.next(),h.label=2;case 2:return a.done?[3,5]:(i=a.value,o=t.get(i),kr.util.isPromise(o)?[4,o]:[3,4]);case 3:s=h.sent(),t.set(i,s),h.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),c={error:u},[3,8];case 7:try{a&&!a.done&&(f=n.return)&&f.call(n)}finally{if(c)throw c.error}return[7];case 8:return l=zv(r,e,t),[2,l]}})})}function Fl(r){var e=!1;if(kr.env().get("IS_BROWSER"))e=r instanceof TextDecoder;else{var t=ew().StringDecoder;e=r instanceof t}return r!=null&&!ArrayBuffer.isView(r)&&(Array.isArray(r)||typeof r=="object"&&!(r instanceof kr.Tensor)&&!(r instanceof Promise)&&!e)}function ybe(r){return r==null||bbe(r)||Array.isArray(r)||typeof r=="object"&&r instanceof kr.Tensor||kr.util.isTypedArray(r)}function bbe(r){return r===null||typeof r!="object"&&typeof r!="function"}function wbe(r){return mbe(r,xbe)}function xbe(r){return r instanceof kr.Tensor?{value:r.clone(),recurse:!1}:Fl(r)?{value:null,recurse:!0}:{value:r,recurse:!1}}var IF=(function(){function r(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return r.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},r.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},r.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},r.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},r.prototype.isFull=function(){return this.length()===this.capacity},r.prototype.isEmpty=function(){return this.length()===0},r.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},r.prototype.pushAll=function(e){var t,n;try{for(var a=lu(e),i=a.next();!i.done;i=a.next()){var o=i.value;this.push(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},r.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},r.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},r.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},r})(),NF=(function(r){Mt(e,r);function e(){return r.call(this,e.INITIAL_CAPACITY)||this}return e.prototype.isFull=function(){return!1},e.prototype.push=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.push.call(this,t)},e.prototype.unshift=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=this.capacity*2,n=new Array(t),a=this.length(),i=0;i<a;i++)n[i]=this.get(this.wrap(this.begin+i));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=a},e})(IF);NF.INITIAL_CAPACITY=32;function CF(r){return new Ebe(r)}function nw(r){return new Tbe(r)}function kbe(r,e){return new AF(r,e)}function Sbe(r,e){return e===void 0&&(e=es.FAIL),new Mbe(r,e)}var nn=(function(){function r(){}return r.prototype.toArray=function(){return Le(this,void 0,void 0,function(){var e,t;return Be(this,function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}})})},r.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){var e,t,n;return Be(this,function(a){switch(a.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=a.sent(),a.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=a.sent(),[3,2];case 4:return[2,t]}})})},r.prototype.resolveFully=function(){return Le(this,void 0,void 0,function(){var e;return Be(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},r.prototype.resolveWhile=function(e){return Le(this,void 0,void 0,function(){var t,n;return Be(this,function(a){switch(a.label){case 0:return[4,this.next()];case 1:t=a.sent(),n=e(t.value),a.label=2;case 2:return!t.done&&n?[4,this.next()]:[3,4];case 3:return t=a.sent(),n=e(t.value),[3,2];case 4:return[2]}})})},r.prototype.handleErrors=function(e){return new Fbe(this,e)},r.prototype.filter=function(e){return new _be(this,e)},r.prototype.map=function(e){return new Dbe(this,e)},r.prototype.mapAsync=function(e){return new bF(this,e)},r.prototype.serialMapAsync=function(e){return new bF(this,e).serial()},r.prototype.flatmap=function(e){return new Rbe(this,e)},r.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.map(e).resolveFully()]})})},r.prototype.serialForEach=function(e){return Le(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(n){return n===!0})]})})},r.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new Abe(this,e,t)},r.prototype.columnMajorBatch=function(e,t,n){t===void 0&&(t=!0),n===void 0&&(n=EF);var a=this.rowMajorBatch(e,t);return a.map(function(i){return gbe(i,n)})},r.prototype.concatenate=function(e,t){return new AF(CF([this,e]),t)},r.prototype.take=function(e){return e<0||e==null?this:new Cbe(this,e)},r.prototype.skip=function(e){return e<0||e==null?this:new Nbe(this,e)},r.prototype.prefetch=function(e){return new _F(this,e)},r.prototype.shuffle=function(e,t){return new Obe(this,e,t)},r.prototype.serial=function(){return new Ibe(this)},r})(),Ebe=(function(r){Mt(e,r);function e(t){var n=r.call(this)||this;return n.items=t,n.trav=0,n}return e.prototype.summary=function(){return"Array of "+this.items.length+" items"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return Be(this,function(n){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:wbe(t),done:!1}])})})},e})(nn),Tbe=(function(r){Mt(e,r);function e(t){var n=r.call(this)||this;return n.nextFn=t,n}return e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){try{return[2,this.nextFn()]}catch(n){throw n.message="Error thrown while iterating through a dataset: "+n.message,n}return[2]})})},e})(nn),Ibe=(function(r){Mt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return e.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.upstream.next()]})})},e})(nn),Nbe=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return Be(this,function(n){switch(n.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return t=n.sent(),t.done?[2,t]:(kr.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e})(nn),Cbe=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Take"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e})(nn),Abe=(function(r){Mt(e,r);function e(t,n,a){a===void 0&&(a=!0);var i=r.call(this)||this;return i.upstream=t,i.batchSize=n,i.enableSmallLastBatch=a,i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,n;return Be(this,function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return n=a.sent(),n.done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(n.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e})(nn),_be=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.predicate=n,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return Be(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:return t=n.sent(),t.done||this.predicate(t.value)?[2,t]:(kr.dispose(t.value),[3,0]);case 2:return[2]}})})},e})(nn),Dbe=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Map"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c;return Be(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,{value:null,done:!0}];n=kr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=kr.tensor_util.getTensorsInContainer(a);try{for(o=lu(n),s=o.next();!s.done;s=o.next())u=s.value,kr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){l={error:h}}finally{try{s&&!s.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}return[2,{value:a,done:!1}]}})})},e})(nn),Fbe=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.handler=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return Be(this,function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,n.sent()];case 3:return t=n.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e})(nn),bF=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c;return Be(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:return t=f.sent(),t.done?[2,{value:null,done:!0}]:(n=kr.tensor_util.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:a=f.sent(),i=kr.tensor_util.getTensorsInContainer(a);try{for(o=lu(n),s=o.next();!s.done;s=o.next())u=s.value,kr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){l={error:h}}finally{try{s&&!s.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}return[2,{value:a,done:!1}]}})})},e})(nn),aw=(function(r){Mt(e,r);function e(){var t=r.call(this)||this;return t.outputQueue=new NF,t.lastRead=Promise.resolve({value:null,done:!1}),t}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e})(nn),Rbe=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c;return Be(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,!1];n=kr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=kr.tensor_util.getTensorsInContainer(a),this.outputQueue.pushAll(a);try{for(o=lu(n),s=o.next();!s.done;s=o.next())u=s.value,kr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){l={error:h}}finally{try{s&&!s.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}return[2,!0]}})})},e})(aw),AF=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.baseErrorHandler=n,a.lastRead=null,a.iterator=null,a.moreIterators=t,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of chained summaries";return t+" -> Chained"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return Le(this,void 0,void 0,function(){var n,a;return Be(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if(n=i.sent(),n.done)return[2,{value:null,done:!0}];this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),i.label=3;case 3:return[4,this.iterator.next()];case 4:return a=i.sent(),a.done?(this.iterator=null,[2,this.readFromChain(t)]):[2,a]}})})},e})(nn),es;(function(r){r[r.FAIL=0]="FAIL",r[r.SHORTEST=1]="SHORTEST",r[r.LONGEST=2]="LONGEST"})(es||(es={}));var Mbe=(function(r){Mt(e,r);function e(t,n){n===void 0&&(n=es.FAIL);var a=r.call(this)||this;return a.iterators=t,a.mismatchMode=n,a.count=0,a.currentPromise=null,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of zip summaries";return"{"+t+"} -> Zip"},e.prototype.nextState=function(t){return Le(this,void 0,void 0,function(){function n(s){if(s instanceof nn){var u=s.next();return{value:u.then(function(l){return a++,l.done&&i++,l.value}),recurse:!1}}else return{value:null,recurse:!0}}var a,i,o;return Be(this,function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),a=0,i=0,[4,TF(this.iterators,n)];case 2:if(o=s.sent(),a===i)return[2,{value:null,done:!0}];if(i>0)switch(this.mismatchMode){case es.FAIL:throw new Error("Zipped streams should have the same length. "+("Mismatched at element "+this.count+"."));case es.SHORTEST:return[2,{value:null,done:!0}];case es.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e})(nn),_F=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.bufferSize=n,a.buffer=new IF(n),a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e})(nn),Obe=(function(r){Mt(e,r);function e(t,n,a){var i=r.call(this,t,n)||this;return i.upstream=t,i.windowSize=n,i.upstreamExhausted=!1,i.random=kF.alea(a||kr.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,n;return Be(this,function(a){switch(a.label){case 0:this.upstreamExhausted||this.refill(),a.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:if(n=a.sent(),n.done)this.upstreamExhausted=!0;else return this.refill(),[2,n];return[3,1];case 3:return[2,{value:null,done:!0}]}})})},e})(_F),Rl=(function(){function r(){this.size=null}return r.prototype.batch=function(e,t){var n=this;t===void 0&&(t=!0);var a=this;kr.util.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `+e});var i;return this.size===1/0||this.size==null?i=this.size:t?i=Math.ceil(this.size/e):i=Math.floor(this.size/e),aa(function(){return Le(n,void 0,void 0,function(){return Be(this,function(o){switch(o.label){case 0:return[4,a.iterator()];case 1:return[2,o.sent().columnMajorBatch(e,t,Bbe)]}})})},i)},r.prototype.concatenate=function(e){var t=this,n=this,a;return this.size===1/0||e.size===1/0?a=1/0:this.size!=null&&e.size!=null?a=this.size+e.size:a=null,aa(function(){return Le(t,void 0,void 0,function(){var i,o;return Be(this,function(s){switch(s.label){case 0:return[4,n.iterator()];case 1:return o=(i=s.sent()).concatenate,[4,e.iterator()];case 2:return[2,o.apply(i,[s.sent()])]}})})},a)},r.prototype.filter=function(e){var t=this,n=this,a;return this.size===1/0?a=1/0:a=null,aa(function(){return Le(t,void 0,void 0,function(){return Be(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().filter(function(o){return kr.tidy(function(){return e(o)})})]}})})},a)},r.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},r.prototype.map=function(e){var t=this,n=this;return aa(function(){return Le(t,void 0,void 0,function(){return Be(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().map(function(i){return kr.tidy(function(){return e(i)})})]}})})},this.size)},r.prototype.mapAsync=function(e){var t=this,n=this;return aa(function(){return Le(t,void 0,void 0,function(){return Be(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().mapAsync(e)]}})})},this.size)},r.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return aa(function(){return Le(t,void 0,void 0,function(){return Be(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().prefetch(e)]}})})},this.size)},r.prototype.repeat=function(e){var t=this,n=this,a;return this.size!=null&&e>0?a=this.size*e:e===0?a=0:this.size!=null&&(e===void 0||e<0)?a=1/0:a=null,aa(function(){return Le(t,void 0,void 0,function(){var i,o=this;return Be(this,function(s){return i=nw(function(){return Le(o,void 0,void 0,function(){var u;return Be(this,function(l){switch(l.label){case 0:return u={},[4,n.iterator()];case 1:return[2,(u.value=l.sent(),u.done=!1,u)]}})})}),[2,kbe(i.take(e))]})})},a)},r.prototype.skip=function(e){var t=this,n=this,a;return this.size!=null&&e>=0&&this.size>=e?a=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?a=0:a=null,aa(function(){return Le(t,void 0,void 0,function(){return Be(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().skip(e)]}})})},a)},r.prototype.shuffle=function(e,t,n){var a=this;if(n===void 0&&(n=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+("bufferSize to the dataset size ("+this.size+" elements)"));var i=this,o=kF.alea(t||kr.util.now().toString());return aa(function(){return Le(a,void 0,void 0,function(){var s;return Be(this,function(u){switch(u.label){case 0:return s=o.int32(),n&&(s+=o.int32()),[4,i.iterator()];case 1:return[2,u.sent().shuffle(e,s.toString())]}})})},this.size)},r.prototype.take=function(e){var t=this,n=this,a;return this.size!=null&&this.size>e?a=e:this.size!=null&&this.size<=e?a=this.size:a=null,aa(function(){return Le(t,void 0,void 0,function(){return Be(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().take(e)]}})})},a)},r.prototype.toArray=function(){return Le(this,void 0,void 0,function(){return Be(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},r.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){return Be(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},r})();Rl.MAX_BUFFER_SIZE=1e4;function aa(r,e){return e===void 0&&(e=null),new((function(t){Mt(n,t);function n(){var a=t.apply(this,ibe(arguments))||this;return a.size=e,a}return n.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return Be(this,function(a){return[2,r()]})})},n})(Rl))}function Pbe(r){var e=this;return aa(function(){return Le(e,void 0,void 0,function(){return Be(this,function(t){return[2,CF(r)]})})},r.length)}function Lbe(r){var e=this;if(!Fl(r))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(r))for(var n=0;n<r.length;n++)t=t==null?r[n].size:Math.min(t,r[n].size);else if(r instanceof Object)for(var a in r)t=t==null?r[a].size:Math.min(t,r[a].size);return aa(function(){return Le(e,void 0,void 0,function(){var i;return Be(this,function(o){switch(o.label){case 0:return[4,TF(r,function(s){if(s instanceof Rl)return{value:s.iterator(),recurse:!1};if(Fl(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return i=o.sent(),[2,Sbe(i,es.SHORTEST)]}})})},t)}function Bbe(r){if(r===null)return null;var e=r[0];if(ybe(e)){var t=zbe(r);return{value:t,recurse:!1}}return{value:null,recurse:!0}}function zbe(r){if(r.length===0)throw new Error("Can't make a batch of zero elements.");return r[0]instanceof kr.Tensor?kr.stack(r):kr.tensor(r)}var DF=(function(r){Mt(e,r);function e(t){var n=r.call(this)||this;return n.input=t,n}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,n,a;return Be(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),n=t.decodeUTF8(),a=n.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o}),[2,a]}})})},e})(Rl),Lv='"',sh=Symbol("out"),wF=Symbol("field"),Bv=Symbol("quote"),tw=Symbol("quoteafterquote"),xF=Symbol("quoteinquote"),FF=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.input=t,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new DF(t),n||(n={}),a.hasHeader=n.hasHeader!==!1,a.fullColumnNames=n.columnNames,a.columnConfigs=n.columnConfigs,a.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(Nr.util.assert(n.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=n.delimiter?n.delimiter:",",a}return e.prototype.columnNames=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f=this;return Be(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&Nr.util.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+f.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce(function(p,d){return p[d]=p[d]+1||1,p},{}),a=Object.keys(n).filter(function(p){return n[p]>1}),Nr.util.assert(a.length===0,function(){return"Duplicate column names found: "+a.toString()}),this.columnConfigs)try{for(i=lu(Object.keys(this.columnConfigs)),o=i.next();!o.done;o=i.next())if(s=o.value,u=this.fullColumnNames.indexOf(s),u===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}catch(p){l={error:p}}finally{try{o&&!o.done&&(c=i.return)&&c.call(i)}finally{if(l)throw l.error}}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return Le(this,void 0,void 0,function(){var t,n,a,i;return Be(this,function(o){switch(o.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return t=o.sent(),[4,t.next()];case 2:if(n=o.sent(),n.done)throw new Error("No data was found for CSV parsing.");return a=n.value,i=this.parseRow(a,!1),[2,i];case 3:return[2,null]}})})},e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,n=this;return Be(this,function(a){switch(a.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:a.sent(),a.label=2;case 2:return[4,this.base.iterator()];case 3:return t=a.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(i){return n.makeDataElement(i)})]}})})},e.prototype.makeDataElement=function(t){for(var n=this.parseRow(t),a={},i={},o=0;o<this.fullColumnNames.length;o++){var s=this.fullColumnNames[o],u=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!u)){var l=n[o],c=null;if(l==="")if(u&&u.default!==void 0)c=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column "+s+" is empty in this line: "+t);c=void 0}else{var f=Number(l);if(isNaN(f))u&&u.dtype==="bool"?c=this.getBoolean(l):c=l;else if(!u||!u.dtype)c=f;else switch(u.dtype){case"float32":c=f;break;case"int32":c=Math.floor(f);break;case"bool":c=this.getBoolean(l);break;default:c=f}}u&&u.isLabel?i[s]=c:a[s]=c}}return Object.keys(i).length===0?a:{xs:a,ys:i}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,n){n===void 0&&(n=!0);for(var a=[],i=0,o=t.length,s=sh,u=0;u<o;u++)switch(s){case sh:switch(t.charAt(u)){case Lv:i=u+1,s=Bv;break;case this.delimiter:if(i=u+1,this.delimiter===" "&&this.delimWhitespace)break;a.push(""),s=sh;break;default:s=wF,i=u;break}break;case wF:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u)),s=sh,i=u+1;break}break;case Bv:switch(t.charAt(u)){case Lv:s=tw;break}break;case tw:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u-1)),s=sh,i=u+1;break;case Lv:s=Bv;break;default:s=xF;break}break;case xF:switch(t.charAt(u)){case Lv:s=Bv;break}break}if(s===tw?a.push(t.substring(i,o-1)):a.push(t.substring(i)),n&&a.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+a);return a},e})(Rl),$be=(function(r){Mt(e,r);function e(t){var n=r.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var a=Math.log2(n.fftSize);if(n.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+("2 to 4 and 2 to 14, but got "+n.fftSize));if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=t.includeSpectrogram!==!1,n.includeWaveform=t.includeWaveform===!0,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),Le(this,void 0,void 0,function(){var n;return Be(this,function(a){switch(a.label){case 0:if(!Nr.env().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");return n=new e(t),[4,n.start()];case 1:return a.sent(),[2,n]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,n,a,i;return Be(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw n=o.sent(),new Error("Error thrown while initializing video stream: "+n.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: "+("Expected: "+this.sampleRateHz+"; ")+("Actual: "+this.audioContext.sampleRate));return i=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,i.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o;return Be(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return a=s.sent(),this.includeSpectrogram&&(i=this.flattenQueue(a.freqDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(a.timeDataQueue),n=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:n},done:!1}]}})})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return Le(this,void 0,void 0,function(){var t,n,a,i=this;return Be(this,function(o){return t=[],n=[],a=0,[2,new Promise(function(s){var u=setInterval(function(){i.includeSpectrogram&&(i.analyser.getFloatFrequencyData(i.freqData),i.freqData[0]===-1/0&&s({freqDataQueue:t,timeDataQueue:n}),t.push(i.freqData.slice(0,i.columnTruncateLength))),i.includeWaveform&&(i.analyser.getFloatTimeDomainData(i.timeData),n.push(i.timeData.slice())),++a===i.numFrames&&(clearInterval(u),s({freqDataQueue:t,timeDataQueue:n}))},i.fftSize/i.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var n=t[0].length,a=new Float32Array(t.length*n);return t.forEach(function(i,o){return a.set(i,o*n)}),a},e.prototype.getTensorFromAudioDataArray=function(t,n){var a=new Float32Array(Nr.util.sizeFromShape(n));return a.set(t,a.length-t.length),Nr.tensor(a,n)},e})(nn),Wbe=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;if(a.webcamVideoElement=t,a.webcamConfig=n,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=Nr.tensor1d([0],"int32"),a.webcamConfig.centerCrop){var i=a.webcamConfig.resizeWidth*1/a.webcamVideoElement.width,o=a.webcamConfig.resizeHeight*1/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,l=s+i,c=o+u;a.cropBox=Nr.tensor2d([u,s,c,l],[1,4])}else a.cropBox=Nr.tensor2d([0,0,1,1],[1,4]);return a}return e.prototype.summary=function(){return"webcam"},e.create=function(t,n){return n===void 0&&(n={}),Le(this,void 0,void 0,function(){var a;return Be(this,function(i){switch(i.label){case 0:if(!Nr.env().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}return a=new e(t,n),[4,a.start()];case 1:return i.sent(),[2,a]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,n,a=this;return Be(this,function(i){switch(i.label){case 0:this.webcamConfig.facingMode&&Nr.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: "+a.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=i.sent(),[3,4];case 3:throw n=i.sent(),n.message="Error thrown while initializing video stream: "+n.message,n;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){a.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return Be(this,function(n){if(this.isClosed)return[2,{value:null,done:!0}];try{t=Nr.browser.fromPixels(this.webcamVideoElement)}catch(a){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(a))}if(this.resize)try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(a){throw new Error("Error thrown cropping the video: "+a.message)}finally{t.dispose()}else return[2,{value:t,done:!1}];return[2]})})},e.prototype.needToResize=function(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))},e.prototype.cropAndResizeFrame=function(t){var n=this;return Nr.tidy(function(){var a=Nr.expandDims(Nr.cast(t,"float32"),0),i;i=Nr.image.cropAndResize(a,n.cropBox,n.cropBoxInd,n.cropSize,"bilinear");var o=i.shape;return Nr.reshape(i,o.slice(1))})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){var t=this.stream.getTracks();t.forEach(function(n){return n.stop()});try{this.webcamVideoElement.srcObject=null}catch(n){console.log(n),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e})(nn);var RF=(function(){function r(){}return r})(),MF=(function(r){Mt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.split=function(t){return new Vbe(this,t)},e})(nn),Vbe=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.impl=new Ube(t,n),a}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.impl.next()]})})},e})(MF),Ube=(function(r){Mt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.separator=n,a.carryover="",a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Be(this,function(l){switch(l.label){case 0:return[4,this.upstream.next()];case 1:if(t=l.sent(),t.done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);n=t.value.split(this.separator),n[0]=this.carryover+n[0];try{for(a=lu(n.slice(0,-1)),i=a.next();!i.done;i=a.next())o=i.value,this.outputQueue.push(o)}catch(c){s={error:c}}finally{try{i&&!i.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}return this.carryover=n[n.length-1],[2,!0]}})})},e})(aw),Gbe=(function(r){Mt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.decodeUTF8=function(){return new Hbe(this)},e})(nn),Hbe=(function(r){Mt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.impl=new qbe(t),n}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.impl.next()]})})},e})(MF),qbe=(function(r){Mt(e,r);function e(t){var n=r.call(this)||this;if(n.upstream=t,Nr.env().get("IS_BROWSER"))n.decoder=new TextDecoder("utf-8");else{var a=ew().StringDecoder;n.decoder=new a("utf8")}return n}return e.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a;return Be(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:return t=i.sent(),t.done?[2,!1]:(n=t.value,Nr.env().get("IS_BROWSER")?a=this.decoder.decode(n,{stream:!0}):a=this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(a),[2,!0])}})})},e})(aw),OF=(function(r){Mt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.file=t,a.options=n,Nr.util.assert(t instanceof Uint8Array||(Nr.env().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),a.offset=n.offset||0,a.chunkSize=n.chunkSize||1024*1024,a}return e.prototype.summary=function(){return"FileChunks "+this.file},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a=this;return Be(this,function(i){switch(i.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,s){var u=a.offset+a.chunkSize;if(a.file instanceof Uint8Array)o(new Uint8Array(a.file.slice(a.offset,u)));else{var l=new FileReader;l.onload=function(f){var h=l.result;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),!(h instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));o(h)},l.onabort=function(f){return s(new Error("Aborted"))},l.onerror=function(f){return s(new Error(f.type))};var c=a.file.slice(a.offset,u);l.readAsArrayBuffer(c)}a.offset=u}),n={},[4,t]);case 1:return[2,(n.value=i.sent(),n.done=!1,n)]}})})},e})(Gbe);function Kbe(r,e,t){return e===void 0&&(e={}),Le(this,void 0,void 0,function(){var n,a,i,o,s;return Be(this,function(u){switch(u.label){case 0:return typeof r=="string"?n=r:(n=r.url,a=jbe(r)),[4,(t||Nr.util.fetch)(n,a)];case 1:return i=u.sent(),i.ok?(s=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new OF(o,e)];case 3:throw new Error(i.statusText)}})})}var jbe=function(r){var e={method:r.method,headers:r.headers,body:r.body,mode:r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,referrer:r.referrer,integrity:r.integrity};return e};function PF(r){return typeof r=="string"&&r.slice(0,7)==="file://"}var LF=(function(r){Mt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.input=t,a.options=n,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t;return Be(this,function(n){return PF(this.input)&&Nr.env().get("IS_NODE")&&(t=yF(),this.input=t.readFileSync(this.input.slice(7))),[2,new OF(this.input,this.options)]})})},e})(RF),BF=(function(r){Mt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.url=t,a.fileOptions=n,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return Be(this,function(t){return PF(this.url)?[2,new LF(this.url,this.fileOptions).iterator()]:[2,Kbe(this.url,this.fileOptions)]})})},e})(RF);function Xbe(r,e){return e===void 0&&(e={}),new FF(new BF(r),e)}function Ybe(r){var e=this,t=nw(r);return aa(function(){return Le(e,void 0,void 0,function(){return Be(this,function(n){return[2,t]})})})}function Zbe(r){var e=this;return aa(function(){return Le(e,void 0,void 0,function(){var t;return Be(this,function(n){switch(n.label){case 0:return[4,r()];case 1:return t=n.sent(),[2,nw(function(){return t.next()})]}})})})}function Qbe(r,e){return Le(this,void 0,void 0,function(){return Be(this,function(t){return[2,Wbe.create(r,e)]})})}function Jbe(r){return Le(this,void 0,void 0,function(){return Be(this,function(e){return[2,$be.create(r)]})})}var e1e="3.21.0";Mn.CSVDataset=FF;Mn.Dataset=Rl;Mn.FileDataSource=LF;Mn.TextLineDataset=DF;Mn.URLDataSource=BF;Mn.array=Pbe;Mn.csv=Xbe;Mn.func=Ybe;Mn.generator=Zbe;Mn.microphone=Jbe;Mn.version_data=e1e;Mn.webcam=Qbe;Mn.zip=Lbe});var WF=gr(($F,iw)=>{(function(r,e,t){function n(s){var u=this,l=o();u.next=function(){var c=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=c-(u.c=c|0)},u.c=1,u.s0=l(" "),u.s1=l(" "),u.s2=l(" "),u.s0-=l(s),u.s0<0&&(u.s0+=1),u.s1-=l(s),u.s1<0&&(u.s1+=1),u.s2-=l(s),u.s2<0&&(u.s2+=1),l=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var l=new n(s),c=u&&u.state,f=l.next;return f.int32=function(){return l.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,c&&(typeof c=="object"&&a(c,l),f.state=function(){return a(l,{})}),f}function o(){var s=4022871197,u=function(l){l=String(l);for(var c=0;c<l.length;c++){s+=l.charCodeAt(c);var f=.02519603282416938*s;s=f>>>0,f-=s,f*=s,s=f>>>0,f-=s,s+=f*4294967296}return(s>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.alea=i})($F,typeof iw=="object"&&iw,typeof define=="function"&&define)});var UF=gr((VF,ow)=>{(function(r,e,t){function n(o){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var c=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^c^c>>>8},o===(o|0)?s.x=o:u+=o;for(var l=0;l<u.length+64;l++)s.x^=u.charCodeAt(l)|0,s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s}function i(o,s){var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor128=i})(VF,typeof ow=="object"&&ow,typeof define=="function"&&define)});var HF=gr((GF,sw)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var c=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(c^c<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,o===(o|0)?s.x=o:u+=o;for(var l=0;l<u.length+64;l++)s.x^=u.charCodeAt(l)|0,l==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s.v=o.v,s.d=o.d,s}function i(o,s){var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorwow=i})(GF,typeof sw=="object"&&sw,typeof define=="function"&&define)});var KF=gr((qF,uw)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var l=s.x,c=s.i,f,h,p;return f=l[c],f^=f>>>7,h=f^f<<24,f=l[c+1&7],h^=f^f>>>10,f=l[c+3&7],h^=f^f>>>3,f=l[c+4&7],h^=f^f<<7,f=l[c+7&7],f=f^f<<13,h^=f^f<<9,l[c]=h,s.i=c+1&7,h};function u(l,c){var f,h,p=[];if(c===(c|0))h=p[0]=c;else for(c=""+c,f=0;f<c.length;++f)p[f&7]=p[f&7]<<15^c.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?h=p[7]=-1:h=p[f],l.x=p,l.i=0,f=256;f>0;--f)l.next()}u(s,o)}function a(o,s){return s.x=o.x.slice(),s.i=o.i,s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(l.x&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorshift7=i})(qF,typeof uw=="object"&&uw,typeof define=="function"&&define)});var XF=gr((jF,lw)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var l=s.w,c=s.X,f=s.i,h,p;return s.w=l=l+1640531527|0,p=c[f+34&127],h=c[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=c[f]=p^h,s.i=f,p+(l^l>>>16)|0};function u(l,c){var f,h,p,d,v,m=[],g=128;for(c===(c|0)?(h=c,c=null):(c=c+"\0",h=0,g=Math.max(g,c.length)),p=0,d=-32;d<g;++d)c&&(h^=c.charCodeAt((d+32)%c.length)),d===0&&(v=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,d>=0&&(v=v+1640531527|0,f=m[d&127]^=h+v,p=f==0?p+1:0);for(p>=128&&(m[(c&&c.length||0)&127]=-1),p=127,d=512;d>0;--d)h=m[p+34&127],f=m[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,m[p]=h^f;l.w=v,l.X=m,l.i=p}u(s,o)}function a(o,s){return s.i=o.i,s.w=o.w,s.X=o.X.slice(),s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(l.X&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor4096=i})(jF,typeof lw=="object"&&lw,typeof define=="function"&&define)});var ZF=gr((YF,cw)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var c=s.b,f=s.c,h=s.d,p=s.a;return c=c<<25^c>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-c|0,s.b=c=c<<20^c>>>12^f,s.c=f=f-h|0,s.d=h<<16^f>>>16^p,s.a=p-c|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,o===Math.floor(o)?(s.a=o/4294967296|0,s.b=o|0):u+=o;for(var l=0;l<u.length+20;l++)s.b^=u.charCodeAt(l)|0,s.next()}function a(o,s){return s.a=o.a,s.b=o.b,s.c=o.c,s.d=o.d,s}function i(o,s){var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.tychei=i})(YF,typeof cw=="object"&&cw,typeof define=="function"&&define)});var JF=gr((QF,$v)=>{(function(r,e,t){var n=256,a=6,i=52,o="random",s=t.pow(n,a),u=t.pow(2,i),l=u*2,c=n-1,f;function h(b,w,k){var S=[];w=w==!0?{entropy:!0}:w||{};var E=m(v(w.entropy?[b,y(e)]:b??g(),3),S),N=new p(S),C=function(){for(var R=N.g(a),_=s,O=0;R<u;)R=(R+O)*n,_*=n,O=N.g(1);for(;R>=l;)R/=2,_/=2,O>>>=1;return(R+O)/_};return C.int32=function(){return N.g(4)|0},C.quick=function(){return N.g(4)/4294967296},C.double=C,m(y(N.S),e),(w.pass||k||function(R,_,O,P){return P&&(P.S&&d(P,N),R.state=function(){return d(N,{})}),O?(t[o]=R,_):R})(C,E,"global"in w?w.global:this==t,w.state)}function p(b){var w,k=b.length,S=this,E=0,N=S.i=S.j=0,C=S.S=[];for(k||(b=[k++]);E<n;)C[E]=E++;for(E=0;E<n;E++)C[E]=C[N=c&N+b[E%k]+(w=C[E])],C[N]=w;(S.g=function(R){for(var _,O=0,P=S.i,B=S.j,W=S.S;R--;)_=W[P=c&P+1],O=O*n+W[c&(W[P]=W[B=c&B+_])+(W[B]=_)];return S.i=P,S.j=B,O})(n)}function d(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function v(b,w){var k=[],S=typeof b,E;if(w&&S=="object")for(E in b)try{k.push(v(b[E],w-1))}catch{}return k.length?k:S=="string"?b:b+"\0"}function m(b,w){for(var k=b+"",S,E=0;E<k.length;)w[c&E]=c&(S^=w[c&E]*19)+k.charCodeAt(E++);return y(w)}function g(){try{var b;return f&&(b=f.randomBytes)?b=b(n):(b=new Uint8Array(n),(r.crypto||r.msCrypto).getRandomValues(b)),y(b)}catch{var w=r.navigator,k=w&&w.plugins;return[+new Date,r,k,r.screen,y(e)]}}function y(b){return String.fromCharCode.apply(0,b)}if(m(t.random(),e),typeof $v=="object"&&$v.exports){$v.exports=h;try{f=vp()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+o]=h})(typeof self<"u"?self:QF,[],Math)});var tR=gr((rqe,eR)=>{var t1e=WF(),r1e=UF(),n1e=HF(),a1e=KF(),i1e=XF(),o1e=ZF(),pu=JF();pu.alea=t1e;pu.xor128=r1e;pu.xorwow=n1e;pu.xorshift7=a1e;pu.xor4096=i1e;pu.tychei=o1e;eR.exports=pu});var gM=gr(hh=>{"use strict";Object.defineProperty(hh,"__esModule",{value:!0});var I=Ds(),s1e=tR();function u1e(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var l1e=u1e(s1e),hw=function(r,e){return hw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},hw(r,e)};function c1e(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");hw(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function rR(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function nR(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Pl(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function nt(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Ei(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(nt(arguments[e]));return r}function He(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&I.util.assert(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors in the CPU backend."})})}var f1e=I.kernel_impls.whereImpl,vw=(function(r){c1e(e,r);function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new I.DataStorage(t,I.engine()),t}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.write=function(t,n,a){this.firstUse&&(this.firstUse=!1,I.env().get("IS_NODE")&&I.backend_util.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));var i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:a,refCount:1}),i},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&I.util.isString(a[0])){var o=a.map(function(s){return I.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return{dataId:i,shape:t,dtype:n}},e.prototype.refCount=function(t){if(this.data.has(t)){var n=this.data.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.data.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.data.has(t)){var n=this.data.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){this.data.set(t,{values:n,dtype:i,refCount:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return rR(this,void 0,void 0,function(){return nR(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),a=n.dtype,i=n.complexTensorInfos;if(a==="complex64"){var o=this.readSync(i.real.dataId),s=this.readSync(i.imag.dataId);return I.backend_util.mergeRealAndImagArrays(o,s)}return this.data.get(t).values},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return I.util.decodeString(i)});return I.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return I.buffer(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,n,a){return I.engine().makeTensorFromTensorInfo(this.makeTensorInfo(n,a,t),this)},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;var a=this.data.get(t).complexTensorInfos;a!=null&&(this.disposeData(a.real.dataId,!0),this.disposeData(a.imag.dataId,!0)),this.data.delete(t)}return!0},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.time=function(t){return rR(this,void 0,void 0,function(){var n,a;return nR(this,function(i){return n=I.util.now(),t(),a=I.util.now()-n,[2,{kernelMs:a}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.where=function(t){He([t],"where");var n=this.readSync(t.dataId);return f1e(t.shape,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return r.prototype.epsilon.call(this)},e})(I.KernelBackend);vw.nextDataId=0;function fR(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}var h1e=function(r){var e=r.inputs.x,t=r.backend;He(e,"abs");var n=new Float32Array(I.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId).values;return n=fR(a),t.makeOutput(n,e.shape,e.dtype)},p1e={kernelName:I.Abs,backendName:"cpu",kernelFunc:h1e};function Ur(r){return function(e,t,n,a,i){var o=I.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=I.util.computeStrides(o),l=I.util.sizeFromShape(o),c=I.util.getTypedArrayFromDType(i,l),f=e.length,h=t.length,p=I.util.computeStrides(e),d=I.util.computeStrides(t),v=I.backend_util.getBroadcastDims(e,o),m=I.backend_util.getBroadcastDims(t,o);if(v.length+m.length===0)for(var g=0;g<c.length;++g)c[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(b){var w=I.util.indexToLoc(b,s,u),k=w.slice(-f);v.forEach(function(C){return k[C]=0});var S=I.util.locToIndex(k,f,p),E=w.slice(-h);m.forEach(function(C){return E[C]=0});var N=I.util.locToIndex(E,h,d);c[b]=r(n[S],a[N])},g=0;g<c.length;++g)y(g);return[c,o]}}function ia(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=t.makeTensorInfo(n.shape,"complex64"),u=t.data.get(s.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(n.shape,"float32",i),imag:t.makeTensorInfo(a.shape,"float32",o)},s}var d1e={kernelName:I.Complex,backendName:"cpu",kernelFunc:ia};function Wv(r,e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Wv(r,e,"float32"),a=Wv(r,e,"float32");return ia({inputs:{real:n,imag:a},backend:r})}var i=I.util.makeZerosTypedArray(I.util.sizeFromShape(e),t);return r.makeTensorInfo(e,t,i)}function Vi(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var v1e={kernelName:I.Identity,backendName:"cpu",kernelFunc:Vi};function du(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.real,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var m1e={kernelName:I.Real,backendName:"cpu",kernelFunc:du};function hR(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=I.util.toTypedArray([0],t),o=nt(Ur(function(l,c){return l!==c?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast "+t+" to "+n)}function ts(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return Vi({inputs:{x:a},backend:t});var o=Wv(t,a.shape,a.dtype),s=ts({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=ia({inputs:{real:s,imag:o},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var l=du({inputs:{input:a},backend:t}),u=ts({inputs:{x:l},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(l),u}if(!I.util.hasEncodingLoss(a.dtype,i)){var u=Vi({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}var c=t.data.get(a.dataId).values,f=nt(hR(c,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}var g1e={kernelName:I.Cast,backendName:"cpu",kernelFunc:ts};function an(r,e,t,n){return t==null?function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,l=o;He([s,u],r);var c=l.data.get(s.dataId).values,f=l.data.get(u.dataId).values,h=s.dtype==="string"?I.backend_util.fromUint8ToStringArray(c):c,p=s.dtype==="string"?I.backend_util.fromUint8ToStringArray(f):f,d=n||s.dtype,v=nt(e(s.shape,u.shape,h,p,d),2),m=v[0],g=v[1];return l.makeTensorInfo(g,d,m)}:function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,l=o;if(s.dtype==="complex64"||u.dtype==="complex64"){var c=ts({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),f=l.data.get(c.dataId),h=f.complexTensorInfos.real,p=f.complexTensorInfos.imag,d=l.data.get(h.dataId).values,v=l.data.get(p.dataId).values,m=ts({inputs:{x:u},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,w=l.data.get(y.dataId).values,k=l.data.get(b.dataId).values,S=nt(t(s.shape,u.shape,d,v,w,k),3),E=S[0],N=S[1],C=S[2],R=l.makeTensorInfo(C,"float32",E),_=l.makeTensorInfo(C,"float32",N),O=ia({inputs:{real:R,imag:_},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(R),l.disposeIntermediateTensorInfo(_),O}else{var P=l.data.get(s.dataId).values,B=l.data.get(u.dataId).values,W=n||s.dtype,L=nt(e(s.shape,u.shape,P,B,W),2),G=L[0],C=L[1];return l.makeTensorInfo(C,W,G)}}}function mw(r){return function(e,t,n,a,i,o){var s=I.backend_util.assertAndGetBroadcastShape(e,t),u=I.util.sizeFromShape(s),l=s.length,c=I.util.computeStrides(s),f=I.util.getTypedArrayFromDType("float32",u),h=I.util.getTypedArrayFromDType("float32",u),p=I.backend_util.getBroadcastDims(e,s),d=I.backend_util.getBroadcastDims(t,s),v=I.backend_util.mergeRealAndImagArrays(n,a),m=I.backend_util.mergeRealAndImagArrays(i,o),g=e.length,y=I.util.computeStrides(e),b=t.length,w=I.util.computeStrides(t);if(p.length+d.length===0)for(var k=0;k<f.length;k++){var S=k%v.length,E=k%m.length,N=r(v[S*2],v[S*2+1],m[E*2],m[E*2+1]);f[k]=N.real,h[k]=N.imag}else for(var C=function(R){var _=I.util.indexToLoc(R,l,c),O=_.slice(-g);p.forEach(function(G){return O[G]=0});var P=I.util.locToIndex(O,g,y),B=_.slice(-b);d.forEach(function(G){return B[G]=0});var W=I.util.locToIndex(B,b,w),L=r(v[P*2],v[P*2+1],m[W*2],m[W*2+1]);f[R]=L.real,h[R]=L.imag},k=0;k<f.length;k++)C(k);return[f,h,s]}}var pR=Ur((function(r,e){return r+e})),y1e=mw((function(r,e,t,n){return{real:r+t,imag:e+n}})),Ll=an(I.Add,pR,y1e),b1e={kernelName:I.Add,backendName:"cpu",kernelFunc:Ll};function gw(r,e,t,n,a){for(var i=I.util.sizeFromShape(n),o=I.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function dR(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=I.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var l=r.get(s,u);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(n?o.set(1,s,l):e.size>0?o.set(o.get(s,l)+e.get(s,u),s,l):o.set(o.get(s,l)+1,s,l))}return o}function rs(r){return function(e,t,n){for(var a=I.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}function $t(r,e,t){return function(n){var a=n.inputs,i=n.attrs,o=n.backend,s=a.x;if(He(s,r),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,l=u.data.get(s.dataId).values,c=I.util.sizeFromShape(s.shape),f=t||s.dtype,h=I.util.getArrayFromDType(f,c),p=0;p<c;++p)h[p]=e(l[p],i);return u.makeTensorInfo(s.shape,f,h)}}function $l(r,e,t){return function(n){var a=n.inputs,i=n.attrs,o=n.backend,s=a.x;if(He(s,r),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");var u=o,l=u.data.get(s.dataId).values,c=t||s.dtype,f=e(l,c,i);return u.makeTensorInfo(s.shape,c,f)}}var vR=rs(function(r){return Math.ceil(r)}),w1e=$l(I.Ceil,vR),x1e={kernelName:I.Ceil,backendName:"cpu",kernelFunc:w1e};function mR(r,e,t,n){var a=I.util.getArrayFromDType(t,I.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=I.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?I.backend_util.fromUint8ToStringArray(s.vals):s.vals,l=0,c=0;c<s.shape[0];++c)for(var f=c*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[l++];o+=s.shape[1]})}return a}var gR=Ur(function(r,e){return r===e?1:0}),yR=an(I.Equal,gR,null,"bool"),k1e={kernelName:I.Equal,backendName:"cpu",kernelFunc:yR};var bR=rs(function(r){return Math.exp(r)}),wR=$l(I.Exp,bR,"float32"),S1e={kernelName:I.Exp,backendName:"cpu",kernelFunc:wR};var xR=rs(function(r){return Math.expm1(r)}),E1e=$l(I.Expm1,xR),T1e={kernelName:I.Expm1,backendName:"cpu",kernelFunc:E1e};var kR=rs(function(r){return Math.floor(r)}),I1e=$l(I.Floor,kR),N1e={kernelName:I.Floor,backendName:"cpu",kernelFunc:I1e};function SR(r,e,t,n,a,i,o,s,u){for(var l=I.buffer([n,i],t),c=0;c<n;c++){for(var f=[],h=0,p=0;p<a;p++){var d=r[c*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: "+f+" does not index into "+s);for(var v=0;v<i;v++)l.values[c*i+v]=e.get.apply(e,Ei(e.indexToLoc(h*i+v)))}return l}function ER(r,e,t){for(var n=I.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],l=e.locToIndex([s,u]);o[2]=e.values[l];var c=r.locToIndex(o);0<=c&&c<r.values.length&&(n.values[a]=r.values[c])}return n}var TR=Ur(function(r,e){return r>e?1:0}),C1e=an(I.Greater,TR,null,"bool"),A1e={kernelName:I.Greater,backendName:"cpu",kernelFunc:C1e};var IR=Ur(function(r,e){return r>=e?1:0}),_1e=an(I.GreaterEqual,IR,null,"bool"),D1e={kernelName:I.GreaterEqual,backendName:"cpu",kernelFunc:_1e};var NR=Ur(function(r,e){return r<e?1:0}),F1e=an(I.Less,NR,null,"bool"),R1e={kernelName:I.Less,backendName:"cpu",kernelFunc:F1e};var CR=Ur(function(r,e){return r<=e?1:0}),M1e=an(I.LessEqual,CR,null,"bool"),O1e={kernelName:I.LessEqual,backendName:"cpu",kernelFunc:M1e};function AR(r,e,t){var n=(e-r)/(t-1),a=I.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var _R=rs(function(r){return Math.log(r)}),P1e=$l(I.Log,_R),L1e={kernelName:I.Log,backendName:"cpu",kernelFunc:P1e};function DR(r,e,t,n){for(var a=I.util.getTypedArrayFromDType(n,I.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var l=r[o+u];(Number.isNaN(l)||l>s)&&(s=l)}a[i]=s}return a}var FR=Ur((function(r,e){return Math.max(r,e)})),B1e=an(I.Maximum,FR),z1e={kernelName:I.Maximum,backendName:"cpu",kernelFunc:B1e};var RR=Ur((function(r,e){return Math.min(r,e)})),$1e=an(I.Minimum,RR),W1e={kernelName:I.Minimum,backendName:"cpu",kernelFunc:$1e};var yw=Ur((function(r,e){return r*e})),V1e=mw((function(r,e,t,n){return{real:r*t-e*n,imag:r*n+e*t}})),Hv=an(I.Multiply,yw,V1e),U1e={kernelName:I.Multiply,backendName:"cpu",kernelFunc:Hv};function MR(r,e,t){var n=I.util.createScalarValue(-1,t);return yw([],e,n,r,t)}function G1e(r){var e=r.inputs,t=r.backend,n=e.x;He(n,"neg");var a=t.data.get(n.dataId).values,i=nt(MR(a,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var H1e={kernelName:I.Neg,backendName:"cpu",kernelFunc:G1e};var OR=Ur((function(r,e){return r!==e?1:0})),q1e=an(I.NotEqual,OR,null,"bool"),K1e={kernelName:I.NotEqual,backendName:"cpu",kernelFunc:q1e};function bw(r,e,t,n,a){for(var i=e.length,o=I.util.sizeFromShape(e),s=I.util.computeStrides(e),u=I.util.computeStrides(a),l=I.util.getTypedArrayFromDType(t,I.util.sizeFromShape(a)),c=0;c<o;++c){for(var f=I.util.indexToLoc(c,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=I.util.locToIndex(h,i,u);l[d]=r[c]}return l}function On(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.perm;He(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var l=n.data.get(a.dataId).values,c=bw(l,a.shape,a.dtype,i,s),f=n.write(c,s,a.dtype);return{dataId:f,shape:s,dtype:a.dtype}}var j1e={kernelName:I.Transpose,backendName:"cpu",kernelFunc:On};function PR(r,e,t,n){for(var a=nt(I.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=I.upcastType(e,"int32"),u=I.util.makeZerosTypedArray(I.util.sizeFromShape(i),s),l=I.util.sizeFromShape(o),c=0;c<u.length;++c){for(var f=c*l,h=1,p=0;p<l;++p)h*=t[f+p];u[c]=h}return{outVals:u,outShape:i,outDtype:s}}function X1e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"prod");var s=a.shape.length,u=I.util.parseAxisParam(i,a.shape),l=I.backend_util.getAxesPermutation(u,s),c=u,f=a,h=[];l!=null&&(f=On({inputs:{x:a},backend:t,attrs:{perm:l}}),h.push(f),c=I.backend_util.getInnerMostAxes(c.length,s));var p=t.data.get(f.dataId).values,d=PR(f.shape,f.dtype,p,c),v=d.outVals,m=d.outShape,g=d.outDtype,y=m;return o&&(y=I.backend_util.expandShapeToKeepDim(m,u)),h.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),t.makeTensorInfo(y,g,v)}var Y1e={kernelName:I.Prod,backendName:"cpu",kernelFunc:X1e};function Z1e(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=I.util.indexToLoc(a,e.length,I.util.computeStrides(e)).join(",");throw new Error("indices["+i+"] = "+n+" is not in [0, "+t+")")}})}function Q1e(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function J1e(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});Q1e(t,n);for(var u=1,l=0;l<e.length-1;++l){u*=e[l];for(var c=e[l+1],f=1;f<u+1;++f)s[l].push(f*c)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,l=0;l<t.length;++l){var d=t[l],v=l+e.length-1;if(v>=0)for(var m=s[v],g=m[m.length-1]-d[h],y=h;y<p;++y)s[v].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function ewe(r){for(var e=[],t=function(a){var i=r[a].length,o=I.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function aR(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function twe(r,e,t,n,a,i){var o,s,u=aR(e,2)[1],l=aR(i,2)[1],c=0;try{for(var f=Pl(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var v=0;v<n;++v)a[c*l+v]=r[d*u+v];++c}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function rwe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=I.util.getArrayFromDType(t,I.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return twe(r,e,n,u,o,i),[o,i]}function LR(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(Z1e(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var l=n[0],c=J1e(i,o,r,l),f=c.outSplits,h=c.valueSlices,p=c.numValues,d=ewe(f),v=rwe(t,n,a,h,p);return[d,v[0],v[1]]}var Ja=I.backend_util.RowPartitionType,nwe=(function(){function r(e,t,n,a,i,o,s,u,l,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=I.backend_util.getRowPartitionTypesHelper(c),this.raggedRank=I.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Ja.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Ja.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ja.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case Ja.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type "+Ja[this.getRowPartitionTypeByDimension(e-1)])}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return oR(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;I.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=I.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return I.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],l=Math.min(a,u),c=t[s];c===-1&&(l=0);for(var f=0;f<l;++f)o.push(c),c+=n;for(var f=0;f<u-l;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId="+u+", which is not less than "+t.length);var l=t[u];o.push(l);for(var c=1;c<i;++c){var f=e[c];if(f===u)l>=0&&(++s,s<a?l+=n:l=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId="+f+" which is not less than "+t.length);l=t[f]}o.push(l)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ja.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case Ja.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: "+(i.length-1)+" > "+t.length);return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: "+Ja[o])}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Ja.FIRST_DIM_SIZE:return e[0];case Ja.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ja.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type "+Ja[t])}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=oR(n,!1),s=I.util.getArrayFromDType(this.valuesDType,I.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var l=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var c=this.calculateOutputIndex(i-1,l,a[i],n[i]);l=c}this.setOutput(this.raggedRank,l,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=I.util.sizeFromShape(s),l=t.length,c=this.defaultValue;if(c.length!==u&&c.length!==1){var f=this.defaultValueShape;I.tidy(function(){var k=I.reshape(c,f),S=I.broadcastTo(k,s);c=S.dataSync()})}for(var h=0,p=0,d=0,v=0;v<=l;++v){var m=v<l?t[v]:-1;if(m===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),b=(d-p)*u;iR(y,g,b)}if(v>=l){var w=n.length;m=Math.floor(w/u)}if(m>d)if(this.defaultValue.length===1)o.subarray(d*u,m*u).fill(this.defaultValue[0]),d=m;else for(;m>d;){var y=o.slice(d*u);iR(y,c,u),++d}m<0?(h=v+1,p=d):(h=v,p=d,d=p+1)}}},r})();function iR(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function oR(r,e){var t,n,a=[];try{for(var i=Pl(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension "+s+" must be >= 0");if(s<-1)throw new Error("Dimension "+s+" must be >= -1");s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function BR(r,e,t,n,a,i,o,s,u,l){return new nwe(r,e,t,n,a,i,o,s,u,l).compute()}function zR(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return I.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=I.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var l=1;l<u.length;l++)u[l]=u[l-1]+t;return u}var $R=rs(function(r){return 1/Math.sqrt(r)}),awe=$l(I.Rsqrt,$R),iwe={kernelName:I.Rsqrt,backendName:"cpu",kernelFunc:awe};function Ol(r,e,t,n,a,i,o,s,u,l){var c=[n/a,a],f=r.values,h=e.values;if(n===0)return I.buffer(t,e.dtype);var p=I.buffer(c,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var v=[],m=0,g=0;g<o;g++){var y=f[d*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=n/a)throw new Error("Invalid indices: "+v+" does not index into "+t);for(var b=0;b<a;b++)l?p.values[m*a+b]+=h[d*a+b]:p.values[m*a+b]=e.rank===0?h[0]:h[d*a+b]}return p}var owe=rs(function(r){return 1/(1+Math.exp(-r))}),WR=$t(I.Sigmoid,function(r){return 1/(1+Math.exp(-r))}),swe={kernelName:I.Sigmoid,backendName:"cpu",kernelFunc:WR};function VR(r,e,t,n,a){var i=I.slice_util.isSliceContinous(n,e,t),o=I.util.sizeFromShape(t),s=I.util.computeStrides(n);if(i){var u=I.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var l=a==="string"?I.backend_util.fromUint8ToStringArray(r):r,c=I.buffer(n,a,l),f=I.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(v,m){return v+e[m]});f.set.apply(f,Ei([c.get.apply(c,Ei(d))],p))}return a==="string"?I.backend_util.fromStringArrayToUint8(f.values):f.values}function vu(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size;He(a,"slice");var s=nt(I.slice_util.parseSliceParams(a,i,o),2),u=s[0],l=s[1];I.slice_util.assertParamsValid(a,u,l);var c=t.data.get(a.dataId).values,f=VR(c,u,l,a.shape,a.dtype);return t.makeTensorInfo(l,a.dtype,f)}var uwe={kernelName:I.Slice,backendName:"cpu",kernelFunc:vu};function UR(r,e,t,n,a,i,o){var s=e[0],u=i[0],l=new Array(u),c=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(I.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=I.util.getArrayFromDType(t,0),p=I.util.getArrayFromDType(a,0);return[h,[0,f],p,l,c]}for(var d=!0,v=0,m=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(I.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(I.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++m[y],d=d&&y>=v,v=y}for(var b=!0,y=0;y<u;++y){var w=m[y]===0;l[y]=w,b=b&&!w,m[y]=Math.max(m[y],1),y>0&&(m[y]+=m[y-1])}if(b&&d){for(var h=r,p=n,g=0;g<s;++g)c[g]=g;return[h,[s,f],p,l,c]}else{for(var k=m[u-1],h=I.util.getArrayFromDType(t,k*f),p=I.util.getArrayFromDType(a,k),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],E=S[y],N=(y===0?0:m[y-1])+E;S[y]++;for(var C=0;C<f;++C)h[N*f+C]=r[g*f+C];p[N]=n[g],c[g]=N}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:m[y-1];h[_*f+0]=y;for(var O=1;O<f;++O)h[_*f+O]=0;p[_]=o}}return[h,[k,f],p,l,c]}}function GR(r,e,t,n,a){for(var i=I.util.sizeFromShape(n),o=e[0],s=a.length,u=[],l=1,c=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(c!==-1)throw new Error(I.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,f));c=f,u.push(1)}else{if(h<0)throw new Error(I.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));l*=h,u.push(h)}}if(c!==-1){if(l<=0)throw new Error(I.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/l);if(l*p!==i)throw new Error(I.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[c]=p}var d=I.util.sizeFromShape(u);if(d!==i)throw new Error(I.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var v=n.length,m=[];if(v>0){m[v-1]=1;for(var f=v-2;f>=0;--f)m[f]=m[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=I.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,k=0;k<v;++k)w+=r[b*v+k]*m[k];for(var k=0;k<s;++k)y[b*s+k]=Math.trunc(w/g[k]),w%=g[k]}return[y,[o,s],u]}function ww(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],l=u[1],c=s>0?a[s-1]+1:0,f=c;if(f<0)throw new Error(I.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(E,N){return E*N},1),d=I.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(I.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,m=1,g=0,y=a[v];;){var b=0;if(m<s){if(b=a[m],y===b){++m;continue}if(y>=b)throw new Error(I.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(I.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*l,y*l);for(var w=v;w<m;++w){var k=n[w];if(k<0||k>=u[0])throw new Error(I.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,n[w],u[0]));for(var S=0;S<l;S++)d[y*l+S]+=r[k*l+S]}if(i)for(var S=0;S<l;S++)d[y*l+S]/=m-v;if(v=m,++m,g=y+1,y=b,m>s)break}return g<f&&d.fill(o,g*l,f*l),[d,h]}var lwe=rs(function(r){return Math.sqrt(r)}),cwe=$t(I.Sqrt,function(r){return Math.sqrt(r)}),fwe={kernelName:I.Sqrt,backendName:"cpu",kernelFunc:cwe};var HR=Ur((function(r,e){var t=r-e;return t*t})),hwe=an(I.SquaredDifference,HR),pwe={kernelName:I.SquaredDifference,backendName:"cpu",kernelFunc:hwe};function qR(r,e,t,n){for(var a=I.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,Ei([e.get.apply(e,Ei(s))],o))}return a}var dwe=(function(){function r(e,t,n,a,i,o){this.separator=I.util.encodeString(e),this.nGramWidths=t,this.leftPad=I.util.encodeString(n),this.rightPad=I.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(c){var f=u.getPadWidth(o),h=Math.max(0,f-c),p=Math.max(0,f-(i-(c+1))),d=o-(h+p),v=t+(h>0?0:c-f),m=0;m+=h*u.leftPad.length;for(var g=0;g<d;++g)m+=e[v+g].length;m+=p*u.rightPad.length;var y=h+p+d-1;m+=y*u.separator.length,n[a+c]=new Uint8Array(m);for(var b=n[a+c],w=0,k=function(S){return S.forEach(function(E){return b[w++]=E})},g=0;g<h;++g)k(u.leftPad),k(u.separator);for(var g=0;g<d-1;++g)k(e[v+g]),k(u.separator);if(d>0){k(e[v+d-1]);for(var g=0;g<p;++g)k(u.separator),k(u.rightPad)}else{for(var g=0;g<p-1;++g)k(u.rightPad),k(u.separator);k(u.rightPad)}},u=this,l=0;l<i;++l)s(l)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got "+o);for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value "+t[s]+", must be in ["+o+", "+a+"]");o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected "+a+", got "+o)}var l=i-1,c=I.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=l;++s)c[s]=0;return[f,c]}c[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;p.nGramWidths.forEach(function(w){b+=n.getNumNGrams(y,w)}),p.preserveShort&&y>0&&b===0&&(b=1),c[g]=c[g-1]+b},p=this,s=1;s<=l;++s)h(s);for(var d=new Array(c[l]),v=function(g){var y=t[g],b=c[g];if(m.nGramWidths.forEach(function(E){var N=t[g+1]-t[g],C=n.getNumNGrams(N,E);n.createNGrams(e,y,d,b,C,E),b+=C}),m.preserveShort&&b===c[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var k=w+2*m.padWidth,S=1;m.createNGrams(e,y,d,b,S,k)}},m=this,s=0;s<l;++s)v(s);return[d,c]},r})();function KR(r,e,t,n,a,i,o,s){return new dwe(t,n,a,i,o,s).compute(r,e)}function vwe(r,e,t,n){if(r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function jR(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var l=a.length;vwe(r[u],e,t,a);var c=a.length-l;s[u]=c,i+=c,o=Math.max(o,c)}for(var f=I.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var v=0;v<s[u];++v)f[d*2]=u,f[d*2+1]=v,h[d]=a[d],++d;return[f,h,p]}function XR(r,e){for(var t=I.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=I.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var YR=Ur((function(r,e){return r-e})),mwe=mw((function(r,e,t,n){return{real:r-t,imag:e-n}})),xw=an(I.Sub,YR,mwe),gwe={kernelName:I.Sub,backendName:"cpu",kernelFunc:xw};function ZR(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=I.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var lh=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function QR(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),l=Math.max(t,Math.floor(e-i*s/a+u)),c=Math.min(n,Math.floor(e+(a-i)*s/a+u));QR(r,e,l,c)}var f=r[e],h=t,p=n;for(I.util.swap(r,t,e),lh(r[n],f)>0&&I.util.swap(r,t,n);h<p;){for(I.util.swap(r,h,p),h++,p--;lh(r[h],f)<0;)h=h+1;for(;lh(r[p],f)>0;)p=p-1}lh(r[t],f)===0?I.util.swap(r,t,p):(p=p+1,I.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function JR(r,e,t,n,a){for(var i=e[e.length-1],o=nt([r.length/i,i],2),s=o[0],u=o[1],l=I.util.getTypedArrayFromDType(t,s*n),c=I.util.getTypedArrayFromDType("int32",s*n),f=function(d){var v=d*u,m=r.subarray(v,v+u),g=new Array(m.length);m.forEach(function(S,E){return g[E]={value:S,index:E}}),n<g.length&&(QR(g,n),g=g.slice(0,n)),a&&g.sort(lh);for(var y=d*n,b=l.subarray(y,y+n),w=c.subarray(y,y+n),k=0;k<n;k++)b[k]=g[k].value,w[k]=g[k].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[I.buffer(p,t,l),I.buffer(p,"int32",c)]}function eM(r,e,t,n){for(var a=I.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),l=new I.TensorBuffer(i,n,r),c=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var v=0;v<i[2];v++)p.push(l.get(d,o,v));h=p.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var m=Object.keys(s).length;s[h]=m,u[o]=m,c.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new I.TensorBuffer(g,n);c.forEach(function(w,k){for(var S=0;S<i[0];S++)for(var E=0;E<i[2];E++)y.set(l.get(S,w,E),S,k,E)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var ywe={__proto__:null,simpleAbsImpl:fR,addImpl:pR,bincountImpl:gw,bincountReduceImpl:dR,castImpl:hR,ceilImpl:vR,concatImpl:mR,equalImpl:gR,expImpl:bR,expm1Impl:xR,floorImpl:kR,gatherNdImpl:SR,gatherV2Impl:ER,greaterImpl:TR,greaterEqualImpl:IR,lessImpl:NR,lessEqualImpl:CR,linSpaceImpl:AR,logImpl:_R,maxImpl:DR,maximumImpl:FR,minimumImpl:RR,multiplyImpl:yw,negImpl:MR,notEqualImpl:OR,prodImpl:PR,raggedGatherImpl:LR,raggedTensorToTensorImpl:BR,rangeImpl:zR,rsqrtImpl:$R,scatterImpl:Ol,sigmoidImpl:owe,sliceImpl:VR,sparseFillEmptyRowsImpl:UR,sparseReshapeImpl:GR,sparseSegmentReductionImpl:ww,sqrtImpl:lwe,squaredDifferenceImpl:HR,stridedSliceImpl:qR,stringNGramsImpl:KR,stringSplitImpl:jR,stringToHashBucketFastImpl:XR,subImpl:YR,tileImpl:ZR,topKImpl:JR,transposeImpl:bw,uniqueImpl:eM};var bwe="3.21.0";I.registerBackend("cpu",function(){return new vw},1);var tM=$t(I.Elu,function(r){return r>=0?r:Math.exp(r)-1}),wwe={kernelName:I.Elu,backendName:"cpu",kernelFunc:tM};function rM(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha;He([a],"leakyRelu");for(var o=I.util.sizeFromShape(a.shape),s=t.data.get(a.dataId).values,u=I.util.getTypedArrayFromDType("float32",o),l=0;l<s.length;l++)u[l]=s[l]<0?i*s[l]:s[l];return t.makeTensorInfo(a.shape,"float32",u)}var xwe={kernelName:I.LeakyRelu,backendName:"cpu",kernelFunc:rM},kwe=Ur(function(r,e){return r<0?e*r:r});function nM(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha;He([n,a],"prelu");var i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=nt(kwe(n.shape,a.shape,i,o,"float32"),2),u=s[0],l=s[1];return t.makeTensorInfo(l,"float32",u)}var Swe={kernelName:I.Prelu,backendName:"cpu",kernelFunc:nM};var aM=$t(I.Relu,function(r){return Math.max(0,r)}),Ewe={kernelName:I.Relu,backendName:"cpu",kernelFunc:aM};var iM=$t(I.Relu6,function(r){return Math.min(Math.max(0,r),6)}),Twe={kernelName:I.Relu6,backendName:"cpu",kernelFunc:iM};function Vv(r,e,t,n,a){if(t==="linear")return Vi({inputs:{x:e},backend:r});if(t==="relu")return aM({inputs:{x:e},backend:r});if(t==="elu")return tM({inputs:{x:e},backend:r});if(t==="relu6")return iM({inputs:{x:e},backend:r});if(t==="prelu")return nM({inputs:{x:e,alpha:n},backend:r});if(t==="leakyrelu")return rM({inputs:{x:e},backend:r,attrs:{alpha:a}});if(t==="sigmoid")return WR({inputs:{x:e},backend:r});throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}function Yt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=I.util.sizeFromShape(a.shape),s=I.util.inferFromImplicitShape(i,o),u=I.util.sizeFromShape(s);I.util.assert(o===u,function(){return"The new shape ("+s+") has "+u+" elements and the old "+("shape ("+a.shape+") has "+o+" elements. The new shape and old ")+"shape must have the same number of elements."}),t.incRef(a.dataId);var l=t.data.get(a.dataId);if(l.complexTensorInfos!=null){var c=l.complexTensorInfos.real,f=l.complexTensorInfos.imag;c.shape=s,f.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var Iwe={kernelName:I.Reshape,backendName:"cpu",kernelFunc:Yt};function oM(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;He([a,i],"matMul");var u=a.shape.length,l=i.shape.length,c=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[l-1]:i.shape[l-2],h=o?a.shape[u-1]:a.shape[u-2],p=s?i.shape[l-2]:i.shape[l-1],d=a.shape.slice(0,-2),v=i.shape.slice(0,-2),m=I.util.sizeFromShape(d),g=I.util.sizeFromShape(v),y=I.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),b=y.concat([h,p]);I.util.assert(c===f,function(){return"Error in matMul: inner shapes ("+c+") and ("+(f+") of Tensors with shapes "+a.shape+" and ")+(i.shape+" and transposeA="+o)+(" and transposeB="+s+" must match.")});for(var w=o?[m,c,h]:[m,h,c],k=s?[g,p,f]:[g,f,p],S=Yt({inputs:{x:a},backend:t,attrs:{shape:w}}),E=Yt({inputs:{x:i},backend:t,attrs:{shape:k}}),N=o?S.shape[1]:S.shape[2],C=o?S.shape[2]:S.shape[1],R=s?E.shape[1]:E.shape[2],_=Math.max(m,g),O=t.data.get(S.dataId).values,P=t.data.get(E.dataId).values,B=I.util.computeStrides(S.shape),W=I.util.computeStrides(E.shape),L=nt(o?[B[0],1,B[1]]:[B[0],B[1],1],3),G=L[0],M=L[1],$=L[2],K=nt(s?[1,W[1],W[0]]:[W[1],1,W[0]],3),j=K[0],te=K[1],Q=K[2],ie=C*R,le=I.buffer([_,C,R],S.dtype),de=le.values,we=t.blockSize,pe=0;pe<_;pe++)for(var Se=0;Se<C;Se+=we)for(var Ee=0;Ee<R;Ee+=we)for(var Ne=0;Ne<N;Ne+=we)for(var Ge=Math.min(Se+we,C),Ke=Math.min(Ee+we,R),Ue=Math.min(Ne+we,N),tt=Se;tt<Ge;tt++)for(var st=Ee;st<Ke;st++){for(var je=0,Xe=Ne;Xe<Ue;Xe++){var at=Math.min(pe,m-1)*G,it=Math.min(pe,g-1)*Q,Kt=O[at+tt*M+Xe*$],Pe=P[Xe*j+st*te+it];je+=Kt*Pe}de[pe*ie+(tt*R+st)]+=je}return t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(E),t.makeTensorInfo(b,le.dtype,le.values)}var Nwe={kernelName:I.BatchMatMul,backendName:"cpu",kernelFunc:oM};function Cwe(r){var e,t,n=r.inputs,a=r.backend,i=r.attrs,o=n.a,s=n.b,u=n.bias,l=n.preluActivationWeights,c=i.transposeA,f=i.transposeB,h=i.activation,p=i.leakyreluAlpha,d,v,m,g=[],y=oM({inputs:{a:o,b:s},attrs:{transposeA:c,transposeB:f},backend:a});d=y,u&&(v=Ll({inputs:{a:d,b:u},backend:a}),g.push(d),d=v),h&&(m=Vv(a,d,h,l,p),g.push(d),d=m);try{for(var b=Pl(g),w=b.next();!w.done;w=b.next()){var k=w.value;a.disposeIntermediateTensorInfo(k)}}catch(S){e={error:S}}finally{try{w&&!w.done&&(t=b.return)&&t.call(b)}finally{if(e)throw e.error}}return d}var Awe={kernelName:I._FusedMatMul,backendName:"cpu",kernelFunc:Cwe};var _we=$t(I.Acos,function(r){return Math.acos(r)}),Dwe={kernelName:I.Acos,backendName:"cpu",kernelFunc:_we};var Fwe=$t(I.Acosh,function(r){return Math.acosh(r)}),Rwe={kernelName:I.Acosh,backendName:"cpu",kernelFunc:Fwe};function Mwe(r){var e=r.inputs,t=r.backend,n=e;He(e,"addN");for(var a=n.map(function(c){return t.data.get(c.dataId).values}),i=I.buffer(n[0].shape,n[0].dtype),o=i.values,s=0;s<n.length;s++)for(var u=a[s],l=0;l<o.length;l++)o[l]+=u[l];return t.makeTensorInfo(i.shape,i.dtype,i.values)}var Owe={kernelName:I.AddN,backendName:"cpu",kernelFunc:Mwe};function Pwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"all");var s=I.util.parseAxisParam(i,a.shape),u=s,l=I.backend_util.getAxesPermutation(u,a.shape.length),c=a;l!=null&&(c=On({inputs:{x:a},backend:t,attrs:{perm:l}}),u=I.backend_util.getInnerMostAxes(u.length,a.shape.length)),I.backend_util.assertAxesAreInnerMostDims("all",u,c.shape.length);for(var f=nt(I.backend_util.computeOutAndReduceShapes(c.shape,u),2),h=f[0],p=f[1],d=I.util.sizeFromShape(p),v=I.util.makeZerosTypedArray(I.util.sizeFromShape(h),c.dtype),m=t.data.get(c.dataId).values,g=0;g<v.length;++g){for(var y=g*d,b=m[y],w=0;w<d;++w){var k=m[y+w];b=b&&k}v[g]=b}l!=null&&t.disposeIntermediateTensorInfo(c);var S=t.makeTensorInfo(h,c.dtype,v);if(o){var E=I.backend_util.expandShapeToKeepDim(h,s),N=Yt({inputs:{x:S},backend:t,attrs:{shape:E}});return t.disposeIntermediateTensorInfo(S),N}return S}var Lwe={kernelName:I.All,backendName:"cpu",kernelFunc:Pwe};function Bwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"any");var s=I.util.parseAxisParam(i,a.shape),u=s,l=I.backend_util.getAxesPermutation(u,a.shape.length),c=a;l!=null&&(c=On({inputs:{x:a},backend:t,attrs:{perm:l}}),u=I.backend_util.getInnerMostAxes(u.length,a.shape.length)),I.backend_util.assertAxesAreInnerMostDims("any",u,c.shape.length);for(var f=nt(I.backend_util.computeOutAndReduceShapes(c.shape,u),2),h=f[0],p=f[1],d=I.util.sizeFromShape(p),v=I.util.makeZerosTypedArray(I.util.sizeFromShape(h),c.dtype),m=t.data.get(c.dataId).values,g=0;g<v.length;++g){for(var y=g*d,b=m[y],w=0;w<d;++w){var k=m[y+w];b=b||k}v[g]=b}l!=null&&t.disposeIntermediateTensorInfo(c);var S=t.makeTensorInfo(h,c.dtype,v);if(o){var E=I.backend_util.expandShapeToKeepDim(h,s),N=Yt({inputs:{x:S},backend:t,attrs:{shape:E}});return t.disposeIntermediateTensorInfo(S),N}return S}var zwe={kernelName:I.Any,backendName:"cpu",kernelFunc:Bwe};function $we(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;He(a,"argMax");var o=I.util.parseAxisParam(i,a.shape),s=I.backend_util.getAxesPermutation(o,a.shape.length),u=a,l=[];s!=null&&(u=On({inputs:{x:a},backend:t,attrs:{perm:s}}),l.push(u),o=I.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],I.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var c=nt(I.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=c[0],h=c[1],p=I.util.sizeFromShape(f),d=I.util.makeZerosTypedArray(p,"int32"),v=I.util.sizeFromShape(h),m=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*v,b=m[y],w=0,k=0;k<v;++k){var S=m[y+k];S>b&&(b=S,w=k)}d[g]=w}return l.forEach(function(E){return t.disposeIntermediateTensorInfo(E)}),t.makeTensorInfo(f,"int32",d)}var Wwe={kernelName:I.ArgMax,backendName:"cpu",kernelFunc:$we};function Vwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;He(a,"argMin");var o=I.util.parseAxisParam(i,a.shape),s=I.backend_util.getAxesPermutation(o,a.shape.length),u=a,l=[];s!=null&&(u=On({inputs:{x:a},backend:t,attrs:{perm:s}}),l.push(u),o=I.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],I.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var c=nt(I.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=c[0],h=c[1],p=I.util.sizeFromShape(f),d=I.util.makeZerosTypedArray(p,"int32"),v=I.util.sizeFromShape(h),m=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*v,b=m[y],w=0,k=0;k<v;++k){var S=m[y+k];S<b&&(b=S,w=k)}d[g]=w}return l.forEach(function(E){return t.disposeIntermediateTensorInfo(E)}),t.makeTensorInfo(f,"int32",d)}var Uwe={kernelName:I.ArgMin,backendName:"cpu",kernelFunc:Vwe};var Gwe=$t(I.Asin,function(r){return Math.asin(r)}),Hwe={kernelName:I.Asin,backendName:"cpu",kernelFunc:Gwe};var qwe=$t(I.Asinh,function(r){return Math.asinh(r)}),Kwe={kernelName:I.Asinh,backendName:"cpu",kernelFunc:qwe};var jwe=$t(I.Atan,function(r){return Math.atan(r)}),Xwe={kernelName:I.Atan,backendName:"cpu",kernelFunc:jwe};var Ywe=Ur(function(r,e){return Math.atan2(r,e)}),Zwe=an(I.Atan2,Ywe),Qwe={kernelName:I.Atan2,backendName:"cpu",kernelFunc:Zwe};var Jwe=$t(I.Atanh,function(r){return Math.atanh(r)}),exe={kernelName:I.Atanh,backendName:"cpu",kernelFunc:Jwe};function kw(r,e,t,n,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,l=a.dilationWidth,c=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,d=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=I.buffer(a.outShape,t),m=v.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],w=0;w<a.batchSize;++w)for(var k=w*g,S=w*n[0],E=0;E<a.inChannels;++E)for(var N=0;N<a.outHeight;++N)for(var C=N*o-h,R=Math.max(0,C),_=Math.min(a.inHeight,c+C),O=k+N*y,P=0;P<a.outWidth;++P){for(var B=P*s-p,W=Math.max(0,B),L=Math.min(a.inWidth,f+B),G=d,M=0,$=0,K=R;K<_;K+=u){for(var j=S+K*n[1],te=W;te<L;te+=l){var Q=j+te*n[2],ie=r[Q+E];i==="max"&&ie>G?G=ie:i==="avg"&&(M+=ie,$++)}if(isNaN(G))break}var le=O+P*b+E;m[le]=i==="avg"?M/$:G}return v}function sM(r,e,t,n,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=I.buffer(n.outShape,"int32"),s=n.strideHeight,u=n.strideWidth,l=n.dilationHeight,c=n.dilationWidth,f=n.effectiveFilterHeight,h=n.effectiveFilterWidth,p=n.padInfo.top,d=n.padInfo.left,v=I.buffer(e,t,r),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.outHeight;++y){for(var b=y*s-p,w=b;w<0;)w+=l;for(var k=Math.min(n.inHeight,f+b),S=0;S<n.outWidth;++S){for(var E=S*u-d,N=E;N<0;)N+=c;for(var C=Math.min(n.inWidth,h+E),R=Number.NEGATIVE_INFINITY,_=-1,O=w;O<k;O+=l)for(var P=O-b,B=N;B<C;B+=c){var W=B-E,L=v.get(m,O,B,g);L>R&&(R=L,a?_=i?((m*n.inHeight+O)*n.inWidth+B)*n.inChannels+g:(O*n.inWidth+B)*n.inChannels+g:_=P*h+W)}o.set(_,m,y,S,g)}}return o}function uM(r,e,t,n,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,l=a.dilationDepth,c=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,p=a.effectiveFilterHeight,d=a.effectiveFilterWidth,v=a.padInfo.front,m=a.padInfo.top,g=a.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=I.buffer(a.outShape,t),w=b.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[2]*a.outShape[3]*a.outShape[4],E=a.outShape[3]*a.outShape[4],N=a.outShape[4],C=0;C<a.batchSize;++C)for(var R=C*k,_=C*n[0],O=0;O<a.inChannels;++O)for(var P=0;P<a.outDepth;++P){for(var B=P*o-v,W=B;W<0;)W+=l;for(var L=Math.min(a.inDepth,h+B),G=R+P*S,M=0;M<a.outHeight;++M){for(var $=M*s-m,K=$;K<0;)K+=c;for(var j=Math.min(a.inHeight,p+$),te=G+M*E,Q=0;Q<a.outWidth;++Q){for(var ie=Q*u-g,le=ie;le<0;)le+=f;for(var de=Math.min(a.inWidth,d+ie),we=te+Q*N,pe=y,Se=0,Ee=0,Ne=W;Ne<L;Ne+=l){for(var Ge=_+Ne*n[1],Ke=K;Ke<j;Ke+=c){for(var Ue=Ge+Ke*n[2],tt=le;tt<de;tt+=f){var st=Ue+tt*n[3],je=r[st+O];if(i==="max"&&je>pe?pe=je:i==="avg"&&(Se+=je,Ee++),isNaN(pe))break}if(isNaN(pe))break}if(isNaN(pe))break}var Xe=we+O;w[Xe]=i==="avg"?Se/Ee:pe}}}return b}function txe(r,e){for(var t=I.buffer(e.outShape,"int32"),n=e.strideDepth,a=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,d=e.padInfo.left,v=0;v<e.batchSize;++v)for(var m=0;m<e.inChannels;++m)for(var g=0;g<e.outDepth;++g){for(var y=g*n-h,b=y;b<0;)b+=o;for(var w=Math.min(e.inDepth,l+y),k=0;k<e.outHeight;++k){for(var S=k*a-p,E=S;E<0;)E+=s;for(var N=Math.min(e.inHeight,c+S),C=0;C<e.outWidth;++C){for(var R=C*i-d,_=R;_<0;)_+=u;for(var O=Math.min(e.inWidth,f+R),P=Number.NEGATIVE_INFINITY,B=-1,W=b;W<w;W+=o)for(var L=W-y,G=E;G<N;G+=s)for(var M=G-S,$=_;$<O;$+=u){var K=$-R,j=r.get(v,W,G,$,m);j>=P&&(P=j,B=L*c*f+M*c+K)}t.set(B,v,g,k,C,m)}}}return t}function rxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;He(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=1;I.util.assert(I.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+l+"'")});var c=I.backend_util.computePool2DInfo(a.shape,i,o,l,s,u),f;if(c.filterWidth===1&&c.filterHeight===1&&I.util.arraysEqual(c.inShape,c.outShape))f=Vi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=I.util.computeStrides(a.shape),d=kw(h,a.shape,a.dtype,p,c,"avg");f=t.makeTensorInfo(c.outShape,a.dtype,d.values)}return f}var nxe={kernelName:I.AvgPool,backendName:"cpu",kernelFunc:rxe};function axe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=n.dataFormat;He(a,"avgPool3d");var c=I.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,l),f=t.data.get(a.dataId).values,h=uM(f,a.shape,a.dtype,I.util.computeStrides(a.shape),c,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}var ixe={kernelName:I.AvgPool3D,backendName:"cpu",kernelFunc:axe};function oxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,l=n.dimRoundingMode;He([a,i],"avgPool3DGrad");for(var c=I.backend_util.computePool3DInfo(i.shape,o,s,1,u,l),f=c.strideDepth,h=c.strideHeight,p=c.strideWidth,d=c.filterDepth,v=c.filterHeight,m=c.filterWidth,g=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,w=c.effectiveFilterDepth,k=c.effectiveFilterHeight,S=c.effectiveFilterWidth,E=w-1-c.padInfo.front,N=S-1-c.padInfo.left,C=k-1-c.padInfo.top,R=I.buffer(i.shape,"float32"),_=1/(d*v*m),O=t.bufferSync(a),P=0;P<c.batchSize;++P)for(var B=0;B<c.inChannels;++B)for(var W=0;W<c.inDepth;++W)for(var L=0;L<c.inHeight;++L)for(var G=0;G<c.inWidth;++G){for(var M=W-E,$=L-C,K=G-N,j=0,te=0;te<w;te+=g){var Q=(M+te)/f;if(!(Q<0||Q>=c.outDepth||Math.floor(Q)!==Q))for(var ie=0;ie<k;ie+=y){var le=($+ie)/h;if(!(le<0||le>=c.outHeight||Math.floor(le)!==le))for(var de=0;de<S;de+=b){var we=(K+de)/p;if(!(we<0||we>=c.outWidth||Math.floor(we)!==we)){var pe=O.get(P,Q,le,we,B);j+=pe}}}}R.set(j*_,P,W,L,G,B)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}var sxe={kernelName:I.AvgPool3DGrad,backendName:"cpu",kernelFunc:oxe};function uxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;He([a,i],"avgPoolGrad");for(var s=n.filterSize,u=n.strides,l=n.pad,c=I.backend_util.computePool2DInfo(o.shape,s,u,1,l),f=c.strideHeight,h=c.strideWidth,p=c.filterHeight,d=c.filterWidth,v=c.dilationHeight,m=c.dilationWidth,g=c.effectiveFilterHeight,y=c.effectiveFilterWidth,b=y-1-c.padInfo.left,w=g-1-c.padInfo.top,k=I.buffer(o.shape,"float32"),S=1/(p*d),E=t.data.get(a.dataId).values,N=I.buffer(a.shape,"float32",E),C=0;C<c.batchSize;++C)for(var R=0;R<c.inChannels;++R)for(var _=0;_<c.inHeight;++_)for(var O=0;O<c.inWidth;++O){for(var P=_-w,B=O-b,W=0,L=0;L<g;L+=v){var G=(P+L)/f;if(!(G<0||G>=c.outHeight||Math.floor(G)!==G))for(var M=0;M<y;M+=m){var $=(B+M)/h;if(!($<0||$>=c.outWidth||Math.floor($)!==$)){var K=N.get(C,G,$,R);W+=K}}}k.set(W*S,C,_,O,R)}return t.makeTensorInfo(k.shape,k.dtype,k.values)}var lxe={kernelName:I.AvgPoolGrad,backendName:"cpu",kernelFunc:uxe};function cxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.scale,o=e.offset,s=e.mean,u=e.variance;I.util.assert(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),I.util.assert(o==null||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),I.util.assert(i==null||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),He([a,s,u,i,o],"batchNorm");var l=n.varianceEpsilon;l==null&&(l=.001);for(var c=t.data.get(a.dataId).values,f=t.data.get(s.dataId).values,h=t.data.get(u.dataId).values,p=i?t.data.get(i.dataId).values:new Float32Array([1]),d=o?t.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(c.length),m=d.length,g=p.length,y=h.length,b=f.length,w=0,k=0,S=0,E=0,N=0;N<c.length;++N)v[N]=d[w++]+(c[N]-f[k++])*p[S++]/Math.sqrt(h[E++]+l),w>=m&&(w=0),k>=b&&(k=0),S>=g&&(S=0),E>=y&&(E=0);return t.makeTensorInfo(a.shape,a.dtype,v)}var fxe={kernelName:I.FusedBatchNorm,backendName:"cpu",kernelFunc:cxe};function hxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;He([a],"batchToSpaceND");var s=i.reduce(function(g,y){return g*y}),u=I.backend_util.getReshaped(a.shape,i,s),l=I.backend_util.getPermuted(u.length,i.length),c=I.backend_util.getReshapedPermuted(a.shape,i,s),f=I.backend_util.getSliceBeginCoords(o,i.length),h=I.backend_util.getSliceSize(c,o,i.length),p=Yt({inputs:{x:a},backend:t,attrs:{shape:u}}),d=On({inputs:{x:p},backend:t,attrs:{perm:l}}),v=Yt({inputs:{x:d},backend:t,attrs:{shape:c}}),m=vu({inputs:{x:v},backend:t,attrs:{begin:f,size:h}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(v),m}var pxe={kernelName:I.BatchToSpaceND,backendName:"cpu",kernelFunc:hxe};function dxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,l=gw(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}var vxe={kernelName:I.Bincount,backendName:"cpu",kernelFunc:dxe};function mxe(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=I.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var gxe={kernelName:I.BroadcastArgs,backendName:"cpu",kernelFunc:mxe};var yxe=$t(I.ClipByValue,function(r,e){var t=e;return r>t.clipValueMax?t.clipValueMax:r<t.clipValueMin?t.clipValueMin:r}),bxe={kernelName:I.ClipByValue,backendName:"cpu",kernelFunc:yxe};var wxe=function(r){for(var e=r.inputs.x,t=r.backend,n=new Float32Array(I.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,l=0;l<s.length;l++){var c=s[l],f=u[l];n[l]=Math.hypot(c,f)}return t.makeOutput(n,e.shape,"float32")},xxe={kernelName:I.ComplexAbs,backendName:"cpu",kernelFunc:wxe};function Bl(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.imag,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var kxe={kernelName:I.Imag,backendName:"cpu",kernelFunc:Bl};function zl(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=I.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(w){return w.shape});I.backend_util.assertParamsConsistent(o,i);var s=I.backend_util.computeOutShape(e.map(function(w){return w.shape}),i);if(I.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(w){return I.util.sizeFromShape(w.shape)>0});if(u.length===1)return Vi({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){var l=u.map(function(w){return du({inputs:{input:w},backend:t})}),c=u.map(function(w){return Bl({inputs:{input:w},backend:t})}),f=zl({inputs:l,backend:t,attrs:{axis:i}}),h=zl({inputs:c,backend:t,attrs:{axis:i}}),p=ia({inputs:{real:f,imag:h},backend:t});return l.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),c.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}var d=u.map(function(w){var k=I.util.sizeFromShape(w.shape.slice(i)),S=[-1,k];return Yt({inputs:{x:w},backend:t,attrs:{shape:S}})}),v=d.map(function(w){return{vals:t.data.get(w.dataId).values,shape:w.shape}});s=I.backend_util.computeOutShape(d.map(function(w){return w.shape}),1);var m=d[0].shape[0]===1,g=mR(v,s,e[0].dtype,m),y=I.backend_util.computeOutShape(u.map(function(w){return w.shape}),i),b=t.makeTensorInfo(y,e[0].dtype,g);return d.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),b}var Sxe={kernelName:I.Concat,backendName:"cpu",kernelFunc:zl};function lM(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dilations,c=n.dimRoundingMode;He([a,i],"conv2d");for(var f=I.backend_util.convertConv2DDataFormat(u),h=I.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!1,f),p=h.filterHeight,d=h.filterWidth,v=h.dilationHeight,m=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,b=h.dataFormat==="channelsLast",w=new I.TensorBuffer(h.outShape,a.dtype),k=I.util.computeStrides(a.shape),S=I.util.computeStrides(i.shape),E=k[0],N=b?k[1]:k[2],C=b?k[2]:1,R=b?1:k[1],_=w.strides[0],O=b?w.strides[1]:w.strides[2],P=b?w.strides[2]:1,B=b?1:w.strides[1],W=t.data.get(a.dataId).values,L=t.data.get(i.dataId).values,G=w.values,M=0;M<h.batchSize;++M)for(var $=M*E,K=M*_,j=0;j<h.outHeight;++j)for(var te=K+j*O,Q=j*h.strideHeight-y,ie=0;ie<p;++ie){var le=Q+ie*v;if(!(le<0||le>=h.inHeight))for(var de=ie*S[0],we=$+le*N,pe=0;pe<h.outWidth;++pe)for(var Se=te+pe*P,Ee=pe*h.strideWidth-g,Ne=0;Ne<d;++Ne){var Ge=Ee+Ne*m;if(!(Ge<0||Ge>=h.inWidth))for(var Ke=de+Ne*S[1],Ue=we+Ge*C,tt=Ke,st=0;st<h.inChannels;++st){for(var je=W[Ue+st*R],Xe=0;Xe<h.outChannels;++Xe)G[Se+Xe*B]+=je*L[tt+Xe];tt+=h.outChannels}}}return t.makeTensorInfo(w.shape,w.dtype,G)}var Exe={kernelName:I.Conv2D,backendName:"cpu",kernelFunc:lM};function Txe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dimRoundingMode,c=n.filterShape;He([a,i],"conv2dBackpropFilter");for(var f=I.backend_util.convertConv2DDataFormat(u),h=I.backend_util.computeConv2DInfo(a.shape,c,o,1,s,l,!1,f),p=h.strideHeight,d=h.strideWidth,v=h.filterHeight,m=h.filterWidth,g=h.dataFormat==="channelsLast",y=new I.TensorBuffer(h.filterShape,"float32"),b=h.padInfo.left,w=h.padInfo.top,k=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,E=new I.TensorBuffer(a.shape,a.dtype,k),N=new I.TensorBuffer(i.shape,i.dtype,S),C=0;C<v;++C)for(var R=Math.max(0,Math.ceil((w-C)/p)),_=Math.min(h.outHeight,(h.inHeight+w-C)/p),O=0;O<m;++O)for(var P=Math.max(0,Math.ceil((b-O)/d)),B=Math.min(h.outWidth,(h.inWidth+b-O)/d),W=0;W<h.inChannels;++W)for(var L=0;L<h.outChannels;++L){for(var G=0,M=0;M<h.batchSize;++M)for(var $=R;$<_;++$)for(var K=C+$*p-w,j=P;j<B;++j){var te=O+j*d-b;g?G+=E.get(M,K,te,W)*N.get(M,$,j,L):G+=E.get(M,W,K,te)*N.get(M,L,$,j)}y.set(G,C,O,W,L)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var Ixe={kernelName:I.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:Txe};function Nxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,l=n.dataFormat,c=n.dimRoundingMode;He([a,i],"conv2dBackpropInput");var f=I.util.computeStrides(i.shape),h=I.util.computeStrides(a.shape),p=I.backend_util.convertConv2DDataFormat(l),d=I.backend_util.computeConv2DInfo(o,i.shape,s,1,u,c,!1,p),v=new I.TensorBuffer(d.inShape,"float32"),m=v.values,g=t.data.get(a.dataId).values,y=t.data.get(i.dataId).values,b=nt(f,3),w=b[0],k=b[1],S=b[2],E=d.batchSize,N=d.filterHeight,C=d.filterWidth,R=d.inChannels,_=d.inHeight,O=d.inWidth,P=d.outChannels,B=d.outHeight,W=d.outWidth,L=d.strideHeight,G=d.strideWidth;p=d.dataFormat;for(var M=N-1-d.padInfo.top,$=C-1-d.padInfo.left,K=p==="channelsLast",j=v.strides[0],te=K?v.strides[1]:v.strides[2],Q=K?v.strides[2]:1,ie=K?1:v.strides[1],le=h[0],de=K?h[1]:h[2],we=K?h[2]:1,pe=K?1:h[1],Se=0;Se<E;++Se)for(var Ee=0;Ee<R;++Ee)for(var Ne=0;Ne<_;++Ne)for(var Ge=Ne-M,Ke=Math.max(0,Math.ceil(Ge/L)),Ue=Math.min(B,(N+Ge)/L),tt=0;tt<O;++tt){for(var st=tt-$,je=Math.max(0,Math.ceil(st/G)),Xe=Math.min(W,(C+st)/G),at=0,it=Ke;it<Ue;++it)for(var Kt=it*L-Ge,Pe=je;Pe<Xe;++Pe)for(var xt=Pe*G-st,Mr=le*Se+de*it+we*Pe,dn=w*(N-1-Kt)+k*(C-1-xt)+S*Ee,Br=0;Br<P;++Br){var Or=g[Mr+pe*Br],mr=y[dn+Br];at+=Or*mr}var zn=j*Se+te*Ne+Q*tt+ie*Ee;m[zn]=at}return t.makeTensorInfo(v.shape,v.dtype,v.values)}var Cxe={kernelName:I.Conv2DBackpropInput,backendName:"cpu",kernelFunc:Nxe};function Axe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations;He([a,i],"conv3d");for(var l=I.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),c=l.filterDepth,f=l.filterHeight,h=l.filterWidth,p=l.dilationDepth,d=l.dilationHeight,v=l.dilationWidth,m=l.padInfo,g=m.front,y=m.left,b=m.top,w=new I.TensorBuffer(l.outShape,a.dtype),k=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,E=w.values,N=I.util.computeStrides(a.shape),C=I.util.computeStrides(i.shape),R=0;R<l.batchSize;++R)for(var _=R*N[0],O=R*w.strides[0],P=0;P<l.outDepth;++P)for(var B=O+P*w.strides[1],W=P*l.strideDepth-g,L=0;L<c;++L){var G=W+L*p;if(!(G<0||G>=l.inDepth))for(var M=L*C[0],$=_+G*N[1],K=0;K<l.outHeight;++K)for(var j=B+K*w.strides[2],te=K*l.strideHeight-b,Q=0;Q<f;++Q){var ie=te+Q*d;if(!(ie<0||ie>=l.inHeight))for(var le=M+Q*C[1],de=$+ie*N[2],we=0;we<l.outWidth;++we)for(var pe=j+we*l.outChannels,Se=we*l.strideWidth-y,Ee=0;Ee<h;++Ee){var Ne=Se+Ee*v;if(!(Ne<0||Ne>=l.inWidth))for(var Ge=le+Ee*C[2],Ke=de+Ne*l.inChannels,Ue=Ge,tt=0;tt<l.inChannels;++tt){for(var st=k[Ke+tt],je=0;je<l.outChannels;++je)E[pe+je]+=st*S[Ue+je];Ue+=l.outChannels}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var _xe={kernelName:I.Conv3D,backendName:"cpu",kernelFunc:Axe};function Dxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape;He([a,i],"conv3dBackpropFilterV2");for(var l=I.util.computeStrides(a.shape),c=I.util.computeStrides(i.shape),f=I.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,p=f.strideHeight,d=f.strideWidth,v=f.filterDepth,m=f.filterHeight,g=f.filterWidth,y=new I.TensorBuffer(f.filterShape,"float32"),b=y.values,w=nt(y.strides,4),k=w[0],S=w[1],E=w[2],N=w[3],C=t.data.get(i.dataId).values,R=nt(c,4),_=R[0],O=R[1],P=R[2],B=R[3],W=t.data.get(a.dataId).values,L=nt(l,4),G=L[0],M=L[1],$=L[2],K=L[3],j=f.padInfo.front,te=f.padInfo.left,Q=f.padInfo.top,ie=0;ie<v;++ie)for(var le=Math.max(0,Math.ceil((j-ie)/h)),de=Math.min(f.outDepth,(f.inDepth+j-ie)/h),we=ie*k,pe=0;pe<m;++pe)for(var Se=Math.max(0,Math.ceil((Q-pe)/p)),Ee=Math.min(f.outHeight,(f.inHeight+Q-pe)/p),Ne=pe*S+we,Ge=0;Ge<g;++Ge)for(var Ke=Math.max(0,Math.ceil((te-Ge)/d)),Ue=Math.min(f.outWidth,(f.inWidth+te-Ge)/d),tt=Ge*E+Ne,st=0;st<f.inChannels;++st)for(var je=st*N+tt,Xe=0;Xe<f.outChannels;++Xe){for(var at=0,it=0;it<f.batchSize;++it)for(var Kt=it*G,Pe=it*_,xt=le;xt<de;++xt)for(var Mr=ie+xt*h-j,dn=Mr*M+Kt,Br=xt*O+Pe,Or=Se;Or<Ee;++Or)for(var mr=pe+Or*p-Q,zn=mr*$+dn,vn=Or*P+Br,$n=Ke;$n<Ue;++$n){var Cr=Ge+$n*d-te,Yi=Cr*K+zn,Pu=$n*B+vn;at+=W[Yi+st]*C[Pu+Xe]}b[je+Xe]=at}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var Fxe={kernelName:I.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:Dxe};function Rxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape;He([a],"conv3dBackpropInputV2");for(var l=I.util.computeStrides(a.shape),c=I.util.computeStrides(i.shape),f=I.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new I.TensorBuffer(f.inShape,"float32"),p=h.values,d=nt(h.strides,4),v=d[0],m=d[1],g=d[2],y=d[3],b=t.data.get(a.dataId).values,w=nt(l,4),k=w[0],S=w[1],E=w[2],N=w[3],C=t.data.get(i.dataId).values,R=nt(c,4),_=R[0],O=R[1],P=R[2],B=R[3],W=f.batchSize,L=f.filterDepth,G=f.filterHeight,M=f.filterWidth,$=f.inChannels,K=f.inDepth,j=f.inHeight,te=f.inWidth,Q=f.outChannels,ie=f.outDepth,le=f.outHeight,de=f.outWidth,we=f.strideDepth,pe=f.strideHeight,Se=f.strideWidth,Ee=L-1-f.padInfo.front,Ne=G-1-f.padInfo.top,Ge=M-1-f.padInfo.left,Ke=0;Ke<W;++Ke)for(var Ue=0;Ue<$;++Ue)for(var tt=0;tt<K;++tt)for(var st=tt-Ee,je=Math.max(0,Math.ceil(st/we)),Xe=Math.min(ie,(L+st)/we),at=0;at<j;++at)for(var it=at-Ne,Kt=Math.max(0,Math.ceil(it/pe)),Pe=Math.min(le,(G+it)/pe),xt=0;xt<te;++xt){for(var Mr=xt-Ge,dn=Math.max(0,Math.ceil(Mr/Se)),Br=Math.min(de,(M+Mr)/Se),Or=0,mr=je;mr<Xe;++mr)for(var zn=mr*we-st,vn=Kt;vn<Pe;++vn)for(var $n=vn*pe-it,Cr=dn;Cr<Br;++Cr)for(var Yi=Cr*Se-Mr,Pu=k*Ke+S*mr+E*vn+N*Cr,fp=_*(L-1-zn)+O*(G-1-$n)+P*(M-1-Yi)+B*Ue,Zi=0;Zi<Q;++Zi){var cs=b[Pu+Zi],Lu=C[fp+Zi];Or+=cs*Lu}p[v*Ke+m*tt+g*at+y*xt+Ue]=Or}return t.makeTensorInfo(h.shape,h.dtype,h.values)}var Mxe={kernelName:I.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:Rxe};var Oxe=$t(I.Cos,function(r){return Math.cos(r)}),Pxe={kernelName:I.Cos,backendName:"cpu",kernelFunc:Oxe};var Lxe=$t(I.Cosh,function(r){return Math.cosh(r)}),Bxe={kernelName:I.Cosh,backendName:"cpu",kernelFunc:Lxe};function zxe(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,l=n.extrapolationValue,c=nt(a.shape,4),f=c[0],h=c[1],p=c[2],d=c[3],v=i.shape[0],m=nt(s,2),g=m[0],y=m[1],b=I.buffer([v,g,y,d],"float32"),w=t.data.get(i.dataId).values,k=t.data.get(o.dataId).values,S=t.data.get(a.dataId).values,E=I.util.computeStrides(a.shape),N=I.util.computeStrides(b.shape),C=0;C<v;C++){var R=C*4,_=w[R],O=w[R+1],P=w[R+2],B=w[R+3],W=k[C];if(!(W>=f))for(var L=g>1?(P-_)*(h-1)/(g-1):0,G=y>1?(B-O)*(p-1)/(y-1):0,M=0;M<g;M++){var $=g>1?_*(h-1)+M*L:.5*(_+P)*(h-1);if($<0||$>h-1){for(var K=0;K<y;K++)for(var j=0;j<d;j++){var te=j+K*N[2]+M*N[1]+C*N[0];b.values[te]=l}continue}if(u==="bilinear")for(var Q=Math.floor($),ie=Math.ceil($),le=$-Q,K=0;K<y;K++){var de=y>1?O*(p-1)+K*G:.5*(O+B)*(p-1);if(de<0||de>p-1){for(var j=0;j<d;j++){var te=j+K*N[2]+M*N[1]+C*N[0];b.values[te]=l}continue}for(var we=Math.floor(de),pe=Math.ceil(de),Se=de-we,j=0;j<d;j++){var te=j+we*E[2]+Q*E[1]+W*E[0],Ee=S[te];te=j+pe*E[2]+Q*E[1]+W*E[0];var Ne=S[te];te=j+we*E[2]+ie*E[1]+W*E[0];var Ge=S[te];te=j+pe*E[2]+ie*E[1]+W*E[0];var Ke=S[te],Ue=Ee+(Ne-Ee)*Se,tt=Ge+(Ke-Ge)*Se;te=j+K*N[2]+M*N[1]+C*N[0],b.values[te]=Ue+(tt-Ue)*le}}else for(var K=0;K<y;++K){var de=y>1?O*(p-1)+K*G:.5*(O+B)*(p-1);if(de<0||de>p-1){for(var j=0;j<d;j++){var te=j+K*N[2]+M*N[1]+C*N[0];b.values[te]=l}continue}for(var st=Math.round(de),je=Math.round($),j=0;j<d;j++){var Xe=j+st*E[2]+je*E[1]+W*E[0],at=j+K*N[2]+M*N[1]+C*N[0];b.values[at]=S[Xe]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}var $xe={kernelName:I.CropAndResize,backendName:"cpu",kernelFunc:zxe};function Wxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;He(a,"cumprod");var u=I.backend_util.getAxesPermutation([i],a.shape.length),l=a;u!=null&&(l=On({inputs:{x:a},backend:t,attrs:{perm:u}}));var c=I.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(c!==l.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+("axis="+(l.shape.length-1)+" but got axis="+c));for(var f=I.upcastType(l.dtype,"int32"),h=I.util.makeOnesTypedArray(I.util.sizeFromShape(l.shape),f),p=t.data.get(l.dataId).values,d=l.shape[l.shape.length-1],v=s?function(E,N){return E+d-N-1}:function(E,N){return E+N},m=0;m<p.length;m+=d)for(var g=0;g<d;g++){var y=v(m,g);if(g===0)h[y]=o?1:p[y];else{var b=v(m,g-1);h[y]=o?p[b]*h[b]:p[y]*h[b]}}var w=t.makeTensorInfo(l.shape,f,h);if(u!=null){var k=I.backend_util.getUndoAxesPermutation(u),S=On({inputs:{x:w},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(l),S}return w}var Vxe={kernelName:I.Cumprod,backendName:"cpu",kernelFunc:Wxe};function Uxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;He(a,"cumsum");var u=I.backend_util.getAxesPermutation([i],a.shape.length),l=a;u!=null&&(l=On({inputs:{x:a},backend:t,attrs:{perm:u}}));var c=I.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(c!==l.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+("axis="+(l.shape.length-1)+" but got axis="+c));for(var f=I.upcastType(l.dtype,"int32"),h=I.util.makeZerosTypedArray(I.util.sizeFromShape(l.shape),f),p=t.data.get(l.dataId).values,d=l.shape[l.shape.length-1],v=s?function(E,N){return E+d-N-1}:function(E,N){return E+N},m=0;m<p.length;m+=d)for(var g=0;g<d;g++){var y=v(m,g);if(g===0)h[y]=o?0:p[y];else{var b=v(m,g-1);h[y]=o?p[b]+h[b]:p[y]+h[b]}}var w=t.makeTensorInfo(l.shape,f,h);if(u!=null){var k=I.backend_util.getUndoAxesPermutation(u),S=On({inputs:{x:w},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(l),S}return w}var Gxe={kernelName:I.Cumsum,backendName:"cpu",kernelFunc:Uxe};function Hxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,c=gw(u,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=dR(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+(a.shape.length+"."))}var qxe={kernelName:I.DenseBincount,backendName:"cpu",kernelFunc:Hxe};function Kxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat;I.util.assert(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o});for(var s=a.shape[0],u=a.shape[1],l=a.shape[2],c=a.shape[3],f=u*i,h=l*i,p=c/(i*i),d=t.data.get(a.dataId).values,v=new Float32Array(s*f*h*p),m=0,g=0;g<s;++g)for(var y=0;y<f;++y)for(var b=Math.floor(y/i),w=y%i,k=0;k<h;++k)for(var S=Math.floor(k/i),E=k%i,N=(w*i+E)*p,C=0;C<p;++C){var R=C+N,_=R+c*(S+l*(b+u*g));v[m++]=d[_]}return t.makeTensorInfo([s,f,h,p],a.dtype,v)}var jxe={kernelName:I.DepthToSpace,backendName:"cpu",kernelFunc:Kxe};function cM(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=n.dimRoundingMode;He([a,i],"depthwiseConv2DNative");var c=I.util.computeStrides(a.shape),f=I.util.computeStrides(i.shape),h=u;h==null&&(h=[1,1]),I.util.assert(I.backend_util.eitherStridesOrDilationsAreOne(o,h),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+("1. Got strides "+o+" and dilations '"+h+"'")});for(var p=I.backend_util.computeConv2DInfo(a.shape,i.shape,o,h,s,l,!0),d=p.filterHeight,v=p.filterWidth,m=p.dilationHeight,g=p.dilationWidth,y=p.padInfo,b=y.left,w=y.top,k=p.outChannels/p.inChannels,S=new I.TensorBuffer(p.outShape,a.dtype),E=t.data.get(a.dataId).values,N=t.data.get(i.dataId).values,C=S.values,R=0;R<p.batchSize;++R)for(var _=R*c[0],O=R*S.strides[0],P=0;P<p.outHeight;++P)for(var B=O+P*S.strides[1],W=P*p.strideHeight-w,L=0;L<d;++L){var G=W+L*m;if(!(G<0||G>=p.inHeight))for(var M=L*f[0],$=_+G*c[1],K=0;K<p.outWidth;++K)for(var j=B+K*S.strides[2],te=K*p.strideWidth-b,Q=0;Q<v;++Q){var ie=te+Q*g;if(!(ie<0||ie>=p.inWidth))for(var le=M+Q*f[1],de=$+ie*p.inChannels,we=j,pe=le,Se=0;Se<p.inChannels;++Se){for(var Ee=E[de+Se],Ne=0;Ne<k;++Ne)C[we+Ne]+=Ee*N[pe+Ne];we+=k,pe+=k}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}var Xxe={kernelName:I.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:cM};function Yxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,l=n.dimRoundingMode,c=n.filterShape;He([a,i],"depthwiseConv2dNativeBackpropFilter");for(var f=I.backend_util.computeConv2DInfo(a.shape,c,o,s,u,l,!0),h=f.strideHeight,p=f.strideWidth,d=f.filterHeight,v=f.filterWidth,m=new I.TensorBuffer(f.filterShape,"float32"),g=f.padInfo.left,y=f.padInfo.top,b=f.outChannels/f.inChannels,w=t.data.get(a.dataId).values,k=new I.TensorBuffer(a.shape,a.dtype,w),S=t.data.get(i.dataId).values,E=new I.TensorBuffer(i.shape,i.dtype,S),N=0;N<d;++N)for(var C=Math.max(0,Math.ceil((y-N)/h)),R=Math.min(f.outHeight,(f.inHeight+y-N)/h),_=0;_<v;++_)for(var O=Math.max(0,Math.ceil((g-_)/p)),P=Math.min(f.outWidth,(f.inWidth+g-_)/p),B=0;B<f.outChannels;++B){for(var W=Math.trunc(B/b),L=B%b,G=0,M=0;M<f.batchSize;++M)for(var $=C;$<R;++$)for(var K=N+$*h-y,j=O;j<P;++j){var te=_+j*p-g;G+=k.get(M,K,te,W)*E.get(M,$,j,B)}m.set(G,N,_,W,L)}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var Zxe={kernelName:I.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:Yxe};function Qxe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,l=n.dimRoundingMode,c=n.inputShape;He([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=I.util.computeStrides(a.shape),h=I.util.computeStrides(i.shape),p=I.backend_util.computeConv2DInfo(c,i.shape,o,s,u,l,!0),d=new I.TensorBuffer(p.inShape,"float32"),v=d.values,m=nt(d.strides,3),g=m[0],y=m[1],b=m[2],w=t.data.get(a.dataId).values,k=nt(f,3),S=k[0],E=k[1],N=k[2],C=t.data.get(i.dataId).values,R=nt(h,3),_=R[0],O=R[1],P=R[2],B=p.batchSize,W=p.filterHeight,L=p.filterWidth,G=p.inChannels,M=p.inHeight,$=p.inWidth,K=p.outChannels,j=p.outHeight,te=p.outWidth,Q=p.strideHeight,ie=p.strideWidth,le=W-1-p.padInfo.top,de=L-1-p.padInfo.left,we=K/G,pe=0;pe<B;++pe)for(var Se=0;Se<G;++Se)for(var Ee=0;Ee<M;++Ee)for(var Ne=Ee-le,Ge=Math.max(0,Math.ceil(Ne/Q)),Ke=Math.min(j,(W+Ne)/Q),Ue=0;Ue<$;++Ue){for(var tt=Ue-de,st=Math.max(0,Math.ceil(tt/ie)),je=Math.min(te,(L+tt)/ie),Xe=0,at=Ge;at<Ke;++at)for(var it=at*Q-Ne,Kt=st;Kt<je;++Kt)for(var Pe=Kt*ie-tt,xt=S*pe+E*at+N*Kt,Mr=_*(W-1-it)+O*(L-1-Pe)+P*Se,dn=0;dn<we;++dn){var Br=Se*we+dn,Or=w[xt+Br],mr=C[Mr+dn];Xe+=Or*mr}v[g*pe+y*Ee+b*Ue+Se]=Xe}return t.makeTensorInfo(d.shape,d.dtype,d.values)}var Jxe={kernelName:I.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:Qxe};function eke(r){for(var e=r.inputs,t=r.backend,n=e.x,a=I.util.sizeFromShape(n.shape),i=t.data.get(n.dataId).values,o=I.buffer([a,a],n.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var l=Ei(n.shape,n.shape);return t.makeTensorInfo(l,o.dtype,o.values)}var tke={kernelName:I.Diag,backendName:"cpu",kernelFunc:eke};var rke={kernelName:I.Dilation2D,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=t,c=l.data.get(a.dataId).values,f=a.shape.length,h=l.data.get(i.dataId).values,p=i.shape.length,d=I.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),v=d.batchSize,m=d.inHeight,g=d.inWidth,y=d.inChannels,b=d.outHeight,w=d.outWidth,k=d.padInfo,S=d.strideHeight,E=d.strideWidth,N=d.filterHeight,C=d.filterWidth,R=d.dilationHeight,_=d.dilationWidth,O=d.outShape,P=I.util.sizeFromShape(O),B=O.length,W=I.util.getArrayFromDType(a.dtype,P),L=0;L<v;++L)for(var G=0;G<b;++G)for(var M=G*S-k.top,$=0;$<w;++$)for(var K=$*E-k.left,j=0;j<y;++j){for(var te=Number.MIN_SAFE_INTEGER,Q=0;Q<N;++Q){var ie=M+Q*R;if(ie>=0&&ie<m)for(var le=0;le<C;++le){var de=K+le*_;if(de>=0&&de<g){var we=I.util.locToIndex([L,ie,de,j],f,I.util.computeStrides(a.shape)),pe=I.util.locToIndex([Q,le,j],p,I.util.computeStrides(i.shape)),Se=c[we]+h[pe];Se>te&&(te=Se)}}}var Ee=I.util.locToIndex([L,G,$,j],B,I.util.computeStrides(O));W[Ee]=te}var Ne=l.write(I.util.toTypedArray(W,a.dtype),O,a.dtype);return{dataId:Ne,shape:O,dtype:a.dtype}}};var nke={kernelName:I.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,l=n.dilations,c=t,f=I.util.toNestedArray(a.shape,c.data.get(a.dataId).values),h=I.util.toNestedArray(i.shape,c.data.get(i.dataId).values),p=I.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",l),d=p.batchSize,v=p.inHeight,m=p.inWidth,g=p.inChannels,y=p.outHeight,b=p.outWidth,w=p.padInfo,k=p.strideHeight,S=p.strideWidth,E=p.filterHeight,N=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;I.util.assert(o.rank===_.length,function(){return"Error in "+I.Dilation2DBackpropFilter+", dy "+("must have the same rank as output "+_.length+", but got ")+(""+o.rank)});for(var O=I.util.toNestedArray(_,c.data.get(o.dataId).values),P=I.util.makeZerosNestedTypedArray(i.shape,i.dtype),B=0;B<d;++B)for(var W=0;W<y;++W)for(var L=W*k-w.top,G=0;G<b;++G)for(var M=G*S-w.left,$=0;$<g;++$){for(var K=Number.MIN_SAFE_INTEGER,j=0,te=0,Q=0;Q<E;++Q){var ie=L+Q*C;if(ie>=0&&ie<v)for(var le=0;le<N;++le){var de=M+le*R;if(de>=0&&de<m){var we=f[B][ie][de][$]+h[Q][le][$];we>K&&(K=we,j=Q,te=le)}}}P[j][te][$]+=O[B][W][G][$]}var pe=c.write(I.util.toTypedArray(P,a.dtype),i.shape,i.dtype);return{dataId:pe,shape:i.shape,dtype:i.dtype}}};var ake={kernelName:I.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,l=n.dilations,c=t,f=I.util.toNestedArray(a.shape,c.data.get(a.dataId).values),h=I.util.toNestedArray(i.shape,c.data.get(i.dataId).values),p=I.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",l),d=p.batchSize,v=p.inHeight,m=p.inWidth,g=p.inChannels,y=p.outHeight,b=p.outWidth,w=p.padInfo,k=p.strideHeight,S=p.strideWidth,E=p.filterHeight,N=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;I.util.assert(o.rank===_.length,function(){return"Error in "+I.Dilation2DBackpropInput+", dy "+("must have the same rank as output "+_.length+", but got ")+(""+o.rank)});for(var O=I.util.toNestedArray(_,c.data.get(o.dataId).values),P=I.util.makeZerosNestedTypedArray(a.shape,a.dtype),B=0;B<d;++B)for(var W=0;W<y;++W)for(var L=W*k-w.top,G=0;G<b;++G)for(var M=G*S-w.left,$=0;$<g;++$){for(var K=Number.MIN_SAFE_INTEGER,j=L<0?0:L,te=M<0?0:M,Q=0;Q<E;++Q){var ie=L+Q*C;if(ie>=0&&ie<v)for(var le=0;le<N;++le){var de=M+le*R;if(de>=0&&de<m){var we=f[B][ie][de][$]+h[Q][le][$];we>K&&(K=we,j=ie,te=de)}}}P[B][j][te][$]+=O[B][W][G][$]}var pe=c.write(I.util.toTypedArray(P,a.dtype),a.shape,a.dtype);return{dataId:pe,shape:a.shape,dtype:a.dtype}}};function fh(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"sum");var s;a.dtype==="bool"?s=ts({inputs:{x:a},backend:t,attrs:{dtype:"int32"}}):s=Vi({inputs:{x:a},backend:t});var u=s.shape.length,l=I.util.parseAxisParam(i,s.shape),c=I.backend_util.getAxesPermutation(l,u),f=l,h=s;c!=null&&(h=On({inputs:{x:s},backend:t,attrs:{perm:c}}),f=I.backend_util.getInnerMostAxes(f.length,u)),I.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var p=nt(I.backend_util.computeOutAndReduceShapes(h.shape,f),2),d=p[0],v=p[1],m=I.backend_util.upcastType(h.dtype,"int32"),g=Wv(t,d,m),y=I.util.sizeFromShape(v),b=t.data.get(g.dataId).values,w=t.data.get(h.dataId).values,k=0;k<b.length;++k){for(var S=k*y,E=0,N=0;N<y;++N)E+=w[S+N];b[k]=E}if(o){var C=I.backend_util.expandShapeToKeepDim(g.shape,l),R=g;g=Yt({inputs:{x:g},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(R)}return t.disposeIntermediateTensorInfo(s),c!=null&&t.disposeIntermediateTensorInfo(h),g}var ike={kernelName:I.Sum,backendName:"cpu",kernelFunc:fh};function oke(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,l=i,c=I.backend_util.decodeEinsumEquation(u,l.length),f=c.allDims,h=c.summedDims,p=c.idDims;I.backend_util.checkEinsumDimSizes(f.length,p,l);for(var d=I.backend_util.getEinsumComputePath(h,p),v=d.path,m=d.steps,g=m.length,y=null,b=f.length,w=[],k=0;k<g;++k){try{for(var S=(e=void 0,Pl(m[k])),E=S.next();!E.done;E=S.next()){var N=E.value,C=I.backend_util.getEinsumPermutation(b,p[N]),R=C.permutationIndices,_=C.expandDims,O=void 0;I.backend_util.isIdentityPermutation(R)?O=l[N]:(O=On({inputs:{x:l[N]},backend:o,attrs:{perm:R}}),w.push(O));for(var P=O.shape.slice(),B=0;B<_.length;++B)P.splice(_[B],0,1);I.util.arraysEqual(O.shape,P)||(O=Yt({inputs:{x:O},backend:o,attrs:{shape:P}}),w.push(O)),y===null?y=O:(y=Hv({inputs:{a:O,b:y},backend:o}),w.push(y))}}catch(M){e={error:M}}finally{try{E&&!E.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}k<g-1&&(v[k]>=0&&(y=fh({inputs:{x:y},backend:o,attrs:{axis:v[k]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var W=Pl(w),L=W.next();!L.done;L=W.next()){var G=L.value;G!==y&&o.disposeIntermediateTensorInfo(G)}}catch(M){n={error:M}}finally{try{L&&!L.done&&(a=W.return)&&a.call(W)}finally{if(n)throw n.error}}return y}var ske={kernelName:I.Einsum,backendName:"cpu",kernelFunc:oke};function uke(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y;He([n,a],"eluGrad");for(var i=new Float32Array(I.util.sizeFromShape(a.shape)),o=t.data.get(a.dataId).values,s=t.data.get(n.dataId).values,u=0;u<o.length;++u){var l=o[u];l>=1?i[u]=s[u]:i[u]=s[u]*(l+1)}return t.makeTensorInfo(a.shape,"float32",i)}var lke={kernelName:I.EluGrad,backendName:"cpu",kernelFunc:uke};var cke=I.backend_util.ERF_P,fke=I.backend_util.ERF_A1,hke=I.backend_util.ERF_A2,pke=I.backend_util.ERF_A3,dke=I.backend_util.ERF_A4,vke=I.backend_util.ERF_A5,mke=$t(I.Erf,function(r){var e=Math.sign(r),t=Math.abs(r),n=1/(1+cke*t);return e*(1-((((vke*n+dke)*n+pke)*n+hke)*n+fke)*n*Math.exp(-t*t))}),gke={kernelName:I.Erf,backendName:"cpu",kernelFunc:mke};function Uv(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(I.util.assert(-(o+1)<=i,function(){return"Axis must be in the interval ["+-(o+1)+", "+o+"]"}),u=o+i+1),s.splice(u,0,1),Yt({inputs:{x:a},backend:t,attrs:{shape:s}})}var yke={kernelName:I.ExpandDims,backendName:"cpu",kernelFunc:Uv};var bke=Ur(function(r,e){return r/e}),Sw=an(I.RealDiv,bke),pw={kernelName:I.RealDiv,backendName:"cpu",kernelFunc:Sw};function fM(r,e,t){for(var n=r.shape,a=n[0],i=n[1],o=t.data.get(r.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,l=[a,i],c=I.util.sizeFromShape(l),f=I.util.getTypedArrayFromDType("float32",c),h=I.util.getTypedArrayFromDType("float32",c),p=0;p<a;p++){for(var d=vu({inputs:{x:s},backend:t,attrs:{begin:[p,0],size:[1,i]}}),v=vu({inputs:{x:u},backend:t,attrs:{begin:[p,0],size:[1,i]}}),m=ia({inputs:{real:d,imag:v},backend:t}),g=wke(m,e,t),y=g.real,b=g.imag,w=I.backend_util.mergeRealAndImagArrays(y,b),k=0;k<i;k++){var S=I.backend_util.getComplexWithIndex(w,k);f[p*i+k]=S.real,h[p*i+k]=S.imag}t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(m)}var E=t.makeTensorInfo(l,"float32",f),N=t.makeTensorInfo(l,"float32",h),C=ia({inputs:{real:E,imag:N},backend:t});return t.disposeIntermediateTensorInfo(E),t.disposeIntermediateTensorInfo(N),C}function wke(r,e,t){var n=I.util.sizeFromShape(r.shape),a=t.data.get(r.dataId),i=t.data.get(a.complexTensorInfos.real.dataId).values,o=t.data.get(a.complexTensorInfos.imag.dataId).values;if(xke(n)){var s=dw(i,o,n,e,t),u=[r.shape[0],r.shape[1]];if(e){var l=t.makeTensorInfo(u,"float32",s.real),c=t.makeTensorInfo(u,"float32",s.imag),f=t.makeTensorInfo([],"float32",I.util.createScalarValue(n,"float32")),h=Vi({inputs:{x:f},backend:t}),p=pw.kernelFunc({inputs:{a:l,b:f},backend:t}),d=pw.kernelFunc({inputs:{a:c,b:h},backend:t}),v=t.data.get(p.dataId).values,m=t.data.get(d.dataId).values;return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),{real:v,imag:m}}return s}else{var g=I.backend_util.mergeRealAndImagArrays(i,o),y=kke(g,n,e);return I.backend_util.splitRealAndImagArrays(y)}}function xke(r){return(r&r-1)===0}function dw(r,e,t,n,a){if(t===1)return{real:r,imag:e};var i=I.backend_util.mergeRealAndImagArrays(r,e),o=t/2,s=I.backend_util.complexWithEvenIndex(i),u=s.real,l=s.imag,c=[u.length],f=a.makeTensorInfo(c,"float32",u),h=a.makeTensorInfo(c,"float32",l),p=ia({inputs:{real:f,imag:h},backend:a}),d=I.backend_util.complexWithOddIndex(i),v=d.real,m=d.imag,g=[v.length],y=a.makeTensorInfo(g,"float32",v),b=a.makeTensorInfo(g,"float32",m),w=ia({inputs:{real:y,imag:b},backend:a}),k=dw(u,l,o,n,a),S=k.real,E=k.imag,N=[S.length],C=a.makeTensorInfo(N,"float32",S),R=a.makeTensorInfo(N,"float32",E),_=ia({inputs:{real:C,imag:R},backend:a}),O=dw(v,m,o,n,a),P=O.real,B=O.imag,W=[P.length],L=a.makeTensorInfo(W,"float32",P),G=a.makeTensorInfo(W,"float32",B),M=ia({inputs:{real:L,imag:G},backend:a}),$=I.backend_util.exponents(t,n),K=[$.real.length],j=a.makeTensorInfo(K,"float32",$.real),te=a.makeTensorInfo(K,"float32",$.imag),Q=ia({inputs:{real:j,imag:te},backend:a}),ie=Hv({inputs:{a:Q,b:M},backend:a}),le=Ll({inputs:{a:_,b:ie},backend:a}),de=xw({inputs:{a:_,b:ie},backend:a}),we=du({inputs:{input:le},backend:a}),pe=du({inputs:{input:de},backend:a}),Se=Bl({inputs:{input:le},backend:a}),Ee=Bl({inputs:{input:de},backend:a}),Ne=zl({inputs:[we,pe],backend:a,attrs:{axis:0}}),Ge=zl({inputs:[Se,Ee],backend:a,attrs:{axis:0}}),Ke=a.data.get(Ne.dataId).values,Ue=a.data.get(Ge.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(te),a.disposeIntermediateTensorInfo(Q),a.disposeIntermediateTensorInfo(ie),a.disposeIntermediateTensorInfo(le),a.disposeIntermediateTensorInfo(de),a.disposeIntermediateTensorInfo(we),a.disposeIntermediateTensorInfo(Se),a.disposeIntermediateTensorInfo(pe),a.disposeIntermediateTensorInfo(Ee),a.disposeIntermediateTensorInfo(Ne),a.disposeIntermediateTensorInfo(Ge),{real:Ke,imag:Ue}}function kke(r,e,t){for(var n=new Float32Array(e*2),a=0;a<e;a++){for(var i=0,o=0,s=0;s<e;s++){var u=I.backend_util.exponent(a*s,e,t),l=I.backend_util.getComplexWithIndex(r,s);i+=l.real*u.real-l.imag*u.imag,o+=l.real*u.imag+l.imag*u.real}t&&(i/=e,o/=e),I.backend_util.assignToTypedArray(n,i,o,a)}return n}function Ske(r){var e=r.inputs,t=r.backend,n=e.input,a=I.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Yt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=fM(s,!1,t),l=Yt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),l}var Eke={kernelName:I.FFT,backendName:"cpu",kernelFunc:Ske};function Ew(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype,o=i||I.util.inferDtype(a),s=I.util.getArrayFromDType(o,I.util.sizeFromShape(n));return Ike(s,a,o),e.makeTensorInfo(n,o,s)}var Tke={kernelName:I.Fill,backendName:"cpu",kernelFunc:Ew};function Ike(r,e,t){r.fill(e)}var Nke={kernelName:I.FlipLeftRight,backendName:"cpu",kernelFunc:function(r){var e=r.inputs;r.attrs;for(var t=r.backend,n=e.image,a=t,i=I.util.getTypedArrayFromDType(n.dtype,I.util.sizeFromShape(n.shape)),o=nt(n.shape,4),s=o[0],u=o[1],l=o[2],c=o[3],f=a.data.get(n.dataId).values,h=0;h<s;h++)for(var p=h*l*u*c,d=0;d<u;d++)for(var v=d*(l*c),m=0;m<l;m++)for(var g=m*c,y=0;y<c;y++){var b=Math.round(l-m-1),w=p+v+g+y,k=f[w];if(b>=0&&b<l){var S=b*c,E=p+v+S+y;k=f[E]}i[w]=k}var N=a.write(i,n.shape,n.dtype);return{dataId:N,shape:n.shape,dtype:n.dtype}}};var Cke=Ur(function(r,e){return Math.floor(r/e)}),Ake=an(I.FloorDiv,Cke,null,"int32"),_ke={kernelName:I.FloorDiv,backendName:"cpu",kernelFunc:Ake};function Dke(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,l=n.pad,c=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,v=lM({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){var m=v;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){var g=Yt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});v=Ll({inputs:{a:v,b:g},backend:t}),t.disposeIntermediateTensorInfo(g)}else v=Ll({inputs:{a:v,b:o},backend:t});t.disposeIntermediateTensorInfo(m)}if(p){var m=v;if(c==="NCHW"&&p==="prelu"&&s.shape.length===1&&s.shape[0]!==1){var y=Yt({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});v=Vv(t,v,p,y,d),t.disposeIntermediateTensorInfo(y)}else v=Vv(t,v,p,s,d);t.disposeIntermediateTensorInfo(m)}return v}var Fke={kernelName:I.FusedConv2D,backendName:"cpu",kernelFunc:Dke};function Rke(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,l=n.pad,c=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,v=cM({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){var m=v;v=Ll({inputs:{a:v,b:o},backend:t}),t.disposeIntermediateTensorInfo(m)}if(p){var m=v;v=Vv(t,v,p,s,d),t.disposeIntermediateTensorInfo(m)}return v}var Mke={kernelName:I.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:Rke};function Oke(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=I.util.sizeFromShape(n.shape),o=a.shape,s=o[o.length-1],u=nt(I.backend_util.prepareAndValidate(n,a),4),l=u[0],c=u[1],f=u[2],h=u[3];if(c===0)return t.makeTensorInfo(l,n.dtype,[]);var p=t.data.get(a.dataId).values,d=t.bufferSync(n),v=SR(p,d,n.dtype,c,s,f,h,n.shape,i);return t.makeTensorInfo(l,n.dtype,v.values)}var Pke={kernelName:I.GatherNd,backendName:"cpu",kernelFunc:Oke};function Lke(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims;He([a,i],"gatherV2");for(var u=I.util.parseAxisParam(o,a.shape)[0],l=t.data.get(i.dataId).values,c=a.shape[u],f=function(S){var E=l[S];I.util.assert(E<=c-1&&E>=0,function(){return"GatherV2: the index value "+E+" is not in [0, "+(c-1)+"]"})},h=0;h<l.length;++h)f(h);var p=s;s==null&&(p=0);var d=I.util.sizeFromShape(i.shape),v=I.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,p),m=Yt({inputs:{x:a},backend:t,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),g=Yt({inputs:{x:i},backend:t,attrs:{shape:[v.batchSize,d/v.batchSize]}}),y=[v.batchSize,v.outerSize,d/v.batchSize,v.sliceSize],b=t.bufferSync(g),w=t.bufferSync(m),k=ER(w,b,y);return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(v.outputShape,k.dtype,k.values)}var Bke={kernelName:I.GatherV2,backendName:"cpu",kernelFunc:Lke};function zke(r){var e=r.inputs,t=r.backend,n=e.input,a=I.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Yt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=fM(s,!0,t),l=Yt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),l}var $ke={kernelName:I.IFFT,backendName:"cpu",kernelFunc:zke};var Wke=$t(I.IsFinite,function(r){return Number.isFinite(r)?1:0},"bool"),Vke={kernelName:I.IsFinite,backendName:"cpu",kernelFunc:Wke};var Uke=$t(I.IsInf,function(r){return Math.abs(r)===1/0?1:0},"bool"),Gke={kernelName:I.IsInf,backendName:"cpu",kernelFunc:Uke};var Hke=$t(I.IsNan,function(r){return Number.isNaN(r)?1:0},"bool"),qke={kernelName:I.IsNan,backendName:"cpu",kernelFunc:Hke};function Kke(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=AR(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var jke={kernelName:I.LinSpace,backendName:"cpu",kernelFunc:Kke};var Xke=$t(I.Log1p,function(r){return Math.log1p(r)}),Yke={kernelName:I.Log1p,backendName:"cpu",kernelFunc:Xke};var Zke=Ur(function(r,e){return r&&e}),Qke=an(I.LogicalAnd,Zke,null,"bool"),Jke={kernelName:I.LogicalAnd,backendName:"cpu",kernelFunc:Qke};var e2e=$t(I.LogicalNot,function(r){return r?0:1},"bool"),t2e={kernelName:I.LogicalNot,backendName:"cpu",kernelFunc:e2e};var r2e=Ur(function(r,e){return r||e}),n2e=an(I.LogicalOr,r2e,null,"bool"),a2e={kernelName:I.LogicalOr,backendName:"cpu",kernelFunc:n2e};function i2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta;He(a,"LRN");var l=a.shape[3],c=l-1,f=t.data.get(a.dataId).values,h=I.util.sizeFromShape(a.shape),p=new Float32Array(h);function d(y){for(var b=y%l,w=y-b+Math.max(0,b-i),k=y-b+Math.min(b+i,c),S=0;w<=k;w++){var E=f[w];S+=E*E}return S}for(var v=0;v<h;v++){var m=d(v),g=f[v]*Math.pow(o+s*m,-u);p[v]=g}return t.makeTensorInfo(a.shape,a.dtype,p)}var o2e={kernelName:I.LRN,backendName:"cpu",kernelFunc:i2e};function s2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,l=n.alpha,c=n.beta;He(o,"LRNGrad");for(var f=I.util.sizeFromShape(o.shape),h=o.shape[3],p=t.data.get(o.dataId).values,d=t.data.get(a.dataId).values,v=t.data.get(i.dataId).values,m=new Float32Array(f),g=f,y=0;y<g;y++){for(var b=y%h,w=y-b+Math.max(0,b-s),k=y-b+Math.min(h,b+s+1),S=0,E=w;E<k;E++)S+=Math.pow(d[E],2);S=l*S+u;for(var E=w;E<k;E++){var N=-2*l*c*d[E]*v[y]/S;y===E&&(N+=Math.pow(S,-c)),N*=p[y],m[E]+=N}}return t.makeTensorInfo(o.shape,a.dtype,m)}var u2e={kernelName:I.LRNGrad,backendName:"cpu",kernelFunc:s2e};function hM(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=t,u=a.shape,l=u.length,c=I.util.parseAxisParam(i,u),f=c,h=I.backend_util.getAxesPermutation(f,l),p=s.data.get(a.dataId).values;if(h!=null){for(var d=new Array(l),v=0;v<d.length;v++)d[v]=u[h[v]];p=bw(p,u,a.dtype,h,d),f=I.backend_util.getInnerMostAxes(f.length,l),u=d}He(a,"max"),I.backend_util.assertAxesAreInnerMostDims("max",f,l);var m=nt(I.backend_util.computeOutAndReduceShapes(u,f),2),g=m[0],y=m[1],b=I.util.sizeFromShape(y),w=DR(p,b,g,a.dtype),k=s.write(w,g,a.dtype),S=g;if(o){var d=I.backend_util.expandShapeToKeepDim(g,c);S=d}return{dataId:k,shape:S,dtype:a.dtype}}var l2e={kernelName:I.Max,backendName:"cpu",kernelFunc:hM};function c2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;He(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=1;I.util.assert(I.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+l+"'")});var c=I.backend_util.computePool2DInfo(a.shape,i,o,l,s,u),f;if(c.filterWidth===1&&c.filterHeight===1&&I.util.arraysEqual(c.inShape,c.outShape))f=Vi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=I.util.computeStrides(a.shape),d=kw(h,a.shape,a.dtype,p,c,"max");f=t.makeTensorInfo(c.outShape,a.dtype,d.values)}return f}var f2e={kernelName:I.MaxPool,backendName:"cpu",kernelFunc:c2e};function h2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=n.dataFormat;He(a,"maxPool3d");var c=I.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,l),f=t.data.get(a.dataId).values,h=uM(f,a.shape,a.dtype,I.util.computeStrides(a.shape),c,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}var p2e={kernelName:I.MaxPool3D,backendName:"cpu",kernelFunc:h2e};function d2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,l=n.dimRoundingMode;He([a,i],"maxPool3DGrad");for(var c=I.backend_util.computePool3DInfo(i.shape,o,s,1,u,l),f=t.bufferSync(i),h=txe(f,c),p=c.strideDepth,d=c.strideHeight,v=c.strideWidth,m=c.dilationDepth,g=c.dilationHeight,y=c.dilationWidth,b=c.effectiveFilterDepth,w=c.effectiveFilterHeight,k=c.effectiveFilterWidth,S=b-1-c.padInfo.front,E=k-1-c.padInfo.left,N=w-1-c.padInfo.top,C=I.buffer(i.shape,"float32"),R=t.bufferSync(a),_=0;_<c.batchSize;++_)for(var O=0;O<c.inChannels;++O)for(var P=0;P<c.inDepth;++P)for(var B=0;B<c.inHeight;++B)for(var W=0;W<c.inWidth;++W){for(var L=P-S,G=B-N,M=W-E,$=0,K=0;K<b;K+=m){var j=(L+K)/p;if(!(j<0||j>=c.outDepth||Math.floor(j)!==j))for(var te=0;te<w;te+=g){var Q=(G+te)/d;if(!(Q<0||Q>=c.outHeight||Math.floor(Q)!==Q))for(var ie=0;ie<k;ie+=y){var le=(M+ie)/v;if(!(le<0||le>=c.outWidth||Math.floor(le)!==le)){var de=b*w*k-1-h.get(_,j,Q,le,O),we=K*w*k+te*k+ie,pe=de===we?1:0;if(pe!==0){var Se=R.get(_,j,Q,le,O);$+=Se*pe}}}}}C.set($,_,P,B,W,O)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}var v2e={kernelName:I.MaxPool3DGrad,backendName:"cpu",kernelFunc:d2e};function m2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;He([i,o],"maxPoolGrad");for(var u=n.filterSize,l=n.strides,c=n.pad,f=n.dimRoundingMode,h=I.backend_util.computePool2DInfo(s.shape,u,l,1,c,f),p=t.data.get(s.dataId).values,d=I.buffer(h.outShape,s.dtype,sM(p,s.shape,s.dtype,h).values),v=h.strideHeight,m=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,b=h.effectiveFilterHeight,w=h.effectiveFilterWidth,k=w-1-h.padInfo.left,S=b-1-h.padInfo.top,E=I.buffer(s.shape,"float32"),N=t.data.get(a.dataId).values,C=I.buffer(a.shape,"float32",N),R=0;R<h.batchSize;++R)for(var _=0;_<h.inChannels;++_)for(var O=0;O<h.inHeight;++O)for(var P=0;P<h.inWidth;++P){for(var B=O-S,W=P-k,L=0,G=0;G<b;G+=g){var M=(B+G)/v;if(!(M<0||M>=h.outHeight||Math.floor(M)!==M))for(var $=0;$<w;$+=y){var K=(W+$)/m;if(!(K<0||K>=h.outWidth||Math.floor(K)!==K)){var j=b*w-1-d.get(R,M,K,_),te=G*w+$,Q=j===te?1:0;if(Q!==0){var ie=C.get(R,M,K,_);L+=ie*Q}}}}E.set(L,R,O,P,_)}return t.makeTensorInfo(E.shape,E.dtype,E.values)}var g2e={kernelName:I.MaxPoolGrad,backendName:"cpu",kernelFunc:m2e};function y2e(r,e,t,n,a){var i=I.util.computeStrides(e),o=kw(r,e,t,i,a,"max"),s=sM(r,e,t,a,!0,n);return[o.values,s.values]}var b2e={kernelName:I.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,l=n;He(a,"MaxPoolWithArgmax");var c=l.data.get(a.dataId).values,f=I.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=nt(y2e(c,a.shape,a.dtype,u,f),2),p=h[0],d=h[1],v=l.write(p,f.outShape,a.dtype),m=l.write(d,f.outShape,a.dtype);return[{dataId:v,shape:f.outShape,dtype:a.dtype},{dataId:m,shape:f.outShape,dtype:"int32"}]}};function w2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=I.util.parseAxisParam(i,a.shape),u=I.backend_util.computeOutAndReduceShapes(a.shape,s),l=u[1],c=I.util.sizeFromShape(l),f=[],h=t.makeTensorInfo([],"float32",new Float32Array([c]));f.push(h);var p=ts({inputs:{x:a},backend:t,attrs:{dtype:"float32"}});f.push(p);var d=Sw({inputs:{a:p,b:h},backend:t});f.push(d);var v=fh({inputs:{x:d},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(function(m){return t.disposeIntermediateTensorInfo(m)}),v}var x2e={kernelName:I.Mean,backendName:"cpu",kernelFunc:w2e};function k2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"min");var s=I.util.parseAxisParam(i,a.shape),u=s,l=I.backend_util.getAxesPermutation(u,a.shape.length),c=a;l!=null&&(c=On({inputs:{x:a},backend:t,attrs:{perm:l}}),u=I.backend_util.getInnerMostAxes(u.length,a.shape.length)),I.backend_util.assertAxesAreInnerMostDims("min",u,c.shape.length);for(var f=nt(I.backend_util.computeOutAndReduceShapes(c.shape,u),2),h=f[0],p=f[1],d=I.util.sizeFromShape(p),v=I.util.makeZerosTypedArray(I.util.sizeFromShape(h),c.dtype),m=t.data.get(c.dataId).values,g=0;g<v.length;++g){for(var y=g*d,b=m[y],w=0;w<d;++w){var k=m[y+w];(Number.isNaN(k)||k<b)&&(b=k)}v[g]=b}l!=null&&t.disposeIntermediateTensorInfo(c);var S=t.makeTensorInfo(h,c.dtype,v);if(o){var E=I.backend_util.expandShapeToKeepDim(h,s),N=Yt({inputs:{x:S},backend:t,attrs:{shape:E}});return t.disposeIntermediateTensorInfo(S),N}return S}var S2e={kernelName:I.Min,backendName:"cpu",kernelFunc:k2e};function E2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode;He(a,"mirrorPad");for(var s=i.map(function(E,N){return E[0]+a.shape[N]+E[1]}),u=i.map(function(E){return E[0]}),l=i.map(function(E,N){return E[0]+a.shape[N]}),c=o==="reflect"?0:1,f=t.data.get(a.dataId).values,h=a.shape.length,p=I.util.computeStrides(a.shape),d=I.util.sizeFromShape(s),v=s.length,m=I.util.computeStrides(s),g=I.util.getTypedArrayFromDType(a.dtype,d),y=0;y<d;y++){for(var b=I.util.indexToLoc(y,v,m),w=0;w<v;w++)b[w]<u[w]?b[w]=u[w]*2-b[w]-c:b[w]>=l[w]&&(b[w]=(l[w]-1)*2-b[w]+c);b=b.map(function(E,N){return E-u[N]});var k=I.util.locToIndex(b,h,p);g[y]=f[k]}var S=t.write(g,s,a.dtype);return{dataId:S,shape:s,dtype:a.dtype}}var T2e={kernelName:I.MirrorPad,backendName:"cpu",kernelFunc:E2e};var I2e=Ur((function(r,e){var t=r%e;return r<0&&e<0||r>=0&&e>=0?t:(t+e)%e})),N2e=an(I.Mod,I2e),C2e={kernelName:I.Mod,backendName:"cpu",kernelFunc:N2e};function pM(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=a.shape.length,s=i;if(s===-1&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+o+" and dim was "+s));var u=I.util.parseAxisParam([s],a.shape),l=hM({inputs:{x:a},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),c=I.backend_util.expandShapeToKeepDim(l.shape,u),f=Yt({inputs:{x:l},backend:t,attrs:{shape:c}}),h=xw({inputs:{a,b:f},backend:t}),p=wR({inputs:{x:h},backend:t}),d=fh({inputs:{x:p},backend:t,attrs:{axis:u,keepDims:!1}}),v=Yt({inputs:{x:d},backend:t,attrs:{shape:c}}),m=Sw({inputs:{a:p,b:v},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(v),m}var A2e={kernelName:I.Softmax,backendName:"cpu",kernelFunc:pM};function _2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized;He(a,"multinomial");for(var u=s?a:pM({inputs:{logits:a},backend:t,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],f=t.data.get(u.dataId).values,h=[l,i],p=I.util.makeZerosTypedArray(I.util.sizeFromShape(h),"int32"),d=0;d<l;++d){var v=d*c,m=new Float32Array(c-1);m[0]=f[v];for(var g=1;g<m.length;++g)m[g]=m[g-1]+f[v+g];for(var y=l1e.alea(o.toString()),b=d*i,w=0;w<i;++w){var k=y();p[b+w]=m.length;for(var g=0;g<m.length;g++)if(k<m[g]){p[b+w]=g;break}}}return s||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(h,"int32",p)}var D2e={kernelName:I.Multinomial,backendName:"cpu",kernelFunc:_2e};var F2e=I.kernel_impls.nonMaxSuppressionV3Impl;function R2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold;He(a,"NonMaxSuppression");var l=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,f=F2e(l,c,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var M2e={kernelName:I.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:R2e};var O2e=I.kernel_impls.nonMaxSuppressionV4Impl;function P2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=n.padToMaxOutputSize;He(a,"NonMaxSuppressionPadded");var c=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=O2e(c,f,o,s,u,l),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var L2e={kernelName:I.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:P2e};var B2e=I.kernel_impls.nonMaxSuppressionV5Impl;function z2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=n.softNmsSigma;He(a,"NonMaxSuppressionWithScore");var c=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=o,p=s,d=u,v=l,m=B2e(c,f,h,p,d,v),g=m.selectedIndices,y=m.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var $2e={kernelName:I.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:z2e};function W2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue;He(a,"oneHot");var l=I.util.sizeFromShape(a.shape),c=new Float32Array(l*o);c.fill(u);for(var f=t.data.get(a.dataId).values,h=0;h<l;++h)f[h]>=0&&f[h]<o&&(c[h*o+f[h]]=s);return t.makeTensorInfo(Ei(a.shape,[o]),i,c)}var V2e={kernelName:I.OneHot,backendName:"cpu",kernelFunc:W2e};function Gv(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){var a=du({inputs:{input:n},backend:t}),i=Gv({inputs:{x:a},backend:t}),o=Bl({inputs:{input:n},backend:t}),s=Gv({inputs:{x:o},backend:t}),u=ia({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Ew({backend:t,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}var U2e={kernelName:I.ZerosLike,backendName:"cpu",kernelFunc:Gv};function dM(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){var a=du({inputs:{input:n},backend:t}),i=dM({inputs:{x:a},backend:t}),o=Bl({inputs:{input:n},backend:t}),s=Gv({inputs:{x:o},backend:t}),u=ia({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Ew({backend:t,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}var G2e={kernelName:I.OnesLike,backendName:"cpu",kernelFunc:dM};function vM(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return Uv({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(c){I.util.assertShapesMatch(i,c.shape,"All tensors passed to stack must have matching shapes"),I.util.assert(o===c.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(c){var f=Uv({inputs:{input:c},backend:t,attrs:{dim:a}});return s.push(f),f}),l=zl({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(c){return t.disposeIntermediateTensorInfo(c)}),l}var H2e={kernelName:I.Pack,backendName:"cpu",kernelFunc:vM};function q2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;He(a,"pad");var s=i.map(function(S,E){return S[0]+a.shape[E]+S[1]}),u=i.map(function(S){return S[0]}),l=t.data.get(a.dataId).values,c=I.util.sizeFromShape(a.shape),f=a.shape.length,h=I.util.computeStrides(a.shape),p=I.util.sizeFromShape(s),d=s.length,v=I.util.computeStrides(s),m=I.util.getTypedArrayFromDType(a.dtype,p);o!==0&&m.fill(o);for(var g=0;g<c;g++){var y=I.util.indexToLoc(g,f,h),b=y.map(function(S,E){return S+u[E]}),w=I.util.locToIndex(b,d,v);m[w]=l[g]}var k=t.write(m,s,a.dtype);return{dataId:k,shape:s,dtype:a.dtype}}var mM={kernelName:I.PadV2,backendName:"cpu",kernelFunc:q2e};var K2e=Ur(function(r,e){return Math.pow(r,e)}),j2e=an(I.Pow,K2e),X2e={kernelName:I.Pow,backendName:"cpu",kernelFunc:j2e};function Y2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.data.get(g.dataId).values}),u=a.map(function(g){return g.shape}),l=t.data.get(i.dataId).values,c=t.data.get(o.dataId).values,f=nt(LR(s,u,l,i.shape,i.dtype,c,o.shape),3),h=f[0],p=f[1],d=f[2],v=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),m=t.makeTensorInfo(d,i.dtype,p);return v.concat([m])}var Z2e={kernelName:I.RaggedGather,backendName:"cpu",kernelFunc:Y2e};function Q2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,l=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,h=s.map(function(g){return t.data.get(g.dataId).values}),p=s.map(function(g){return g.shape}),d=nt(BR(l,a.shape,c,i.shape,i.dtype,f,o.shape,h,p,u),2),v=d[0],m=d[1];return t.makeTensorInfo(v,i.dtype,m)}var J2e={kernelName:I.RaggedTensorToTensor,backendName:"cpu",kernelFunc:Q2e};function eSe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.dtype,o=t.step,s=zR(n,a,o,i);return e.makeTensorInfo([s.length],i,s)}var tSe={kernelName:I.Range,backendName:"cpu",kernelFunc:eSe};var rSe=$t(I.Reciprocal,function(r){return 1/r}),nSe={kernelName:I.Reciprocal,backendName:"cpu",kernelFunc:rSe};function aSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;He(a,"resizeBilinear");for(var u=I.util.computeStrides(a.shape),l=nt(s,2),c=l[0],f=l[1],h=nt(a.shape,4),p=h[0],d=h[1],v=h[2],m=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(I.util.sizeFromShape([p,c,f,m])),b=[i&&c>1?d-1:d,i&&f>1?v-1:v],w=[i&&c>1?c-1:c,i&&f>1?f-1:f],k=0,S=b[0]/w[0],E=b[1]/w[1],N=0;N<p;N++)for(var C=0;C<c;C++){var R=void 0;o?R=S*(C+.5)-.5:R=S*C;for(var _=Math.max(0,Math.floor(R)),O=R-_,P=Math.min(d-1,Math.ceil(R)),B=N*u[0]+_*u[1],W=N*u[0]+P*u[1],L=0;L<f;L++){var G=void 0;o?G=E*(L+.5)-.5:G=E*L;for(var M=Math.max(0,Math.floor(G)),$=G-M,K=Math.min(v-1,Math.ceil(G)),j=B+M*u[2],te=W+M*u[2],Q=B+K*u[2],ie=W+K*u[2],le=0;le<m;le++){var de=g[j+le],we=g[te+le],pe=g[Q+le],Se=g[ie+le],Ee=de+(pe-de)*$,Ne=we+(Se-we)*$,Ge=Ee+(Ne-Ee)*O;y[k++]=Ge}}}return t.makeTensorInfo([p,c,f,m],"float32",y)}var iSe={kernelName:I.ResizeBilinear,backendName:"cpu",kernelFunc:aSe};function oSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;He([i,a],"resizeBilinearGrad");for(var s=I.util.computeStrides(a.shape),u=nt(a.shape,4),l=u[0],c=u[1],f=u[2],h=u[3],p=nt(i.shape,3),d=p[1],v=p[2],m=new Float32Array(l*c*f*h),g=[o&&d>1?c-1:c,o&&v>1?f-1:f],y=[o&&d>1?d-1:d,o&&v>1?v-1:v],b=g[0]/y[0],w=g[1]/y[1],k=t.data.get(i.dataId).values,S=0,E=0;E<l;E++)for(var N=E*s[0],C=0;C<d;C++)for(var R=C*b,_=Math.floor(R),O=Math.min(Math.ceil(R),c-1),P=N+_*s[1],B=N+O*s[1],W=R-_,L=1-W,G=0;G<v;G++)for(var M=G*w,$=Math.floor(M),K=Math.min(Math.ceil(M),f-1),j=M-$,te=1-j,Q=P+$*s[2],ie=P+K*s[2],le=B+$*s[2],de=B+K*s[2],we=L*te,pe=L*j,Se=W*te,Ee=W*j,Ne=0;Ne<h;Ne++){var Ge=k[S++];m[Q+Ne]+=Ge*we,m[ie+Ne]+=Ge*pe,m[le+Ne]+=Ge*Se,m[de+Ne]+=Ge*Ee}return t.makeTensorInfo([l,f,c,h],"float32",m)}var sSe={kernelName:I.ResizeBilinearGrad,backendName:"cpu",kernelFunc:oSe};function uSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;He(a,"resizeNearestNeighbor");for(var u=I.util.computeStrides(a.shape),l=nt(s,2),c=l[0],f=l[1],h=nt(a.shape,4),p=h[0],d=h[1],v=h[2],m=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(p*c*f*m),b=[i&&c>1?d-1:d,i&&f>1?v-1:v],w=[i&&c>1?c-1:c,i&&f>1?f-1:f],k=b[0]/w[0],S=b[1]/w[1],E=0,N=0;N<p;N++)for(var C=N*u[0],R=0;R<c;R++){var _=o?k*(R+.5):k*R,O=Math.min(d-1,i?Math.round(_):Math.floor(_));o&&(O=Math.max(0,O));for(var P=C+O*u[1],B=0;B<f;B++){var W=o?S*(B+.5):S*B,L=Math.min(v-1,i?Math.round(W):Math.floor(W));o&&(L=Math.max(0,L));for(var G=P+L*u[2],M=0;M<m;M++){var $=g[G+M];y[E++]=$}}}return t.makeTensorInfo([p,c,f,m],a.dtype,y)}var lSe={kernelName:I.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:uSe};function cSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;He([i,a],"resizeNearestNeighborGrad");for(var s=I.util.computeStrides(a.shape),u=I.util.computeStrides(i.shape),l=nt(a.shape,4),c=l[0],f=l[1],h=l[2],p=l[3],d=nt(i.shape,3),v=d[1],m=d[2],g=new Float32Array(c*f*h*p),y=t.data.get(i.dataId).values,b=[o&&v>1?f-1:f,o&&m>1?h-1:h],w=[o&&v>1?v-1:v,o&&m>1?m-1:m],k=b[0]/w[0],S=b[1]/w[1],E=1/k,N=1/S,C=Math.ceil(E)*2+2,R=Math.ceil(N)*2+2,_=0;_<c;_++)for(var O=_*s[0],P=0;P<f;P++)for(var B=O+P*s[1],W=Math.floor(P*E),L=Math.floor(W-C/2),G=0;G<h;G++)for(var M=B+G*s[2],$=Math.floor(G*N),K=Math.floor($-R/2),j=0;j<p;j++){for(var te=0,Q=0;Q<C;Q++){var ie=Q+L;if(!(ie<0||ie>=v)){var le=O+ie*u[1],de=ie*k,we=Math.min(f-1,o?Math.round(de):Math.floor(de));if(P===we)for(var pe=0;pe<R;pe++){var Se=pe+K;if(!(Se<0||Se>=m)){var Ee=le+Se*u[2],Ne=Se*S,Ge=Math.min(h-1,o?Math.round(Ne):Math.floor(Ne));G===Ge&&(te+=y[Ee+j])}}}}g[M+j]=te}return t.makeTensorInfo(a.shape,a.dtype,g)}var fSe={kernelName:I.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:cSe};function hSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims;He(a,"reverse");var o=a.shape.length,s=I.util.parseAxisParam(i,a.shape);if(o===0)return Vi({inputs:{x:a},backend:t});for(var u=new I.TensorBuffer(a.shape,a.dtype),l=t.bufferSync(a),c=function(h){var p=u.indexToLoc(h),d=p.slice();s.forEach(function(v){return d[v]=a.shape[v]-1-d[v]}),u.set.apply(u,Ei([l.get.apply(l,Ei(d))],p))},f=0;f<u.size;f++)c(f);return t.makeTensorInfo(u.shape,u.dtype,u.values)}var pSe={kernelName:I.Reverse,backendName:"cpu",kernelFunc:hSe},dSe={kernelName:I.RotateWithOffset,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,l=I.util.getTypedArrayFromDType(a.dtype,I.util.sizeFromShape(a.shape)),c=nt(a.shape,4),f=c[0],h=c[1],p=c[2],d=c[3],v=nt(I.backend_util.getImageCenter(s,h,p),2),m=v[0],g=v[1],y=255,b=Math.sin(i),w=Math.cos(i),k=u.data.get(a.dataId).values,S=0;S<f;S++)for(var E=S*p*h*d,N=0;N<h;N++)for(var C=N*(p*d),R=0;R<p;R++)for(var _=R*d,O=0;O<d;O++){var P=[f,N,R,O],B=P[2],W=P[1],L=(B-m)*w-(W-g)*b,G=(B-m)*b+(W-g)*w;L=Math.round(L+m),G=Math.round(G+g);var M=o;if(typeof o!="number"&&(O===3?M=y:M=o[O]),L>=0&&L<p&&G>=0&&G<h){var $=G*(p*d),K=L*d,j=E+$+K+O;M=k[j]}var te=E+C+_+O;l[te]=M}var Q=u.write(l,a.shape,a.dtype);return{dataId:Q,shape:a.shape,dtype:a.dtype}}};var vSe=$t(I.Round,function(r){var e=Math.floor(r);return r-e<.5?Math.floor(r):r-e>.5?Math.ceil(r):e%2===0?e:e+1}),mSe={kernelName:I.Round,backendName:"cpu",kernelFunc:vSe};function gSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=I.backend_util.calculateShapes(i,a,o),u=s.sliceRank,l=s.numUpdates,c=s.sliceSize,f=s.strides,h=s.outputSize,p=!0,d=t.bufferSync(a),v=t.bufferSync(i),m=Ol(d,v,o,h,c,l,u,f,0,p);return t.makeTensorInfo(o,m.dtype,m.values)}var ySe={kernelName:I.ScatterNd,backendName:"cpu",kernelFunc:gSe};function bSe(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<e?t=a+1:n=a;return n}function wSe(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<=e?t=a+1:n=a;return n}function xSe(r,e,t,n,a,i){for(var o=I.util.getArrayFromDType("int32",t*a),s=0;s<t;++s)for(var u=r.slice(s*n,(s+1)*n),l=s*a,c=0;c<a;++c)o[l+c]=i==="left"?bSe(u,e[c+l]):wSe(u,e[c+l]);return o}function kSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,l=xSe(s,u,a.shape[0],a.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",l)}var SSe={kernelName:I.SearchSorted,backendName:"cpu",kernelFunc:kSe};function ESe(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e;He([n,a,i],"select");for(var o=n.shape.length,s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,c=I.upcastType(a.dtype,i.dtype),f=I.util.makeZerosTypedArray(I.util.sizeFromShape(a.shape),c),h=0,p=o===0||o>1||a.shape.length===1?1:I.util.sizeFromShape(a.shape.slice(1)),d=0;d<s.length;d++)for(var v=0;v<p;v++)s[d]===1?f[h++]=u[d]:f[h++]=l[d];return t.makeTensorInfo(a.shape,c,f)}var TSe={kernelName:I.Select,backendName:"cpu",kernelFunc:ESe};var ISe=I.backend_util.SELU_SCALEALPHA,NSe=I.backend_util.SELU_SCALE,CSe=$t(I.Selu,function(r){return r>=0?NSe*r:ISe*(Math.exp(r)-1)}),ASe={kernelName:I.Selu,backendName:"cpu",kernelFunc:CSe};var _Se=$t(I.Sign,function(r){return r<0?-1:r>0?1:0}),DSe={kernelName:I.Sign,backendName:"cpu",kernelFunc:_Se};var FSe=$t(I.Sin,function(r){return Math.sin(r)}),RSe={kernelName:I.Sin,backendName:"cpu",kernelFunc:FSe};var MSe=$t(I.Sinh,function(r){return Math.sinh(r)}),OSe={kernelName:I.Sinh,backendName:"cpu",kernelFunc:MSe};var PSe=11920928955078125e-23,sR=Math.log(PSe)+2,LSe=$t(I.Softplus,function(r){var e=r>-sR,t=r<sR,n=Math.exp(r),a;return t?a=n:e?a=r:a=Math.log(1+n),a}),BSe={kernelName:I.Softplus,backendName:"cpu",kernelFunc:LSe};function zSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;He([a],"spaceToBatchND");var s=I.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,Ei(o));for(var l=1+i.length;l<a.shape.length;++l)u.push([0,0]);var c=mM.kernelFunc({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),f=I.backend_util.getReshaped(c.shape,i,s,!1),h=I.backend_util.getPermuted(f.length,i.length,!1),p=I.backend_util.getReshapedPermuted(c.shape,i,s,!1),d={x:c},v={shape:f},m=Yt({inputs:d,backend:t,attrs:v}),g={x:m},y={perm:h},b=On({inputs:g,backend:t,attrs:y}),w={x:b},k={shape:p},S=Yt({inputs:w,backend:t,attrs:k});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(b),S}var $Se={kernelName:I.SpaceToBatchND,backendName:"cpu",kernelFunc:zSe};function WSe(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        `+i.shape);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        `+n.shape);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        `+a.shape);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `+o.shape);var s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,c=t.data.get(o.dataId).values[0],f=nt(UR(s,n.shape,n.dtype,u,a.dtype,l,c),5),h=f[0],p=f[1],d=f[2],v=f[3],m=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(function(g){return Number(g)}))),t.makeTensorInfo([m.length],n.dtype,new Int32Array(m))]}var VSe={kernelName:I.SparseFillEmptyRows,backendName:"cpu",kernelFunc:WSe};function USe(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        `+n.shape);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        `+a.shape);if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape "+i.shape);var o=Array.from(t.data.get(a.dataId).values),s=t.data.get(n.dataId).values,u=Array.from(t.data.get(i.dataId).values),l=nt(GR(s,n.shape,n.dtype,o,u),3),c=l[0],f=l[1],h=l[2];return[t.makeTensorInfo(f,n.dtype,c),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var GSe={kernelName:I.SparseReshape,backendName:"cpu",kernelFunc:USe};function HSe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          `+a.shape);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          `+i.shape);if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,l=nt(ww(o,n.shape,n.dtype,s,u,!0),2),c=l[0],f=l[1];return t.makeTensorInfo(f,n.dtype,c)}var qSe={kernelName:I.SparseSegmentMean,backendName:"cpu",kernelFunc:HSe};function KSe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         `+a.shape);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         `+i.shape);if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,l=nt(ww(o,n.shape,n.dtype,s,u),2),c=l[0],f=l[1];return t.makeTensorInfo(f,n.dtype,c)}var jSe={kernelName:I.SparseSegmentSum,backendName:"cpu",kernelFunc:KSe};function XSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=I.backend_util.calculateShapes(i,a,s),l=u.sliceRank,c=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1,v=t.bufferSync(a),m;switch(i.dtype){case"bool":{var g=t.bufferSync(i),y=!!t.data.get(o.dataId).values[0];m=Ol(v,g,s,p,f,c,l,h,y,d);break}case"float32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];m=Ol(v,g,s,p,f,c,l,h,y,d);break}case"int32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];m=Ol(v,g,s,p,f,c,l,h,y,d);break}case"string":{var g=t.bufferSync(i),y=I.util.decodeString(t.data.get(o.dataId).values[0]);m=Ol(v,g,s,p,f,c,l,h,y,d);break}default:throw new Error("Unsupported type "+i.dtype)}return t.makeTensorInfo(s,m.dtype,m.values)}var YSe={kernelName:I.SparseToDense,backendName:"cpu",kernelFunc:XSe};function ZSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=I.util.parseAxisParam(o,a.shape)[0],u=I.backend_util.prepareSplitSize(a,i,s),l=new Array(a.shape.length).fill(0),c=a.shape.slice();return u.map(function(f){var h=Ei(c);h[s]=f;var p=vu({inputs:{x:a},backend:t,attrs:{begin:l,size:h}});return l[s]+=f,p})}var QSe={kernelName:I.SplitV,backendName:"cpu",kernelFunc:ZSe};var JSe={kernelName:I.Square,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,a=t;He(n,"square");for(var i=a.data.get(n.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}var l=a.write(o,n.shape,n.dtype);return{dataId:l,shape:n.shape,dtype:n.dtype}}};var eEe=$t(I.Step,function(r,e){var t=e;return isNaN(r)?NaN:r>0?1:t.alpha}),tEe={kernelName:I.Step,backendName:"cpu",kernelFunc:eEe};function rEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,l=n.endMask,c=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask;He(a,"stridedSlice");var p=I.slice_util.sliceInfo(a.shape,i,o,s,u,l,c,f,h),d=p.finalShapeSparse,v=p.finalShape,m=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,b=p.begin,w=p.end,k=p.strides,S;if(m)S=Yt({inputs:{x:a},backend:t,attrs:{shape:v}});else if(g||y){I.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: "+a.shape.length});var E=I.slice_util.computeOutShape(b,w,k),N=vu({inputs:{x:a},backend:t,attrs:{begin:b,size:E}});S=Yt({inputs:{x:N},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(N)}else{var C=t.bufferSync(a),R=qR(d,C,k,b);S=t.makeTensorInfo(v,R.dtype,R.values)}return S}var nEe={kernelName:I.StridedSlice,backendName:"cpu",kernelFunc:rEe};function aEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,l=n.preserveShortSequences,c=e.data,f=e.dataSplits,h=t.data.get(c.dataId).values,p=t.data.get(f.dataId).values,d=nt(KR(h,p,a,i,o,s,u,l),2),v=d[0],m=d[1];return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(f.shape,"int32",m)]}var iEe={kernelName:I.StringNGrams,backendName:"cpu",kernelFunc:aEe};function oEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: "+i.shape);if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: "+o.shape);var s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],l=nt(jR(s,u,a),3),c=l[0],f=l[1],h=l[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",c),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var sEe={kernelName:I.StringSplit,backendName:"cpu",kernelFunc:oEe};function uEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.data.get(i.dataId).values,s=XR(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var lEe={kernelName:I.StringToHashBucketFast,backendName:"cpu",kernelFunc:uEe};var cEe=$t(I.Tan,function(r){return Math.tan(r)}),fEe={kernelName:I.Tan,backendName:"cpu",kernelFunc:cEe};var hEe=$t(I.Tanh,function(r){return Math.tanh(r)}),pEe={kernelName:I.Tanh,backendName:"cpu",kernelFunc:hEe};function dEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;He(a,"tile");var o=ZR(t.bufferSync(a),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}var vEe={kernelName:I.Tile,backendName:"cpu",kernelFunc:dEe};function mEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted;He(a,"topk");var s=t.data.get(a.dataId).values,u=nt(JR(s,a.shape,a.dtype,i,o),2),l=u[0],c=u[1];return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(c.shape,c.dtype,c.values)]}var gEe={kernelName:I.TopK,backendName:"cpu",kernelFunc:mEe};function yEe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=e.transforms,o=t.interpolation,s=t.fillMode,u=t.fillValue,l=t.outputShape,c=nt(a.shape,4),f=c[0],h=c[1],p=c[2],d=c[3],v=nt(l??[h,p],2),m=v[0],g=v[1],y=[f,m,g,d],b=I.util.computeStrides(a.shape),w=b[0],k=b[1],S=b[2],E=I.util.computeStrides(y),N=E[0],C=E[1],R=E[2],_=I.util.getTypedArrayFromDType(a.dtype,I.util.sizeFromShape(y));_.fill(u);for(var O=n.data.get(a.dataId).values,P=n.data.get(i.dataId).values,B=0;B<f;++B){for(var W=i.shape[0]===1?P:P.subarray(B*8,B*8+8),L=0;L<m;++L)for(var G=0;G<g;++G)for(var M=0;M<d;++M){var $=void 0,K=W[6]*G+W[7]*L+1;if(K!==0){var j=(W[0]*G+W[1]*L+W[2])/K,te=(W[3]*G+W[4]*L+W[5])/K,Q=uR(j,p,s),ie=uR(te,h,s);switch(o){case"nearest":$=EEe(O,h,p,w,k,S,B,ie,Q,M,u);break;case"bilinear":$=TEe(O,h,p,w,k,S,B,ie,Q,M,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+("'bilinear', but got "+o))}var le=B*N+L*C+G*R+M;_[le]=$}}return n.makeTensorInfo(y,a.dtype,_)}var de=n.write(_,y,a.dtype);return{dataId:de,shape:a.shape,dtype:a.dtype}}var bEe={kernelName:I.Transform,backendName:"cpu",kernelFunc:yEe};function uR(r,e,t){switch(t){case"reflect":return wEe(r,e);case"wrap":return xEe(r,e);case"nearest":return SEe(r,e);case"constant":default:return kEe(r)}}function wEe(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=2*e;t<n&&(t=n*Math.trunc(-t/n)+t),t=t<-e?t+n:-t-1}else if(t>e-1)if(e<=1)t=0;else{var n=2*e;t-=n*Math.trunc(t/n),t>=e&&(t=n-t-1)}return I.util.clamp(0,t,e-1)}function xEe(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=e-1;t+=e*(Math.trunc(-t/n)+1)}else if(t>e-1)if(e<=1)t=0;else{var n=e-1;t-=e*Math.trunc(t/n)}return I.util.clamp(0,t,e-1)}function kEe(r,e){return r}function SEe(r,e){return I.util.clamp(0,r,e-1)}function ch(r,e,t,n,a,i,o,s,u,l,c){var f=o*n+s*a+u*i+l;return 0<=s&&s<e&&0<=u&&u<t?r[f]:c}function EEe(r,e,t,n,a,i,o,s,u,l,c){var f=Math.round(s),h=Math.round(u);return ch(r,e,t,n,a,i,o,f,h,l,c)}function TEe(r,e,t,n,a,i,o,s,u,l,c){var f=Math.floor(s),h=Math.floor(u),p=f+1,d=h+1,v=(d-u)*ch(r,e,t,n,a,i,o,f,h,l,c)+(u-h)*ch(r,e,t,n,a,i,o,f,d,l,c),m=(d-u)*ch(r,e,t,n,a,i,o,p,h,l,c)+(u-h)*ch(r,e,t,n,a,i,o,p,d,l,c);return(p-s)*v+(s-f)*m}function IEe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;He(i,"unique");var o=n.data.get(i.dataId).values,s=eM(o,a,i.shape,i.dtype),u=s.outputValues,l=s.outputShape,c=s.indices;return[n.makeTensorInfo(l,i.dtype,u),n.makeTensorInfo([c.length],"int32",c)]}var NEe={kernelName:I.Unique,backendName:"cpu",kernelFunc:IEe};function CEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),l=0,c=0;c<o;c++)c!==i&&(u[l++]=a.shape[c]);var f=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var p=new Array(s),c=0;c<p.length;c++){f[i]=c;var d=vu({inputs:{x:a},backend:t,attrs:{begin:f,size:h}});p[c]=Yt({inputs:{x:d},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(d)}return p}var AEe={kernelName:I.Unpack,backendName:"cpu",kernelFunc:CEe};function _Ee(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments;He(a,"unsortedSegmentSum");for(var s=a.shape.length,u=i.shape.length,l=[],c=[],f=s-u,h=i,p=0;p<f;++p){var d=Uv({inputs:{input:h},backend:t,attrs:{dim:p+1}});h=d,c.push(d)}for(var p=0;p<o;++p){var v=I.util.createScalarValue(p,"int32"),m=t.makeTensorInfo([],"int32",v),g=yR({inputs:{a:m,b:h},backend:t}),y=ts({inputs:{x:g},backend:t,attrs:{dtype:"float32"}}),b=Hv({inputs:{a:y,b:a},backend:t}),w=fh({inputs:{x:b},backend:t,attrs:{axis:0,keepDims:!1}});l.push(w),c.push(m),c.push(g),c.push(y),c.push(b),c.push(w)}var k=vM({inputs:l,backend:t,attrs:{axis:0}});return c.forEach(function(S){return t.disposeIntermediateTensorInfo(S)}),k}var DEe={kernelName:I.UnsortedSegmentSum,backendName:"cpu",kernelFunc:_Ee},fw,lR,FEe=[Awe,p1e,Dwe,Rwe,b1e,Owe,Lwe,zwe,Wwe,Uwe,Hwe,Kwe,Xwe,Qwe,exe,nxe,ixe,sxe,lxe,Nwe,fxe,pxe,vxe,gxe,g1e,x1e,bxe,d1e,xxe,Sxe,Exe,Ixe,Cxe,_xe,Fxe,Mxe,Pxe,Bxe,$xe,Vxe,Gxe,qxe,jxe,Xxe,Zxe,Jxe,tke,rke,nke,ake,ske,wwe,lke,k1e,gke,S1e,yke,T1e,Eke,Tke,Nke,N1e,_ke,Fke,Mke,Pke,Bke,A1e,D1e,v1e,$ke,kxe,Vke,Gke,qke,xwe,R1e,O1e,jke,L1e,Yke,Jke,t2e,a2e,o2e,u2e,l2e,z1e,f2e,p2e,v2e,g2e,b2e,x2e,S2e,W1e,T2e,C2e,D2e,U1e,H1e,M2e,L2e,$2e,K1e,V2e,G2e,H2e,mM,X2e,Swe,Y1e,Z2e,J2e,tSe,m1e,pw,nSe,Ewe,Twe,Iwe,iSe,sSe,lSe,fSe,pSe,dSe,mSe,iwe,ySe,SSe,TSe,ASe,swe,DSe,RSe,OSe,uwe,A2e,BSe,$Se,VSe,GSe,qSe,jSe,YSe,QSe,fwe,JSe,pwe,tEe,nEe,iEe,sEe,lEe,gwe,ike,fEe,pEe,vEe,gEe,bEe,j1e,NEe,AEe,DEe,U2e];try{for(uh=Pl(FEe),Ml=uh.next();!Ml.done;Ml=uh.next())cR=Ml.value,I.registerKernel(cR)}catch(r){fw={error:r}}finally{try{Ml&&!Ml.done&&(lR=uh.return)&&lR.call(uh)}finally{if(fw)throw fw.error}}var cR,uh,Ml;hh.MathBackendCPU=vw;hh.shared=ywe;hh.version_cpu=bwe});var kP=gr(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});var T=Ds();function REe(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var MEe=REe(T),Nw=function(r,e){return Nw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Nw(r,e)};function OEe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Nw(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Gl(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function Hl(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function oa(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ve(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Gr(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Ve(arguments[e]));return r}var gu={},qv={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qM(r,e){gu[r]=e}function Ti(r,e){if(!(r in gu)||e!=null){var t=LEe(r,e);if(t!==null)gu[r]=t;else return console.log("Could not get context for WebGL version",r),null}var n=gu[r];return n==null||n.isContextLost()?(delete gu[r],Ti(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),gu[r])}function PEe(r){if(typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function LEe(r,e){if(r!==1&&r!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=e??PEe(r);return t.addEventListener("webglcontextlost",function(n){n.preventDefault(),delete gu[r]},!1),T.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(qv.failIfMajorPerformanceCaveat=!1),r===1?t.getContext("webgl",qv)||t.getContext("experimental-webgl",qv):t.getContext("webgl2",qv)}var yh;(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(yh||(yh={}));var Sa;(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(Sa||(Sa={}));var ln;(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ln||(ln={}));function Sh(r,e){return[e,r]}function BEe(r,e){return r*e}function Kv(r){var e=T.util.sizeFromShape(r),t=Math.ceil(e/4);return T.util.sizeToSquarishShape(t)}function Kl(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function zEe(r,e){var t=Ve(Kl(r,e),2),n=t[0],a=t[1];return n*a*4}function Ow(r,e){var t=r,n,a,i,o,s,u,l,c,f,h;return T.env().getNumber("WEBGL_VERSION")===2?(n=t.R32F,a=t.R16F,i=t.RGBA16F,o=t.RGBA32F,s=t.RED,l=4,c=1,f=t.HALF_FLOAT,h=t.FLOAT,u=t.RGBA8):(n=r.RGBA,a=r.RGBA,i=r.RGBA,o=t.RGBA,s=r.RGBA,l=4,c=4,f=e!=null?e.HALF_FLOAT_OES:null,h=r.FLOAT,u=r.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:f,textureTypeFloat:h}}function We(r,e){var t=e();return T.env().getBool("DEBUG")&&$Ee(r),t}function $Ee(r){var e=r.getError();if(e!==r.NO_ERROR)throw new Error("WebGL Error: "+jM(r,e))}var WEe=596e-10,VEe=65504;function KM(r){return!!(T.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||WEe<Math.abs(r)&&Math.abs(r)<VEe)}function jM(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function dh(r,e){return go(r,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function XM(r,e){var t=go(r,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(We(r,function(){return r.shaderSource(t,e)}),We(r,function(){return r.compileShader(t)}),r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function YM(r,e){var t=go(r,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(We(r,function(){return r.shaderSource(t,e)}),We(r,function(){return r.compileShader(t)}),T.env().get("ENGINE_COMPILE_ONLY"))return t;if(r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw Pw(e,r.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var UEe=/ERROR: [0-9]+:([0-9]+):/g;function Pw(r,e){var t=UEe.exec(e);if(t==null){console.log("Couldn't parse line number in error: "+e),console.log(r);return}for(var n=+t[1],a=r.split(`
`),i=a.length.toString().length+2,o=a.map(function(h,p){return T.util.rightPad((p+1).toString(),i)+h}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var l=o.slice(0,n-1),c=o.slice(n-1,n),f=o.slice(n);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c "+T.util.rightPad(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function ZM(r){return go(r,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function QM(r,e){if(We(r,function(){return r.linkProgram(e)}),!T.env().get("ENGINE_COMPILE_ONLY")&&r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Zv(r,e){if(We(r,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function JM(r,e){var t=go(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return We(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),We(r,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function eO(r,e){var t=go(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return We(r,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t)}),We(r,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function GEe(){return T.env().getNumber("WEBGL_VERSION")===2?1:4}function tO(r){return go(r,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function rO(r,e){var t=T.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="["+r+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t){var n="["+r+"x"+e+"]",a="["+t+"x"+t+"]";throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+a+".")}}function nO(r){return go(r,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Cw(r,e,t,n,a,i,o){var s=r.getAttribLocation(e,t);return s===-1?!1:(We(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),We(r,function(){return r.vertexAttribPointer(s,a,r.FLOAT,!1,i,o)}),We(r,function(){return r.enableVertexAttribArray(s)}),!0)}function aO(r,e,t){lO(r,t),We(r,function(){return r.activeTexture(r.TEXTURE0+t)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function HEe(r,e){lO(r,e),We(r,function(){return r.activeTexture(r.TEXTURE0+e)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function iO(r,e,t){return go(r,function(){return r.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function oO(r,e,t){return r.getUniformLocation(e,t)}function sO(r,e,t,n){We(r,function(){return aO(r,e,n)}),We(r,function(){return r.uniform1i(t,n)})}function qEe(r){We(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),We(r,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),We(r,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})}function Qv(r,e,t){We(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),We(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function Aw(r,e){We(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),We(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function vh(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+uO(r,e))}function uO(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function go(r,e,t){var n=We(r,function(){return e()});if(n==null)throw new Error(t);return n}function lO(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t){var a="[gl.TEXTURE0, gl.TEXTURE"+t+"]";throw new Error("textureUnit must be in "+a+".")}}function bu(r,e){return e===void 0&&(e=2),T.util.sizeFromShape(r.slice(0,r.length-e))}function wu(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function Jv(r){var e=[1,1,1],t=r.length===0||r.length===1&&r[0]===1;return t||(e=Gr([bu(r)],wu(r))),e}function cO(r,e){var t;e===void 0&&(e=!1);var n=T.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=T.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(a===1/0&&T.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=n/2),e&&(n=n*2,a=a*2,r=r.map(function(h,p){return p>=r.length-2?T.util.nearestLargerEven(r[p]):r[p]}),r.length===1&&(r=[2,r[0]])),r.length!==2){var i=T.util.squeezeShape(r);r=i.newShape}var o=T.util.sizeFromShape(r),s=null;r.length<=1&&o<=n?s=[1,o]:r.length===2&&r[0]<=n&&r[1]<=n?s=r:r.length===3&&r[0]*r[1]<=n&&r[2]<=n?s=[r[0]*r[1],r[2]]:r.length===3&&r[0]<=n&&r[1]*r[2]<=n?s=[r[0],r[1]*r[2]]:r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n?s=[r[0]*r[1]*r[2],r[3]]:r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n&&(s=[r[0],r[1]*r[2]*r[3]]);var u=s!=null&&Math.max.apply(Math,Gr(s))>a&&Math.min.apply(Math,Gr(s))<=(e?2:1)&&Math.min.apply(Math,Gr(s))>0;if(s==null||u)if(e){var l=bu(r),c=2,f=2;r.length&&(t=Ve(wu(r),2),c=t[0],f=t[1]),o=l*(c/2)*(f/2),s=T.util.sizeToSquarishShape(o).map(function(h){return h*2})}else s=T.util.sizeToSquarishShape(o);return s}function jv(r){return r%2===0}function bh(r,e){if(r=r.slice(-2),e=e.slice(-2),T.util.arraysEqual(r,e)||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r.slice(-1)[0],n=e.slice(-1)[0];if(t===n||jv(t)&&jv(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&jv(r[0])&&jv(e[0])}var em,tm;function fO(r){if(em==null){var e=Ti(r);em=e.getParameter(e.MAX_TEXTURE_SIZE)}return em}function KEe(){em=null}function jEe(){tm=null}function hO(r){if(tm==null){var e=Ti(r);tm=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,tm)}function pO(r){if(r===0)return 0;var e,t=Ti(r);return Ea(t,"EXT_disjoint_timer_query_webgl2")&&r===2?e=2:Ea(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ea(r,e){var t=r.getExtension(e);return t!=null}function _w(r){try{var e=Ti(r);if(e!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function dO(r){if(r===0)return!1;var e=Ti(r);if(r===1){if(!Ea(e,"OES_texture_float"))return!1}else if(!Ea(e,"EXT_color_buffer_float"))return!1;var t=Dw(e);return t}function vO(r){if(r===0)return!1;var e=Ti(r);if(r===1){if(!Ea(e,"OES_texture_float")||!Ea(e,"WEBGL_color_buffer_float"))return!1}else{if(Ea(e,"EXT_color_buffer_float"))return Dw(e);var t="EXT_color_buffer_half_float";if(Ea(e,t)){var n=e.getExtension(t);return XEe(e,n)}return!1}var a=Dw(e);return a}function Dw(r){var e=Ow(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);var n=1,a=1;r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,n,a,0,e.textureFormatFloat,e.textureTypeFloat,null);var i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(i),o}function XEe(r,e){var t=Ow(r,e),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);var a=1,i=1;r.texImage2D(r.TEXTURE_2D,0,t.internalFormatHalfFloat,a,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);var s=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(o),s}function mO(r){if(r!==2)return!1;var e=Ti(r),t=e.fenceSync!=null;return t}function jl(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&T.util.assert(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors in the WebGL backend."})})}var YEe={__proto__:null,callAndCheck:We,canBeRepresented:KM,getWebGLErrorMessage:jM,getExtensionOrThrow:dh,createVertexShader:XM,createFragmentShader:YM,logShaderSourceAndInfoLog:Pw,createProgram:ZM,linkProgram:QM,validateProgram:Zv,createStaticVertexBuffer:JM,createStaticIndexBuffer:eO,getNumChannels:GEe,createTexture:tO,validateTextureSize:rO,createFramebuffer:nO,bindVertexBufferToProgramAttribute:Cw,bindTextureUnit:aO,unbindTextureUnit:HEe,getProgramUniformLocationOrThrow:iO,getProgramUniformLocation:oO,bindTextureToProgramUniformSampler:sO,bindCanvasToFramebuffer:qEe,bindColorTextureToFramebuffer:Qv,unbindColorTextureFromFramebuffer:Aw,validateFramebuffer:vh,getFramebufferErrorMessage:uO,getBatchDim:bu,getRowsCols:wu,getShapeAs3D:Jv,getTextureShapeFromLogicalShape:cO,isReshapeFree:bh,getWebGLMaxTextureSize:fO,resetMaxTextureSize:KEe,resetMaxTexturesInShader:jEe,getMaxTexturesInShader:hO,getWebGLDisjointQueryTimerVersion:pO,hasExtension:Ea,isWebGLVersionEnabled:_w,isCapableOfRenderingToFloatTexture:dO,isDownloadFloatTextureEnabled:vO,isWebGLFenceEnabled:mO,assertNotComplex:jl};var Qe=T.env();Qe.registerFlag("HAS_WEBGL",function(){return Qe.getNumber("WEBGL_VERSION")>0});Qe.registerFlag("WEBGL_VERSION",function(){return _w(2)?2:_w(1)?1:0});Qe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1});Qe.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Qe.get("WEBGL_VERSION")===2});Qe.registerFlag("WEBGL_CPU_FORWARD",function(){return!0});Qe.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1});Qe.registerFlag("WEBGL_PACK",function(){return Qe.getBool("HAS_WEBGL")});Qe.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_PACK_CLIP",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_PACK_REDUCE",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_CONV_IM2COL",function(){return Qe.getBool("WEBGL_PACK")});Qe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return fO(Qe.getNumber("WEBGL_VERSION"))});Qe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return hO(Qe.getNumber("WEBGL_VERSION"))});Qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=Qe.getNumber("WEBGL_VERSION");return r===0?0:pO(r)});Qe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Qe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!T.device_util.isMobile()});Qe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return dO(Qe.getNumber("WEBGL_VERSION"))});Qe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return Qe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Qe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")});Qe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return vO(Qe.getNumber("WEBGL_VERSION"))});Qe.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return mO(Qe.getNumber("WEBGL_VERSION"))});Qe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){var r=Qe.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return r?4:0});Qe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(r){if(r<0&&r!==-1)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+("delete) or at least 0, but got "+r+"."))});Qe.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return T.device_util.isMobile()?1:-1},function(r){if(r<0&&r!==-1)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+("manual flush) or at least 0, but got "+r+"."))});Qe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",function(){return 128});Qe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",function(){return!1});Qe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",function(){return 1e5});Qe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",function(){return 128});Qe.registerFlag("WEBGL_EXP_CONV",function(){return!1});Qe.registerFlag("SOFTWARE_WEBGL_ENABLED",function(){return Qe.getBool("IS_TEST")});Qe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",function(){return 1/0});Qe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",function(){return!1});Qe.registerFlag("WEBGL2_ISNAN_CUSTOM",function(){return!1});function kn(){var r,e,t,n,a,i,o,s,u,l;return T.env().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=T.env().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function xu(r,e,t){t===void 0&&(t="index");var n=T.util.computeStrides(e);return n.map(function(a,i){var o="int "+r[i]+" = "+t+" / "+a,s=i===n.length-1?"int "+r[i+1]+" = "+t+" - "+r[i]+" * "+a:"index -= "+r[i]+" * "+a;return o+"; "+s+";"}).join("")}function sm(r,e,t){t===void 0&&(t="index");var n=T.util.computeStrides(e);return n.map(function(a,i){var o="int "+r[i]+" = "+t+" / outShapeStrides["+i+"]",s=i===n.length-1?"int "+r[i+1]+" = "+t+" - "+r[i]+" * outShapeStrides["+i+"]":"index -= "+r[i]+" * outShapeStrides["+i+"]";return o+"; "+s+";"}).join("")}function ZEe(r,e){var t=r.length,n=r.map(function(o){return e+"["+o+"]"}),a=new Array(t-1);a[t-2]=n[t-1];for(var i=t-3;i>=0;--i)a[i]="("+a[i+1]+" * "+n[i+1]+")";return a}function QEe(r,e,t){t===void 0&&(t="index");var n=r.map(function(i,o){return o}),a=ZEe(n,e);return a.map(function(i,o){var s="int "+r[o]+" = "+t+" / "+a[o],u=o===a.length-1?"int "+r[o+1]+" = "+t+" - "+r[o]+" * "+a[o]:"index -= "+r[o]+" * "+a[o];return s+"; "+u+";"}).join("")}function Lw(r){var e=T.util.computeStrides(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}function Bw(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var gO=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,yO=T.backend_util.getBroadcastDims;function JEe(r,e,t){var n=[];if(r.forEach(function(p){var d=T.util.sizeFromShape(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?n.push("uniform float "+p.name+(d>1?"["+d+"]":"")+";"):(n.push("uniform sampler2D "+p.name+";"),n.push("uniform int offset"+p.name+";")),t.enableShapeUniforms){var v=zw(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape).uniformShape;switch(v.length){case 1:n.push("uniform int "+p.name+"Shape;");break;case 2:n.push("uniform ivec2 "+p.name+"Shape;");break;case 3:n.push("uniform ivec3 "+p.name+"Shape;");break;case 4:n.push("uniform ivec4 "+p.name+"Shape;");break}n.push("uniform ivec2 "+p.name+"TexShape;")}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break}n.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(function(p){n.push("uniform "+p.type+" "+p.name+(p.arrayIndex?"["+p.arrayIndex+"]":"")+";")});var a=n.join(`
`),i=r.map(function(p){return eTe(p,e,t.packedInputs,t.enableShapeUniforms)}).join(`
`),o=e.texShape,s=kn(),u=nTe(s),l,c,f=oTe(s);e.isPacked?(l=tTe(e.logicalShape,o,t.enableShapeUniforms),c=iTe(s)):(l=rTe(e.logicalShape,o,t.enableShapeUniforms),c=aTe(s)),t.packedInputs&&(f+=cTe);var h=[f,u,c,a,l,i,t.userCode].join(`
`);return h}function Xl(r,e){e===void 0&&(e=!1);var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return kTe(r,e);case 1:return ETe(r,e);case 2:return ITe(r,e);case 3:return CTe(r,e);case 4:return _Te(r,e);case 5:return DTe(r);case 6:return FTe(r);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function bO(r,e){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return xTe(r);case 1:return STe(r,e);case 2:return TTe(r,e);case 3:return NTe(r,e);default:return ATe(r,e)}}function eTe(r,e,t,n){t===void 0&&(t=!1);var a="";t?a+=bO(r,n):a+=Xl(r,n);var i=r.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?a+=RTe(r,e):a+=MTe(r,e)),a}function tTe(r,e,t){switch(r.length){case 0:return wO();case 1:return fTe(r,e,t);case 2:return bTe(r,e,t);case 3:return pTe(r,e,t);default:return vTe(r,e,t)}}function rTe(r,e,t){switch(r.length){case 0:return wO();case 1:return hTe(r,e,t);case 2:return wTe(r,e,t);case 3:return dTe(r,e,t);case 4:return mTe(r,e,t);case 5:return gTe(r,e);case 6:return yTe(r,e);default:throw new Error(r.length+"-D output sampling is not yet supported")}}function nTe(r){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+r.texture2D+`(textureSampler, uv).r;
    }
  `}function aTe(r){return`
    void setOutput(float val) {
      `+r.output+` = vec4(val, 0, 0, 0);
    }
  `}function iTe(r){return`
    void setOutput(vec4 val) {
      `+r.output+` = val;
    }
  `}function oTe(r){var e=r.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+r.varyingFs+` vec2 resultUV;
    `+r.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+r.defineSpecialNaN+`
    `+r.defineSpecialInf+`
    `+r.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+sTe+`
    `+uTe+`
    `+lTe+`
  `;return e}var sTe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,uTe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,lTe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,cTe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function wO(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function fTe(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+n[1]+`.0);
      }
    `:n[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+n[0]+`.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      return 2 * (resTexRC.x * `+n[1]+` + resTexRC.y);
    }
  `}function hTe(r,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * `+e[1]+`.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * `+e[0]+`.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      return resTexRC.x * `+e[1]+` + resTexRC.y;
    }
  `}function pTe(r,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[2]/2),i=a*Math.ceil(r[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      int index = resTexRC.x * `+n[1]+` + resTexRC.y;

      int b = index / `+i+`;
      index -= b * `+i+`;

      int r = 2 * (index / `+a+`);
      int c = imod(index, `+a+`) * 2;

      return ivec3(b, r, c);
    }
  `}function dTe(r,e,t){if(t){var n=sm(["r","c","d"],r);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    `+n+`
    return ivec3(r, c, d);
  }
`}var a=xu(["r","c","d"],r);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      `+a+`
      return ivec3(r, c, d);
    }
  `}function vTe(r,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[r.length-1]/2),i=a*Math.ceil(r[r.length-2]/2),o=i,s="",u="b, r, c",l=2;l<r.length-1;l++)o*=r[r.length-l-1],s=`
      int b`+l+" = index / "+o+`;
      index -= b`+l+" * "+o+`;
    `+s,u="b"+l+", "+u;return`
    ivec`+r.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      int index = resTexRC.x * `+n[1]+` + resTexRC.y;

      `+s+`

      int b = index / `+i+`;
      index -= b * `+i+`;

      int r = 2 * (index / `+a+`);
      int c = imod(index, `+a+`) * 2;

      return ivec`+r.length+"("+u+`);
    }
  `}function mTe(r,e,t){if(t){var n=sm(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      `+n+`
      return ivec4(r, c, d, d2);
    }
  `}var a=xu(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      `+a+`
      return ivec4(r, c, d, d2);
    }
  `}function gTe(r,e){var t=xu(["r","c","d","d2","d3"],r);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+e[0]+`,
                             `+e[1]+`));

      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      `+t+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function yTe(r,e){var t=xu(["r","c","d","d2","d3","d4"],r);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      `+t+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function bTe(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(T.util.arraysEqual(r,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+n[0]+", "+n[1]+`));
      }
    `;var a=Math.ceil(r[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));

      int index = resTexRC.x * `+n[1]+` + resTexRC.y;
      int r = 2 * (index / `+a+`);
      int c = imod(index, `+a+`) * 2;

      return ivec2(r, c);
    }
  `}function wTe(r,e,t){return T.util.arraysEqual(r,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+e[0]+", "+e[1]+`));
      }
    `:r[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+e[0]+", "+e[1]+`));
        int index = resTexRC.x * `+e[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:r[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+e[0]+", "+e[1]+`));
        int index = resTexRC.x * `+e[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      int r = index / `+r[1]+`;
      int c = index - r * `+r[1]+`;
      return ivec2(r, c);
    }
  `}function ku(r){return"offset"+r}function xTe(r){var e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=kn();return`
    vec4 `+t+`() {
      return `+n.texture2D+"("+e+`, halfCR);
    }
  `}function kTe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var a=Ve(r.shapeInfo.texShape,2),i=a[0],o=a[1];if(i===1&&o===1)return`
      float `+n+`() {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var s=ku(t);if(e)return`
    float `+n+`() {
      vec2 uv = uvFromFlat(`+t+"TexShape[0], "+t+"TexShape[1], "+s+`);
      return sampleTexture(`+t+`, uv);
    }
  `;var u=Ve(r.shapeInfo.texShape,2),l=u[0],c=u[1];return`
    float `+n+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+s+`);
      return sampleTexture(`+t+`, uv);
    }
  `}function STe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=r.shapeInfo.texShape,i=kn();if(e)return`
    vec4 `+n+`(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(`+t+"TexShape[0]) / 2.0), ceil(float("+t+`TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return `+i.texture2D+"("+t+`, uv);
    }
  `;var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `+n+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+o[0]+", "+o[1]+`, index);
      return `+i.texture2D+"("+t+`, uv);
    }
  `}function ETe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return`
      float `+n+`(int index) {
        `+Yl(r)+`
      }
    `;var a=r.shapeInfo.texShape,i=a[0],o=a[1];if(o===1&&i===1)return`
      float `+n+`(int index) {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var s=ku(t);return o===1?e?`
      float `+n+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+s+") + 0.5) / float("+t+`TexShape[0]));
        return sampleTexture(`+t+`, uv);
      }
    `:`
      float `+n+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+s+") + 0.5) / "+i+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:i===1?e?`
      float `+n+`(int index) {
        vec2 uv = vec2((float(index + `+s+") + 0.5) / float("+t+`TexShape[1]), 0.5);
        return sampleTexture(`+t+`, uv);
      }
    `:`
      float `+n+`(int index) {
        vec2 uv = vec2((float(index + `+s+") + 0.5) / "+o+`.0, 0.5);
        return sampleTexture(`+t+`, uv);
      }
    `:e?`
    float `+n+`(int index) {
      vec2 uv = uvFromFlat(`+t+"TexShape[0], "+t+"TexShape[1], index + "+s+`);
      return sampleTexture(`+t+`, uv);
    }
  `:`
    float `+n+`(int index) {
      vec2 uv = uvFromFlat(`+i+", "+o+", index + "+s+`);
      return sampleTexture(`+t+`, uv);
    }
  `}function TTe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=i[0],s=i[1],u=kn();if(i!=null&&T.util.arraysEqual(t,i))return e?`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+n+"TexShape[1], "+n+`TexShape[0]);

        return `+u.texture2D+"("+n+`, uv);
      }
    `:`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+s+".0, "+o+`.0);

        return `+u.texture2D+"("+n+`, uv);
      }
    `;if(e)return`
    vec4 `+a+`(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`+n+"TexShape[0]) / 2.0), ceil(float("+n+`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`+n+`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return `+u.texture2D+"("+n+`, uv);
    }
  `;var l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(t[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+c+", "+l[0]+", "+l[1]+`, row, col);
      return `+u.texture2D+"("+n+`, uv);
    }
  `}function ITe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape;if(i!=null&&T.util.arraysEqual(t,i)){if(e)return`
      float `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `;var o=i[0],s=i[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+s+".0, "+o+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `}var u=T.util.squeezeShape(t),l=u.newShape,c=u.keptDims,f=l;if(f.length<t.length){var h=Zl(r,f),p=["row","col"];return`
      `+Xl(h,e)+`
      float `+a+`(int row, int col) {
        return `+a+"("+Ql(p,c)+`);
      }
    `}if(r.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+t[1]+`, 1)));
        `+Yl(r)+`
      }
    `;var d=i[0],v=i[1],m=ku(n);return v===1?e?`
      float `+a+`(int row, int col) {
        float index = dot(vec3(row, col, `+m+"), vec3("+n+`Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(`+n+`TexShape[0]));
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+d+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `:d===1?e?`
      float `+a+`(int row, int col) {
        float index = dot(vec3(row, col, `+m+"), vec3("+n+`Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(`+n+`TexShape[1]), 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+n+`, uv);
    }
  `:e?`
      float `+a+`(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+n+"Shape[1] + col + "+m+`;
        vec2 uv = uvFromFlat(`+n+"TexShape[0], "+n+`TexShape[1], index);
        return sampleTexture(`+n+`, uv);
      }
    `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+t[1]+" + col + "+m+`;
    vec2 uv = uvFromFlat(`+d+", "+v+`, index);
    return sampleTexture(`+n+`, uv);
  }
`}function NTe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){var s=t.slice(1),u=[1,2],l=Zl(r,s),c=["b","row","col"];return`
        `+bO(l,e)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+Ql(c,u)+`);
        }
      `}var f=kn();if(e)return`
    vec4 `+a+`(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`+n+"TexShape[0]) / 2.0), ceil(float("+n+`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`+n+`Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`+n+`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return `+f.texture2D+"("+n+`, uv);
    }
  `;var h=o[0],p=o[1],d=Math.ceil(t[2]/2),v=d*Math.ceil(t[1]/2);return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+h+", "+p+", "+v+", "+d+`, b, row, col);
      return `+f.texture2D+"("+n+`, uv);
    }
  `}function CTe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],o=t[2],s=T.util.squeezeShape(t),u=s.newShape,l=s.keptDims,c=u;if(c.length<t.length){var f=Zl(r,c),h=["row","col","depth"];return`
        `+Xl(f,e)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+Ql(h,l)+`);
        }
      `}if(r.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+i+", "+o+`, 1)));
        `+Yl(r)+`
      }
    `;var p=r.shapeInfo.texShape,d=p[0],v=p[1],m=r.shapeInfo.flatOffset;if(v===i&&m==null)return e?`
      float `+a+`(int row, int col, int depth) {
        int stride1 = `+n+`Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `:`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+o+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+d+`.0);
          return sampleTexture(`+n+`, uv);
        }
      `;if(v===o&&m==null)return e?`
      float `+a+`(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(`+n+`Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+d+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `;var g=ku(n);return e?`
    float `+a+`(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = `+n+"Shape[1] * "+n+`Shape[2];
      int stride1 = `+n+`Shape[2];
      int index = row * stride0 + col * stride1 + depth + `+g+`;
      vec2 uv = uvFromFlat(`+n+"TexShape[0], "+n+`TexShape[1], index);
      return sampleTexture(`+n+`, uv);
    }
    `:`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+i+" + col * "+o+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+d+", "+v+`, index);
        return sampleTexture(`+n+`, uv);
      }
  `}function ATe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=kn();if(e)return`
    vec4 `+n+`(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(`+t+`Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`+t+`Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= `+t+`Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(`+t+"TexShape[0]) / 2.0), ceil(float("+t+`TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return `+a.texture2D+"("+t+`, uv);
    }
  `;for(var i=r.shapeInfo.logicalShape,o=i.length,s=r.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=u[0],c=u[1],f=Math.ceil(i[o-1]/2),h=f*Math.ceil(i[o-2]/2),p="int b, int row, int col",d="b * "+h+" + (row / 2) * "+f+" + (col / 2)",v=2;v<o-1;v++)p="int b"+v+", "+p,h*=i[o-v-1],d="b"+v+" * "+h+" + "+d;return`
    vec4 `+n+"("+p+`) {
      int index = `+d+`;
      int texR = index / `+c+`;
      int texC = index - texR * `+c+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+c+", "+l+`);
      return `+a.texture2D+"("+t+`, uv);
    }
  `}function _Te(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],o=t[2]*i,s=t[1]*o,u=T.util.squeezeShape(t),l=u.newShape,c=u.keptDims;if(l.length<t.length){var f=Zl(r,l),h=["row","col","depth","depth2"];return`
      `+Xl(f,e)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+Ql(h,c)+`);
      }
    `}if(r.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+s+", "+o+", "+i+`, 1)));
        `+Yl(r)+`
      }
    `;var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,v=d[0],m=d[1],g="int stride2 = "+n+"Shape[3];",y="int stride1 = "+n+"Shape[2] * stride2;",b="int stride0 = "+n+"Shape[1] * stride1;";if(m===s&&p==null)return e?`
      float `+a+`(int row, int col, int depth, int depth2) {
        `+g+`
        `+y+`
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `:`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+o+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `;if(m===i&&p==null)return e?`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n+"Shape[1] * "+n+"Shape[2], "+n+`Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `:`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+t[1]*t[2]+", "+t[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `;var w=ku(n);return e?`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      `+g+`
      `+y+`
      `+b+`
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(`+n+"TexShape[0], "+n+"TexShape[1], index + "+w+`);
      return sampleTexture(`+n+`, uv);
    }
  `:`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+s+" + col * "+o+` +
          depth * `+i+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+m+", index + "+w+`);
      return sampleTexture(`+n+`, uv);
    }
  `}function DTe(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=e[4],i=e[3]*a,o=e[2]*i,s=e[1]*o,u=T.util.squeezeShape(e),l=u.newShape,c=u.keptDims;if(l.length<e.length){var f=Zl(r,l),h=["row","col","depth","depth2","depth3"];return`
      `+Xl(f)+`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        return `+n+"("+Ql(h,c)+`);
      }
    `}if(r.shapeInfo.isUniform)return`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+s+", "+o+", "+i+", "+a+`)) +
          depth3;
        `+Yl(r)+`
      }
    `;var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,v=d[0],m=d[1];if(m===s&&p==null)return`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+o+", "+i+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `;if(m===a&&p==null)return`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]+`,
               `+e[2]*e[3]+", "+e[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `;var g=ku(t);return`
    float `+n+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+s+" + col * "+o+" + depth * "+i+` +
          depth2 * `+a+" + depth3 + "+g+`;
      vec2 uv = uvFromFlat(`+v+", "+m+`, index);
      return sampleTexture(`+t+`, uv);
    }
  `}function FTe(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=T.util.squeezeShape(e),i=a.newShape,o=a.keptDims;if(i.length<e.length){var s=Zl(r,i),u=["row","col","depth","depth2","depth3","depth4"];return`
      `+Xl(s)+`
      float `+n+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+n+"("+Ql(u,o)+`);
      }
    `}var l=e[5],c=e[4]*l,f=e[3]*c,h=e[2]*f,p=e[1]*h;if(r.shapeInfo.isUniform)return`
      float `+n+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+h+", "+f+", "+c+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+Yl(r)+`
      }
    `;var d=r.shapeInfo.flatOffset,v=r.shapeInfo.texShape,m=v[0],g=v[1];if(g===p&&d==null)return`
      float `+n+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+f+", "+c+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `;if(g===l&&d==null)return`
      float `+n+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]*e[4]+`,
               `+e[2]*e[3]*e[4]+`,
               `+e[3]*e[4]+`,
               `+e[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `;var y=ku(t);return`
    float `+n+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+h+" + depth * "+f+` +
          depth2 * `+c+" + depth3 * "+l+" + depth4 + "+y+`;
      vec2 uv = uvFromFlat(`+m+", "+g+`, index);
      return sampleTexture(`+t+`, uv);
    }
  `}function Yl(r){var e=r.name,t=T.util.sizeFromShape(r.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function RTe(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=r.shapeInfo.logicalShape.length,o=e.logicalShape.length,s=yO(r.shapeInfo.logicalShape,e.logicalShape),u=Zt(o),l=o-i,c,f=["x","y","z","w","u","v"];i===0?c="":o<2&&s.length>=1?c="coords = 0;":c=s.map(function(w){return"coords."+f[w+l]+" = 0;"}).join(`
`);var h="";o<2&&i>0?h="coords":h=r.shapeInfo.logicalShape.map(function(w,k){return"coords."+f[k+l]}).join(", ");var p="return outputValue;",d=T.util.sizeFromShape(r.shapeInfo.logicalShape),v=d===1,m=T.util.sizeFromShape(e.logicalShape),g=m===1;if(i===1&&!v&&!g)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!g)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(s.length){var y=i-2,b=i-1;s.indexOf(y)>-1&&s.indexOf(b)>-1?p="return vec4(outputValue.x);":s.indexOf(y)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(b)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `+a+`() {
      `+u+` coords = getOutputCoords();
      `+c+`
      vec4 outputValue = get`+n+"("+h+`);
      `+p+`
    }
  `}function MTe(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=e.texShape,o=r.shapeInfo.texShape,s=r.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!r.shapeInfo.isUniform&&s===u&&r.shapeInfo.flatOffset==null&&T.util.arraysEqual(o,i))return`
      float `+a+`() {
        return sampleTexture(`+t+`, resultUV);
      }
    `;var l=Zt(u),c=yO(r.shapeInfo.logicalShape,e.logicalShape),f=u-s,h,p=["x","y","z","w","u","v"];s===0?h="":u<2&&c.length>=1?h="coords = 0;":h=c.map(function(v){return"coords."+p[v+f]+" = 0;"}).join(`
`);var d="";return u<2&&s>0?d="coords":d=r.shapeInfo.logicalShape.map(function(v,m){return"coords."+p[m+f]}).join(", "),`
    float `+a+`() {
      `+l+` coords = getOutputCoords();
      `+h+`
      return get`+n+"("+d+`);
    }
  `}function Zt(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function zw(r,e,t){var n=T.util.squeezeShape(e),a=n.newShape,i=n.keptDims,o=e.length,s=r&&o===3&&e[0]===1,u=s?e.slice(1):a,l=!r&&o>1&&!T.util.arraysEqual(e,t)&&a.length<o||s,c=l?u:e;return{useSqueezeShape:l,uniformShape:c,keptDims:i}}function Zl(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function Ql(r,e){return e.map(function(t){return r[t]}).join(", ")}function OTe(r,e,t,n){var a=t.map(function(c,f){var h={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(h.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:h}}),i=a.map(function(c){return c.shapeInfo}),o={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},s=JEe(a,o,e),u=YM(r.gl,s),l=r.createProgram(u);return T.env().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:s,webGLProgram:l,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:u,source:s,webGLProgram:l,inShapeInfos:i,outShapeInfo:o},xO(r,e,l))}function xO(r,e,t){var n={},a={},i={},o=[],s,u,l,c=null,f=null;f=r.getUniformLocation(t,"NAN",!1),T.env().getNumber("WEBGL_VERSION")===1&&(c=r.getUniformLocation(t,"INFINITY",!1));for(var h=!1,p=0;p<e.variableNames.length;p++){var d=e.variableNames[p];n[d]=r.getUniformLocation(t,d,h),n["offset"+d]=r.getUniformLocation(t,"offset"+d,h),e.enableShapeUniforms&&(a[d+"Shape"]=r.getUniformLocation(t,d+"Shape",h),i[d+"TexShape"]=r.getUniformLocation(t,d+"TexShape",h))}return e.enableShapeUniforms&&(s=r.getUniformLocation(t,"outShape",h),l=r.getUniformLocation(t,"outShapeStrides",h),u=r.getUniformLocation(t,"outTexShape",h)),e.customUniforms&&e.customUniforms.forEach(function(v,m){o[m]=r.getUniformLocation(t,v.name,h)}),{uniformLocations:n,customUniformLocations:o,infLoc:c,nanLoc:f,inShapesLocations:a,inTexShapesLocations:i,outShapeLocation:s,outShapeStridesLocation:l,outTexShapeLocation:u}}function yM(r,e){if(r.length!==e.length)throw Error("Binary was compiled with "+r.length+" inputs, but "+("was executed with "+e.length+" inputs"));r.forEach(function(t,n){var a=t.logicalShape,i=e[n],o=i.shape;if(!T.util.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+("the current args. Shapes "+a+" and "+o+" must match"));if(!(t.isUniform&&i.isUniform)){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!T.util.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+(" current args. Shape "+s+" and "+u+" must match"))}})}function PTe(r,e,t,n,a){e.program.enableShapeUniforms||(yM(e.inShapeInfos,t),yM([e.outShapeInfo],[n]));var i=n.texData.texture,o=n.texData.texShape;n.texData.isPacked?r.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):r.setOutputMatrixTexture(i.texture,o[0],o[1]),r.setProgram(e.webGLProgram),T.env().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&r.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&r.gl.uniform1f(e.nanLoc,NaN),t.forEach(function(l,c){var f=e.program.variableNames[c],h=e.uniformLocations[f],p=e.uniformLocations["offset"+f],d=e.inShapesLocations[f+"Shape"],v=e.inTexShapesLocations[f+"TexShape"];if(d){var m=zw(e.program.packedInputs,l.shape,l.texData.texShape).uniformShape;switch(m.length){case 1:r.gl.uniform1iv(d,new Int32Array(m));break;case 2:r.gl.uniform2iv(d,new Int32Array(m));break;case 3:r.gl.uniform3iv(d,new Int32Array(m));break;case 4:r.gl.uniform4iv(d,new Int32Array(m));break}}if(v&&r.gl.uniform2i(v,l.texData.texShape[0],l.texData.texShape[1]),h!=null){if(l.isUniform){if(T.util.sizeFromShape(l.shape)<2)r.gl.uniform1f(h,l.uniformValues[0]);else{var g=l.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),r.gl.uniform1fv(h,g)}return}l.texData.slice!=null&&p!=null&&r.gl.uniform1i(p,l.texData.slice.flatOffset),r.setInputMatrixTexture(l.texData.texture.texture,h,c)}});var s=e.outShapeLocation;if(s)switch(n.shape.length){case 1:r.gl.uniform1iv(s,new Int32Array(n.shape));break;case 2:r.gl.uniform2iv(s,new Int32Array(n.shape));break;case 3:r.gl.uniform3iv(s,new Int32Array(n.shape));break;case 4:r.gl.uniform4iv(s,new Int32Array(n.shape));break}if(e.outShapeStridesLocation){var u=T.util.computeStrides(n.shape);switch(n.shape.length){case 2:r.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(u));break;case 3:r.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(u));break;case 4:r.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(u));break}}e.outTexShapeLocation&&r.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&a&&e.program.customUniforms.forEach(function(l,c){var f=e.customUniformLocations[c],h=a[c];if(l.type==="float")r.gl.uniform1fv(f,h);else if(l.type==="vec2")r.gl.uniform2fv(f,h);else if(l.type==="vec3")r.gl.uniform3fv(f,h);else if(l.type==="vec4")r.gl.uniform4fv(f,h);else if(l.type==="int")r.gl.uniform1iv(f,h);else if(l.type==="ivec2")r.gl.uniform2iv(f,h);else if(l.type==="ivec3")r.gl.uniform3iv(f,h);else if(l.type==="ivec4")r.gl.uniform4iv(f,h);else throw Error("uniform type "+l.type+" is not supported yet.")}),r.executeProgram()}function LTe(r,e,t){var n="";e.concat(t).forEach(function(o){var s=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(r.enableShapeUniforms&&!o.isUniform){var u=o.texData.texShape,l=zw(r.packedInputs,o.shape,u),c=l.useSqueezeShape,f=l.uniformShape,h=l.keptDims,p="",d="",v="";if(f.length===1&&r.packedInputs){var m=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p=(m[0]>1)+"_"+(m[1]>1)}else if(f.length===2&&!r.packedInputs)d=(f[0]>1)+"_"+(f[1]>1);else if(f.length>2&&!r.packedInputs){var g=T.util.computeStrides(f);v=(g[0]===u[1])+"_"+(g[g.length-1]===u[1])}var y=o.shape.length,b=f.length===2&&T.util.arraysEqual(o.shape,u),w=T.util.sizeFromShape(o.shape)===1,k=T.backend_util.getBroadcastDims(o.shape,t.shape),S=!r.packedInputs&&y===t.shape.length&&T.util.arraysEqual(u,t.texData.texShape),E=r.packedInputs||f.length>2?"":(u[0]>1)+"_"+(u[1]>1);n+=y+"_"+S+"_"+(c?h:"")+"_"+f.length+"_"+w+"_"+k+"_"+b+"_"+p+"_"+d+"_"+v+"_"+E+"_"+s}else{var N=o.isUniform?"uniform":o.texData.texShape;n+=o.shape+"_"+N+"_"+s}});var a=r.userCode,i=r.constructor.name;return i+="_"+n+"_"+a+(""+T.env().getNumber("WEBGL_VERSION")),i}function Sn(r){return T.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&r<=4}var BTe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=yh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=kn();this.outputShape=e,this.enableShapeUniforms=Sn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+(this.enableShapeUniforms?sm(["r","c","d"],e):xu(["r","c","d"],e))+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `}return r})();var zTe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=yh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=kn();this.outputShape=e,this.enableShapeUniforms=Sn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+(this.enableShapeUniforms?sm(["r","c","d"],e):xu(["r","c","d"],e))+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `}return r})();var $Te=(function(){function r(e){this.variableNames=["A"],this.outTexUsage=Sa.DOWNLOAD;var t=kn();this.outputShape=e,this.userCode=`
      `+gO+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `}return r})();var WTe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Sa.DOWNLOAD;var t=kn();this.outputShape=e,this.userCode=`
      `+gO+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `}return r})();var VTe=(function(){function r(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=kn();this.outputShape=e,this.enableShapeUniforms=Sn(this.outputShape.length);var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+(this.enableShapeUniforms?Bw():Lw(e))+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / texShape[1];
        int c = imod(flatIndex, texShape[1]);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `}return r})();var UTe=(function(){function r(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=kn();this.outputShape=e,this.enableShapeUniforms=Sn(this.outputShape.length);var a="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=o*2+s;a+=`
          localCoords = coords;
          if(localCoords[2] + `+s+" < "+(this.enableShapeUniforms?"outShape[2]":""+e[2])+`) {
          localCoords[2] += `+s+`;
          if (localCoords[1] + `+o+" < "+(this.enableShapeUniforms?"outShape[1]":""+e[1])+`) {
            localCoords[1] += `+o+`;

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = `+n.texture2D+`(A, uv);

            if (offset == 0) {
              result[`+u+`] = values[0];
            } else if (offset == 1) {
              result[`+u+`] = values[1];
            } else if (offset == 2) {
              result[`+u+`] = values[2];
            } else {
              result[`+u+`] = values[3];
            }
          }
        }
        `}this.userCode=`
        `+(this.enableShapeUniforms?Bw():Lw(e))+`

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          `+a+`

          `+n.output+" = "+i+`;
        }
    `}return r})();function kO(r){var e=kn(),t=e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return XM(r,t)}function SO(r){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return JM(r,e)}function EO(r){var e=new Uint16Array([0,1,2,2,1,3]);return eO(r,e)}function Eh(r,e,t,n,a,i){rO(e,t);var o=tO(r),s=r.TEXTURE_2D;return We(r,function(){return r.bindTexture(s,o)}),We(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),We(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),We(r,function(){return r.texParameteri(s,r.TEXTURE_MIN_FILTER,r.NEAREST)}),We(r,function(){return r.texParameteri(s,r.TEXTURE_MAG_FILTER,r.NEAREST)}),T.env().getNumber("WEBGL_VERSION")===1?We(r,function(){return r.texImage2D(s,0,n,e,t,0,a,i,null)}):We(r,function(){return r.texStorage2D(s,1,n,e,t)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,null)}),{texture:o,texShape:[t,e]}}function $w(r){return r.internalFormatFloat}function TO(r,e,t,n){var a=Ve(Sh(e,t),2),i=a[0],o=a[1];return Eh(r,i,o,$w(n),n.textureFormatFloat,r.FLOAT)}function Ww(r){return r.internalFormatHalfFloat}function IO(r,e,t,n){var a=Ve(Sh(e,t),2),i=a[0],o=a[1];return Eh(r,i,o,Ww(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function Vw(r){return r.downloadTextureFormat}function NO(r,e,t,n){var a=Ve(Sh(e,t),2),i=a[0],o=a[1];return Eh(r,i,o,Vw(n),r.RGBA,r.UNSIGNED_BYTE)}function Uw(r){return r.internalFormatPackedFloat}function CO(r,e,t,n){var a=Ve(Kl(e,t),2),i=a[0],o=a[1];return Eh(r,i,o,Uw(n),r.RGBA,r.FLOAT)}function Gw(r){return r.internalFormatPackedHalfFloat}function AO(r,e,t,n){var a=Ve(Kl(e,t),2),i=a[0],o=a[1];return Eh(r,i,o,Gw(n),r.RGBA,n.textureTypeHalfFloat)}function _O(r,e,t){var n=0,a=12,i=20;We(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)});var o=Cw(r,e,"clipSpacePos",t,3,i,n);return o&&Cw(r,e,"uv",t,2,i,a)}function DO(r,e,t,n,a,i){We(r,function(){return r.bindTexture(r.TEXTURE_2D,e)});var o,s,u;a instanceof Uint8Array?(o=new Uint8Array(t*n*4),s=r.UNSIGNED_BYTE,u=r.RGBA):(o=new Float32Array(t*n*4),s=r.FLOAT,u=i.internalFormatPackedFloat),o.set(a),T.env().getNumber("WEBGL_VERSION")===2?We(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t,n,r.RGBA,s,o)}):We(r,function(){return r.texImage2D(r.TEXTURE_2D,0,u,t,n,0,r.RGBA,s,o)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function FO(r,e,t){We(r,function(){return r.bindTexture(r.TEXTURE_2D,e)}),t.data instanceof Uint8Array?T.env().getNumber("WEBGL_VERSION")===2?We(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,t.data)}):We(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t.data)}):T.env().getNumber("WEBGL_VERSION")===2?We(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,t)}):We(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function RO(r,e,t,n){var a=r.createBuffer();We(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var i=4,o=4,s=i*o*e*t;return We(r,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,s,r.STREAM_READ)}),We(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,0)}),We(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function MO(r,e,t){var n=r,a=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,a),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),a}function OO(r,e,t,n){var a=Ve(Sh(e,t),2),i=a[0],o=a[1],s=4,u=new Uint8Array(BEe(e*t,s));return We(r,function(){return r.readPixels(0,0,i,o,n.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function PO(r,e,t,n,a,i,o,s){var u=r,l=new Float32Array(zEe(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function LO(r,e,t){var n=new Float32Array(e*t*4);return We(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,n)}),n}var GTe={__proto__:null,createVertexShader:kO,createVertexBuffer:SO,createIndexBuffer:EO,getInternalFormatForFloat32MatrixTexture:$w,createFloat32MatrixTexture:TO,getInternalFormatForFloat16MatrixTexture:Ww,createFloat16MatrixTexture:IO,getInternalFormatForUnsignedBytesMatrixTexture:Vw,createUnsignedBytesMatrixTexture:NO,getInternalFormatForPackedMatrixTexture:Uw,createPackedMatrixTexture:CO,getInternalFormatForFloat16PackedMatrixTexture:Gw,createFloat16PackedMatrixTexture:AO,bindVertexProgramAttributeStreams:_O,uploadDenseMatrixToTexture:DO,uploadPixelDataToTexture:FO,createBufferFromOutputTexture:RO,downloadFloat32MatrixFromBuffer:MO,downloadByteEncodedFloatMatrixFromOutputTexture:OO,downloadPackedMatrixFromBuffer:PO,downloadMatrixFromPackedOutputTexture:LO},rm=(function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=T.env().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,qM(t,e)):this.gl=Ti(t);var n="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),T.env().getNumber("WEBGL_VERSION")===1){var i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=dh(this.gl,i),Ea(this.gl,o))this.textureHalfFloatExtension=dh(this.gl,o);else if(T.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Ea(this.gl,a))this.colorBufferHalfFloatExtension=dh(this.gl,a);else if(T.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Ea(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(Ea(this.gl,a))this.colorBufferHalfFloatExtension=this.gl.getExtension(a);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=SO(this.gl),this.indexBuffer=EO(this.gl),this.framebuffer=nO(this.gl),this.textureConfig=Ow(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return T.env().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;We(t,function(){return t.finish()}),We(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),We(t,function(){return t.deleteFramebuffer(e.framebuffer)}),We(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),We(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),We(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),TO(this.gl,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),IO(this.gl,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),NO(this.gl,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),FO(this.gl,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,a){this.throwIfDisposed(),DO(this.gl,e,t,n,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),AO(this.gl,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),CO(this.gl,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Aw(this.gl,this.framebuffer),this.outputTexture=null),We(this.gl,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return OO(a.gl,t,n,a.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,a,i,o){return PO(this.gl,e,t,n,a,i,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return MO(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var a=RO(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t=this,n,a;if(T.env().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=o}else T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),a=function(){return t.isQueryAvailable(n,T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:n,isFencePassed:a}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return LO(a.gl,t,n)})},r.prototype.createProgram=function(e){var t=this;this.throwIfDisposed();var n=this.gl;this.vertexShader==null&&(this.vertexShader=kO(n));var a=ZM(n);return We(n,function(){return n.attachShader(a,t.vertexShader)}),We(n,function(){return n.attachShader(a,e)}),QM(n,a),this.debug&&Zv(n,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=_O(n,this.program,this.vertexBuffer)),a},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&We(this.gl,function(){return t.gl.deleteProgram(e)})},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Zv(this.gl,this.program),We(this.gl,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?iO(this.gl,e,t):oO(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),We(this.gl,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),sO(this.gl,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var a=Ve(Kl(t,n),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,a){this.setOutputMatrixWriteRegionDriver(n,e,a,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&Zv(this.gl,this.program),vh(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),We(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),We(this.gl,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=dh(this.gl,T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)},r.prototype.waitForQueryAndGetTime=function(e){return Gl(this,void 0,void 0,function(){var t=this;return Hl(this,function(n){switch(n.label){case 0:return[4,T.util.repeatedTry(function(){return t.disposed||t.isQueryAvailable(e,T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl,a=n.getQueryParameter(e,n.QUERY_RESULT);return a/1e6}else{var i=this.getQueryTimerExtensionWebGL1(),a=i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT);return a/1e6}},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{var a=this.getQueryTimerExtensionWebGL1(),i=a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=HTe(this.itemsToPoll.map(function(a){return a.isDoneFn})),t=0;t<=e;++t){var n=this.itemsToPoll[t].resolveFn;n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var a=void 0;"setTimeoutCustom"in T.env().platform&&(a=T.env().platform.setTimeoutCustom.bind(T.env().platform)),T.util.repeatedTry(function(){return n.pollItems(),n.itemsToPoll.length===0},function(){return 0},null,a)}},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Qv(this.gl,e,this.framebuffer),this.debug&&vh(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Qv(this.gl,this.outputTexture,this.framebuffer),this.debug&&vh(this.gl)):Aw(this.gl,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var a=this.gl;Qv(a,e,this.framebuffer),this.debug&&vh(a),this.outputTexture=e,We(a,function(){return a.viewport(0,0,t,n)}),We(a,function(){return a.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,a){var i=this;this.throwIfDisposed(),We(this.gl,function(){return i.gl.scissor(e,t,n,a)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r})();function HTe(r){for(var e=0;e<r.length;++e){var t=r[e]();if(!t)break}return e-1}function qTe(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}function ti(r){return function(e,t,n,a,i){var o=T.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=T.util.computeStrides(o),l=T.util.sizeFromShape(o),c=T.util.getTypedArrayFromDType(i,l),f=e.length,h=t.length,p=T.util.computeStrides(e),d=T.util.computeStrides(t),v=T.backend_util.getBroadcastDims(e,o),m=T.backend_util.getBroadcastDims(t,o);if(v.length+m.length===0)for(var g=0;g<c.length;++g)c[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(b){var w=T.util.indexToLoc(b,s,u),k=w.slice(-f);v.forEach(function(C){return k[C]=0});var S=T.util.locToIndex(k,f,p),E=w.slice(-h);m.forEach(function(C){return E[C]=0});var N=T.util.locToIndex(E,h,d);c[b]=r(n[S],a[N])},g=0;g<c.length;++g)y(g);return[c,o]}}function KTe(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=T.util.toTypedArray([0],t),o=Ve(ti(function(l,c){return l!==c?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast "+t+" to "+n)}var jTe=ti((function(r,e){return r+e}));function XTe(r,e,t,n,a){for(var i=T.util.sizeFromShape(n),o=T.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function YTe(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=T.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var l=r.get(s,u);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(n?o.set(1,s,l):e.size>0?o.set(o.get(s,l)+e.get(s,u),s,l):o.set(o.get(s,l)+1,s,l))}return o}function ns(r){return function(e,t,n){for(var a=T.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}var ZTe=ns(function(r){return Math.ceil(r)});function QTe(r,e,t,n){var a=T.util.getArrayFromDType(t,T.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=T.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?T.backend_util.fromUint8ToStringArray(s.vals):s.vals,l=0,c=0;c<s.shape[0];++c)for(var f=c*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[l++];o+=s.shape[1]})}return a}var JTe=ti(function(r,e){return r===e?1:0});var eIe=ns(function(r){return Math.exp(r)});var tIe=ns(function(r){return Math.expm1(r)});var rIe=ns(function(r){return Math.floor(r)});function nIe(r,e,t,n,a,i,o,s,u){for(var l=T.buffer([n,i],t),c=0;c<n;c++){for(var f=[],h=0,p=0;p<a;p++){var d=r[c*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: "+f+" does not index into "+s);for(var v=0;v<i;v++)l.values[c*i+v]=e.get.apply(e,Gr(e.indexToLoc(h*i+v)))}return l}function aIe(r,e,t){for(var n=T.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],l=e.locToIndex([s,u]);o[2]=e.values[l];var c=r.locToIndex(o);0<=c&&c<r.values.length&&(n.values[a]=r.values[c])}return n}var iIe=ti(function(r,e){return r>e?1:0});var oIe=ti(function(r,e){return r>=e?1:0});var sIe=ti(function(r,e){return r<e?1:0});var uIe=ti(function(r,e){return r<=e?1:0});function lIe(r,e,t){var n=(e-r)/(t-1),a=T.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var cIe=ns(function(r){return Math.log(r)});function fIe(r,e,t,n){for(var a=T.util.getTypedArrayFromDType(n,T.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var l=r[o+u];(Number.isNaN(l)||l>s)&&(s=l)}a[i]=s}return a}var hIe=ti((function(r,e){return Math.max(r,e)}));var pIe=ti((function(r,e){return Math.min(r,e)}));var BO=ti((function(r,e){return r*e}));function dIe(r,e,t){var n=T.util.createScalarValue(-1,t);return BO([],e,n,r,t)}var vIe=ti((function(r,e){return r!==e?1:0}));function mIe(r,e,t,n,a){for(var i=e.length,o=T.util.sizeFromShape(e),s=T.util.computeStrides(e),u=T.util.computeStrides(a),l=T.util.getTypedArrayFromDType(t,T.util.sizeFromShape(a)),c=0;c<o;++c){for(var f=T.util.indexToLoc(c,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=T.util.locToIndex(h,i,u);l[d]=r[c]}return l}function gIe(r,e,t,n){for(var a=Ve(T.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=T.upcastType(e,"int32"),u=T.util.makeZerosTypedArray(T.util.sizeFromShape(i),s),l=T.util.sizeFromShape(o),c=0;c<u.length;++c){for(var f=c*l,h=1,p=0;p<l;++p)h*=t[f+p];u[c]=h}return{outVals:u,outShape:i,outDtype:s}}function yIe(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=T.util.indexToLoc(a,e.length,T.util.computeStrides(e)).join(",");throw new Error("indices["+i+"] = "+n+" is not in [0, "+t+")")}})}function bIe(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function wIe(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});bIe(t,n);for(var u=1,l=0;l<e.length-1;++l){u*=e[l];for(var c=e[l+1],f=1;f<u+1;++f)s[l].push(f*c)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,l=0;l<t.length;++l){var d=t[l],v=l+e.length-1;if(v>=0)for(var m=s[v],g=m[m.length-1]-d[h],y=h;y<p;++y)s[v].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function xIe(r){for(var e=[],t=function(a){var i=r[a].length,o=T.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function bM(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function kIe(r,e,t,n,a,i){var o,s,u=bM(e,2)[1],l=bM(i,2)[1],c=0;try{for(var f=oa(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var v=0;v<n;++v)a[c*l+v]=r[d*u+v];++c}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function SIe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=T.util.getArrayFromDType(t,T.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return kIe(r,e,n,u,o,i),[o,i]}function EIe(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(yIe(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var l=n[0],c=wIe(i,o,r,l),f=c.outSplits,h=c.valueSlices,p=c.numValues,d=xIe(f),v=SIe(t,n,a,h,p);return[d,v[0],v[1]]}var ei=T.backend_util.RowPartitionType,TIe=(function(){function r(e,t,n,a,i,o,s,u,l,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=T.backend_util.getRowPartitionTypesHelper(c),this.raggedRank=T.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===ei.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===ei.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ei.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case ei.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type "+ei[this.getRowPartitionTypeByDimension(e-1)])}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return xM(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;T.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=T.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return T.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],l=Math.min(a,u),c=t[s];c===-1&&(l=0);for(var f=0;f<l;++f)o.push(c),c+=n;for(var f=0;f<u-l;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId="+u+", which is not less than "+t.length);var l=t[u];o.push(l);for(var c=1;c<i;++c){var f=e[c];if(f===u)l>=0&&(++s,s<a?l+=n:l=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId="+f+" which is not less than "+t.length);l=t[f]}o.push(l)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ei.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case ei.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: "+(i.length-1)+" > "+t.length);return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: "+ei[o])}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case ei.FIRST_DIM_SIZE:return e[0];case ei.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ei.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type "+ei[t])}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=xM(n,!1),s=T.util.getArrayFromDType(this.valuesDType,T.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var l=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var c=this.calculateOutputIndex(i-1,l,a[i],n[i]);l=c}this.setOutput(this.raggedRank,l,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=T.util.sizeFromShape(s),l=t.length,c=this.defaultValue;if(c.length!==u&&c.length!==1){var f=this.defaultValueShape;T.tidy(function(){var k=T.reshape(c,f),S=T.broadcastTo(k,s);c=S.dataSync()})}for(var h=0,p=0,d=0,v=0;v<=l;++v){var m=v<l?t[v]:-1;if(m===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),b=(d-p)*u;wM(y,g,b)}if(v>=l){var w=n.length;m=Math.floor(w/u)}if(m>d)if(this.defaultValue.length===1)o.subarray(d*u,m*u).fill(this.defaultValue[0]),d=m;else for(;m>d;){var y=o.slice(d*u);wM(y,c,u),++d}m<0?(h=v+1,p=d):(h=v,p=d,d=p+1)}}},r})();function wM(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function xM(r,e){var t,n,a=[];try{for(var i=oa(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension "+s+" must be >= 0");if(s<-1)throw new Error("Dimension "+s+" must be >= -1");s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function IIe(r,e,t,n,a,i,o,s,u,l){return new TIe(r,e,t,n,a,i,o,s,u,l).compute()}function NIe(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return T.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=T.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var l=1;l<u.length;l++)u[l]=u[l-1]+t;return u}var CIe=ns(function(r){return 1/Math.sqrt(r)});function AIe(r,e,t,n,a,i,o,s,u,l){var c=[n/a,a],f=r.values,h=e.values;if(n===0)return T.buffer(t,e.dtype);var p=T.buffer(c,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var v=[],m=0,g=0;g<o;g++){var y=f[d*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=n/a)throw new Error("Invalid indices: "+v+" does not index into "+t);for(var b=0;b<a;b++)l?p.values[m*a+b]+=h[d*a+b]:p.values[m*a+b]=e.rank===0?h[0]:h[d*a+b]}return p}var _Ie=ns(function(r){return 1/(1+Math.exp(-r))});function DIe(r,e,t,n,a){var i=T.slice_util.isSliceContinous(n,e,t),o=T.util.sizeFromShape(t),s=T.util.computeStrides(n);if(i){var u=T.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var l=a==="string"?T.backend_util.fromUint8ToStringArray(r):r,c=T.buffer(n,a,l),f=T.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(v,m){return v+e[m]});f.set.apply(f,Gr([c.get.apply(c,Gr(d))],p))}return a==="string"?T.backend_util.fromStringArrayToUint8(f.values):f.values}function FIe(r,e,t,n,a,i,o){var s=e[0],u=i[0],l=new Array(u),c=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(T.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=T.util.getArrayFromDType(t,0),p=T.util.getArrayFromDType(a,0);return[h,[0,f],p,l,c]}for(var d=!0,v=0,m=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(T.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(T.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++m[y],d=d&&y>=v,v=y}for(var b=!0,y=0;y<u;++y){var w=m[y]===0;l[y]=w,b=b&&!w,m[y]=Math.max(m[y],1),y>0&&(m[y]+=m[y-1])}if(b&&d){for(var h=r,p=n,g=0;g<s;++g)c[g]=g;return[h,[s,f],p,l,c]}else{for(var k=m[u-1],h=T.util.getArrayFromDType(t,k*f),p=T.util.getArrayFromDType(a,k),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],E=S[y],N=(y===0?0:m[y-1])+E;S[y]++;for(var C=0;C<f;++C)h[N*f+C]=r[g*f+C];p[N]=n[g],c[g]=N}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:m[y-1];h[_*f+0]=y;for(var O=1;O<f;++O)h[_*f+O]=0;p[_]=o}}return[h,[k,f],p,l,c]}}function RIe(r,e,t,n,a){for(var i=T.util.sizeFromShape(n),o=e[0],s=a.length,u=[],l=1,c=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(c!==-1)throw new Error(T.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,f));c=f,u.push(1)}else{if(h<0)throw new Error(T.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));l*=h,u.push(h)}}if(c!==-1){if(l<=0)throw new Error(T.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/l);if(l*p!==i)throw new Error(T.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[c]=p}var d=T.util.sizeFromShape(u);if(d!==i)throw new Error(T.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var v=n.length,m=[];if(v>0){m[v-1]=1;for(var f=v-2;f>=0;--f)m[f]=m[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=T.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,k=0;k<v;++k)w+=r[b*v+k]*m[k];for(var k=0;k<s;++k)y[b*s+k]=Math.trunc(w/g[k]),w%=g[k]}return[y,[o,s],u]}function MIe(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],l=u[1],c=s>0?a[s-1]+1:0,f=c;if(f<0)throw new Error(T.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(E,N){return E*N},1),d=T.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(T.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,m=1,g=0,y=a[v];;){var b=0;if(m<s){if(b=a[m],y===b){++m;continue}if(y>=b)throw new Error(T.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(T.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*l,y*l);for(var w=v;w<m;++w){var k=n[w];if(k<0||k>=u[0])throw new Error(T.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,n[w],u[0]));for(var S=0;S<l;S++)d[y*l+S]+=r[k*l+S]}if(i)for(var S=0;S<l;S++)d[y*l+S]/=m-v;if(v=m,++m,g=y+1,y=b,m>s)break}return g<f&&d.fill(o,g*l,f*l),[d,h]}var OIe=ns(function(r){return Math.sqrt(r)});function PIe(r,e,t,n){for(var a=T.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,Gr([e.get.apply(e,Gr(s))],o))}return a}var LIe=(function(){function r(e,t,n,a,i,o){this.separator=T.util.encodeString(e),this.nGramWidths=t,this.leftPad=T.util.encodeString(n),this.rightPad=T.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(c){var f=u.getPadWidth(o),h=Math.max(0,f-c),p=Math.max(0,f-(i-(c+1))),d=o-(h+p),v=t+(h>0?0:c-f),m=0;m+=h*u.leftPad.length;for(var g=0;g<d;++g)m+=e[v+g].length;m+=p*u.rightPad.length;var y=h+p+d-1;m+=y*u.separator.length,n[a+c]=new Uint8Array(m);for(var b=n[a+c],w=0,k=function(S){return S.forEach(function(E){return b[w++]=E})},g=0;g<h;++g)k(u.leftPad),k(u.separator);for(var g=0;g<d-1;++g)k(e[v+g]),k(u.separator);if(d>0){k(e[v+d-1]);for(var g=0;g<p;++g)k(u.separator),k(u.rightPad)}else{for(var g=0;g<p-1;++g)k(u.rightPad),k(u.separator);k(u.rightPad)}},u=this,l=0;l<i;++l)s(l)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got "+o);for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value "+t[s]+", must be in ["+o+", "+a+"]");o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected "+a+", got "+o)}var l=i-1,c=T.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=l;++s)c[s]=0;return[f,c]}c[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;p.nGramWidths.forEach(function(w){b+=n.getNumNGrams(y,w)}),p.preserveShort&&y>0&&b===0&&(b=1),c[g]=c[g-1]+b},p=this,s=1;s<=l;++s)h(s);for(var d=new Array(c[l]),v=function(g){var y=t[g],b=c[g];if(m.nGramWidths.forEach(function(E){var N=t[g+1]-t[g],C=n.getNumNGrams(N,E);n.createNGrams(e,y,d,b,C,E),b+=C}),m.preserveShort&&b===c[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var k=w+2*m.padWidth,S=1;m.createNGrams(e,y,d,b,S,k)}},m=this,s=0;s<l;++s)v(s);return[d,c]},r})();function BIe(r,e,t,n,a,i,o,s){return new LIe(t,n,a,i,o,s).compute(r,e)}function zIe(r,e,t,n){if(r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function $Ie(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var l=a.length;zIe(r[u],e,t,a);var c=a.length-l;s[u]=c,i+=c,o=Math.max(o,c)}for(var f=T.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var v=0;v<s[u];++v)f[d*2]=u,f[d*2+1]=v,h[d]=a[d],++d;return[f,h,p]}function WIe(r,e){for(var t=T.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=T.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var VIe=ti((function(r,e){return r-e}));function UIe(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=T.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var mh=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function zO(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),l=Math.max(t,Math.floor(e-i*s/a+u)),c=Math.min(n,Math.floor(e+(a-i)*s/a+u));zO(r,e,l,c)}var f=r[e],h=t,p=n;for(T.util.swap(r,t,e),mh(r[n],f)>0&&T.util.swap(r,t,n);h<p;){for(T.util.swap(r,h,p),h++,p--;mh(r[h],f)<0;)h=h+1;for(;mh(r[p],f)>0;)p=p-1}mh(r[t],f)===0?T.util.swap(r,t,p):(p=p+1,T.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function GIe(r,e,t,n,a){for(var i=e[e.length-1],o=Ve([r.length/i,i],2),s=o[0],u=o[1],l=T.util.getTypedArrayFromDType(t,s*n),c=T.util.getTypedArrayFromDType("int32",s*n),f=function(d){var v=d*u,m=r.subarray(v,v+u),g=new Array(m.length);m.forEach(function(S,E){return g[E]={value:S,index:E}}),n<g.length&&(zO(g,n),g=g.slice(0,n)),a&&g.sort(mh);for(var y=d*n,b=l.subarray(y,y+n),w=c.subarray(y,y+n),k=0;k<n;k++)b[k]=g[k].value,w[k]=g[k].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[T.buffer(p,t,l),T.buffer(p,"int32",c)]}function HIe(r,e,t,n){for(var a=T.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),l=new T.TensorBuffer(i,n,r),c=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var v=0;v<i[2];v++)p.push(l.get(d,o,v));h=p.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var m=Object.keys(s).length;s[h]=m,u[o]=m,c.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new T.TensorBuffer(g,n);c.forEach(function(w,k){for(var S=0;S<i[0];S++)for(var E=0;E<i[2];E++)y.set(l.get(S,w,E),S,k,E)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var qIe=jTe,$O=XTe,KIe=YTe,jIe=KTe,XIe=ZTe,YIe=QTe,ZIe=JTe,QIe=eIe,JIe=tIe,eNe=rIe,tNe=nIe,rNe=aIe,nNe=iIe,aNe=oIe,iNe=sIe,oNe=uIe,sNe=lIe,uNe=cIe,lNe=fIe,cNe=hIe,fNe=pIe,hNe=BO,pNe=dIe,dNe=vIe,vNe=gIe,mNe=EIe,gNe=IIe,yNe=NIe,bNe=CIe,wNe=AIe,xNe=_Ie,WO=qTe,kNe=DIe,SNe=FIe,ENe=RIe,VO=MIe,TNe=OIe,INe=PIe,NNe=BIe,CNe=$Ie,ANe=WIe,_Ne=VIe,DNe=UIe,FNe=GIe,Hw=mIe,RNe=HIe;function UO(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return r+"."+t})}function wn(r,e){return e===1?[r]:UO(r,e)}function MNe(r,e){if(r===1)return"rc";for(var t="",n=0;n<r;n++)t+=e[n],n<r-1&&(t+=",");return t}var ONe=(function(){function r(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Sn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=wn("rc",this.rank),n=Zt(this.rank),a=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+a+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+o+`));
          }
        }
      `}}return r.prototype.getSourceCoordsArr=function(e){for(var t=[],n=0;n<=1;n++)for(var a=0;a<=1;a++){for(var i=(n===0?"r":"rp1")+", "+(a===0?"c":"cp1"),o=2;o<this.rank;o++)i=e[e.length-1-o]+","+i;t.push(i)}return t},r.prototype.getOutOfBoundsCondition=function(e){if(this.rank===1)return"rc > "+(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+=e[n]+" >= "+(this.enableShapeUniforms?"outShape["+n+"]":this.outputShape[n]),n<this.rank-1&&(t+="||");return t},r.prototype.getSetup=function(e){if(this.rank===1)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape["+this.rank+" - 1]":this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape["+this.rank+" - 2]":this.outputShape[this.rank-2];return`
      int r = `+t[0]+`;
      int c = `+t[1]+`;
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= `+n+`;
      bool rEdge = rp1 >= `+a+`;
    `},r.prototype.getOutput=function(e){var t=this.getSourceCoordsArr(e);if(this.rank===1){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= "+n+" ? 0. : getA(rc + 1)), 0, 0"}return"getA("+t[0]+`),
            cEdge ? 0. : getA(`+t[1]+`),
            rEdge ? 0. : getA(`+t[2]+`),
            rEdge || cEdge ? 0. : getA(`+t[3]+")"},r})();var GO=(function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Sn(this.outputShape.length);for(var n="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),n+=`
        `+i+`
        `+(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+a+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(a>0?"}":"")+`
      `}this.userCode=`
      `+PNe(t,this.enableShapeUniforms)+`
      `+(this.enableShapeUniforms?Bw():Lw(e))+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+(this.enableShapeUniforms?"outShape[1]":e[1])+`;
        int cols = `+(this.enableShapeUniforms?"outShape[2]":e[2])+`;

        `+n+`

        setOutput(result);
      }
    `}return r})();function PNe(r,e){var t=e?QEe(["r","c","d"],"inputShape"):xu(["r","c","d"],r);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+t+`
      return ivec3(r, c, d);
    }
  `}var LNe=(function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(e,t,n){var a=SM(t,n),i=EM(e,a,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);var o=kM(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}var u;return a===ln.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===ln.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===ln.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===ln.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===ln.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),u},r.prototype.releaseTexture=function(e,t,n,a){if(this.freeTextures!=null){var i=SM(n,a),o=EM(t,i,a);o in this.freeTextures||(this.freeTextures[o]=[]);var s=kM(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,a),u=T.env().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var l=this.usedTextures[o],c=l.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(c,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")");var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: "+this._numBytesAllocated),console.log("Bytes unused: "+this._numBytesFree+" ("+Math.round(100*t)+"%)")}},Object.defineProperty(r.prototype,"numBytesAllocated",{get:function(){return this._numBytesAllocated},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"numBytesFree",{get:function(){return this._numBytesFree},enumerable:!0,configurable:!0}),r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n.texture)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){e.gpgpu.deleteMatrixTexture(a.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}},r})();function BNe(r,e){var t=r;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===r.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error("Unknown internal format "+e)}function kM(r,e,t,n,a){var i=zNe(e,n),o;if(a){var s=Ve(Kl(r[0],r[1]),2),u=s[0],l=s[1];o=u*l}else{var c=Ve(Sh(r[0],r[1]),2),f=c[0],h=c[1];o=f*h}var p=BNe(t,i);return o*p}function zNe(r,e){switch(r){case ln.PACKED_2X2_FLOAT32:return Uw(e);case ln.PACKED_2X2_FLOAT16:return Gw(e);case ln.UNPACKED_FLOAT32:return $w(e);case ln.UNPACKED_FLOAT16:return Ww(e);case ln.PACKED_4X1_UNSIGNED_BYTE:return Vw(e);default:throw new Error("Unknown physical texture type "+r)}}function $Ne(r){return T.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?r?ln.PACKED_2X2_FLOAT32:ln.UNPACKED_FLOAT32:r?ln.PACKED_2X2_FLOAT16:ln.UNPACKED_FLOAT16}function SM(r,e){if(r===Sa.UPLOAD)return ln.PACKED_2X2_FLOAT32;if(r===Sa.RENDER||r==null)return $Ne(e);if(r===Sa.DOWNLOAD||r===Sa.PIXELS)return ln.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function EM(r,e,t){return r[0]+"_"+r[1]+"_"+e+"_"+t}var mo=(function(){function r(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Sn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}return r})(),ri="if (isnan(x)) return x;",WNe="return x;",TM="return abs(x);",VNe="return (x >= 0.0) ? x : (exp(x) - 1.0);",UNe=ri+`
  return (x < 0.0) ? 0.0 : x;
`,GNe=ri+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Wl="return x;",HNe="return 1.0 / (1.0 + exp(-1.0 * x));";var qNe="return x;",KNe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,jNe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,XNe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,YNe="return 1.0 / (1.0 + exp(-1.0 * x));",yu=(function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Sn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}return r})();var ZNe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Sn(this.outputShape.length);var t=e.length,n=wn("rc",t),a=Zt(t),i=MNe(t,n),o=n.slice(-2),s=t<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+a+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `}return r})(),QNe=T.kernel_impls.whereImpl,JNe=1e-7,eCe=1e-4,Xv={};function tCe(r){return r in Xv||(Xv[r]={}),Xv[r]}var rCe=T.env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),nCe=600;function aCe(){return T.env().global.screen==null?1024:T.env().global.screen.height*T.env().global.screen.width*window.devicePixelRatio*nCe/1024/1024}var qw=(function(r){OEe(e,r);function e(t){var n=r.call(this)||this;if(n.pendingRead=new WeakMap,n.pendingDisposal=new WeakSet,n.dataRefCount=new WeakMap,n.numBytesInGPU=0,n.uploadWaitMs=0,n.downloadWaitMs=0,n.lastGlFlushTime=0,n.warnedAboutMemory=!1,n.pendingDeletes=0,n.disposed=!1,!T.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");var a;if(t!=null){if(t instanceof rm)a=t;else{var i=Ti(T.env().getNumber("WEBGL_VERSION"),t);a=new rm(i)}n.binaryCache={},n.gpgpuCreatedLocally=!1}else{var i=Ti(T.env().getNumber("WEBGL_VERSION"));a=new rm(i),n.binaryCache=tCe(T.env().getNumber("WEBGL_VERSION")),n.gpgpuCreatedLocally=!0}return n.gpgpu=a,n.canvas=n.gpgpu.gl.canvas,n.textureManager=new LNe(n.gpgpu),n.numMBBeforeWarning=aCe(),n.texData=new T.DataStorage(n,T.engine()),n}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.numDataIds=function(){return this.texData.numDataIds()-this.pendingDeletes},e.prototype.write=function(t,n,a){if((T.env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||T.env().getBool("DEBUG"))&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:a,values:t,usage:Sa.UPLOAD,refCount:1}),i},e.prototype.refCount=function(t){if(this.texData.has(t)){var n=this.texData.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.texData.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){if(T.env().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:i,values:n,usage:Sa.UPLOAD,refCount:o})},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.readSync=function(t){var n=this.texData.get(t),a=n.values,i=n.dtype,o=n.complexTensorInfos,s=n.slice,u=n.shape,l=n.isPacked;if(s!=null){var c=void 0;l?c=new yu(u,Wl):c=new mo(u,Wl);var f=this.runWebGLProgram(c,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),h}if(a!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return a;var p=this.activeTimers!=null,d;p&&(d=T.util.now());var v;if(i==="complex64"){var m=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);v=T.backend_util.mergeRealAndImagArrays(m,g)}else v=this.getValuesFromTexture(t);return p&&(this.downloadWaitMs+=T.util.now()-d),this.convertAndCacheOnCPU(t,v)},e.prototype.read=function(t){return Gl(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,v,m,g,y,b,w,k,S,E,N,C;return Hl(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(_){return n.push(_)})];if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,l=a.complexTensorInfos,c=a.isPacked,s!=null)return f=void 0,c?f=new yu(o,Wl):f=new mo(o,Wl),h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),[2,p];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(T.env().getBool("DEBUG")&&!T.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&T.env().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,u!=="complex64"&&T.env().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),m=this.texData.get(v.dataId),d=(C=this.gpgpu).createBufferFromTexture.apply(C,Gr([m.texture.texture],Kv(o)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)])];case 3:return y=R.sent(),b=y[0],w=y[1],g=T.backend_util.mergeRealAndImagArrays(b,w),[3,5];case 4:d==null?g=this.getValuesFromTexture(t):(k=T.util.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,k)),R.label=5;case 5:return v!=null&&this.disposeIntermediateTensorInfo(v),d!=null&&(S=this.gpgpu.gl,We(S,function(){return S.deleteBuffer(d)})),E=this.convertAndCacheOnCPU(t,g),N=this.pendingRead.get(t),this.pendingRead.delete(t),N.forEach(function(_){return _(E)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&T.engine().removeDataId(t,this),this.pendingDeletes--),[2,E]}})})},e.prototype.readToGPU=function(t,n){n===void 0&&(n={});var a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,l=a.isPacked,c=a.texture;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){var f=void 0;l?f=new yu(o,Wl):f=new mo(o,Wl);var h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.readToGPU(h,n);return this.disposeIntermediateTensorInfo(h),p}if(c==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(t,n.customTexShape),v=T.engine().makeTensorFromTensorInfo(d),m=this.texData.get(d.dataId);return Object.assign({tensorRef:v},m.texture)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return T.util.decodeString(i)});return T.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return T.buffer(t.shape,t.dtype,n)},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var a=t[n];if(!KM(a))throw T.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+a+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+a+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.isPacked,u=T.util.sizeFromShape(i);if(T.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(t),c=this.texData.get(l.dataId),f=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,Gr([c.texture.texture],Kv(i))).subarray(0,u);return this.disposeIntermediateTensorInfo(l),f}var h=T.env().getBool("WEBGL_PACK")&&s===!0,p=h?Jv(i):i,d=h?new WTe(p):new $Te(p),v=this.runWebGLProgram(d,[{shape:p,dtype:o,dataId:t}],"float32"),m=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeIntermediateTensorInfo(v),g},e.prototype.timerAvailable=function(){return T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0},e.prototype.time=function(t){var n=this,a=this.activeTimers,i=[],o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();var s=T.util.flatten(this.activeTimers.map(function(c){return c.query})).filter(function(c){return c!=null}),u=T.util.flatten(this.activeTimers.map(function(c){return c.name})).filter(function(c){return c!=null});this.activeTimers=a,o&&(this.programTimersStack=null);var l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(function(){return Gl(n,void 0,void 0,function(){var c;return Hl(this,function(f){switch(f.label){case 0:return T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return c=f.sent(),l.kernelMs=T.util.sum(c),l.getExtraProfileInfo=function(){return c.map(function(h,p){return{name:u[p],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:l.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,l]}})})})()},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}},e.prototype.startTimer=function(){return T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:T.util.now(),endMs:null}},e.prototype.endTimer=function(t){return T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=T.util.now(),t)},e.prototype.getQueryTime=function(t){return Gl(this,void 0,void 0,function(){var n;return Hl(this,function(a){return T.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(n=t,[2,n.endMs-n.startMs])})})},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);var a=this.texData.get(t).complexTensorInfos;return a!=null&&(this.disposeData(a.real.dataId,n),this.disposeData(a.imag.dataId,n)),this.texData.delete(t),!0},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),a=n.texture,i=n.dtype,o=n.texShape,s=n.usage,u=n.isPacked,l=n.slice,c=l&&l.origDataId||t,f=this.dataRefCount.get(c);f>1?this.dataRefCount.set(c,f-1):(this.dataRefCount.delete(c),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.shouldExecuteOnCPU=function(t,n){var a=this;return n===void 0&&(n=rCe),T.env().getBool("WEBGL_CPU_FORWARD")&&t.every(function(i){return a.texData.get(i.dataId).texture==null&&T.util.sizeFromShape(i.shape)<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.where=function(t){T.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return QNe(t.shape,n)},e.prototype.packedUnaryOp=function(t,n,a){var i=new yu(t.shape,n),o=this.compileAndRun(i,[t],a);return T.engine().makeTensorFromTensorInfo(o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){var n=WO(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,n)}if(T.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,TM,t.dtype);var a=new mo(t.shape,TM),i=this.compileAndRun(a,[t]);return T.engine().makeTensorFromTensorInfo(i)},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&T.util.isString(a[0])){var o=a.map(function(s){return T.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n,a){return T.engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,a),this)},e.prototype.unpackTensor=function(t){var n=new ZNe(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new ONe(t.shape),a=!0;return this.runWebGLProgram(n,[t],t.dtype,null,a)},e.prototype.packedReshape=function(t,n){var a=Gr([bu(t.shape)],wu(t.shape)),i={dtype:t.dtype,shape:a,dataId:t.dataId},o=Gr([bu(n)],wu(n)),s=new GO(o,a),u=!0,l=[a],c=this.runWebGLProgram(s,[i],t.dtype,l,u);return{dataId:c.dataId,shape:n,dtype:c.dtype}},e.prototype.decode=function(t,n){var a=this.texData.get(t),i=a.isPacked,o=a.shape,s=a.dtype;if(n!=null){var u=T.util.sizeFromShape(o),l=n[0]*n[1]*4;T.util.assert(u<=l,function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."})}var c=Jv(o),f;i?f=new zTe(c):f=new BTe(c);var h=!0,p=[n??Kv(c)],d=this.runWebGLProgram(f,[{shape:c,dtype:s,dataId:t}],s,p,h,n);return{dtype:s,shape:o,dataId:d.dataId}},e.prototype.runWebGLProgram=function(t,n,a,i,o,s){var u=this;o===void 0&&(o=!1);var l=this.makeTensorInfo(t.outputShape,a),c=this.texData.get(l.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===yh.DENSE){var f=s??Kv(t.outputShape);c.texShape=f.map(function(S){return S*2})}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),T.util.sizeFromShape(l.shape)===0)return c.values=T.util.getTypedArrayFromDType(l.dtype,0),l;var h=[],p=n.map(function(S){if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var E=u.texData.get(S.dataId);if(E.texture==null){if(!t.packedInputs&&T.util.sizeFromShape(S.shape)<=T.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:E.values};t.packedInputs&&(E.isPacked=!0,E.shape=S.shape)}if(u.uploadToGPU(S.dataId),!!E.isPacked!=!!t.packedInputs)S=E.isPacked?u.unpackTensor(S):u.packTensor(S),h.push(S),E=u.texData.get(S.dataId);else if(E.isPacked&&!bh(E.shape,S.shape)){var N=S,C=S.shape;S.shape=E.shape,S=u.packedReshape(S,C),h.push(S),E=u.texData.get(S.dataId),N.shape=C}return{shape:S.shape,texData:E,isUniform:!1}});this.uploadToGPU(l.dataId);var d={shape:l.shape,texData:c,isUniform:!1},v=LTe(t,p,d),m=this.getAndSaveBinary(v,function(){return OTe(u.gpgpu,t,p,d)}),g=this.activeTimers!=null,y;g&&(y=this.startTimer()),T.env().get("ENGINE_COMPILE_ONLY")||PTe(this.gpgpu,m,p,d,i),h.forEach(function(S){return u.disposeIntermediateTensorInfo(S)}),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));var b=T.env().get("WEBGL_FLUSH_THRESHOLD");if(b>0){var w=T.util.now();w-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=w)}if(!T.env().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&o===!1){var k=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),k}return l},e.prototype.compileAndRun=function(t,n,a,i,o){o===void 0&&(o=!1),a=a||n[0].dtype;var s=this.runWebGLProgram(t,n,a,i,o);return s},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;if(!this.disposed){if(!T.env().getBool("IS_TEST")){var n=Object.keys(this.binaryCache);n.forEach(function(a){t.gpgpu.deleteProgram(t.binaryCache[a].webGLProgram),delete t.binaryCache[a]})}this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=T.tidy(function(){if(!T.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=T.env().getBool("DEBUG");T.env().set("DEBUG",!1);var a=t.abs(T.scalar(1e-8)).dataSync()[0];if(T.env().set("DEBUG",n),a>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?JNe:eCe},e.prototype.uploadToGPU=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.values,u=a.texture,l=a.usage,c=a.isPacked;if(u==null){var f=this.activeTimers!=null,h;f&&(h=T.util.now());var p=a.texShape;if(p==null&&(p=cO(i,c),a.texShape=p),s!=null){var d=Jv(i),v=void 0,m=p[1],g=p[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(c||!y)&&(n=Ve(Kl(p[0],p[1]),2),m=n[0],g=n[1]),c?v=new UTe(d,y):v=new VTe(d,y);var b=y?[g,m]:p,w=this.makeTensorInfo(b,o),k=this.texData.get(w.dataId);y?k.usage=Sa.PIXELS:k.usage=Sa.UPLOAD,k.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),m,g,s);var S=[[g,m]],E=!0,N=this.runWebGLProgram(v,[w],o,S,E),C=this.texData.get(N.dataId);a.texShape=C.texShape,a.isPacked=C.isPacked,a.usage=C.usage,T.env().get("ENGINE_COMPILE_ONLY")?this.disposeData(N.dataId):(a.texture=C.texture,a.values=null,this.texData.delete(N.dataId)),this.disposeIntermediateTensorInfo(w),f&&(this.uploadWaitMs+=T.util.now()-h)}else{var R=this.acquireTexture(p,l,o,c);a.texture=R}}},e.prototype.convertAndCacheOnCPU=function(t,n){var a=this.texData.get(t),i=a.dtype;return this.releaseGPUData(t),n!=null&&(a.values=iCe(n,i)),a.values},e.prototype.acquireTexture=function(t,n,a,i){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,i)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*T.util.bytesPerElement(n)},e.prototype.checkCompileCompletion=function(){var t,n;try{for(var a=oa(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Ve(i.value,2),s=o[1];this.checkCompletion_(s)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.checkCompileCompletionAsync=function(){return Gl(this,void 0,void 0,function(){var t,n,a,i,c,o,s,u,l,c,f,h,p,d,v=this;return Hl(this,function(m){if(t=[],this.gpgpu.parallelCompilationExtension){try{for(n=oa(Object.entries(this.binaryCache)),a=n.next();!a.done;a=n.next())i=Ve(a.value,2),c=i[1],t.push(this.checkCompletionAsync_(c))}catch(g){f={error:g}}finally{try{a&&!a.done&&(h=n.return)&&h.call(n)}finally{if(f)throw f.error}}return[2,Promise.all(t)]}else{o=function(g){var y=new Promise(function(b){try{v.checkCompletion_(g),b(!0)}catch(w){throw w}});t.push(y)};try{for(s=oa(Object.entries(this.binaryCache)),u=s.next();!u.done;u=s.next())l=Ve(u.value,2),c=l[1],o(c)}catch(g){p={error:g}}finally{try{u&&!u.done&&(d=s.return)&&d.call(s)}finally{if(p)throw p.error}}return[2,Promise.all(t)]}})})},e.prototype.checkCompletionAsync_=function(t){return Gl(this,void 0,void 0,function(){return Hl(this,function(n){switch(n.label){case 0:return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?[2,this.checkCompletion_(t)]:[3,1];case 1:return[4,T.nextFrame()];case 2:return n.sent(),[2,this.checkCompletionAsync_(t)]}})})},e.prototype.checkCompletion_=function(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Pw(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0},e.prototype.getUniformLocations=function(){var t,n;try{for(var a=oa(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Ve(i.value,2),s=o[1],u=xO(this.gpgpu,s.program,s.webGLProgram),l=u.uniformLocations,c=u.customUniformLocations,f=u.infLoc,h=u.nanLoc,p=u.inShapesLocations,d=u.inTexShapesLocations,v=u.outShapeLocation,m=u.outShapeStridesLocation,g=u.outTexShapeLocation;s.uniformLocations=l,s.customUniformLocations=c,s.infLoc=f,s.nanLoc=h,s.inShapesLocations=p,s.inTexShapesLocations=d,s.outShapeLocation=v,s.outShapeStridesLocation=m,s.outTexShapeLocation=g}}catch(y){t={error:y}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e})(T.KernelBackend);qw.nextDataId=0;function iCe(r,e){if(e==="float32"||e==="complex64")return r;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(r.length):new Uint8Array(r.length),n=0;n<t.length;++n)t[n]=Math.round(r[n]);return t}else throw new Error("Unknown dtype "+e)}var oCe="3.21.0";function HO(){T.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}T.device_util.isBrowser()&&T.registerBackend("webgl",function(){return new qw},2);var sCe={forceHalfFloat:HO};var Kw=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,ql=(function(){function r(e,t,n){this.variableNames=["A","B"],this.outputShape=T.backend_util.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=Sn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}return r})();var Th=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,Ih=(function(){function r(e,t,n,a){a===void 0&&(a=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=T.backend_util.assertAndGetBroadcastShape(t,n);var i=this.outputShape.length;this.enableShapeUniforms=Sn(i);var o="";if(a)if(i===0||T.util.sizeFromShape(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{var s=Zt(i);if(o=`
          `+s+` coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var u=wn("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (`+u[i-2]+" + 1) >= outShape["+i+` - 2];
            bool nextColOutOfBounds =
              (`+u[i-1]+" + 1) >= outShape["+i+` - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (`+u[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+u[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `}return r})();function sa(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var uCe={kernelName:T.Identity,backendName:"webgl",kernelFunc:sa};function as(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.makeTensorInfo(n.shape,"complex64"),o=t.texData.get(i.dataId),s=sa({inputs:{x:n},backend:t}),u=sa({inputs:{x:a},backend:t});return o.complexTensorInfos={real:s,imag:u},i}var lCe={kernelName:T.Complex,backendName:"webgl",kernelFunc:as};var qO="return (a < 0.) ? b * a : a;",KO=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function cCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha,o=t.makeTensorInfo([],"float32",T.util.createScalarValue(i,"float32")),s=T.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ih(KO,a.shape,o.shape):new ql(qO,a.shape,o.shape),u=t.runWebGLProgram(s,[a,o],"float32");return t.disposeIntermediateTensorInfo(o),u}var fCe={kernelName:T.LeakyRelu,backendName:"webgl",kernelFunc:cCe};var jO="return (a < 0.) ? b * a : a;",XO=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function hCe(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha,i=T.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ih(XO,n.shape,a.shape):new ql(jO,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],"float32")}var pCe={kernelName:T.Prelu,backendName:"webgl",kernelFunc:hCe},Jl="if (isnan(x)) return x;";function It(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.cpuKernelImpl,a=r.dtype;return function(i){var o=i.inputs,s=i.backend,u=o.x,l=s,c=a||u.dtype;if(l.shouldExecuteOnCPU([u])&&n!=null){var f=l.texData.get(u.dataId),h=n(f.values,c);return l.makeTensorInfo(u.shape,c,h)}var p=T.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,d;return p?d=new yu(u.shape,t):d=new mo(u.shape,e),l.runWebGLProgram(d,[u],c)}}function cn(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.checkOutOfBounds,a=n===void 0?!1:n,i=r.supportsComplex,o=i===void 0?!1:i,s=r.cpuKernelImpl,u=r.dtype;return function(l){var c=l.inputs,f=l.backend,h=c.a,p=c.b,d=f;if(o&&h.dtype==="complex64"){var v=d.texData.get(h.dataId),m=d.texData.get(p.dataId),g=Ve([[v.complexTensorInfos.real,m.complexTensorInfos.real],[v.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(function(G){var M=Ve(G,2),$=M[0],K=M[1],j={dataId:$.dataId,dtype:$.dtype,shape:h.shape},te={dataId:K.dataId,dtype:K.dtype,shape:p.shape},Q=new ql(e,h.shape,p.shape);return d.runWebGLProgram(Q,[j,te],T.upcastType($.dtype,K.dtype))}),2),y=g[0],b=g[1],w=as({inputs:{real:y,imag:b},backend:d});return d.disposeIntermediateTensorInfo(y),d.disposeIntermediateTensorInfo(b),w}var k=u||T.upcastType(h.dtype,p.dtype);if((h.dtype==="string"||p.dtype==="string"||d.shouldExecuteOnCPU([h,p]))&&s!=null){var S=d.texData.get(h.dataId).values,E=d.texData.get(p.dataId).values,N=h.dtype==="string"?T.backend_util.fromUint8ToStringArray(S):S,C=h.dtype==="string"?T.backend_util.fromUint8ToStringArray(E):E,R=Ve(s(h.shape,p.shape,N,C,k),2),_=R[0],O=R[1],P=d.makeTensorInfo(O,k),B=d.texData.get(P.dataId);return B.values=_,P}var W=T.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,L;return W?L=new Ih(t,h.shape,p.shape,a):L=new ql(e,h.shape,p.shape),d.runWebGLProgram(L,[h,p],k)}}function wh(r,e){if(e===void 0&&(e=!1),r==="linear")return e?qNe:WNe;if(r==="relu")return e?jNe:UNe;if(r==="elu")return e?KNe:VNe;if(r==="relu6")return e?XNe:GNe;if(r==="prelu")return e?XO:jO;if(r==="leakyrelu")return e?KO:qO;if(r==="sigmoid")return e?YNe:HNe;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var YO=(function(){function r(e,t,n,a,i,o,s,u,l){a===void 0&&(a=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),s===void 0&&(s=null),u===void 0&&(u=!1),l===void 0&&(l=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Sn(this.outputShape.length);var c=a?e[1]:e[2],f=Math.ceil(c/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",d=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";s&&(u?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+s+`
        }`:l?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `+s+`
        }`:m=`vec4 activation(vec4 x) {
          `+s+`
        }`,g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");var b="rc.x",w="rc.x";e[0]<t[0]?b="int(min(float(rc.x), "+(e[0]-1)+".))":t[0]<e[0]&&(w="int(min(float(rc.x), "+(t[0]-1)+".))"),this.userCode=`
      `+m+`
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = `+f+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+f+`; i++) {
          int batchA = `+b+`;
          int batchB = `+w+`;
          vec4 a = getMatrixA(batchA, `+h+`);
          vec4 b = getMatrixB(batchB, `+p+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+v[0]+`);
          result += (`+d[1]+" * "+v[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+y+`

        `+g+`

        setOutput(result);
      }
    `}return r})();var IM={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},NM=(function(){function r(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=T.backend_util.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}return r})(),CM="return a * b;";function jw(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=T.backend_util.upcastType(n.dtype,a.dtype);if(n.dtype==="complex64"){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),u=new NM(IM.REAL,n.shape,a.shape),l=new NM(IM.IMAG,n.shape,a.shape),c=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:n.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape}],f=t.runWebGLProgram(u,c,"float32"),h=t.runWebGLProgram(l,c,"float32"),p=as({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}if(t.shouldExecuteOnCPU([n,a])){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),d=Ve(hNe(n.shape,a.shape,o.values,s.values,i),2),v=d[0],m=d[1],g=t.makeTensorInfo(m,i),y=t.texData.get(g.dataId);return y.values=v,g}var b;return T.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?b=new Ih(CM,n.shape,a.shape):b=new ql(CM,n.shape,a.shape),t.runWebGLProgram(b,[n,a],i)}var dCe={kernelName:T.Multiply,backendName:"webgl",kernelFunc:jw};function vCe(r,e,t){var n=Gr([bu(r.shape)],wu(r.shape)),a={dtype:r.dtype,shape:n,dataId:r.dataId},i=Gr([bu(e)],wu(e)),o=new GO(i,n),s=!0,u=[n],l=t.runWebGLProgram(o,[a],r.dtype,u,s);return{dataId:l.dataId,shape:e,dtype:l.dtype}}function Me(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=t,s=T.util.sizeFromShape(a.shape),u=T.util.inferFromImplicitShape(i,s),l=T.util.sizeFromShape(u);T.util.assert(s===l,function(){return"The new shape ("+u+") has "+l+" elements and the old "+("shape ("+a.shape+") has "+s+" elements. The new shape and old ")+"shape must have the same number of elements."});var c=o.texData.get(a.dataId);return c.isPacked&&!bh(a.shape,u)&&!(c.texture!==null&&bh(c.shape,u))?vCe(a,u,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var mCe={kernelName:T.Reshape,backendName:"webgl",kernelFunc:Me};var AM=(function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s=Math.floor(n/4)*4,u=n%4,l="sumValue += dot(values, ones);";if(t!=null){var c=1/t;l="sumValue += dot(values * "+(T.util.isInt(c)?c.toPrecision(2):c)+", ones);"}var f="";i%n>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          `+l+`
        }
        setOutput(sumValue);
      }
    `}return r})();var gCe=(function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var l=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");var c=Math.floor(n/4)*4,f=n%4,h=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+u+`(values, minMaxValue);
        if (`+(t==="min")+" || "+(t==="max")+`) {
          minMaxValue = `+u+`(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";t==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(f===1)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(f===2)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(f===3)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+l+`);
      }
    `}return r})();function yCe(r){for(var e=[];e.length===0||e[e.length-1].outSize!==1;){var t=e.length?e[e.length-1].outSize:r[1],n=T.backend_util.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:n,outSize:Math.ceil(t/n)})}return e}function Su(r,e,t,n){for(var a=yCe(r.shape),i=r,o=0;o<a.length;o++){var s=a[o],u=s.inSize,l=s.windowSize,c=s.outSize,f=void 0,h=void 0;t==="mean"?f=o===0?new AM({windowSize:l,inSize:u,batchSize:r.shape[0],outSize:c},u):new AM({windowSize:l,inSize:u,batchSize:r.shape[0],outSize:c}):f=new gCe({windowSize:l,inSize:u,batchSize:r.shape[0],outSize:c},t),h=i,i=n.runWebGLProgram(f,[i],e),h.dataId!==r.dataId&&n.disposeIntermediateTensorInfo(h)}return i}var bCe=(function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;var i=Zt(this.rank),o=wCe(t);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `}return r})();function wCe(r){var e=r.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e),a=0;a<r.length;a++)n[r[a]]=t[a];return n.join()}var xCe=(function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");for(var i=Zt(this.rank),o=UO("rc",this.rank),s=new Array(this.rank),a=0;a<t.length;a++)s[t[a]]=o[a];var u="vec2("+s.slice(-2).join()+")",l="++"+o[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+s.join()+"), "+u+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+l+`) {
        result[1] = `+c+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+l+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `}return r})();function um(r,e,t){var n=T.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new xCe(r.shape,e):new bCe(r.shape,e);return t.runWebGLProgram(n,[r],r.dtype)}function kCe(r,e,t,n){var a=e,i=r.shape.length,o=T.util.parseAxisParam(a,r.shape),s=o,u=T.backend_util.getAxesPermutation(s,i),l=u!=null,c=r;l&&(c=um(r,u,n),s=T.backend_util.getInnerMostAxes(s.length,i)),T.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=Ve(T.backend_util.computeOutAndReduceShapes(c.shape,s),2),h=f[0],p=f[1],d=h;t&&(d=T.backend_util.expandShapeToKeepDim(h,o));var v=T.util.sizeFromShape(p),m=T.util.sizeFromShape(r.shape),g=m/v,y=Me({inputs:{x:c},attrs:{shape:[g,v]},backend:n}),b=T.sumOutType(r.dtype),w=Su(y,b,"sum",n),k=Me({inputs:{x:w},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w),l&&n.disposeIntermediateTensorInfo(c),k}function lm(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;return kCe(a,i,o,t)}var SCe={kernelName:T.Sum,backendName:"webgl",kernelFunc:lm};function xn(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.perm,o=t,s=a.shape.length,u=new Array(s),l=0;l<u.length;l++)u[l]=a.shape[i[l]];var c;if(o.shouldExecuteOnCPU([a])){var f=o.texData.get(a.dataId),h=f.values,p=Hw(h,a.shape,a.dtype,i,u);c=o.makeTensorInfo(u,a.dtype);var d=o.texData.get(c.dataId);d.values=p}else c=um(a,i,o);return c}var ECe={kernelName:T.Transpose,backendName:"webgl",kernelFunc:xn},ZO=1e3;function am(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=r.transposeB,s=r.backend,u=r.bias,l=u===void 0?null:u,c=r.preluActivationWeights,f=c===void 0?null:c,h=r.leakyreluAlpha,p=h===void 0?0:h,d=r.activation,v=d===void 0?null:d,m=n.shape.length,g=a.shape.length,y=i?n.shape[m-2]:n.shape[m-1],b=o?a.shape[g-1]:a.shape[g-2],w=i?n.shape[m-1]:n.shape[m-2],k=o?a.shape[g-2]:a.shape[g-1],S=n.shape.slice(0,-2),E=a.shape.slice(0,-2),N=T.util.sizeFromShape(S),C=T.util.sizeFromShape(E),R=T.broadcast_util.assertAndGetBroadcastShape(n.shape.slice(0,-2),a.shape.slice(0,-2)),_=R.concat([w,k]);T.util.assert(y===b,function(){return"Error in matMul: inner shapes ("+y+") and ("+(b+") of Tensors with shapes "+n.shape+" and ")+(a.shape+" and transposeA="+i)+(" and transposeB="+o+" must match.")});var O=i?[N,y,w]:[N,w,y],P=o?[C,k,b]:[C,b,k],B=Me({inputs:{x:n},backend:s,attrs:{shape:O}}),W=Me({inputs:{x:a},backend:s,attrs:{shape:P}}),L=[B,W],G=Math.max(N,C),M=i?B.shape[1]:B.shape[2],$=l!=null,K=f!=null,j=v==="leakyrelu",te=v!=null?wh(v,!0):null,Q=$||K||j||te!=null,ie;if((w===1||k===1)&&M>ZO&&Q===!1){var le=B,de=W;i&&(le=xn({inputs:{x:B},backend:s,attrs:{perm:[0,2,1]}}),L.push(le)),o&&(de=xn({inputs:{x:W},backend:s,attrs:{perm:[0,2,1]}}),L.push(de));var we=k!==1,pe=k===1,Se=le;we&&(Se=Me({inputs:{x:le},backend:s,attrs:{shape:[G,M,1]}}),L.push(Se));var Ee=k===1?2:1,Ne=de;pe&&(Ne=Me({inputs:{x:de},backend:s,attrs:{shape:[G,1,M]}}),L.push(Ne));var Ge=jw({inputs:{a:Se,b:Ne},backend:s});ie=lm({inputs:{x:Ge},backend:s,attrs:{axis:Ee,keepDims:!0}}),L.push(Ge)}else{var Ke=T.upcastType(n.dtype,a.dtype),Ue=new YO(O,P,[G,w,k],i,o,$,te,K,j),tt=[B,W];if(l!=null&&tt.push(l),K&&tt.push(f),j){var st=s.makeTensorInfo([],"float32",T.util.createScalarValue(p,"float32"));tt.push(st),L.push(st)}ie=s.runWebGLProgram(Ue,tt,Ke)}var je=Me({inputs:{x:ie},backend:s,attrs:{shape:_}});L.push(ie);try{for(var Xe=oa(L),at=Xe.next();!at.done;at=Xe.next()){var it=at.value;s.disposeIntermediateTensorInfo(it)}}catch(Kt){e={error:Kt}}finally{try{at&&!at.done&&(t=Xe.return)&&t.call(Xe)}finally{if(e)throw e.error}}return je}function TCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=e.bias,s=e.preluActivationWeights,u=n.transposeA,l=n.transposeB,c=n.activation,f=n.leakyreluAlpha;return am({a,b:i,transposeA:u,transposeB:l,backend:t,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:c})}var ICe={kernelName:T._FusedMatMul,backendName:"webgl",kernelFunc:TCe};var _M="return abs(x);";function NCe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){var a=t.texData.get(n.dataId),i=WO(a.values);return t.makeTensorInfo(n.shape,n.dtype,i)}var o;return T.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new yu(n.shape,_M):o=new mo(n.shape,_M),t.runWebGLProgram(o,[n],n.dtype)}var CCe={kernelName:T.Abs,backendName:"webgl",kernelFunc:NCe};var ACe=ri+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,_Ce=It({opSnippet:ACe}),DCe={kernelName:T.Acos,backendName:"webgl",kernelFunc:_Ce};var FCe=ri+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,RCe=It({opSnippet:FCe}),MCe={kernelName:T.Acosh,backendName:"webgl",kernelFunc:RCe};var DM="return a + b;",OCe=cn({opSnippet:DM,packedOpSnippet:DM,supportsComplex:!0,cpuKernelImpl:qIe}),PCe={kernelName:T.Add,backendName:"webgl",kernelFunc:OCe};var LCe=(function(){function r(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("float v"+i+" = get"+i+"AtOutCoords();")});var a=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+a+`;
        setOutput(result);
      }
    `}return r})();var BCe=(function(){function r(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var a=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+a+`;
        setOutput(result);
      }
    `}return r})();function nm(r){var e=r.inputs,t=r.backend,n=e;if(n.length===1)return sa({inputs:{x:n[0]},backend:t});if(n.length>T.env().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),i=nm({inputs:n.slice(0,a),backend:t}),o=nm({inputs:n.slice(a),backend:t});return nm({inputs:[i,o],backend:t})}var s=n.map(function(f){return f.dtype}).reduce(function(f,h){return T.upcastType(f,h)}),u=n.map(function(f){return f.shape}),l=T.env().getBool("WEBGL_PACK"),c=l?new BCe(n[0].shape,u):new LCe(n[0].shape,u);return t.runWebGLProgram(c,n,s)}var zCe={kernelName:T.AddN,backendName:"webgl",kernelFunc:nm};function $Ce(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=T.util.parseAxisParam(i,a.shape),l=u,c=T.backend_util.getAxesPermutation(l,s),f=a;c!=null&&(f=xn({inputs:{x:a},backend:t,attrs:{perm:c}}),l=T.backend_util.getInnerMostAxes(l.length,s)),T.backend_util.assertAxesAreInnerMostDims("all",l,s);var h=Ve(T.backend_util.computeOutAndReduceShapes(f.shape,l),2),p=h[0],d=h[1],v=T.util.sizeFromShape(d),m=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=Su(m,m.dtype,"all",t),y;if(o){var b=T.backend_util.expandShapeToKeepDim(p,u);y=Me({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Me({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),c!=null&&t.disposeIntermediateTensorInfo(f),y}var WCe={kernelName:T.All,backendName:"webgl",kernelFunc:$Ce};function VCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=T.util.parseAxisParam(i,a.shape),l=u,c=T.backend_util.getAxesPermutation(l,s),f=a;c!=null&&(f=xn({inputs:{x:a},backend:t,attrs:{perm:c}}),l=T.backend_util.getInnerMostAxes(l.length,s)),T.backend_util.assertAxesAreInnerMostDims("any",l,s);var h=Ve(T.backend_util.computeOutAndReduceShapes(f.shape,l),2),p=h[0],d=h[1],v=T.util.sizeFromShape(d),m=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=Su(m,m.dtype,"any",t),y;if(o){var b=T.backend_util.expandShapeToKeepDim(p,u);y=Me({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Me({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),c!=null&&t.disposeIntermediateTensorInfo(f),y}var UCe={kernelName:T.Any,backendName:"webgl",kernelFunc:VCe};var GCe=(function(){function r(e,t,n){this.variableNames=["A"];var a=e.windowSize,i=e.batchSize,o=e.outSize;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+a+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+a+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}return r})();var HCe=(function(){function r(e,t,n,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T.util.assert(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s=this.outputShape,u=s.length,l=Zt(u),c=wn("coords",u),f,h;if(o===1){h=u+1;var p=Zt(h);f=`
        `+p+" sourceLocR = "+p+"("+c.join()+`, 0);
        ++`+c[u-1]+`;
        `+p+" sourceLocG = "+p+"("+c.join()+`, 0);
        ++`+c[u-2]+`;
        `+p+" sourceLocA = "+p+"("+c.join()+`, 0);
        --`+c[u-1]+`;
        `+p+" sourceLocB = "+p+"("+c.join()+`, 0);
        --`+c[u-2]+";"}else h=u,f=`
        `+l+` sourceLocR = coords;
        ++`+c[u-1]+`;
        `+l+` sourceLocG = coords;
        ++`+c[u-2]+`;
        `+l+` sourceLocA = coords;
        --`+c[u-1]+`;
        `+l+` sourceLocB = coords;
        --`+c[u-2]+";";var d=["x","y","z","w","u","v"].slice(0,h),v="."+d[h-1],m=d.map(function(C){return"int "+C}),g=wn("sourceLocR",h-1).concat("inIdx.r"),y=wn("sourceLocG",h-1).concat("inIdx.g"),b=wn("sourceLocB",h-1).concat("inIdx.b"),w=wn("sourceLocA",h-1).concat("inIdx.a"),k=n==="max"?"greaterThan":"lessThan",S=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+w.join()+")));",E=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+w.join()+") : 0.)",N=a?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+d.join()+`),
                                          vec2(`+d.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+d.join()+`),
                               vec2(`+d.slice(-2).join()+`));
      }
      `+N+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+c[u-1]+" < "+(s[u-1]-1)+`;
        bool hasNextRow = `+c[u-2]+" < "+(s[u-2]-1)+`;
        `+f+`
        ivec4 srcIdx = ivec4(sourceLocR`+v+", sourceLocG"+v+`,
          sourceLocB`+v+", sourceLocA"+v+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+E+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+S+`
          vec4 candidate = `+E+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+k+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}return r})();function QO(r,e,t,n){n===void 0&&(n=null);var a=e.shape[0],i=e.shape[1];n!=null&&(a=n.shape[0],i=n.shape[1]);var o=T.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new GCe(s,t,n==null),l=[e];n!=null&&l.push(n);var c=r.runWebGLProgram(u,l,"int32");if(c.shape[1]===1)return c;var f=QO(r,e,t,c);return r.disposeIntermediateTensorInfo(c),f}function JO(r,e,t,n){n===void 0&&(n=null);var a=n!=null?n.shape:e.shape,i=a[a.length-1],o=T.backend_util.computeOptimalWindowSize(i),s=new HCe(a,o,t,n==null),u=n==null?[e]:[e,n],l=r.runWebGLProgram(s,u,"int32");if(l.shape.length===e.shape.length){var c=JO(r,e,t,l);return r.disposeIntermediateTensorInfo(l),c}return l}function eP(r,e,t,n){var a=[t];if(T.backend_util.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),a,e.shape.length),!T.env().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){var i=[],o=r.texData.get(e.dataId),s=o!==null&&o.isPacked,u=e;s&&(u=r.unpackTensor(e),i.push(u));var l=Ve(T.backend_util.computeOutAndReduceShapes(u.shape,a),2),c=l[0],f=l[1],h=T.util.sizeFromShape(f),p=Me({inputs:{x:u},backend:r,attrs:{shape:[-1,h]}});i.push(p);var d=QO(r,p,n);i.push(d);var v=Me({inputs:{x:d},backend:r,attrs:{shape:c}});return i.forEach(function(m){return r.disposeIntermediateTensorInfo(m)}),v}return JO(r,e,n)}function qCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=T.util.parseAxisParam(i,a.shape),s=T.backend_util.getAxesPermutation(o,a.shape.length),u=a,l=[];s!=null&&(u=xn({inputs:{x:a},backend:t,attrs:{perm:s}}),l.push(u),o=T.backend_util.getInnerMostAxes(o.length,u.shape.length)),T.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var c=eP(t,u,o[0],"max");return l.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),c}var KCe={kernelName:T.ArgMax,backendName:"webgl",kernelFunc:qCe};function jCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=T.util.parseAxisParam(i,a.shape),s=T.backend_util.getAxesPermutation(o,a.shape.length),u=a,l=[];s!=null&&(u=xn({inputs:{x:a},backend:t,attrs:{perm:s}}),l.push(u),o=T.backend_util.getInnerMostAxes(o.length,u.shape.length)),T.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var c=eP(t,u,o[0],"min");return l.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),c}var XCe={kernelName:T.ArgMin,backendName:"webgl",kernelFunc:jCe};var YCe=ri+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,ZCe=It({opSnippet:YCe}),QCe={kernelName:T.Asin,backendName:"webgl",kernelFunc:ZCe};var JCe=ri+"return log(x + sqrt(x * x + 1.0));",eAe=It({opSnippet:JCe}),tAe={kernelName:T.Asinh,backendName:"webgl",kernelFunc:eAe};var rAe=ri+`
  return atan(x);
`,nAe=It({opSnippet:rAe}),aAe={kernelName:T.Atan,backendName:"webgl",kernelFunc:nAe};var iAe=Kw+`
  return atan(a, b);
`,oAe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Th+`
  return result;
`,sAe=cn({opSnippet:iAe,packedOpSnippet:oAe}),uAe={kernelName:T.Atan2,backendName:"webgl",kernelFunc:sAe};var lAe=ri+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,cAe=It({opSnippet:lAe}),fAe={kernelName:T.Atanh,backendName:"webgl",kernelFunc:cAe};var xh=(function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var v=t==="avg",m="((batch  * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + d",g="(xR * "+e.inWidth+" + xC) * "+e.inChannels+" + d",y="0.0";if(v||(y="-1.0 / 1e-20"),n){var b=">=";this.userCode=`
        const ivec2 strides = ivec2(`+s+", "+u+`);
        const ivec2 pads = ivec2(`+p+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+f+`;
              wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+c+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value `+b+` currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(a?i?m:g:"wR * "+h+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}var w="max",k=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(k="avgValue / count");var S=Math.floor(o/4)*4,E=o%4,N=`
      if (`+v+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `+w+`(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+s+", "+u+`);
      const ivec2 pads = ivec2(`+p+", "+d+`);
      const float initializationValue = `+y+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+y+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+f+`;
            wR += `+l+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+S+`; wC += 4) {
            int xC = xCCorner + wC * `+c+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+c+`, d),
              getValue(batch, xR, xC + 2 * `+c+`, d),
              getValue(batch, xR, xC + 3 * `+c+`, d)
            );

            `+N+`
          }

          int xC = xCCorner + `+S+`;
          if (`+(E===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+N+`
          } else if (`+(E===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+c+`, d),
              initializationValue,
              initializationValue
            );

            `+N+`
          } else if (`+(E===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+c+`, d),
              getValue(batch, xR, xC + 2 * `+c+`, d),
              initializationValue
            );

            `+N+`
          }
        }
        setOutput(`+k+`);
      }
    `}return r})(),Xw=(function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,u=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,f=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,d=e.effectiveFilterHeight,v=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var b=t==="avg",w="0.0";if(b||(w="-1.0 / 1e-20"),n){var k=">=";this.userCode=`
        const ivec3 strides =
            ivec3(`+s+", "+u+", "+l+`);
        const ivec3 pads = ivec3(`+m+", "+g+", "+y+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+p+`;
              wD += `+c+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+f+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+v+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value `+k+` currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(a?i?"(((batch * "+e.inDepth+" + xD) * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"((xD * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"wD * "+d+" * "+v+` +
                      wR * `+v+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}var S="max",E=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(E="avgValue / count");var N=Math.floor(o/4)*4,C=o%4,R=`
      if (`+b+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `+S+`(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+s+", "+u+", "+l+`);
      const ivec3 pads = ivec3(`+m+", "+g+", "+y+`);
      const float initializationValue = `+w+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+w+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+p+`;
            wD += `+c+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+f+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+N+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+R+`
            }

            int xC = xCCorner + `+N+`;
            if (`+(C===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+R+`
            } else if (`+(C===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+R+`
            } else if (`+(C===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+R+`
            }
          }
          setOutput(`+E+`);
        }
      }
    `}return r})();function hAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;jl(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=1;T.util.assert(T.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+l+"'")});var c=T.backend_util.computePool2DInfo(a.shape,i,o,l,s,u);if(c.filterWidth===1&&c.filterHeight===1&&T.util.arraysEqual(c.inShape,c.outShape))return sa({inputs:{x:a},backend:t});var f=new xh(c,"avg",!1);return t.runWebGLProgram(f,[a],"float32")}var pAe={kernelName:T.AvgPool,backendName:"webgl",kernelFunc:hAe};function dAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=n.dataFormat,c=[1,1,1],f=T.backend_util.computePool3DInfo(a.shape,i,o,c,s,u,l),h=new Xw(f,"avg",!1);return t.runWebGLProgram(h,[a],"float32")}var vAe={kernelName:T.AvgPool3D,backendName:"webgl",kernelFunc:dAe};var mAe=(function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=u-1-e.padInfo.top,f=l-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+f+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+a+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+l+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}return r})(),gAe=(function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=f-1-e.padInfo.front,v=h-1-e.padInfo.top,m=p-1-e.padInfo.left,g=1/(t*n*a);this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+v+", "+m+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+f+`;
            wD += `+u+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+l+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+p+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r})();function yAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,l=n.pad,c=n.dimRoundingMode,f=[1,1,1],h=T.backend_util.computePool3DInfo(o.shape,s,u,f,l,c),p=new gAe(h);return t.runWebGLProgram(p,[a],o.dtype)}var bAe={kernelName:T.AvgPool3DGrad,backendName:"webgl",kernelFunc:yAe};function wAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;jl([a,i],"avgPoolGrad");var s=n.filterSize,u=n.strides,l=n.pad,c=T.backend_util.computePool2DInfo(o.shape,s,u,1,l),f=new mAe(c);return t.runWebGLProgram(f,[a],o.dtype)}var xAe={kernelName:T.AvgPoolGrad,backendName:"webgl",kernelFunc:wAe};function kAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;return am({a,b:i,transposeA:o,transposeB:s,backend:t})}var SAe={kernelName:T.BatchMatMul,backendName:"webgl",kernelFunc:kAe};var EAe=(function(){function r(e,t,n,a,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],T.backend_util.assertAndGetBroadcastShape(e,t),T.backend_util.assertAndGetBroadcastShape(e,n);var s="0.0";a!=null&&(T.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(T.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+u+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}return r})();var TAe=(function(){function r(e,t,n,a,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],T.backend_util.assertAndGetBroadcastShape(e,t),T.backend_util.assertAndGetBroadcastShape(e,n);var s="vec4(0.0)";a!=null&&(T.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(T.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+u+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `}return r})();var IAe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.mean,o=e.variance,s=e.offset,u=e.scale;T.util.assert(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),T.util.assert(s==null||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),T.util.assert(u==null||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var l=n.varianceEpsilon;l==null&&(l=.001);var c=[a,i,o],f=null;s!=null&&(f=s.shape,c.push(s));var h=null;u!=null&&(h=u.shape,c.push(u));var p=T.env().getBool("WEBGL_PACK_NORMALIZATION")?new TAe(a.shape,i.shape,o.shape,f,h,l):new EAe(a.shape,i.shape,o.shape,f,h,l),d=t.runWebGLProgram(p,c,c[0].dtype);return d},NAe={kernelName:T.FusedBatchNorm,backendName:"webgl",kernelFunc:IAe};var CAe=(function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=Zt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=AAe(this.rank),a,i=e.map(function(o,s){return"sourceLoc."+Fw[s]+" = start["+s+"] + coords."+Fw[s]+";"});a=`
        `+t+` sourceLoc;
        `+t+` coords = getOutputCoords();
        `+i.join(`
`)+`
      `,this.userCode=`
      void main() {
        `+a+`
        setOutput(getSource(`+n+`));
      }
    `}return r})(),Fw=["x","y","z","w","u","v"];function AAe(r){if(r===1)return"sourceLoc";if(r<=6)return Fw.slice(0,r).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+r+" is not yet supported")}var _Ae=(function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var t=Zt(this.rank),n=wn("coords",this.rank),a=wn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",o="getChannel(getSource("+a.join()+"), "+i+")",s=`
      result.x = `+o+`;
      if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+a[this.rank-1]+`;
        result.y = `+o+`;
        --`+a[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+a[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+a[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,f){return"start["+f+"]"}).join()+");":e.map(function(c,f){return a[f]+" = "+n[f]+" + start["+f+"];"}).join(`
`);this.userCode=`
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return r})();function DAe(r,e,t,n){var a=n.texData.get(r.dataId),i=n.makeTensorInfo(t,r.dtype),o=n.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=t,o.dtype=r.dtype;var s=T.slice_util.computeFlatOffset(e,T.util.computeStrides(r.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||r.dataId};var u=n.dataRefCount.get(o.slice.origDataId)||1;return n.dataRefCount.set(o.slice.origDataId,u+1),i}function ec(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size,s=Ve(T.slice_util.parseSliceParams(a,i,o),2),u=s[0],l=s[1];if(T.slice_util.assertParamsValid(a,u,l),T.util.sizeFromShape(l)===0)return t.makeTensorInfo(l,a.dtype,[]);if(t.shouldExecuteOnCPU([a])||a.dtype==="string"){var c=t.texData.get(a.dataId),f=kNe(c.values,u,l,a.shape,a.dtype);return t.makeTensorInfo(l,a.dtype,f)}var h=t.texData.get(a.dataId).isPacked,p=T.slice_util.isSliceContinous(a.shape,u,l);if(h||!p){var d=T.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _Ae(l):new CAe(l),v=[u];return t.runWebGLProgram(d,[a],a.dtype,v)}return t.uploadToGPU(a.dataId),DAe(a,u,l,t)}var FAe={kernelName:T.Slice,backendName:"webgl",kernelFunc:ec};var RAe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;T.util.assert(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=T.backend_util.getReshaped(a.shape,i,s),l=T.backend_util.getPermuted(u.length,i.length),c=T.backend_util.getReshapedPermuted(a.shape,i,s),f=T.backend_util.getSliceBeginCoords(o,i.length),h=T.backend_util.getSliceSize(c,o,i.length),p=[],d=Me({inputs:{x:a},backend:t,attrs:{shape:u}}),v=xn({inputs:{x:d},backend:t,attrs:{perm:l}}),m=Me({inputs:{x:v},backend:t,attrs:{shape:c}}),g=ec({inputs:{x:m},backend:t,attrs:{begin:f,size:h}});return p.push(d),p.push(v),p.push(m),p.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},MAe={kernelName:T.BatchToSpaceND,backendName:"webgl",kernelFunc:RAe};function OAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.readSync(a.dataId),u=t.readSync(i.dataId),l=$O(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}var PAe={kernelName:T.Bincount,backendName:"webgl",kernelFunc:OAe};function LAe(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.readSync(n.dataId),o=t.readSync(a.dataId),s=T.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var BAe={kernelName:T.BroadcastArgs,backendName:"webgl",kernelFunc:LAe};var zAe="return float(a != b);",tP=cn({opSnippet:zAe,cpuKernelImpl:dNe,dtype:"bool"}),$Ae={kernelName:T.NotEqual,backendName:"webgl",kernelFunc:tP};function Nh(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return sa({inputs:{x:a.complexTensorInfos.real},backend:t})}var WAe={kernelName:T.Real,backendName:"webgl",kernelFunc:Nh};var VAe="return float(int(x));";function UAe(r,e){var t=new mo(r.shape,VAe),n=e.runWebGLProgram(t,[r],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function Rw(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return sa({inputs:{x:a},backend:t});var o=MEe.zeros(a.shape),s=Rw({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=as({inputs:{real:s,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var l=Nh({inputs:{input:a},backend:t}),u=Rw({inputs:{x:l},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(l),u}if(!T.util.hasEncodingLoss(a.dtype,i)){var u=sa({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}if(t.shouldExecuteOnCPU([a])){var c=t.texData.get(a.dataId).values,f=Ve(jIe(c,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}if(i==="int32")return UAe(a,t);if(i==="bool"){var v=t.makeTensorInfo([],"bool",T.util.getTypedArrayFromDType("bool",1)),m={a,b:v},u=tP({inputs:m,backend:t});return t.disposeIntermediateTensorInfo(v),u}throw new Error("Error in Cast: failed to cast "+a.dtype+" to "+i)}var GAe={kernelName:T.Cast,backendName:"webgl",kernelFunc:Rw};var FM="return ceil(x);",HAe=It({opSnippet:FM,packedOpSnippet:FM,cpuKernelImpl:XIe}),qAe={kernelName:T.Ceil,backendName:"webgl",kernelFunc:HAe};var KAe=(function(){function r(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r})();var jAe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r})();function XAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.clipValueMin,o=n.clipValueMax,s;T.env().getBool("WEBGL_PACK_CLIP")?s=new jAe(a.shape):s=new KAe(a.shape);var u=[[i],[o]];return t.runWebGLProgram(s,[a],a.dtype,u)}var YAe={kernelName:T.ClipByValue,backendName:"webgl",kernelFunc:XAe};var ZAe=(function(){function r(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}return r})();function RM(r,e){return{dataId:e.dataId,dtype:e.dtype,shape:r.shape}}function QAe(r){var e=r.inputs,t=r.backend,n=e.x,a=t.texData.get(n.dataId),i=new ZAe(n.shape),o=[RM(n,a.complexTensorInfos.real),RM(n,a.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}var JAe={kernelName:T.ComplexAbs,backendName:"webgl",kernelFunc:QAe};var e_e=(function(){function r(e){this.outputShape=[],this.outputShape=T.backend_util.computeOutShape(e,1),this.variableNames=e.map(function(u,l){return"T"+l});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];for(var a=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"],n=1;n<t.length;n++){var i=t[n-1];a.push("else if (yC < "+t[n]+") "+("setOutput(getT"+n+"(yR, yC-"+i+"));"))}var o=t.length,s=t[t.length-1];a.push("else setOutput(getT"+o+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+a.join(`
        `)+`
      }
    `}return r})();var t_e=(function(){function r(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=T.backend_util.computeOutShape(e,t);var n=this.outputShape,a=n.length,i=Zt(a),o=wn("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(function(g,y){return"T"+y});var u=new Array(e.length-1);u[0]=e[0][t];for(var l=1;l<u.length;l++)u[l]=u[l-1]+e[l][t];for(var c=s[t],f=s.slice(-2),h=s.join(),p="if ("+c+" < "+u[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+f.join()+`));
        }`,l=1;l<u.length;l++){var d=u[l-1];p+=`
        if (`+c+" < "+u[l]+"  && "+c+" >= "+u[l-1]+`) {
          return getChannel(
            getT`+l+"("+Yv(s,c,d)+`),
            vec2(`+Yv(f,c,d)+`));
        }`}var v=u.length,m=u[u.length-1];p+=`
        return getChannel(
          getT`+v+"("+Yv(s,c,m)+`),
          vec2(`+Yv(f,c,m)+"));",this.userCode=`
      float getValue(`+s.map(function(g){return"int "+g})+`) {
        `+p+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[a-1]+" = "+o[a-1]+` + 1;
        if (`+o[a-1]+" < "+n[a-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[a-2]+" = "+o[a-2]+` + 1;
        if (`+o[a-2]+" < "+n[a-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[a-1]+" = "+o[a-1]+` - 1;
        if (`+o[a-2]+" < "+n[a-2]+` &&
            `+o[a-1]+" < "+n[a-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `}return r})();function Yv(r,e,t){var n=r.indexOf(e),a=r.map(function(i,o){return o===n?i+" - "+t:i});return a.join()}function cm(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return sa({inputs:{x:a.complexTensorInfos.imag},backend:t})}var r_e={kernelName:T.Imag,backendName:"webgl",kernelFunc:cm};function gh(r,e,t){var n,a,i=r[0].dtype;if(i==="complex64"){var o=r.map(function(G){return Nh({inputs:{input:G},backend:t})}),s=r.map(function(G){return cm({inputs:{input:G},backend:t})}),u=gh(o,e,t),l=gh(s,e,t),c=as({inputs:{real:u,imag:l},backend:t});return o.forEach(function(G){return t.disposeIntermediateTensorInfo(G)}),s.forEach(function(G){return t.disposeIntermediateTensorInfo(G)}),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(l),c}var f=t.shouldExecuteOnCPU(r);if(i==="string"&&(f=!0),f){var h=r.map(function(G){var M=T.util.sizeFromShape(G.shape.slice(e)),$=[-1,M];return Me({inputs:{x:G},backend:t,attrs:{shape:$}})}),p=h.map(function(G){return{vals:t.readSync(G.dataId),shape:G.shape}}),d=T.backend_util.computeOutShape(h.map(function(G){return G.shape}),1),v=h[0].shape[0]===1,m=YIe(p,d,i,v),g=T.backend_util.computeOutShape(r.map(function(G){return G.shape}),e),y=t.makeTensorInfo(g,i,m);return h.forEach(function(G){return t.disposeIntermediateTensorInfo(G)}),y}var b=T.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(r.length>b){for(var w=[],k=0;k<r.length;k+=b){var S=r.slice(k,k+b);w.push(gh(S,e,t))}var E=gh(w,e,t);try{for(var N=oa(w),C=N.next();!C.done;C=N.next()){var k=C.value;t.disposeIntermediateTensorInfo(k)}}catch(G){n={error:G}}finally{try{C&&!C.done&&(a=N.return)&&a.call(N)}finally{if(n)throw n.error}}return E}if(T.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&r[0].shape.length>1){var R=new t_e(r.map(function(G){return G.shape}),e);return t.runWebGLProgram(R,r,i)}var _=n_e(r,e,t),O=_.tensors2D,P=_.outShape,B=new e_e(O.map(function(G){return G.shape})),W=t.runWebGLProgram(B,O,i);O.forEach(function(G){return t.disposeIntermediateTensorInfo(G)});var L=Me({inputs:{x:W},attrs:{shape:P},backend:t});return t.disposeIntermediateTensorInfo(W),L}function n_e(r,e,t){var n=T.backend_util.computeOutShape(r.map(function(i){return i.shape}),e),a=r.map(function(i){return Me({inputs:{x:i},attrs:{shape:[-1,T.util.sizeFromShape(i.shape.slice(e))]},backend:t})});return{tensors2D:a,outShape:n}}function rP(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=T.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(l){return l.shape});T.backend_util.assertParamsConsistent(o,i);var s=T.backend_util.computeOutShape(e.map(function(l){return l.shape}),i);if(T.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(l){return T.util.sizeFromShape(l.shape)>0});return u.length===1?sa({inputs:{x:u[0]},backend:t}):gh(u,i,t)}var a_e={kernelName:T.Concat,backendName:"webgl",kernelFunc:rP};var nP=(function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,m=e.dataFormat==="channelsLast",g=m?1:2,y=m?2:3,b=m?3:1,w="",k="";n&&(a?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:i?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `+n+`
        }`:w=`
          float activation(float x) {
            `+n+`
          }
        `,k="result = activation(result);");var S=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+b+`];

        ivec2 xRCCorner =
            ivec2(coords[`+g+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+f+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+m+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(v===1)+`) {

              if (`+m+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(v===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+m+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(v===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+m+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+S+`
        `+k+`
        setOutput(result);
      }
    `}return r})(),i_e=(function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,a=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,f=e.filterDepth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+t+", "+n+", "+a+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+f+`; wF++) {
          int xF = xFCorner + wF * `+u+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+l+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+p+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+d+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(v===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+d+`) *
                  getW(wF, wR, wC, `+d+`, d2);
              } else if (`+(v===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(v===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1),
                  getX(batch, xF, xR, xC, `+d+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2),
                  getW(wF, wR, wC, `+d+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r})();var aP=(function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Sn(this.outputShape.length);for(var o=e.padInfo.left,s=e.strideWidth,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,f=c,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`,p=0;p<c;p++)h+=`
           vec4 xTexelC`+p*2+`;
           int xTexelC`+p*2+`Ready;
           vec4 xTexelC`+(p*2+1)+`;
           int xTexelC`+(p*2+1)+`Ready;
           vec4 xC`+p+";";h+=`
     for (int r = 0; r < `+l+`; r++) {
      for (int d1 = 0; d1 < `+e.inChannels+`; d1 += 2) {
       `;for(var p=0;p<c;p++)h+=`
           xTexelC`+p*2+` = vec4(0.0);
           xTexelC`+p*2+`Ready = 0;
           xTexelC`+(p*2+1)+` = vec4(0.0);
           xTexelC`+(p*2+1)+`Ready = 0;
           xC`+p+" = vec4(0.0);";h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(var d=0;d<(f+1)/2;d++){var v=d*2;if(h+=`
           xC = xCCorner + `+v*u+`;
           `,s===1){if(v<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+v+`Ready == 0) {
                   xTexelC`+v+` = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`+v+`.zw = vec2(0.0);
                   }
                   xTexelC`+v+`Ready = 1;
                 }
               `,u===1&&v>0?h+=`
                 xC`+v+" = vec4(xTexelC"+(v-2)+".zw, xTexelC"+v+`.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC`+v+" = vec4(previous.zw, xTexelC"+v+`.xy);
                   } else {
                     xC`+v+" = vec4(0.0, 0.0, xTexelC"+v+`.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC`+v+`Ready == 0) {
                   xTexelC`+v+` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`+v+`.zw = vec2(0.0);
                   }
                   xTexelC`+v+`Ready = 1;
                 }

                 xC`+v+" = xTexelC"+v+`;
                 `,v+1<c)){var m=o%2===0?T.util.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + `+m+`;

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(v+1)+`Ready == 0) {
                     xTexelC`+(v+1)+` = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC`+(v+1)+`.zw = vec2(0.0);
                     }
                     xTexelC`+(v+1)+`Ready = 1;
                   }
                   `,u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC`+(v+1)+" = vec4(previous.zw, xTexelC"+(v+1)+`.xy);
                     } else {
                      xC`+(v+1)+" = vec4(0.0, 0.0, xTexelC"+(v+1)+`.xy);
                     }
                     `:h+=`
                     xC`+(v+1)+" = vec4(xTexelC"+v+".zw, xTexelC"+(v+1)+`.xy);
                     `):m===1?h+=`
                     xC`+(v+1)+" = xTexelC"+v+`;
                     `:h+=`
                     xCOffset = xC + `+m+`;

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(v+1)+`Ready == 0) {
                       xTexelC`+(v+1)+` = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC`+(v+1)+`.zw = vec2(0.0);
                       }
                       xTexelC`+(v+1)+`Ready = 1;
                     }

                     xC`+(v+1)+" = xTexelC"+(v+1)+`;
                     `}}else v<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+v+`Ready == 0) {
                   xTexelC`+v+` = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`+v+`.zw = vec2(0.0);
                   }
                   xTexelC`+v+`Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`+(v+1)+`Ready == 0) {
                   xTexelC`+(v+1)+` = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC`+(v+1)+`.zw = vec2(0.0);
                   }
                   xTexelC`+(v+1)+`Ready = 1;
                 }

                 xC`+v+" = vec4(xTexelC"+v+".zw, xTexelC"+(v+1)+`.zw);
               `,v+1<c&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC`+(v+1)+" = vec4(xTexelC"+(v+1)+`.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC`+v+`Ready == 0) {
                   xTexelC`+v+` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`+v+`.zw = vec2(0.0);
                   }
                   xTexelC`+v+`Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(v+1)+`Ready == 0) {
                   xTexelC`+(v+1)+` = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`+(v+1)+`.zw = vec2(0.);
                   }
                   xTexelC`+(v+1)+`Ready = 1;
                 }

                 xC`+v+` = vec4(
                   xTexelC`+v+".xy, xTexelC"+(v+1)+`.xy);
               `,v+1<c&&(h+=`
                   xC`+(v+1)+" = vec4(xTexelC"+v+".zw, xTexelC"+(v+1)+`.zw);
                 `)));v<c&&(h+=`
             wTexel = getW(r, `+v+`, d1, d2);
             dotProd += xC`+v+`.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < `+e.inChannels+`) {
               dotProd += xC`+v+`.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,v+1<c&&(h+=`
               wTexel = getW(r, `+(v+1)+`, d1, d2);
               dotProd += xC`+(v+1)+`.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < `+e.inChannels+`) {
                 dotProd += xC`+(v+1)+`.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;var g="",y="";n&&(a?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           `+n+`
         }`:i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           `+n+`
         }`:g=`vec4 activation(vec4 x) {
           `+n+`
         }`,y="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       `+g+`

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         `+h+`

         vec4 result = dotProd - vec4(0.000000000000001);
         `+b+`
         `+y+`
         setOutput(result);
       }
     `}return r})();var o_e=(function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Sn(this.outputShape.length);for(var n=t.dataFormat,a=kn(),i=n==="channelsLast",o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < "+e[2]+" && pos < "+e[1]+") {",l="",c=0;c<=1;c++)for(var f=0;f<=1;f++)l+=`
          blockIndex = rc.z + `+f+`;
          pos = rc.y + `+c+`;

          `+u+`
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[`+o+`] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[`+s+`] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (`+i+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(c*2+f)+`] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(c*2+f)+`] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+l+`

        `+a.output+` = result;
      }
    `}return r})();function im(r,e){var t=r.length;return t>=3?e?Gr(r.slice(0,-3),[r[t-3]*r[t-2],r[t-1]]):Gr(r.slice(0,-3),[r[t-3],r[t-2]*r[t-1]]):!e&&t===1&&r[0]>1?[r[0],1]:null}function iP(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,l=r.preluActivationWeights,c=l===void 0?null:l,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,v=n.shape,m=o.texData.get(n.dataId),g=i.inChannels,y=v[0]*v[1]*v[2],b=i.outChannels,w=i.dataFormat==="channelsLast",k=!1,S=!1,E,N=[];if(c!=null){var C=im(c.shape,w);C!=null&&(c=Me({inputs:{x:c},backend:o,attrs:{shape:C}}),N.push(c))}if(u!=null){var C=im(u.shape,w);C!=null&&(u=Me({inputs:{x:u},backend:o,attrs:{shape:C}}),N.push(u))}var R=(y===1||b===1)&&g>ZO,_=!R&&m.isPacked&&w&&m.texture!=null&&v[2]%2!==0&&T.util.arraysEqual(m.shape.slice(-3),v.slice(-3));if(_){var C=v[0]*v[1]*(v[2]+1),O={dataId:n.dataId,shape:[1,C,i.inChannels],dtype:n.dtype},P=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,T.util.assert(bh(m.shape,O.shape),function(){return"packed reshape "+m.shape+" to "+O.shape+" isn't free"});var B=Me({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});N.push(B);var W=am({a:O,b:B,backend:o,transposeA:k,transposeB:S,bias:u,activation:d,preluActivationWeights:c,leakyreluAlpha:h}),L=o.texData.get(W.dataId);T.util.assert(L.isPacked,function(){return"batchMatMul result is expected to be packed"}),m.shape=P,L.shape=i.outShape,E=sa({inputs:{x:W},backend:o}),E.shape=i.outShape,N.push(W)}else{var G=i.outHeight*i.outWidth,M=Me({inputs:{x:n},backend:o,attrs:{shape:w?[i.batchSize,G,i.inChannels]:[i.batchSize,i.inChannels,G]}}),B=Me({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),$=am({a:w?M:B,b:w?B:M,transposeA:!w,transposeB:S,backend:o,bias:u,activation:d,preluActivationWeights:c,leakyreluAlpha:h});E=Me({inputs:{x:$},backend:o,attrs:{shape:i.outShape}}),N.push(M),N.push(B),N.push($)}try{for(var K=oa(N),j=K.next();!j.done;j=K.next()){var te=j.value;o.disposeIntermediateTensorInfo(te)}}catch(Q){e={error:Q}}finally{try{j&&!j.done&&(t=K.return)&&t.call(K)}finally{if(e)throw e.error}}return E}function oP(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,l=r.preluActivationWeights,c=l===void 0?null:l,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,v=i.filterWidth,m=i.filterHeight,g=i.inChannels,y=i.outWidth,b=i.outHeight,w=i.dataFormat,k=w==="channelsLast",S=v*m*g,E=b*y,N=[i.batchSize,S,E],C=!0,R=!1,_=[];if(c!=null){var O=im(c.shape,k);O!=null&&(c=Me({inputs:{x:c},backend:o,attrs:{shape:O}}),_.push(c))}if(u!=null){var O=im(u.shape,k);O!=null&&(u=Me({inputs:{x:u},backend:o,attrs:{shape:O}}),_.push(u))}var P=Me({inputs:{x:a},backend:o,attrs:{shape:[1,S,T.util.sizeFromShape(a.shape)/S]}});_.push(P);var B=new o_e(N,i),W=[n.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],L=o.runWebGLProgram(B,[n],"float32",W),G=Me({inputs:{x:L},backend:o,attrs:{shape:N}});_.push(L),_.push(G);var M=u!=null,$=c!=null,K=d==="leakyrelu",j=d?wh(d,!0):null,te=new YO(k?G.shape:P.shape,k?P.shape:G.shape,k?[i.batchSize,E,i.outChannels]:[i.batchSize,i.outChannels,E],C,R,M,j,$,K),Q=k?[G,P]:[P,G];if(u&&Q.push(u),$&&Q.push(c),K){var ie=o.makeTensorInfo([],"float32",T.util.createScalarValue(h,"float32"));Q.push(ie),_.push(ie)}var le=o.runWebGLProgram(te,Q,"float32"),de=Me({inputs:{x:le},backend:o,attrs:{shape:i.outShape}});_.push(le);try{for(var we=oa(_),pe=we.next();!pe.done;pe=we.next()){var Se=pe.value;o.disposeIntermediateTensorInfo(Se)}}catch(Ee){e={error:Ee}}finally{try{pe&&!pe.done&&(t=we.return)&&t.call(we)}finally{if(e)throw e.error}}return de}function s_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dilations,c=n.dimRoundingMode,f=T.backend_util.convertConv2DDataFormat(u),h=T.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!1,f),p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=iP({x:a,filter:i,convInfo:h,backend:t});else if(h.strideWidth<=2&&f==="channelsLast"&&T.env().getBool("WEBGL_EXP_CONV")){var d=new aP(h),v=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=t.runWebGLProgram(d,[a,i],"float32",v)}else if(T.env().getBool("WEBGL_CONV_IM2COL"))p=oP({x:a,filter:i,convInfo:h,backend:t});else{var d=new nP(h);p=t.runWebGLProgram(d,[a,i],"float32")}var m=Me({inputs:{x:p},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(p),m}var u_e={kernelName:T.Conv2D,backendName:"webgl",kernelFunc:s_e};var l_e=(function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+a+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}return r})(),c_e=(function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",s=t-1-e.padInfo.top,u=n-1-e.padInfo.left,l=o?1:2,c=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+f+`];

        ivec2 dyCorner = ivec2(coords[`+l+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+a+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}return r})(),f_e=(function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+i+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+o+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+a+" - "+s+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r})(),h_e=(function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=t-1-e.padInfo.front,l=n-1-e.padInfo.top,c=a-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+l+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+a+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+a+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r})();function p_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dimRoundingMode,c=n.filterShape,f=T.backend_util.convertConv2DDataFormat(u),h=T.backend_util.computeConv2DInfo(a.shape,c,o,1,s,l,!1,f),p=new l_e(h);return t.runWebGLProgram(p,[a,i],"float32")}var d_e={kernelName:T.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:p_e};function v_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,l=n.dataFormat,c=n.dimRoundingMode,f=T.backend_util.convertConv2DDataFormat(l),h=T.backend_util.computeConv2DInfo(o,i.shape,s,1,u,c,!1,f),p=new c_e(h);return t.runWebGLProgram(p,[a,i],"float32")}var m_e={kernelName:T.Conv2DBackpropInput,backendName:"webgl",kernelFunc:v_e};function g_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=T.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),c=new i_e(l);return t.runWebGLProgram(c,[a,i],"float32")}var y_e={kernelName:T.Conv3D,backendName:"webgl",kernelFunc:g_e};function b_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape,l=T.backend_util.computeConv3DInfo(a.shape,u,o,1,s),c=new f_e(l);return t.runWebGLProgram(c,[a,i],"float32")}var w_e={kernelName:T.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:b_e};function x_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape,l=T.backend_util.computeConv3DInfo(u,i.shape,s,1,o),c=new h_e(l);return t.runWebGLProgram(c,[a,i],"float32")}var k_e={kernelName:T.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:x_e};var S_e=Jl+`
  return cos(x);
`,E_e=It({opSnippet:S_e}),T_e={kernelName:T.Cos,backendName:"webgl",kernelFunc:E_e};var I_e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,N_e=It({opSnippet:I_e}),C_e={kernelName:T.Cosh,backendName:"webgl",kernelFunc:N_e};var A_e=(function(){function r(e,t,n,a,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=Ve(e,4),s=o[0],u=o[1],l=o[2],c=o[3],f=Ve(t,1),h=f[0],p=Ve(n,2),d=p[0],v=p[1];this.outputShape=[h,d,v,c];var m=a==="bilinear"?1:0,g=Ve([u-1+".0",l-1+".0"],2),y=g[0],b=g[1],w=Ve(d>1?[""+(u-1)/(d-1),"(y2-y1) * height_ratio","y1*"+y+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+y],3),k=w[0],S=w[1],E=w[2],N=Ve(v>1?[""+(l-1)/(v-1),"(x2-x1) * width_ratio","x1*"+b+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+b],3),C=N[0],R=N[1],_=N[2];this.userCode=`
      const float height_ratio = float(`+k+`);
      const float width_ratio = float(`+C+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+s+`) {
          return;
        }

        float height_scale = `+S+`;
        float width_scale = `+R+`;

        float in_y = `+E+`;
        if( in_y < 0.0 || in_y > `+y+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+_+`;
        if( in_x < 0.0 || in_x > `+b+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+m+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}return r})();var __e=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,l=n.extrapolationValue,c=new A_e(a.shape,i.shape,s,u,l);return t.runWebGLProgram(c,[a,i,o],"float32")},D_e={kernelName:T.CropAndResize,backendName:"webgl",kernelFunc:__e},kh;(function(r){r.Prod="*",r.Sum="+"})(kh||(kh={}));var MM=(function(){function r(e,t,n,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===kh.Prod?"1.0":"0.0",s=n?o:"getX("+OM(i,"coords",this.op)+")",u=this.outputShape[this.outputShape.length-1],l="",c="";n?(l=a?"end != "+(u-1):"end != 0",c=a?"end + 1":"end - 1"):(l=a?"end + pow2 < "+u:"end >= pow2",c=a?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        `+Zt(i)+` coords = getOutputCoords();
        int end = `+PM(i,"coords",this.op)+`;
        float val = `+s+`;
        int pow2 = int(pow(2.0, index));
        if (`+l+`) {
          int idx = `+c+`;
          `+PM(i,"coords",this.op)+` = idx;
          val `+this.op+"= getX("+OM(i,"coords",this.op)+`);
        }
        setOutput(val);
      }
    `}return r})();function OM(r,e,t){if(r===1)return""+e;if(r===2)return e+".x, "+e+".y";if(r===3)return e+".x, "+e+".y, "+e+".z";if(r===4)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw new Error("Cumulative "+t+" for rank "+r+" is not yet supported")}function PM(r,e,t){if(r===1)return""+e;if(r===2)return e+".y";if(r===3)return e+".z";if(r===4)return e+".w";throw new Error("Cumulative "+t+" for rank "+r+" is not yet supported")}function sP(r,e,t,n,a,i){var o=e.shape.length,s=T.backend_util.getAxesPermutation([n],o),u=e;s!=null&&(u=xn({inputs:{x:e},backend:t,attrs:{perm:s}}));var l=T.backend_util.getInnerMostAxes(1,o)[0];if(l!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis="+(e.shape.length-1)+" "+("but got axis="+n));for(var c=u.shape[l],f=sa({inputs:{x:u},backend:t}),h=0;h<=Math.ceil(Math.log2(c))-1;h++){var p=new MM(r,u.shape,!1,i),d=[[h]],v=f;f=t.runWebGLProgram(p,[f],f.dtype,d),t.disposeIntermediateTensorInfo(v)}if(a){var p=new MM(r,u.shape,a,i),v=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(v)}if(s!=null){var m=T.backend_util.getUndoAxesPermutation(s),g=xn({inputs:{x:f},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}function F_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return sP(kh.Prod,a,t,i,o,s)}var R_e={kernelName:T.Cumprod,backendName:"webgl",kernelFunc:F_e};function M_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return sP(kh.Sum,a,t,i,o,s)}var O_e={kernelName:T.Cumsum,backendName:"webgl",kernelFunc:M_e};function P_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.readSync(a.dataId),l=t.readSync(i.dataId),c=$O(u,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=KIe(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+(a.shape.length+"."))}var L_e={kernelName:T.DenseBincount,backendName:"webgl",kernelFunc:P_e};var B_e=(function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r})();function z_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat,s=a.shape[0],u=o==="NHWC"?a.shape[1]:a.shape[2],l=o==="NHWC"?a.shape[2]:a.shape[3],c=o==="NHWC"?a.shape[3]:a.shape[1],f=u*i,h=l*i,p=c/(i*i),d=o==="NHWC"?[s,f,h,p]:[s,p,f,h],v=new B_e(d,i,o);return t.runWebGLProgram(v,[a],a.dtype)}var $_e={kernelName:T.DepthToSpace,backendName:"webgl",kernelFunc:z_e};var uP=(function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Sn(this.outputShape.length);var o=e.filterHeight,s=e.filterWidth,u=e.outChannels/e.inChannels,l="",c="";n&&(a?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:i?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `+n+`
        }`:l=`
          float activation(float x) {
            `+n+`
          }
        `,c="result = activation(result);");var f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `+l+`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+u+`;
        int q = d2 - d1 * `+u+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+o+`; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < `+s+`; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+f+`
        `+c+`
        setOutput(result);
      }
    `}return r})();var lP=(function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Sn(this.outputShape.length);for(var o=e.outChannels/e.inChannels,s=e.padInfo.left,u=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,f=e.filterWidth,h=f,p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`,d=0;d<f;d++)p+=`
          vec4 xTexelC`+d*2+`;
          int xTexelC`+d*2+`Ready;
          vec4 xTexelC`+(d*2+1)+`;
          int xTexelC`+(d*2+1)+`Ready;
          vec4 xC`+d+";";p+=`
    for (int r = 0; r < `+c+`; r++) {
      `;for(var d=0;d<f;d++)p+=`
          xTexelC`+d*2+` = vec4(0.0);
          xTexelC`+d*2+`Ready = 0;
          xTexelC`+(d*2+1)+` = vec4(0.0);
          xTexelC`+(d*2+1)+`Ready = 0;
          xC`+d+" = vec4(0.0);";p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(var v=0;v<(h+1)/2;v++){var m=v*2;if(p+=`
          xC = xCCorner + `+m*l+`;
          `,u===1){if(m<f&&(s%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+m+`Ready == 0) {
                  xTexelC`+m+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`+m+`.zw = vec2(0.0);
                  }
                  xTexelC`+m+`Ready = 1;
                }
              `,l===1&&m>0?p+=`
                xC`+m+" = vec4(xTexelC"+(m-2)+".zw, xTexelC"+m+`.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC`+m+" = vec4(previous.zw, xTexelC"+m+`.xy);
                  } else {
                    xC`+m+" = vec4(0.0, 0.0, xTexelC"+m+`.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC`+m+`Ready == 0) {
                  xTexelC`+m+` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`+m+`.zw = vec2(0.0);
                  }
                  xTexelC`+m+`Ready = 1;
                }

                xC`+m+" = xTexelC"+m+`;
                `,m+1<f)){var g=s%2===0?T.util.nearestLargerEven(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + `+g+`;

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(m+1)+`Ready == 0) {
                    xTexelC`+(m+1)+` = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC`+(m+1)+`.zw = vec2(0.0);
                    }
                    xTexelC`+(m+1)+`Ready = 1;
                  }
                  `,l>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC`+(m+1)+" = vec4(previous.zw, xTexelC"+(m+1)+`.xy);
                    } else {
                     xC`+(m+1)+" = vec4(0.0, 0.0, xTexelC"+(m+1)+`.xy);
                    }
                    `:p+=`
                    xC`+(m+1)+" = vec4(xTexelC"+m+".zw, xTexelC"+(m+1)+`.xy);
                    `):g===1?p+=`
                    xC`+(m+1)+" = xTexelC"+m+`;
                    `:p+=`
                    xCOffset = xC + `+g+`;

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(m+1)+`Ready == 0) {
                      xTexelC`+(m+1)+` = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC`+(m+1)+`.zw = vec2(0.0);
                      }
                      xTexelC`+(m+1)+`Ready = 1;
                    }

                    xC`+(m+1)+" = xTexelC"+(m+1)+`;
                    `}}else m<f&&(s%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+m+`Ready == 0) {
                  xTexelC`+m+` = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`+m+`.zw = vec2(0.0);
                  }
                  xTexelC`+m+`Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`+(m+1)+`Ready == 0) {
                  xTexelC`+(m+1)+` = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC`+(m+1)+`.zw = vec2(0.0);
                  }
                  xTexelC`+(m+1)+`Ready = 1;
                }

                xC`+m+" = vec4(xTexelC"+m+".zw, xTexelC"+(m+1)+`.zw);
              `,m+1<f&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC`+(m+1)+" = vec4(xTexelC"+(m+1)+`.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC`+m+`Ready == 0) {
                  xTexelC`+m+` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`+m+`.zw = vec2(0.0);
                  }
                  xTexelC`+m+`Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(m+1)+`Ready == 0) {
                  xTexelC`+(m+1)+` = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`+(m+1)+`.zw = vec2(0.);
                  }
                  xTexelC`+(m+1)+`Ready = 1;
                }

                xC`+m+` = vec4(
                  xTexelC`+m+".xy, xTexelC"+(m+1)+`.xy);
              `,m+1<f&&(p+=`
                  xC`+(m+1)+" = vec4(xTexelC"+m+".zw, xTexelC"+(m+1)+`.zw);
                `)));m<f&&(p+=`
            wTexel = getW(r, `+m+`, d1, q);
            dotProd += xC`+m+` * vec4(wTexel.xz, wTexel.xz);
          `,m+1<f&&(p+=`
              wTexel = getW(r, `+(m+1)+`, d1, q);
              dotProd += xC`+(m+1)+` * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;var y="",b="";n&&(a?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `+n+`
        }`:y=`vec4 activation(vec4 x) {
          `+n+`
        }`,b="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `+y+`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+o+`;
        int q = d2 - d1 * `+o+`;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        `+p+`

        vec4 result = dotProd - vec4(0.000000000000001);
        `+w+`
        `+b+`
        setOutput(result);
      }
    `}return r})();function W_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=n.dimRoundingMode,c=u;c==null&&(c=[1,1]),T.util.assert(T.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+("1. Got strides "+o+" and dilations '"+c+"'")});var f=T.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!0),h;T.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new lP(f):h=new uP(f);var p=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(h,[a,i],"float32",p)}var V_e={kernelName:T.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:W_e};var U_e=(function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+a+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r})(),G_e=(function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+a+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+u+`; dm++) {
              int d2 = d1 * `+u+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r})();function H_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,l=n.dimRoundingMode,c=n.filterShape,f=T.backend_util.computeConv2DInfo(a.shape,c,o,s,u,l,!0),h=new U_e(f);return t.runWebGLProgram(h,[a,i],"float32")}var q_e={kernelName:T.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:H_e};function K_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,l=n.dimRoundingMode,c=n.inputShape,f=T.backend_util.computeConv2DInfo(c,i.shape,o,s,u,l,!0),h=new G_e(f);return t.runWebGLProgram(h,[a,i],"float32")}var j_e={kernelName:T.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:K_e};var X_e=(function(){function r(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}return r})();function Y_e(r){var e=r.inputs,t=r.backend,n=e.x,a=Gr(n.shape,n.shape),i=T.util.sizeFromShape(n.shape),o=Me({inputs:{x:n},backend:t,attrs:{shape:[i]}}),s=new X_e(i),u=t.runWebGLProgram(s,[o],o.dtype),l=Me({inputs:{x:u},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),l}var Z_e={kernelName:T.Diag,backendName:"webgl",kernelFunc:Y_e};var Q_e=(function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,a=e.padInfo,i=e.strideHeight,o=e.strideWidth,s=e.filterHeight,u=e.filterWidth,l=e.dilationHeight,c=e.dilationWidth,f=a.top,h=a.left;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+f+", "+h+`);
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < `+s+`; h++) {
          int hIn = hBeg + h * `+l+`;

          if (hIn >= 0 && hIn < `+t+`) {
            for (int w = 0; w < `+u+`; w++) {
              int wIn = wBeg + w * `+c+`;

              if (wIn >= 0 && wIn < `+n+`) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}return r})();function J_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=T.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),c,f=new Q_e(l);c=t.runWebGLProgram(f,[a,i],"float32");var h=Me({inputs:{x:c},backend:t,attrs:{shape:l.outShape}});return t.disposeIntermediateTensorInfo(c),h}var e3e={kernelName:T.Dilation2D,backendName:"webgl",kernelFunc:J_e};function t3e(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,l=i,c=T.backend_util.decodeEinsumEquation(u,l.length),f=c.allDims,h=c.summedDims,p=c.idDims;T.backend_util.checkEinsumDimSizes(f.length,p,l);for(var d=T.backend_util.getEinsumComputePath(h,p),v=d.path,m=d.steps,g=m.length,y=null,b=f.length,w=[],k=0;k<g;++k){try{for(var S=(e=void 0,oa(m[k])),E=S.next();!E.done;E=S.next()){var N=E.value,C=T.backend_util.getEinsumPermutation(b,p[N]),R=C.permutationIndices,_=C.expandDims,O=void 0;T.backend_util.isIdentityPermutation(R)?O=l[N]:(O=xn({inputs:{x:l[N]},backend:o,attrs:{perm:R}}),w.push(O));for(var P=O.shape.slice(),B=0;B<_.length;++B)P.splice(_[B],0,1);T.util.arraysEqual(O.shape,P)||(O=Me({inputs:{x:O},backend:o,attrs:{shape:P}}),w.push(O)),y===null?y=O:(y=jw({inputs:{a:O,b:y},backend:o}),w.push(y))}}catch(M){e={error:M}}finally{try{E&&!E.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}k<g-1&&(v[k]>=0&&(y=lm({inputs:{x:y},backend:o,attrs:{axis:v[k]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var W=oa(w),L=W.next();!L.done;L=W.next()){var G=L.value;G!==y&&o.disposeIntermediateTensorInfo(G)}}catch(M){n={error:M}}finally{try{L&&!L.done&&(a=W.return)&&a.call(W)}finally{if(n)throw n.error}}return y}var r3e={kernelName:T.Einsum,backendName:"webgl",kernelFunc:t3e};var n3e="return (x >= 0.0) ? x : (exp(x) - 1.0);",a3e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,i3e=It({opSnippet:n3e,packedOpSnippet:a3e}),o3e={kernelName:T.Elu,backendName:"webgl",kernelFunc:i3e};var s3e="return (b >= 1.0) ? a : a * (b + 1.0);",u3e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,l3e=function(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y,i=T.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ih(u3e,n.shape,a.shape):new ql(s3e,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],n.dtype)},c3e={kernelName:T.EluGrad,backendName:"webgl",kernelFunc:l3e};var f3e=`
  return vec4(equal(a, b));
`,h3e="return float(a == b);",p3e=cn({opSnippet:h3e,packedOpSnippet:f3e,dtype:"bool",cpuKernelImpl:ZIe}),d3e={kernelName:T.Equal,backendName:"webgl",kernelFunc:p3e};var v3e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `+T.backend_util.ERF_P+`;
  float a1 = `+T.backend_util.ERF_A1+`;
  float a2 = `+T.backend_util.ERF_A2+`;
  float a3 = `+T.backend_util.ERF_A3+`;
  float a4 = `+T.backend_util.ERF_A4+`;
  float a5 = `+T.backend_util.ERF_A5+`;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,m3e=It({opSnippet:v3e}),g3e={kernelName:T.Erf,backendName:"webgl",kernelFunc:m3e};var y3e=Jl+`
  return exp(x);
`,b3e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cP=It({opSnippet:y3e,packedOpSnippet:b3e,cpuKernelImpl:QIe,dtype:"float32"}),w3e={kernelName:T.Exp,backendName:"webgl",kernelFunc:cP};function Mw(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.dim,i=e.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(T.util.assert(-(o+1)<=a,function(){return"Axis must be in the interval ["+-(o+1)+", "+o+"]"}),u=o+a+1),s.splice(u,0,1),Me({inputs:{x:i},backend:n,attrs:{shape:s}})}var x3e={kernelName:T.ExpandDims,backendName:"webgl",kernelFunc:Mw};var LM="return exp(x) - 1.0;",k3e=It({opSnippet:LM,packedOpSnippet:LM,cpuKernelImpl:JIe}),S3e={kernelName:T.Expm1,backendName:"webgl",kernelFunc:k3e};var BM=(function(){function r(e,t,n){this.variableNames=["real","imag"];var a=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=n?a+".0":"1.0",s;if(e==="real")s="return real * expR - imag * expI;";else if(e==="imag")s="return real * expI + imag * expR;";else throw new Error('FFT component must be either "real" or "imag", got '+e+".");this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+s+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+a+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+a+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}return r})();function fP(r,e,t){var n=t.texData.get(r.dataId),a=T.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=Me({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=s.shape,l=new BM("real",u,e),c=new BM("imag",u,e),f=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:u},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:u}],h=t.runWebGLProgram(l,f,"float32"),p=t.runWebGLProgram(c,f,"float32"),d=as({inputs:{real:h,imag:p},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p);var v=Me({inputs:{x:d},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(d),v}function E3e(r){var e=r.inputs,t=r.backend,n=e.input;return fP(n,!1,t)}var T3e={kernelName:T.FFT,backendName:"webgl",kernelFunc:E3e};var I3e=(function(){function r(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r})();function Ch(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype;if(i=i||T.util.inferDtype(a),i==="string"){var o=T.util.getArrayFromDType(i,T.util.sizeFromShape(n));return o.fill(a),e.makeTensorInfo(n,i,o)}else{var s=new I3e(n,a),u=[[a]];return e.runWebGLProgram(s,[],i,u)}}var N3e={kernelName:T.Fill,backendName:"webgl",kernelFunc:Ch};var C3e=(function(){function r(e){this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = `+t+` - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < `+t+`) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}return r})();var A3e={kernelName:T.FlipLeftRight,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.image,a=t,i=new C3e(n.shape),o=a.runWebGLProgram(i,[n],n.dtype);return o}};var zM="return floor(x);",_3e=It({opSnippet:zM,packedOpSnippet:zM,cpuKernelImpl:eNe}),D3e={kernelName:T.Floor,backendName:"webgl",kernelFunc:_3e};var F3e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,R3e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,M3e=cn({opSnippet:F3e,packedOpSnippet:R3e,dtype:"int32"}),O3e={kernelName:T.FloorDiv,backendName:"webgl",kernelFunc:M3e},P3e=(function(){function r(e){this.variableNames=["A"];var t=kn(),n=Ve(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+i+".0, "+a+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}return r})(),L3e=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=kn(),n=Ve(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+i+".0, "+a+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `}return r})(),B3e={kernelName:T.FromPixels,backendName:"webgl",kernelFunc:z3e},Vl,Tw=T.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function z3e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.pixels,i=n.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=Ve(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),l=u[0],c=u[1],f=[c,l],h=[c,l,i];if(s||o){var p=T.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Vl==null||p!==Tw)&&(Tw=p,Vl=document.createElement("canvas").getContext("2d",{willReadFrequently:Tw})),Vl.canvas.width=l,Vl.canvas.height=c,Vl.drawImage(a,0,0,l,c),a=Vl.canvas}var d=t.makeTensorInfo(f,"int32");t.texData.get(d.dataId).usage=Sa.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),a);var v=T.env().getBool("WEBGL_PACK")?new L3e(h):new P3e(h),m=t.runWebGLProgram(v,[d],"int32");return t.disposeData(d.dataId),m}function $3e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,l=n.pad,c=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,v=T.backend_util.convertConv2DDataFormat(c),m=T.backend_util.computeConv2DInfo(a.shape,i.shape,u,f,l,h,!1,v),g,y=[],b=o!=null,w=s!=null,k=p==="leakyrelu",S=function(){var P=[a,i],B=function(L,G){if(G==="NCHW"&&L.shape.length===1&&L.shape[0]!==1){var M=Me({inputs:{x:L},backend:t,attrs:{shape:[L.shape[0],1,1]}});return y.push(M),M}return L};if(b&&P.push(B(o,c)),w&&P.push(B(s,c)),k){var W=t.makeTensorInfo([],"float32",T.util.createScalarValue(d,"float32"));P.push(W),y.push(W)}return P};if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))g=iP({x:a,filter:i,convInfo:m,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else if(m.strideWidth<=2&&v==="channelsLast"&&T.env().getBool("WEBGL_EXP_CONV")){var E=p?wh(p,!0):null,N=new aP(m,b,E,w,k),C=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],R=S();g=t.runWebGLProgram(N,R,"float32",C)}else if(T.env().getBool("WEBGL_CONV_IM2COL"))g=oP({x:a,filter:i,convInfo:m,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else{var E=p?wh(p,!1):null,N=new nP(m,b,E,w,k),_=S();g=t.runWebGLProgram(N,_,"float32")}var O=Me({inputs:{x:g},backend:t,attrs:{shape:m.outShape}});return y.push(g),y.forEach(function(P){return t.disposeIntermediateTensorInfo(P)}),O}var W3e={kernelName:T.FusedConv2D,backendName:"webgl",kernelFunc:$3e};function V3e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,l=n.pad,c=n.dilations,f=n.dimRoundingMode,h=n.activation,p=n.leakyreluAlpha,d=[],v=c;v==null&&(v=[1,1]),T.util.assert(T.backend_util.eitherStridesOrDilationsAreOne(u,v),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+("1. Got strides "+u+" and dilations '"+v+"'")});var m=T.backend_util.computeConv2DInfo(a.shape,i.shape,u,v,l,f,!0),g=T.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,y=h?wh(h,g):null,b=[a,i],w=o!=null,k=s!=null,S=h==="leakyrelu";if(w&&b.push(o),k&&b.push(s),S){var E=t.makeTensorInfo([],"float32",T.util.createScalarValue(p,"float32"));b.push(E),d.push(E)}var N;g?N=new lP(m,w,y,k,S):N=new uP(m,w,y,k,S);var C=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],R=t.runWebGLProgram(N,b,"float32",C);return d.forEach(function(_){return t.disposeIntermediateTensorInfo(_)}),R}var U3e={kernelName:T.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:V3e},G3e=(function(){function r(e,t,n,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=n;for(var i=Zt(n.length),o=`
    int index;`,s=0;s<this.sliceDim;s++)o+=`
          index = round(getIndices(coords[0], `+s+`));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= `+this.paramsShape[s]+`;
          flattenIndex += index * `+this.strides[s]+";";this.userCode=`
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          `+o+`

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}return r})();function H3e(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=a.shape,o=i[i.length-1],s=T.util.sizeFromShape(n.shape),u=Ve(T.backend_util.prepareAndValidate(n,a),4),l=u[0],c=u[1],f=u[2],h=u[3],p=Me({inputs:{x:a},backend:t,attrs:{shape:[c,o]}}),d=Me({inputs:{x:n},backend:t,attrs:{shape:[T.util.sizeFromShape(n.shape)/f,f]}});if(t.shouldExecuteOnCPU([n,a])||n.dtype==="string"){var v=t.readSync(a.dataId),m=t.bufferSync(n),g=tNe(v,m,n.dtype,c,o,f,h,n.shape,s);return t.makeTensorInfo(l,n.dtype,g.values)}var y=new G3e(o,h,[c,f],n.shape),b=t.runWebGLProgram(y,[d,p],d.dtype),w=Me({inputs:{x:b},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(b),w}var q3e={kernelName:T.GatherNd,backendName:"webgl",kernelFunc:H3e};var K3e=(function(){function r(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var n=Zt(this.rank),a=j3e(e);this.userCode=`
      void main() {
        `+n+` resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < `+e[2]+`) ? 1.0 : 0.0;
        setOutput(inBounds * getA(`+a+`));
      }
    `}return r})();function j3e(r,e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],a=0;a<r.length;a++)a===2?n.push("index"):n.push(""+t[a]);return n.join()}function hP(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims,u=T.util.parseAxisParam(o,a.shape)[0];if(T.env().get("DEBUG"))for(var l=t.readSync(i.dataId),c=a.shape[u],f=function(C){var R=l[C];T.util.assert(R<=c-1&&R>=0,function(){return"GatherV2: the index value "+R+" is not in [0, "+(c-1)+"]"})},h=0;h<l.length;++h)f(h);var p=T.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),d=T.util.sizeFromShape(i.shape),v=[],m=Me({inputs:{x:a},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=Me({inputs:{x:i},backend:t,attrs:{shape:[p.batchSize,d/p.batchSize]}});v.push(m),v.push(g);var y=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize];if(t.shouldExecuteOnCPU([a,i])||a.dtype==="string"){var b=t.bufferSync(g),w=t.bufferSync(m),k=rNe(w,b,y);return v.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),t.makeTensorInfo(p.outputShape,k.dtype,k.values)}var S=new K3e(m.shape,y),E=t.runWebGLProgram(S,[m,g],m.dtype);v.push(E);var N=Me({inputs:{x:E},backend:t,attrs:{shape:p.outputShape}});return v.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),N}var X3e={kernelName:T.GatherV2,backendName:"webgl",kernelFunc:hP};var Y3e="return float(a > b);",Z3e=`
  return vec4(greaterThan(a, b));
`,Q3e=cn({opSnippet:Y3e,packedOpSnippet:Z3e,cpuKernelImpl:nNe,dtype:"bool"}),J3e={kernelName:T.Greater,backendName:"webgl",kernelFunc:Q3e};var eDe="return float(a >= b);",tDe=`
  return vec4(greaterThanEqual(a, b));
`,rDe=cn({opSnippet:eDe,packedOpSnippet:tDe,dtype:"bool",cpuKernelImpl:aNe}),nDe={kernelName:T.GreaterEqual,backendName:"webgl",kernelFunc:rDe};function aDe(r){var e=r.inputs,t=r.backend,n=e.input;return fP(n,!0,t)}var iDe={kernelName:T.IFFT,backendName:"webgl",kernelFunc:aDe};var oDe="return float(!isnan(x) && !isinf(x));",sDe=It({opSnippet:oDe,dtype:"bool"}),uDe={kernelName:T.IsFinite,backendName:"webgl",kernelFunc:sDe};var lDe="return float(isinf(x));",cDe=It({opSnippet:lDe,dtype:"bool"}),fDe={kernelName:T.IsInf,backendName:"webgl",kernelFunc:cDe};var hDe="return float(isnan(x));",pDe=It({opSnippet:hDe,dtype:"bool"}),dDe={kernelName:T.IsNan,backendName:"webgl",kernelFunc:pDe};var vDe="return float(a < b);",mDe=`
  return vec4(lessThan(a, b));
`,gDe=cn({opSnippet:vDe,packedOpSnippet:mDe,cpuKernelImpl:iNe,dtype:"bool"}),yDe={kernelName:T.Less,backendName:"webgl",kernelFunc:gDe};var bDe="return float(a <= b);",wDe=`
  return vec4(lessThanEqual(a, b));
`,xDe=cn({opSnippet:bDe,packedOpSnippet:wDe,cpuKernelImpl:oNe,dtype:"bool"}),kDe={kernelName:T.LessEqual,backendName:"webgl",kernelFunc:xDe};function SDe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=sNe(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var EDe={kernelName:T.LinSpace,backendName:"webgl",kernelFunc:SDe};var TDe=Jl+`
  return x < 0.0 ? 0./0. : log(x);
`,IDe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,NDe=It({opSnippet:TDe,packedOpSnippet:IDe,cpuKernelImpl:uNe}),CDe={kernelName:T.Log,backendName:"webgl",kernelFunc:NDe};var ADe=Jl+`
  return log(1.0 + x);
`,_De=It({opSnippet:ADe}),DDe={kernelName:T.Log1p,backendName:"webgl",kernelFunc:_De};var FDe="return float(a >= 1.0 && b >= 1.0);",RDe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,MDe=cn({opSnippet:FDe,packedOpSnippet:RDe,dtype:"bool"}),ODe={kernelName:T.LogicalAnd,backendName:"webgl",kernelFunc:MDe};var PDe="return float(!(x >= 1.0));",LDe=It({opSnippet:PDe}),BDe={kernelName:T.LogicalNot,backendName:"webgl",kernelFunc:LDe};var zDe="return float(a >= 1.0 || b >= 1.0);",$De=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,WDe=cn({opSnippet:zDe,packedOpSnippet:$De,dtype:"bool"}),VDe={kernelName:T.LogicalOr,backendName:"webgl",kernelFunc:WDe};var UDe=(function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[];var o=t,s=e[3]-1;this.outputShape=e;var u,l="float("+n+") + float("+a+") * sum";i===.5?u="inversesqrt("+l+")":i===1?u="1.0/("+l+")":u="exp(log("+l+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+u+`;
        setOutput(val);
      }
    `}return r})();var GDe=(function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,s=e[3]-1;this.outputShape=e;var u,l="float("+n+") + float("+a+") * sum";i===.5?u="inversesqrt("+l+")":i===1?u="1.0/("+l+")":u="exp(log("+l+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+u+`;
        setOutput(result);
      }
    `}return r})();var HDe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta,l=T.env().getBool("WEBGL_PACK_NORMALIZATION")?new GDe(a.shape,i,o,s,u):new UDe(a.shape,i,o,s,u);return t.runWebGLProgram(l,[a],a.dtype)},qDe={kernelName:T.LRN,backendName:"webgl",kernelFunc:HDe};var KDe=(function(){function r(e,t,n,a,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=a,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+a+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+a+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}return r})();var jDe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,l=n.alpha,c=n.beta,f=new KDe(a.shape,s,u,l,c);return t.runWebGLProgram(f,[a,i,o],a.dtype)},XDe={kernelName:T.LRNGrad,backendName:"webgl",kernelFunc:jDe};function YDe(r,e,t,n){var a=T.util.sizeFromShape(e),i=T.util.sizeFromShape(r.shape),o=i/a,s=Me({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=Su(s,r.dtype,"max",n),l=Me({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),l}function pP(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=a.shape.length,u=T.util.parseAxisParam(i,a.shape),l=u,c=T.backend_util.getAxesPermutation(l,s),f=c!=null,h=t.shouldExecuteOnCPU([a]),p=a;if(f){if(h){for(var d=t.texData.get(p.dataId),v=d.values,m=new Array(s),g=0;g<m.length;g++)m[g]=a.shape[c[g]];var y=Hw(v,a.shape,a.dtype,c,m);p=t.makeTensorInfo(m,a.dtype);var b=t.texData.get(p.dataId);b.values=y}else p=um(a,c,t);l=T.backend_util.getInnerMostAxes(l.length,s)}T.backend_util.assertAxesAreInnerMostDims("max",l,s);var w=Ve(T.backend_util.computeOutAndReduceShapes(p.shape,l),2),k=w[0],S=w[1],E=k;o&&(E=T.backend_util.expandShapeToKeepDim(k,u));var N;if(h){var d=t.texData.get(p.dataId),v=d.values,C=lNe(v,T.util.sizeFromShape(S),E,a.dtype);N=t.makeTensorInfo(E,a.dtype);var R=t.texData.get(N.dataId);R.values=C}else N=YDe(p,S,E,t);return f&&t.disposeIntermediateTensorInfo(p),N}var ZDe={kernelName:T.Max,backendName:"webgl",kernelFunc:pP};var QDe=Kw+`
  return max(a, b);
`,JDe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Th+`
  return result;
`,eFe=cn({opSnippet:QDe,packedOpSnippet:JDe,cpuKernelImpl:cNe}),tFe={kernelName:T.Maximum,backendName:"webgl",kernelFunc:eFe};function rFe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;jl(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=1;T.util.assert(T.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+l+"'")});var c=T.backend_util.computePool2DInfo(a.shape,i,o,l,s,u);if(c.filterWidth===1&&c.filterHeight===1&&T.util.arraysEqual(c.inShape,c.outShape))return sa({inputs:{x:a},backend:t});var f=new xh(c,"max",!1);return t.runWebGLProgram(f,[a],a.dtype)}var nFe={kernelName:T.MaxPool,backendName:"webgl",kernelFunc:rFe};function aFe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dimRoundingMode,c=[1,1,1],f=T.backend_util.computePool3DInfo(a.shape,i,o,c,s,l,u),h=new Xw(f,"max",!1);return t.runWebGLProgram(h,[a],a.dtype)}var iFe={kernelName:T.MaxPool3D,backendName:"webgl",kernelFunc:aFe};var oFe=(function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,a=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=i-1-e.padInfo.top,u=o-1-e.padInfo.left,l=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+l+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}return r})(),sFe=(function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterDepth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,f=u-1-e.padInfo.front,h=l-1-e.padInfo.top,p=c-1-e.padInfo.left,d=u*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+h+", "+p+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+l+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+d+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+l+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r})();function uFe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,l=n.pad,c=n.dimRoundingMode,f=[1,1,1],h=T.backend_util.computePool3DInfo(o.shape,s,u,f,l,c),p=new Xw(h,"max",!0),d=t.runWebGLProgram(p,[o],o.dtype),v=new sFe(h),m=t.runWebGLProgram(v,[a,d],o.dtype);return t.disposeIntermediateTensorInfo(d),m}var lFe={kernelName:T.MaxPool3DGrad,backendName:"webgl",kernelFunc:uFe};function cFe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;jl([i,o],"maxPoolGrad");var u=n.filterSize,l=n.strides,c=n.pad,f=n.dimRoundingMode,h=T.backend_util.computePool2DInfo(s.shape,u,l,1,c,f),p=!0,d=new xh(h,"max",p),v=t.runWebGLProgram(d,[s],s.dtype),m=new oFe(h),g=t.runWebGLProgram(m,[a,v],s.dtype);return t.disposeIntermediateTensorInfo(v),g}var fFe={kernelName:T.MaxPoolGrad,backendName:"webgl",kernelFunc:cFe};function hFe(r,e,t,n){var a=new xh(t,"max",!1),i=n.runWebGLProgram(a,[r],"float32");a=new xh(t,"max",!0,!0,e);var o=n.runWebGLProgram(a,[r],"float32");return[i,o]}var pFe={kernelName:T.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,l=n;T.util.assert(a.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.shape.length+"."});var c=[1,1];T.util.assert(T.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+c+"'")});var f=T.backend_util.computePool2DInfo(a.shape,i,o,c,s),h=Ve(hFe(a,u,f,l),2),p=h[0],d=h[1];return[p,d]}};function dFe(r,e,t,n){var a=T.util.sizeFromShape(e),i=T.util.sizeFromShape(r.shape),o=i/a,s=Me({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=Su(s,"float32","mean",n),l=Me({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),l}var vFe={kernelName:T.Mean,backendName:"webgl",kernelFunc:function(r){var e,t,n=r.inputs,a=r.attrs,i=r.backend,o=n.x,s=a.keepDims,u=a.axis,l=i,c=o.shape.length,f=T.util.parseAxisParam(u,o.shape),h=f,p=T.backend_util.getAxesPermutation(h,c),d=p!=null,v=l.shouldExecuteOnCPU([o]),m=[],g=o;if(d){if(v){for(var y=l.texData.get(g.dataId),b=y.values,w=new Array(c),k=0;k<w.length;k++)w[k]=o.shape[p[k]];var S=Hw(b,o.shape,o.dtype,p,w);g=l.makeTensorInfo(w,o.dtype);var E=l.texData.get(g.dataId);E.values=S}else g=um(o,p,l);m.push(g),h=T.backend_util.getInnerMostAxes(h.length,c)}T.backend_util.assertAxesAreInnerMostDims("sum",h,c);var N=Ve(T.backend_util.computeOutAndReduceShapes(g.shape,h),2),C=N[0],R=N[1],_=C;s&&(_=T.backend_util.expandShapeToKeepDim(C,f));var O=dFe(g,R,_,l);try{for(var P=oa(m),B=P.next();!B.done;B=P.next()){var k=B.value;l.disposeIntermediateTensorInfo(k)}}catch(W){e={error:W}}finally{try{B&&!B.done&&(t=P.return)&&t.call(P)}finally{if(e)throw e.error}}return O}};function mFe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=T.util.parseAxisParam(i,a.shape),l=u,c=T.backend_util.getAxesPermutation(l,s),f=a;c!=null&&(f=xn({inputs:{x:a},backend:t,attrs:{perm:c}}),l=T.backend_util.getInnerMostAxes(l.length,a.shape.length)),T.backend_util.assertAxesAreInnerMostDims("min",l,s);var h=Ve(T.backend_util.computeOutAndReduceShapes(f.shape,l),2),p=h[0],d=h[1],v=T.util.sizeFromShape(d),m=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=Su(m,m.dtype,"min",t),y;if(o){var b=T.backend_util.expandShapeToKeepDim(p,u);y=Me({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Me({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),c!=null&&t.disposeIntermediateTensorInfo(f),y}var gFe={kernelName:T.Min,backendName:"webgl",kernelFunc:mFe};var yFe=Kw+`
  return min(a, b);
`,bFe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Th+`
  return result;
`,wFe=cn({opSnippet:yFe,packedOpSnippet:bFe,cpuKernelImpl:fNe}),xFe={kernelName:T.Minimum,backendName:"webgl",kernelFunc:wFe};var kFe=(function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(c,f){return c[0]+e[f]+c[1]});var a=e.length,i=Zt(a),o=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,f){return c[0]+e[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),l=n==="reflect"?0:1;if(a===1){this.userCode=`
        int start = `+o+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - `+l+`;
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + `+l+`;
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        for (int i = 0; i < `+a+`; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - `+l+`;
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + `+l+`;
          }
        }
        `+i+` coords = outC - start;
        setOutput(getX(`+u+`));
      }
    `}return r})();var SFe=(function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(v,m){return v[0]+e[m]+v[1]});var a=e.length,i=Zt(a),o=t.map(function(v){return v[0]}).join(","),s=t.map(function(v,m){return v[0]+e[m]}).join(","),u=wn("rc",a),l=wn("source",a),c=u[a-1]+" < "+this.outputShape[a-1],f=a===1?"source":"vec2("+l.slice(-2).join()+")",h=n==="reflect"?0:1,p="";if(a===1){var d=`
        `+i+` source = rc;
        if (source < start) {
          source = start * 2 - source - `+h+`;
        } else if (source >= end) {
          source = (end - 1) * 2 - source + `+h+`;
        }
        source -= start;
      `;p=`
        `+i+` rc = outputLoc;
        `+d+`
        result[0] = getChannel(getX(`+l.join()+"), "+f+`);
        `+u[a-1]+` += 1;
        if(`+c+`) {
          `+d+`
          result[1] = getChannel(getX(`+l.join()+"), "+f+`);
        }
      `}else{var d=`
        `+i+` source = rc;
        `+i+" lt = "+i+`(lessThan(source, start));
        `+i+" gte = "+i+`(greaterThanEqual(source, end));
        `+i+` orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - `+h+`) +
                gte * ((end - 1) * 2 - source + `+h+`);
        source -= start;
      `;p=`
        `+i+` rc = outputLoc;
        `+d+`
        result[0] = getChannel(getX(`+l.join()+"), "+f+`);
        `+u[a-1]+` += 1;
        if(`+c+`) {
          `+d+`
          result[1] = getChannel(getX(`+l.join()+"), "+f+`);
        }
        rc = outputLoc;
        `+u[a-2]+` += 1;
        if(`+u[a-2]+" < "+this.outputShape[a-2]+`) {
          `+d+`
          result[2] = getChannel(getX(`+l.join()+"), "+f+`);
          `+u[a-1]+` += 1;
          if(`+c+`) {
            `+d+`
            result[3] = getChannel(getX(`+l.join()+"), "+f+`);
          }
        }
      `}this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+p+`
        setOutput(result);
      }
    `}return r})();var EFe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode,s=T.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new SFe(a.shape,i,o):new kFe(a.shape,i,o),u=t.runWebGLProgram(s,[a],a.dtype);return u},TFe={kernelName:T.MirrorPad,backendName:"webgl",kernelFunc:EFe};var IFe=`if (b == 0.0) return NAN;
  return mod(a, b);`,NFe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Th+`
  return result;
`,CFe=cn({opSnippet:IFe,packedOpSnippet:NFe}),AFe={kernelName:T.Mod,backendName:"webgl",kernelFunc:CFe};var _Fe=(function(){function r(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r})();var DFe=`
if (a == b) {
  return 1.0;
};
return a / b;`,FFe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,dP=cn({opSnippet:DFe,packedOpSnippet:FFe,checkOutOfBounds:!0}),RFe={kernelName:T.RealDiv,backendName:"webgl",kernelFunc:dP};var $M="return a - b;",vP=cn({opSnippet:$M,packedOpSnippet:$M,supportsComplex:!0,cpuKernelImpl:_Ne}),MFe={kernelName:T.Sub,backendName:"webgl",kernelFunc:vP};function mP(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=T.util.parseAxisParam([i],a.shape),s=pP({inputs:{x:a},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=T.backend_util.expandShapeToKeepDim(s.shape,o),l=Me({inputs:{x:s},backend:t,attrs:{shape:u}}),c=vP({inputs:{a,b:l},backend:t}),f=cP({inputs:{x:c},backend:t}),h=lm({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),p=Me({inputs:{x:h},backend:t,attrs:{shape:u}}),d=dP({inputs:{a:f,b:p},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),d}var OFe={kernelName:T.Softmax,backendName:"webgl",kernelFunc:mP};function PFe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized,u=s?a:mP({inputs:{logits:a},backend:t,attrs:{dim:a.shape.length-1}}),l=u.shape[0],c=u.shape[1],f=new _Fe(l,c,i),h=[[o]],p=t.runWebGLProgram(f,[u],"int32",h);return s||t.disposeIntermediateTensorInfo(u),p}var LFe={kernelName:T.Multinomial,backendName:"webgl",kernelFunc:PFe},BFe=ri+`
  return -x;
`,zFe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function $Fe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])){var a=t.texData.get(n.dataId),i=Ve(pNe(a.values,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var u;return T.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?u=new yu(n.shape,zFe):u=new mo(n.shape,BFe),t.runWebGLProgram(u,[n],n.dtype)}var WFe={kernelName:T.Neg,backendName:"webgl",kernelFunc:$Fe};var VFe=T.kernel_impls.nonMaxSuppressionV3Impl;function UFe(r){T.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=t.readSync(a.dataId),c=t.readSync(i.dataId),f=VFe(l,c,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var GFe={kernelName:T.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:UFe};var HFe=T.kernel_impls.nonMaxSuppressionV4Impl;function qFe(r){T.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=n.padToMaxOutputSize,c=t.readSync(a.dataId),f=t.readSync(i.dataId),h=HFe(c,f,o,s,u,l),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var KFe={kernelName:T.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:qFe};var jFe=T.kernel_impls.nonMaxSuppressionV5Impl;function XFe(r){T.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=n.softNmsSigma,c=t.readSync(a.dataId),f=t.readSync(i.dataId),h=o,p=s,d=u,v=l,m=jFe(c,f,h,p,d,v),g=m.selectedIndices,y=m.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var YFe={kernelName:T.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:XFe};var ZFe=(function(){function r(e,t,n,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+a+"), float("+n+`),
                      float(index == coords.y)));
      }
    `}return r})(),QFe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue,l=T.util.sizeFromShape(a.shape),c=new ZFe(l,o,s,u),f=Me({inputs:{x:a},backend:t,attrs:{shape:[l]}}),h=t.runWebGLProgram(c,[f],i);t.disposeIntermediateTensorInfo(f);var p=Gr(a.shape,[o]),d=Me({inputs:{x:h},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(h),d},JFe={kernelName:T.OneHot,backendName:"webgl",kernelFunc:QFe};function om(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="complex64"){var a=Nh({inputs:{input:n},backend:t}),i=om({inputs:{x:a},backend:t}),o=cm({inputs:{input:n},backend:t}),s=om({inputs:{x:o},backend:t}),u=as({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Ch({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:t})}var eRe={kernelName:T.ZerosLike,backendName:"webgl",kernelFunc:om};function gP(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){var a=Nh({inputs:{input:n},backend:t}),i=gP({inputs:{x:a},backend:t}),o=cm({inputs:{input:n},backend:t}),s=om({inputs:{x:o},backend:t}),u=as({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Ch({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:t})}var tRe={kernelName:T.OnesLike,backendName:"webgl",kernelFunc:gP};function rRe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return Mw({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(c){T.util.assertShapesMatch(i,c.shape,"All tensors passed to stack must have matching shapes"),T.util.assert(o===c.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(c){var f=Mw({inputs:{input:c},backend:t,attrs:{dim:a}});return s.push(f),f}),l=rP({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(c){return t.disposeIntermediateTensorInfo(c)}),l}var nRe={kernelName:T.Pack,backendName:"webgl",kernelFunc:rRe};var aRe=(function(){function r(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(l,c){return l[0]+e[c]+l[1]});var a=e.length,i=Zt(a),o=t.map(function(l){return l[0]}).join(","),s=t.map(function(l,c){return l[0]+e[c]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);if(a===1){this.userCode=`
        int start = `+o+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+u+`));
        }
      }
    `}return r})();var iRe=(function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(g,y){return g[0]+e[y]+g[1]});for(var a=e.length,i=Zt(a),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,y){return g[0]+e[y]}).join(","),u=wn("rc",a),l=wn("source",a),c=u[a-1]+" < "+this.outputShape[a-1],f=a===1?"source":"vec2("+l.slice(-2).join()+")",h=[i+" rc = outputLoc;",u[a-1]+` += 1;
       if(`+c+`) {
      `,a===1?"":`}
       rc = outputLoc;
       `+u[a-2]+` += 1;
       if(`+u[a-2]+" < "+this.outputShape[a-2]+") {",a===1?"":"  "+u[a-1]+` += 1;
         if(`+c+") {"],p=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",v=0,m=a===1?2:4;v<m;v++)d+=`
        `+h[v]+`
        if (`+p+`) {
          result[`+v+`] = float(value);
        } else {
          `+i+` source = rc - start;
          result[`+v+"] = getChannel(getX("+l.join()+"), "+f+`);
        }
      `;d+=a===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+d+`
        setOutput(result);
      }
    `}return r})();var yP=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;if(T.util.sizeFromShape(a.shape)===0){var s=i.map(function(c,f){return c[0]+a.shape[f]+c[1]});return Ch({backend:t,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=T.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new iRe(a.shape,i,o):new aRe(a.shape,i,o),l=[[o]];return t.runWebGLProgram(u,[a],a.dtype,l)},oRe={kernelName:T.PadV2,backendName:"webgl",kernelFunc:yP};var sRe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,uRe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Th+`
  return result;
`,lRe=cn({opSnippet:sRe,packedOpSnippet:uRe}),cRe={kernelName:T.Pow,backendName:"webgl",kernelFunc:lRe};function fRe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=[],l=T.util.parseAxisParam(i,a.shape),c=l,f=T.backend_util.getAxesPermutation(c,s),h=a;f!=null&&(h=xn({inputs:{x:a},backend:t,attrs:{perm:f}}),c=T.backend_util.getInnerMostAxes(c.length,s),u.push(h)),T.backend_util.assertAxesAreInnerMostDims("prod",c,s);var p;if(t.shouldExecuteOnCPU([h])){var d=t.texData.get(h.dataId).values,v=vNe(h.shape,h.dtype,d,c),m=v.outVals,g=v.outShape,y=v.outDtype;p=t.makeTensorInfo(g,y,m)}else{var b=Ve(T.backend_util.computeOutAndReduceShapes(h.shape,c),2),g=b[0],w=b[1],k=T.util.sizeFromShape(w),S=Me({inputs:{x:h},backend:t,attrs:{shape:[-1,k]}}),E=T.sumOutType(a.dtype),N=Su(S,E,"prod",t);p=Me({inputs:{x:N},backend:t,attrs:{shape:g}}),u.push(S),u.push(N)}if(o){u.push(p);var C=T.backend_util.expandShapeToKeepDim(p.shape,l);p=Me({inputs:{x:p},backend:t,attrs:{shape:C}})}return u.forEach(function(R){return t.disposeIntermediateTensorInfo(R)}),p}var hRe={kernelName:T.Prod,backendName:"webgl",kernelFunc:fRe};function pRe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.readSync(g.dataId)}),u=a.map(function(g){return g.shape}),l=t.readSync(i.dataId),c=t.readSync(o.dataId),f=Ve(mNe(s,u,l,i.shape,i.dtype,c,o.shape),3),h=f[0],p=f[1],d=f[2],v=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),m=t.makeTensorInfo(d,i.dtype,p);return v.concat([m])}var dRe={kernelName:T.RaggedGather,backendName:"webgl",kernelFunc:pRe};function vRe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,l=t.readSync(a.dataId),c=t.readSync(i.dataId),f=t.readSync(o.dataId),h=s.map(function(g){return t.readSync(g.dataId)}),p=s.map(function(g){return g.shape}),d=Ve(gNe(l,a.shape,c,i.shape,i.dtype,f,o.shape,h,p,u),2),v=d[0],m=d[1];return t.makeTensorInfo(v,i.dtype,m)}var mRe={kernelName:T.RaggedTensorToTensor,backendName:"webgl",kernelFunc:vRe};var bP=function(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.step,o=t.dtype,s=yNe(n,a,i,o);return e.makeTensorInfo([s.length],o,s)},gRe={kernelName:T.Range,backendName:"webgl",kernelFunc:bP};var yRe="return 1.0 / x;",bRe=It({opSnippet:yRe}),wRe={kernelName:T.Reciprocal,backendName:"webgl",kernelFunc:bRe};var xRe=ri+`
  return (x < 0.0) ? 0.0 : x;
`,kRe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,SRe=It({opSnippet:xRe,packedOpSnippet:kRe}),ERe={kernelName:T.Relu,backendName:"webgl",kernelFunc:SRe};var TRe=ri+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,IRe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,NRe=It({opSnippet:TRe,packedOpSnippet:IRe}),CRe={kernelName:T.Relu6,backendName:"webgl",kernelFunc:NRe};var ARe=(function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Ve(e,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,t,n,c];var f=[a&&t>1?u-1:u,a&&n>1?l-1:l],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+u+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `+p+`;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}return r})();var _Re=(function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Ve(e,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,t,n,c];var f=[a&&t>1?u-1:u,a&&n>1?l-1:l],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`,
          `+f[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+u+".0, "+l+`.0,
                                     `+l+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `+p+`;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(c-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}return r})();function DRe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Ve(s,2),l=u[0],c=u[1],f=T.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new _Re(a.shape,l,c,i,o):new ARe(a.shape,l,c,i,o);return t.runWebGLProgram(f,[a],"float32")}var FRe={kernelName:T.ResizeBilinear,backendName:"webgl",kernelFunc:DRe};var RRe=(function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Ve(t,3),i=a[1],o=a[2],s=Ve(e,3),u=s[1],l=s[2],c=[n&&u>1?i-1:i,n&&l>1?o-1:o],f=[n&&u>1?u-1:u,n&&l>1?l-1:l],h=c[0]/f[0],p=c[1]/f[1],d=1/h,v=1/p,m=Math.ceil(d)*2+2,g=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+v+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}return r})();function MRe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new RRe(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var ORe={kernelName:T.ResizeBilinearGrad,backendName:"webgl",kernelFunc:MRe};var PRe=(function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Ve(e,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,t,n,c];var f=[a&&t>1?u-1:u,a&&n>1?l-1:l],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+u+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `+d+`;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+p+`)));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}return r})();var LRe=(function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Ve(e,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,t,n,c];var f=[a&&t>1?u-1:u,a&&n>1?l-1:l],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`,
          `+f[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+u+".0, "+l+`.0,
                                     `+l+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `+d+`;

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+p+`)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(c-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}return r})();function BRe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Ve(s,2),l=u[0],c=u[1],f=T.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new LRe(a.shape,l,c,i,o):new PRe(a.shape,l,c,i,o);return t.runWebGLProgram(f,[a],a.dtype)}var zRe={kernelName:T.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:BRe};var $Re=(function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Ve(t,3),i=a[1],o=a[2],s=Ve(e,3),u=s[1],l=s[2],c=[n&&u>1?i-1:i,n&&l>1?o-1:o],f=[n&&u>1?u-1:u,n&&l>1?l-1:l],h=c[0]/f[0],p=c[1]/f[1],d=1/h,v=1/p,m=Math.ceil(d)*2+2,g=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+v+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+f[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+f[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}return r})();function WRe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new $Re(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var VRe={kernelName:T.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:WRe};var URe=(function(){function r(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `;return}var a=function(s){return t.indexOf(s)!==-1&&e[s]!==1?e[s]+" - coords["+s+"] - 1":"coords["+s+"]"},i=e.map(function(s,u){return a(u)}).join(","),o=Zt(n);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+i+`));
      }
    `}return r})();var GRe=(function(){function r(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var a=wn("rc",n),i=a[n-1]+" + 1 < "+this.outputShape[n-1],o=a[n-2]+" + 1 < "+this.outputShape[n-2],s=Zt(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+u(a.slice())+`;
          if(`+i+`){
            result.g = `+l(a.slice())+`;
          }
          if(`+o+`) {
            result.b = `+c(a.slice())+`;
            if(`+i+`) {
              result.a = `+f(a.slice())+`;
            }
          }
          setOutput(result);
        }
    `;function u(d){return h(d)}function l(d){return d[n-1]="("+d[n-1]+" + 1)",h(d)}function c(d){return d[n-2]="("+d[n-2]+" + 1)",h(d)}function f(d){return d[n-1]="("+d[n-1]+" + 1)",d[n-2]="("+d[n-2]+" + 1)",h(d)}function h(d){var v=e.map(function(y,b){return p(b,d)}),m=v.join(","),g=v.slice(-2).join(",");return"getChannel(getX("+m+"), vec2("+g+"))"}function p(d,v){return t.indexOf(d)!==-1&&e[d]!==1?e[d]+" - "+v[d]+" - 1":""+v[d]}}return r})();function HRe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims,o=a.shape.length,s=T.util.parseAxisParam(i,a.shape);if(o===0)return sa({inputs:{x:a},backend:t});var u=T.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new GRe(a.shape,s):new URe(a.shape,s);return t.runWebGLProgram(u,[a],a.dtype)}var qRe={kernelName:T.Reverse,backendName:"webgl",kernelFunc:HRe};var KRe=(function(){function r(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var n=e[1],a=e[2];this.outputShape=e;var i="";typeof t=="number"?i="float outputValue = "+t.toFixed(2)+";":i=`
        vec3 fill = vec3(`+t.join(",")+`);
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          `+i+`
          if(coordX >= 0 && coordX < `+a+" && coordY >= 0 && coordY < "+n+`) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}return r})(),jRe={kernelName:T.RotateWithOffset,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,l=new KRe(a.shape,o),c=Ve(T.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),2),f=c[0],h=c[1],p=[[f,h,Math.sin(i),Math.cos(i)]],d=u.runWebGLProgram(l,[a],a.dtype,p);return d}};var XRe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,YRe=It({opSnippet:XRe}),ZRe={kernelName:T.Round,backendName:"webgl",kernelFunc:YRe};var QRe="return inversesqrt(x);",JRe=It({opSnippet:QRe,cpuKernelImpl:bNe}),eMe={kernelName:T.Rsqrt,backendName:"webgl",kernelFunc:JRe};var wP=(function(){function r(e,t,n,a,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=Zt(i.length),l=Zt(o.length),c="";n===1?c="i":n===2&&(c="i, j");var f="getIndices("+c+")",h="";a===1?h="i":a===2&&(h="i, coords[1]");var p="getUpdates("+h+")",d=t>1?"strides[j]":"strides";this.userCode=`
        `+u+" strides = "+u+"("+i+`);

        void main() {
          `+l+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+f+`);
              flattenedIndex += index * `+d+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+p+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}return r})();function tMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=T.backend_util.calculateShapes(i,a,o),u=s.sliceRank,l=s.numUpdates,c=s.sliceSize,f=s.strides,h=s.outputSize,p=[h/c,c];if(h===0)return t.makeTensorInfo(o,a.dtype);var d=Me({inputs:{x:a},backend:t,attrs:{shape:[l,u]}}),v=Me({inputs:{x:i},backend:t,attrs:{shape:[l,c]}}),m=t.makeTensorInfo([],"float32",new Float32Array([0])),g=new wP(l,u,d.shape.length,v.shape.length,f,p),y=t.runWebGLProgram(g,[v,d,m],v.dtype),b=Me({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(m),b}var rMe={kernelName:T.ScatterNd,backendName:"webgl",kernelFunc:tMe};var nMe=(function(){function r(e,t,n,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];var i="while (left < right) {",o="for (int i = 0; i < "+Math.ceil(Math.log2(t+1))+"; ++i) { if (left >= right) break;",s=T.env().getNumber("WEBGL_VERSION")===2?i:o,u=a==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         `+s+`
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) `+u+` value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}return r})();function aMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=new nMe(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return t.runWebGLProgram(s,[a,i],"int32",u)}var iMe={kernelName:T.SearchSorted,backendName:"webgl",kernelFunc:aMe};var oMe=(function(){function r(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;var a,i;if(n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],l=0;l<t.length;l++)u.push(""+o[l]),l<e&&s.push(""+o[l]);a=s.join(),i=u.join()}var c=Zt(n);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+a+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `}return r})();function sMe(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e,o=new oMe(n.shape.length,a.shape,a.shape.length);return t.runWebGLProgram(o,[n,a,i],T.upcastType(a.dtype,i.dtype))}var uMe={kernelName:T.Select,backendName:"webgl",kernelFunc:sMe};var lMe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+T.backend_util.SELU_SCALEALPHA+`;
  float scale = `+T.backend_util.SELU_SCALE+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,cMe=It({opSnippet:lMe}),fMe={kernelName:T.Selu,backendName:"webgl",kernelFunc:cMe};var hMe=Jl+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,pMe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,dMe=It({opSnippet:hMe,packedOpSnippet:pMe,cpuKernelImpl:xNe}),vMe={kernelName:T.Sigmoid,backendName:"webgl",kernelFunc:dMe};var mMe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,gMe=It({opSnippet:mMe}),yMe={kernelName:T.Sign,backendName:"webgl",kernelFunc:gMe};var bMe=Jl+`
  return sin(x);
`,wMe=It({opSnippet:bMe}),xMe={kernelName:T.Sin,backendName:"webgl",kernelFunc:wMe};var kMe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,SMe=It({opSnippet:kMe}),EMe={kernelName:T.Sinh,backendName:"webgl",kernelFunc:SMe};var TMe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,IMe=It({opSnippet:TMe}),NMe={kernelName:T.Softplus,backendName:"webgl",kernelFunc:IMe},CMe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;T.util.assert(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=[[0,0]];u.push.apply(u,Gr(o));for(var l=1+i.length;l<a.shape.length;++l)u.push([0,0]);var c=[],f=yP({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),h=T.backend_util.getReshaped(f.shape,i,s,!1),p=T.backend_util.getPermuted(h.length,i.length,!1),d=T.backend_util.getReshapedPermuted(f.shape,i,s,!1),v=Me({inputs:{x:f},backend:t,attrs:{shape:h}}),m=xn({inputs:{x:v},backend:t,attrs:{perm:p}}),g=Me({inputs:{x:m},backend:t,attrs:{shape:d}});return c.push(f),c.push(v),c.push(m),c.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},AMe={kernelName:T.SpaceToBatchND,backendName:"webgl",kernelFunc:CMe};function _Me(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         `+i.shape);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         `+n.shape);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         `+a.shape);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `+o.shape);var s=t.readSync(n.dataId),u=t.readSync(a.dataId),l=t.readSync(i.dataId),c=t.readSync(o.dataId)[0],f=Ve(SNe(s,n.shape,n.dtype,u,a.dtype,l,c),5),h=f[0],p=f[1],d=f[2],v=f[3],m=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(function(g){return Number(g)}))),t.makeTensorInfo([m.length],n.dtype,new Int32Array(m))]}var DMe={kernelName:T.SparseFillEmptyRows,backendName:"webgl",kernelFunc:_Me};function FMe(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error("Input indices should be a matrix but received shape "+n.shape);if(a.shape.length!==1)throw new Error("Input shape should be a vector but received shape "+a.shape);if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape "+i.shape);var o=Array.from(t.readSync(a.dataId)),s=t.readSync(n.dataId),u=Array.from(t.readSync(i.dataId)),l=Ve(ENe(s,n.shape,n.dtype,o,u),3),c=l[0],f=l[1],h=l[2];return[t.makeTensorInfo(f,n.dtype,c),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var RMe={kernelName:T.SparseReshape,backendName:"webgl",kernelFunc:FMe};function MMe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              `+a.shape);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              `+i.shape);var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),l=Ve(VO(o,n.shape,n.dtype,s,u,!0),2),c=l[0],f=l[1];return t.makeTensorInfo(f,n.dtype,c)}var OMe={kernelName:T.SparseSegmentMean,backendName:"webgl",kernelFunc:MMe};function PMe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             `+a.shape);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             `+i.shape);var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),l=Ve(VO(o,n.shape,n.dtype,s,u),2),c=l[0],f=l[1];return t.makeTensorInfo(f,n.dtype,c)}var LMe={kernelName:T.SparseSegmentSum,backendName:"webgl",kernelFunc:PMe};function BMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=T.backend_util.calculateShapes(i,a,s),l=u.sliceRank,c=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1;if(i.dtype==="string"){var v=t.bufferSync(a),m=t.bufferSync(i),g=T.util.decodeString(t.readSync(o.dataId)[0]),y=wNe(v,m,s,p,f,c,l,h,g,d);return t.makeTensorInfo(s,y.dtype,y.values)}var b=new wP(c,l,a.shape.length,i.shape.length,h,[p,1],d),w=t.runWebGLProgram(b,[i,a,o],i.dtype),k=Me({inputs:{x:w},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(w),k}var zMe={kernelName:T.SparseToDense,backendName:"webgl",kernelFunc:BMe};function $Me(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=T.util.parseAxisParam(o,a.shape)[0],u=T.backend_util.prepareSplitSize(a,i,s),l=a.shape.length,c=new Array(l).fill(0),f=a.shape.slice();return u.map(function(h){var p=Gr(f);p[s]=h;var d=ec({inputs:{x:a},backend:t,attrs:{begin:c,size:p}});return c[s]+=h,d})}var WMe={kernelName:T.SplitV,backendName:"webgl",kernelFunc:$Me};var WM="return sqrt(x);",VMe=It({opSnippet:WM,packedOpSnippet:WM,cpuKernelImpl:TNe}),UMe={kernelName:T.Sqrt,backendName:"webgl",kernelFunc:VMe};var GMe="return x * x;",HMe=It({opSnippet:GMe}),qMe={kernelName:T.Square,backendName:"webgl",kernelFunc:HMe};var VM="return (a - b) * (a - b);",KMe=cn({opSnippet:VM,packedOpSnippet:VM}),jMe={kernelName:T.SquaredDifference,backendName:"webgl",kernelFunc:KMe};function XMe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=ri+(`
    return x > 0.0 ? 1.0 : float(`+t.alpha+`);
  `),o=new mo(a.shape,i);return n.runWebGLProgram(o,[a],a.dtype)}var YMe={kernelName:T.Step,backendName:"webgl",kernelFunc:XMe};var ZMe=(function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=n;var a=n.length,i=Zt(n.length),o=Zt(n.length),s="";if(a===1)s="coords * strides + begin";else{var u=0;s=n.map(function(l,c){return u++,n.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(u-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+e+`);
      `+i+" strides = "+i+"("+t+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `}return r})();function QMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,l=n.endMask,c=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask,p=T.slice_util.sliceInfo(a.shape,i,o,s,u,l,c,f,h),d=p.finalShapeSparse,v=p.finalShape,m=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,b=p.begin,w=p.end,k=p.strides,S;if(m)S=Me({inputs:{x:a},backend:t,attrs:{shape:v}});else if(g||y){T.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: "+a.shape.length});var E=T.slice_util.computeOutShape(b,w,k),N=ec({inputs:{x:a},backend:t,attrs:{begin:b,size:E}});S=Me({inputs:{x:N},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(N)}else{var C=t.shouldExecuteOnCPU([a]);if(C){var R=t.readSync(a.dataId),_=T.buffer(a.shape,a.dtype,R),O=INe(d,_,k,b);S=t.makeTensorInfo(v,a.dtype,O.values)}else{var P=new ZMe(b,k,d);S=t.runWebGLProgram(P,[a],a.dtype)}}var B=Me({inputs:{x:S},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(S),B}var JMe={kernelName:T.StridedSlice,backendName:"webgl",kernelFunc:QMe};function eOe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,l=n.preserveShortSequences,c=e.data,f=e.dataSplits,h=t.readSync(c.dataId),p=t.readSync(f.dataId),d=Ve(NNe(h,p,a,i,o,s,u,l),2),v=d[0],m=d[1];return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(f.shape,"int32",m)]}var tOe={kernelName:T.StringNGrams,backendName:"webgl",kernelFunc:eOe};function rOe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: "+i.shape);if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: "+o.shape);var s=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],l=Ve(CNe(s,u,a),3),c=l[0],f=l[1],h=l[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",c),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var nOe={kernelName:T.StringSplit,backendName:"webgl",kernelFunc:rOe};function aOe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.readSync(i.dataId),s=ANe(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var iOe={kernelName:T.StringToHashBucketFast,backendName:"webgl",kernelFunc:aOe};var oOe="return tan(x);",sOe=It({opSnippet:oOe}),uOe={kernelName:T.Tan,backendName:"webgl",kernelFunc:sOe};var lOe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,cOe=It({opSnippet:lOe}),fOe={kernelName:T.Tanh,backendName:"webgl",kernelFunc:cOe};var hOe=(function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;var i=Zt(this.rank),o=pOe(e);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}return r})();function pOe(r){var e=r.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(e===1)return"imod(resRC, "+r[0]+")";for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],a=0;a<r.length;a++)n.push("imod("+t[a]+", "+r[a]+")");return n.join()}function xP(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;if(a.dtype==="string"||a.shape.length>5){var o=t.readSync(a.dataId),s=a.dtype==="string"?o.map(function(h){return T.util.decodeString(h)}):o,u=T.buffer(a.shape,a.dtype,s),l=DNe(u,i);return t.makeTensorInfo(l.shape,l.dtype,l.values)}var c=new hOe(a.shape,i),f=t.runWebGLProgram(c,[a],a.dtype);return f}var dOe={kernelName:T.Tile,backendName:"webgl",kernelFunc:xP},vOe=(function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}return r})(),mOe=(function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}return r})();function mu(r,e){e!==null&&r.disposeIntermediateTensorInfo(e)}function UM(r){for(var e=1;e<r;)e*=2;return e}function gOe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted,s=T.env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=T.env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=a.shape,c=l[l.length-1];if(t.shouldExecuteOnCPU([a])||c<s||i>u){var f=t.readSync(a.dataId),h=Ve(FNe(f,l,a.dtype,i,o),2),p=h[0],d=h[1];return[t.makeTensorInfo(p.shape,p.dtype,p.values),t.makeTensorInfo(d.shape,d.dtype,d.values)]}if(i===0)return l[l.length-1]=0,[t.makeTensorInfo(l,a.dtype,[]),t.makeTensorInfo(l,"int32",[])];if(c===1)return[a,Ch({attrs:{shape:l,dtype:"int32",value:0},backend:t})];var v=t.texData.get(a.dataId),m=v!==null&&v.isPacked,g=m?t.unpackTensor(a):a,y=T.util.sizeFromShape(l),b=y/c,w=Me({inputs:{x:g},attrs:{shape:[b,c]},backend:t});m&&mu(t,g);for(var k=UM(i),S=UM(c),E=null,N=function(){return E===null?[w,w]:[w,E]},C=function(Q,ie,le){var de=N(),we=new vOe(le),pe=E===null?1:0,Se=[[c],[pe],[Number.NEGATIVE_INFINITY],[Q],[ie]],Ee=E;E=t.runWebGLProgram(we,de,"int32",Se),mu(t,Ee)},R=1;R<k;R*=2)for(var _=R*2,O=R;O>=1;O/=2)C(_,O,[b,S]);for(var P=S;P>k;P/=2){var B=N(),W=new mOe([b,P/2]),L=E===null?1:0,G=[[c],[L],[k]],M=E;E=t.runWebGLProgram(W,B,"int32",G),mu(t,M);for(var R=k/2,_=R*2,O=R;O>=1;O/=2)C(_,O,E.shape)}var $=E;E=ec({inputs:{x:E},backend:t,attrs:{begin:0,size:[b,i]}}),mu(t,$);var K=hP({inputs:{x:w,indices:E},backend:t,attrs:{axis:1,batchDims:1}});mu(t,w);var j=l.slice(0,-1);j.push(i),$=E,E=Me({inputs:{x:E},attrs:{shape:j},backend:t}),mu(t,$);var te=K;return K=Me({inputs:{x:K},attrs:{shape:j},backend:t}),mu(t,te),[K,E]}var yOe={kernelName:T.TopK,backendName:"webgl",kernelFunc:gOe};var bOe=(function(){function r(e,t,n,a,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;var s=n==="nearest"?1:2,u;switch(a){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(`+u+` == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`+u+` == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`+u+` == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < `+e+" && 0 <= coordX && coordX < "+t+`) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(`+i+`);
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(`+i+`);
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(`+t+`));
                float mapY = mapCoord(inY, float(`+e+`));

                if (`+s+` == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}return r})();function wOe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,l=n.outputShape,c=Ve(a.shape,4),f=c[0],h=c[1],p=c[2],d=c[3],v=Ve(l??[h,p],2),m=v[0],g=v[1],y=[f,m,g,d],b=new bOe(h,p,o,s,u,y);return t.runWebGLProgram(b,[a,i],"float32")}var xOe={kernelName:T.Transform,backendName:"webgl",kernelFunc:wOe};function kOe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;jl(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=n.readSync(i.dataId),s=RNe(o,a,i.shape,i.dtype),u=s.outputValues,l=s.outputShape,c=s.indices;return[n.makeTensorInfo(l,i.dtype,u),n.makeTensorInfo([c.length],"int32",c)]}var SOe={kernelName:T.Unique,backendName:"webgl",kernelFunc:kOe};function EOe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],l=new Array(s-1),c=0,f=0;f<s;f++)f!==i&&(l[c++]=o.shape[f]);var h=[],p=new Array(s).fill(0),d=o.shape.slice();d[i]=1;for(var v=new Array(u),f=0;f<v.length;f++){p[i]=f;var m=ec({inputs:{x:o},backend:t,attrs:{begin:p,size:d}}),g=Me({inputs:{x:m},backend:t,attrs:{shape:l}});v[f]=g,h.push(m)}return h.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),v}var TOe={kernelName:T.Unpack,backendName:"webgl",kernelFunc:EOe};var IOe=(function(){function r(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.numSegments,s=o*Math.ceil(i/n);this.outputShape=[a,s];var u="0.0",l="sumValue",c=Math.floor(n/4)*4,f=n%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";i%n>0&&(p=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = `+u+`;

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(f===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(f===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(f===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(`+l+`);
      }
    `}return r})();function NOe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments,s=a.shape.length,u=[],l=0,c=T.backend_util.getAxesPermutation([l],s),f=a;c!=null&&(f=xn({inputs:{x:a},backend:t,attrs:{perm:c}}),u.push(f),l=T.backend_util.getInnerMostAxes(1,s)[0]);var h=T.backend_util.segment_util.computeOutShape(f.shape,l,o),p=T.util.sizeFromShape([f.shape[l]]),d=Me({inputs:{x:f},backend:t,attrs:{shape:[-1,p]}});u.push(d);var v=T.sumOutType(a.dtype),m=function(k,S,E,N,C){var R=k.shape[0],_=k.shape[1],O=T.backend_util.segment_util.segOpComputeOptimalWindowSize(_,C),P={windowSize:O,inSize:_,batchSize:R,numSegments:C},B=new IOe(P,S),W=t.compileAndRun(B,[k,E],N);if(u.push(W),W.shape[1]===C)return W;var L=bP({backend:t,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),G=xP({inputs:{x:L},backend:t,attrs:{reps:[_/O]}});u.push(L),u.push(G);var M=m(W,S,G,N,C);return M},g=m(d,"unsortedSegmentSum",i,v,o),y=Me({inputs:{x:g},backend:t,attrs:{shape:h}}),b=y;if(c!=null){u.push(y);var w=T.backend_util.getUndoAxesPermutation(c);b=xn({inputs:{x:b},backend:t,attrs:{perm:w}})}return u.forEach(function(k){return t.disposeIntermediateTensorInfo(k)}),b}var COe={kernelName:T.UnsortedSegmentSum,backendName:"webgl",kernelFunc:NOe},Iw,GM,AOe=[ICe,CCe,DCe,MCe,PCe,zCe,WCe,UCe,KCe,XCe,QCe,tAe,aAe,uAe,fAe,pAe,vAe,bAe,xAe,SAe,NAe,MAe,PAe,BAe,GAe,qAe,YAe,lCe,JAe,a_e,u_e,d_e,m_e,y_e,w_e,k_e,T_e,C_e,D_e,R_e,O_e,L_e,$_e,V_e,q_e,j_e,Z_e,e3e,r3e,o3e,c3e,d3e,g3e,w3e,x3e,S3e,T3e,N3e,A3e,D3e,O3e,B3e,W3e,U3e,q3e,X3e,J3e,nDe,uCe,iDe,r_e,uDe,fDe,dDe,fCe,yDe,kDe,EDe,CDe,DDe,ODe,BDe,VDe,qDe,XDe,ZDe,tFe,nFe,iFe,lFe,fFe,pFe,vFe,gFe,xFe,TFe,AFe,LFe,dCe,WFe,GFe,KFe,YFe,$Ae,JFe,tRe,nRe,oRe,cRe,pCe,hRe,dRe,mRe,gRe,WAe,RFe,wRe,ERe,CRe,mCe,FRe,ORe,zRe,VRe,qRe,jRe,ZRe,eMe,rMe,iMe,uMe,fMe,vMe,yMe,xMe,EMe,FAe,OFe,NMe,AMe,DMe,RMe,OMe,LMe,zMe,WMe,UMe,qMe,jMe,YMe,JMe,tOe,nOe,iOe,MFe,SCe,uOe,fOe,dOe,yOe,xOe,ECe,SOe,TOe,COe,eRe];try{for(ph=oa(AOe),Ul=ph.next();!Ul.done;Ul=ph.next())HM=Ul.value,T.registerKernel(HM)}catch(r){Iw={error:r}}finally{try{Ul&&!Ul.done&&(GM=ph.return)&&GM.call(ph)}finally{if(Iw)throw Iw.error}}var HM,ph,Ul;Ui.GPGPUContext=rm;Ui.MathBackendWebGL=qw;Ui.forceHalfFloat=HO;Ui.gpgpu_util=GTe;Ui.setWebGLContext=qM;Ui.version_webgl=oCe;Ui.webgl=sCe;Ui.webgl_util=YEe});var D4=gr(Fu=>{"use strict";Object.defineProperty(Fu,"__esModule",{value:!0});function _Oe(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var Jw=Ds(),jP=GI(),DOe=_Oe(jP),ex=R3(),tx=gF(),XP=zF(),FOe=gM(),ROe=kP(),YP="Abs",ZP="Acos",QP="Acosh",Ex="Add",JP="AddN",MOe="All",OOe="Any",eL="ArgMax",tL="ArgMin",rL="Asin",nL="Asinh",aL="Atan",iL="Atanh",oL="Atan2",sL="AvgPool",POe="AvgPoolGrad",uL="AvgPool3D",LOe="AvgPool3DGrad",lL="BatchMatMul",cL="BatchToSpaceND",BOe="Bincount",zOe="BroadcastTo",$Oe="BroadcastArgs",Tx="Cast",fL="Ceil",hL="ClipByValue",WOe="Complex",pL="ComplexAbs",dL="Concat",vL="Conv2D",VOe="Conv2DBackpropFilter",mL="Conv2DBackpropInput",gL="Conv3D",UOe="Conv3DBackpropFilterV2",GOe="Conv3DBackpropInputV2",yL="Cos",bL="Cosh",HOe="Cumprod",wL="Cumsum",qOe="CropAndResize",KOe="DenseBincount",jOe="DepthToSpace",xL="DepthwiseConv2dNative",XOe="DepthwiseConv2dNativeBackpropFilter",YOe="DepthwiseConv2dNativeBackpropInput",ZOe="Diag",kL="Dilation2D",QOe="Dilation2DBackpropInput",JOe="Dilation2DBackpropFilter",SL="RealDiv",ePe="Einsum",EL="Elu",tPe="EluGrad",TL="Erf",rPe="Equal",IL="Exp",NL="ExpandDims",CL="Expm1",nPe="FFT",aPe="Fill",iPe="FlipLeftRight",AL="Floor",_L="FloorDiv",DL="FusedBatchNorm",FL="GatherV2",oPe="GatherNd",sPe="Greater",RL="GreaterEqual",Ix="Identity",uPe="IFFT",lPe="Imag",ML="IsFinite",OL="IsInf",PL="IsNan",LL="LeakyRelu",cPe="Less",fPe="LessEqual",BL="Log",zL="Log1p",hPe="LogicalAnd",pPe="LogicalNot",dPe="LogicalOr",vPe="LogSoftmax",$L="LRN",mPe="LRNGrad",WL="Max",VL="Maximum",UL="MaxPool",gPe="MaxPoolGrad",GL="MaxPool3D",yPe="MaxPool3DGrad",bPe="MaxPoolWithArgmax",HL="Mean",qL="Min",KL="Minimum",jL="MirrorPad",XL="Mod",wPe="Multinomial",YL="Multiply",ZL="Neg",xPe="NotEqual",kPe="NonMaxSuppressionV3",SPe="NonMaxSuppressionV4",EPe="NonMaxSuppressionV5",QL="OnesLike",JL="OneHot",eB="Pack",tB="PadV2",rB="Pow",nB="Prelu",aB="Prod",TPe="RaggedGather",IPe="RaggedTensorToTensor",NPe="Range",CPe="Real",iB="Reciprocal",oB="Relu",sB="Reshape",uB="ResizeNearestNeighbor",APe="ResizeNearestNeighborGrad",lB="ResizeBilinear",_Pe="ResizeBilinearGrad",cB="Relu6",fB="Reverse",hB="Round",pB="Rsqrt",DPe="ScatterNd",FPe="SearchSorted",dB="Select",vB="Selu",mB="Slice",gB="Sin",yB="Sinh",bB="Sign",wB="Sigmoid",xB="Softplus",kB="Sqrt",SB="Sum",EB="SpaceToBatchND",TB="SplitV",IB="Softmax",RPe="SparseFillEmptyRows",MPe="SparseReshape",OPe="SparseSegmentMean",PPe="SparseSegmentSum",LPe="SparseToDense",NB="SquaredDifference",BPe="Square",zPe="StridedSlice",$Pe="StringNGrams",WPe="StringSplit",VPe="StringToHashBucketFast",CB="Sub",AB="Tan",_B="Tanh",Nx="Tile",UPe="TopK",GPe="Transform",hm="Transpose",HPe="Unique",DB="Unpack",FB="UnsortedSegmentSum",RB="ZerosLike",MB="Step",SP="FromPixels",qPe="RotateWithOffset",EP="_FusedMatMul",TP="FusedConv2D",IP="FusedDepthwiseConv2D";var KPe=1e-7,jPe=1e-4,rx=class{refCount(e){return Ta("refCount")}incRef(e){return Ta("incRef")}timerAvailable(){return!0}time(e){return Ta("time")}read(e){return Ta("read")}readSync(e){return Ta("readSync")}readToGPU(e,t){return Ta("readToGPU")}numDataIds(){return Ta("numDataIds")}disposeData(e,t){return Ta("disposeData")}write(e,t,n){return Ta("write")}move(e,t,n,a,i){return Ta("move")}memory(){return Ta("memory")}floatPrecision(){return Ta("floatPrecision")}epsilon(){return this.floatPrecision()===32?KPe:jPe}dispose(){return Ta("dispose")}};function Ta(r){throw new Error(`'${r}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function Y(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function qi(r,e,t=""){Y(gc(r,e),()=>t+` Shapes ${r} and ${e} must match`)}function Cx(r){Y(r!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Im(r,e=[],t=!1){if(e==null&&(e=[]),Array.isArray(r)||Gi(r)&&!t)for(let n=0;n<r.length;++n)Im(r[n],e,t);else e.push(r);return e}function ua(r){if(r.length===0)return 1;let e=r[0];for(let t=1;t<r.length;t++)e*=r[t];return e}function gc(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Lh(r){return r%1===0}function pm(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Ci(r,e){let t=e.length;return r=r==null?e.map((n,a)=>a):[].concat(r),Y(r.every(n=>n>=-t&&n<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${r}`),Y(r.every(n=>Lh(n)),()=>`All values in axis param must be integers but got axis ${r}`),r.map(n=>n<0?t+n:n)}function XPe(r,e){let t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Ci(e,r).sort(),o=0;for(let s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${r[s]}' is not 1`);(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function YPe(r,e){let t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error(`Unknown data type ${r}`);return t}function ZPe(r,e){for(let t=0;t<r.length;t++){let n=r[t];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function QPe(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Gi(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function NP(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error(`Unknown dtype ${r}`)}function JPe(r){if(r==null)return 0;let e=0;return r.forEach(t=>e+=t.length),e}function Ax(r){return typeof r=="string"||r instanceof String}function eLe(r){return typeof r=="boolean"}function tLe(r){return typeof r=="number"}function _x(r){return Array.isArray(r)?_x(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":tLe(r)?"float32":Ax(r)?"string":eLe(r)?"bool":"float32"}function nx(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Dx(r){let e=r.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=r[e-1];for(let n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function OB(r,e,t,n=!1){let a=new Array;if(e.length===1){let i=e[0]*(n?2:1);for(let o=0;o<i;o++)a[o]=t[r+o]}else{let i=e[0],o=e.slice(1),s=o.reduce((u,l)=>u*l)*(n?2:1);for(let u=0;u<i;u++)a[u]=OB(r+u*s,o,t,n)}return a}function CP(r,e,t=!1){if(r.length===0)return e[0];let n=r.reduce((a,i)=>a*i)*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${r}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return OB(0,r,e,t)}function PB(r,e){let t=Fx(r,e);for(let n=0;n<t.length;n++)t[n]=1;return t}function Fx(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error(`Unknown data type ${e}`)}function LB(r){r.forEach(e=>{Y(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${r}].`)})}function BB(r){return r&&r.then&&typeof r.then=="function"}var AP="tfjsflags",ax=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=rLe,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(Fr().getBool("IS_TEST")||Fr().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let a=this.urlFlags[e];Fr().getBool("IS_TEST")||Fr().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${a}.`),this.set(e,a)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(BB(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);AP in e&&e[AP].split(",").forEach(n=>{let[a,i]=n.split(":");this.urlFlags[a]=aLe(a,i)})}};function rLe(r){let e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...n)=>(nLe(e,n[0],n[1]),n.join("="))),e}function nLe(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function aLe(r,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${r}.`)}function Fr(){return zB}var zB=null;function iLe(r){zB=r}var Yw;function $B(){if(Yw==null){let r;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Yw=r}return Yw}function oLe(){let r=$B();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Rx(r,e){let t=oLe();if(t.has(r))return t.get(r);{let n=e();return t.set(r,n),t.get(r)}}function tc(...r){Fr().getBool("IS_TEST")||Fr().getBool("PROD")||console.warn(...r)}var WB=Rx("kernelRegistry",()=>new Map),ix=Rx("gradRegistry",()=>new Map);function ox(r,e){let t=uLe(r,e);return WB.get(t)}function _P(r){return ix.get(r)}function DP(r){let e=WB.entries(),t=[];for(;;){let{done:n,value:a}=e.next();if(n)break;let[i,o]=a,[s]=i.split("_");s===r&&t.push(o)}return t}function sLe(r){let{kernelName:e}=r;ix.has(e)&&Fr().getBool("DEBUG")&&tc(`Overriding the gradient for '${e}'`),ix.set(e,r)}function uLe(r,e){return`${e}_${r}`}var lLe=DOe||jP;function Mx(r){return lLe.fromString(r,!0,16)}var iqe=Mx("c3a5c85c97cb3127"),oqe=Mx("b492b66fbe98f273"),sqe=Mx("9ae16a3b2f90404f");function cLe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function VB(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Im(r)),Fr().getBool("DEBUG")&&ZPe(r,e),cLe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){let t=new Uint8Array(r.length);for(let n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error(`Unknown data type ${e}`)}function ym(){return Fr().platform.now()}function fLe(r,e="utf-8"){return e=e||"utf-8",Fr().platform.encode(r,e)}function FP(r,e="utf-8"){return e=e||"utf-8",Fr().platform.decode(r,e)}var sx=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new ux)}profileKernel(e,t,n){let a,i=()=>{a=n()},o,s=ym();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(let l of a)l.dataSync();o=Promise.resolve({kernelMs:ym()-s})}if(Fr().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<a.length;l++){let c=a[l];c.data().then(f=>{hLe(f,c.dtype,e)})}return{kernelName:e,outputs:a,inputs:t,timeMs:o.then(l=>l.kernelMs),extraInfo:o.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:a,inputs:i,extraInfo:o}=e;n.forEach(s=>{Promise.all([s.data(),a,o]).then(u=>{this.logger.logKernelProfile(t,s,u[0],u[1],i,u[2])})})}};function hLe(r,e,t){if(e!=="float32")return!1;for(let n=0;n<r.length;n++){let a=r[n];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${t}'`),!0}return!1}var ux=class{logKernelProfile(e,t,n,a,i,o){let s=typeof a=="number"?pm(`${a}ms`,9):a.error,u=pm(e,25),l=t.rank,c=t.size,f=pm(t.shape.toString(),14),h="";for(let p in i){let d=i[p];if(d!=null){let v=d.shape||t.shape,m=v.length;h+=`${p}: ${m}D ${m>0?v:""} `}}console.log(`%c${u}	%c${s}	%c${l}D ${f}	%c${c}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function pLe(r,e,t){let n={},a={};for(let u=0;u<e.length;u++)n[e[u].id]=!0;for(let u=0;u<r.length;u++){let l=r[u],c=l.inputs;for(let f in c){let h=c[f],p=!1;for(let d=0;d<e.length;d++)if(n[h.id]){l.outputs.forEach(v=>n[v.id]=!0),p=!0,a[l.id]=!0;break}if(p)break}}let i={};i[t.id]=!0;let o={};for(let u=r.length-1;u>=0;u--){let l=r[u],c=l.inputs;for(let f=0;f<l.outputs.length;f++)if(i[l.outputs[f].id]){for(let h in c)i[c[h].id]=!0,o[l.id]=!0;break}}let s=[];for(let u=0;u<r.length;u++){let l=r[u];if(a[l.id]&&o[l.id]){let c={};for(let h in l.inputs){let p=l.inputs[h];n[p.id]&&(c[h]=p)}let f=Object.assign({},l);f.inputs=c,f.outputs=l.outputs,s.push(f)}}return s}function dLe(r,e,t,n){for(let a=e.length-1;a>=0;a--){let i=e[a],o=[];if(i.outputs.forEach(u=>{let l=r[u.id];l!=null?o.push(l):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let s=i.gradient(o);for(let u in i.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);let l=t(()=>s[u]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${l.dtype}'`);let c=i.inputs[u];if(!gc(l.shape,c.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${l.shape}', which does not match the shape of the input '${c.shape}'`);if(r[c.id]==null)r[c.id]=l;else{let f=r[c.id];r[c.id]=n(f,l),f.dispose()}}}}var RP=20,Ah=3,Zw=7;function vLe(r,e,t,n){let a=Dx(e),i=mLe(r,e,t,a),o=e.length,s=dm(r,e,t,a,i),u=["Tensor"];return n&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(s.map(l=>"    "+l).join(`
`)),u.join(`
`)}function mLe(r,e,t,n){let a=ua(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Mh(r):r;if(s>1)for(let l=0;l<a/i;l++){let c=l*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Rh(u[c+f],0,t).length)}return o}function Rh(r,e,t){let n;return Array.isArray(r)?n=`${parseFloat(r[0].toFixed(Zw))} + ${parseFloat(r[1].toFixed(Zw))}j`:Ax(r)?n=`'${r}'`:t==="bool"?n=UB(r):n=parseFloat(r.toFixed(Zw)).toString(),pm(n,e)}function UB(r){return r===0?"false":"true"}function dm(r,e,t,n,a,i=!0){let o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){let v=Mh(r);return[Rh(v[0],0,t)]}return t==="bool"?[UB(r[0])]:[r[0].toString()]}if(u===1){if(s>RP){let m=Ah*o,g=Array.from(r.slice(0,m)),y=Array.from(r.slice((s-Ah)*o,s*o));return t==="complex64"&&(g=Mh(g),y=Mh(y)),["["+g.map((b,w)=>Rh(b,a[w],t)).join(", ")+", ..., "+y.map((b,w)=>Rh(b,a[s-Ah+w],t)).join(", ")+"]"]}return["["+(t==="complex64"?Mh(r):Array.from(r)).map((m,g)=>Rh(m,a[g],t)).join(", ")+"]"]}let l=e.slice(1),c=n.slice(1),f=n[0]*o,h=[];if(s>RP){for(let v=0;v<Ah;v++){let m=v*f,g=m+f;h.push(...dm(r.slice(m,g),l,t,c,a,!1))}h.push("...");for(let v=s-Ah;v<s;v++){let m=v*f,g=m+f;h.push(...dm(r.slice(m,g),l,t,c,a,v===s-1))}}else for(let v=0;v<s;v++){let m=v*f,g=m+f;h.push(...dm(r.slice(m,g),l,t,c,a,v===s-1))}let p=u===2?",":"";h[0]="["+h[0]+p;for(let v=1;v<h.length-1;v++)h[v]=" "+h[v]+p;let d=`,
`;for(let v=2;v<u;v++)d+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":d),h}function Mh(r){let e=[];for(let t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var lx=class{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=ua(e),n!=null){let a=n.length;Y(a===this.size,()=>`Length of values '${a}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||YPe(t,this.size),this.strides=Dx(e)}set(e,...t){t.length===0&&(t=[0]),Y(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);let n=this.locToIndex(t);this.values[n]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(let a of e){if(a<0||a>=this.shape[t]){let i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let n=e[e.length-1];for(let a=0;a<e.length-1;++a)n+=this.strides[a]*e[a];return this.values[n]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];let t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Ii().makeTensor(this.values,this.shape,this.dtype)}},Ii=null,_h=null,gLe=null;function yLe(r){Ii=r}function bLe(r){gLe=r}var pn=class{constructor(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ua(e),this.strides=Dx(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return _h.buffer(this.shape,this.dtype,e)}bufferSync(){return _h.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return CP(this.shape,e,this.dtype==="complex64")}arraySync(){return CP(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=Ii().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(n=>FP(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Ii().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=Ii().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>FP(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await Ii().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Ii().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return _h.print(this,e)}clone(){return this.throwIfDisposed(),_h.clone(this)}toString(e=!1){let t=this.dataSync();return vLe(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),_h.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),Ii().makeVariable(this,e,t,n)}};Object.defineProperty(pn,Symbol.hasInstance,{value:r=>!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null});function xe(){return Rx("Tensor",()=>pn)}xe();var ic=class extends pn{constructor(e,t,n,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!gc(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Ii().disposeTensor(this),this.dataId=e.dataId,Ii().incRef(this,null)}dispose(){Ii().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(ic,Symbol.hasInstance,{value:r=>r instanceof pn&&r.assign!=null&&r.assign instanceof Function});var MP;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(MP||(MP={}));var cx;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(cx||(cx={}));var fx;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(fx||(fx={}));var hx;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(hx||(hx={}));var px;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(px||(px={}));var wLe={float32:hx,int32:cx,bool:fx,complex64:px};function xLe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${r} with ${e}`)}return wLe[r][e]}function Rr(r,e){if(r.dtype===e.dtype)return[r,e];let t=xLe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function kLe(r,e){Y(r.dtype===e.dtype,()=>`The dtypes of the first(${r.dtype}) and second(${e.dtype}) input must match`)}function GB(r){let e=[];return HB(r,e,new Set),e}function HB(r,e,t){if(r==null)return;if(r instanceof pn){e.push(r);return}if(!SLe(r))return;let n=r;for(let a in n){let i=n[a];t.has(i)||(t.add(i),HB(i,e,t))}}function SLe(r){return Array.isArray(r)||typeof r=="object"}function Qw(r){return r.kernelName!=null}var bm=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},Bh=class r{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new bm}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(tc(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new sx(this.backendInstance),!0}setupRegisteredKernels(){DP(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){DP(e).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=t.factory();if(n&&!(n instanceof rx)&&typeof n.then=="function"){let a=++this.pendingBackendInitId,i=n.then(o=>a<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,tc(`Initialization of backend ${e} failed`),tc(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(n){return tc(`Initialization of backend ${e} failed`),tc(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t],{success:a,asyncInit:i}=this.initializeBackend(n);if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");n=e}let a;return this.scopedRun(()=>this.startScope(n),()=>this.endScope(a),()=>(a=t(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(e,t,n){e();try{let a=n();return t(),a}catch(a){throw t(),a}}nextTensorId(){return r.nextTensorId++}nextVariableId(){return r.nextVariableId++}clone(e){let t=ue.runKernel(Ix,{x:e}),n={x:e},a=o=>({x:()=>{let s="float32",u={x:o},l={dtype:s};return ue.runKernel(Tx,u,l)}}),i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t}runKernel(e,t,n){if(this.backendName==null&&this.backend,!(ox(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){let a=this.backend.numDataIds(),i=0;n.forEach(u=>{i+=u.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[],a=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u,l=Qw(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Qw(e)){let{kernelName:d,inputs:v,attrs:m}=e;this.backendName==null&&this.backend;let g=ox(d,this.backendName);Y(g!=null,()=>`Cannot find registered kernel '${d}' for backend '${this.backendName}'`),s=()=>{let y=this.backend.numDataIds();u=g.kernelFunc({inputs:v,attrs:m,backend:this.backend});let b=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,y,b);let w=b.map(k=>k.rank!=null?k:this.makeTensorFromTensorInfo(k));if(a){let k=this.getTensorsForGradient(d,v,w);n=this.saveTensorsForBackwardMode(k)}return w}}else{let{forwardFunc:d}=e,v=m=>{a&&(n=m.map(g=>this.keep(this.clone(g))))};s=()=>{let m=this.backend.numDataIds();u=this.tidy(()=>d(this.backend,v));let g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,m,g),g}}let{inputs:c,attrs:f}=e,h=Qw(e)?null:e.backwardsFunc,p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=s():(p=this.profiler.profileKernel(l,c,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),a&&this.addTapeNode(l,c,t,h,n,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(d=>c[d]!=null?c[d].shape:null),outputShapes:t.map(d=>d.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(e,t,n){let a=_P(e);if(a!=null){let i=a.inputsToSave||[],o=a.outputsToSave||[],s;a.saveAllInputs?(Y(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(l=>t[l])):s=i.map(l=>t[l]);let u=n.filter((l,c)=>o[c]);return s.concat(u)}return[]}makeTensor(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;let i=e;n==="string"&&Ax(e[0])&&(i=e.map(u=>fLe(u)));let o=a.write(i,t,n),s=new pn(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){let u=this.state.tensorInfo.get(o),l=JPe(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s}makeTensorFromDataId(e,t,n,a){n=n||"float32";let i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)}makeTensorFromTensorInfo(e,t){let{dataId:n,shape:a,dtype:i}=e,o=new pn(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,n,a){n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));let i=new ic(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*NP(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof ic||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let n=e.size*NP(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,n,a,i,o){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=_P(e);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=l=>(l=l.map((c,f)=>{if(c==null){let h=n[f],p=Fx(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return c}),a(l.length>1?l:l[0],i,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=GB(e),n=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let o=this.state.activeScope.track[i];!o.kept&&!n.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===a.id&&this.track(i)})}gradients(e,t,n,a=!1){if(Y(t.length>0,()=>"gradients() received an empty list of xs."),n!=null&&n.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));Y(i instanceof pn,()=>"The result y returned by f() must be a tensor.");let o=pLe(this.state.activeTape,t,i);if(!a&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let s={};s[i.id]=n??ELe(i.shape),dLe(s,o,l=>this.tidy(l),ILe);let u=t.map(l=>s[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(let c of l.saved)c.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(e){return Y(nx(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{Y(t.every(s=>s instanceof pn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let n,a={};t.forEach((s,u)=>{a[u]=s});let i=(s,u)=>(n=e(...t,u),Y(n.value instanceof pn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),Y(nx(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),o=(s,u)=>{let l=n.gradFunc(s,u),c=Array.isArray(l)?l:[l];Y(c.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),Y(c.every(h=>h instanceof pn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return c.forEach((h,p)=>{f[p]=()=>h}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=ym(),n=await this.backend.time(e);return n.wallMs=ym()-t,n}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new bm;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};Bh.nextTensorId=0;Bh.nextVariableId=0;function ELe(r){let e=PB(ua(r),"float32");return ue.makeTensor(e,r,"float32")}function TLe(){let r=$B();if(r._tfengine==null){let e=new ax(r);r._tfengine=new Bh(e)}return iLe(r._tfengine.ENV),yLe(()=>r._tfengine),r._tfengine}var ue=TLe();function ILe(r,e){let t={a:r,b:e};return ue.runKernel(Ex,t)}function Kh(r,e){let t=r;if(Gi(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];let n=[];for(;Array.isArray(t)||Gi(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&Fr().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&qB(r,n,[]),n}function qB(r,e,t){if(t=t||[],!Array.isArray(r)&&!Gi(r)){Y(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}Y(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${r.length} elements`),Y(r.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${r.length} elements`);let n=e.slice(1);for(let a=0;a<r.length;++a)qB(r[a],n,t.concat(a))}function OP(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${n}' must be ${r} tensor, but got ${e} tensor`)}}function q(r,e,t,n="numeric"){if(r instanceof pn)return OP(n,r.dtype,e,t),r;let a=_x(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),OP(n,a,e,t),r==null||!Gi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){let u=r==null?"null":r.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}let i=Kh(r,a);!Gi(r)&&!Array.isArray(r)&&(r=[r]);let s=a!=="string"?VB(r,a):Im(r,[],!0);return ue.makeTensor(s,i,a)}function wm(r,e,t,n="numeric"){if(!Array.isArray(r))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return r.map((i,o)=>q(i,`${e}[${o}]`,t,n))}var NLe="__op";function ee(r){let e=Object.keys(r);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+NLe;let a=(...i)=>{ue.startScope(t);try{let o=n(...i);return BB(o)&&console.error("Cannot return a Promise inside of tidy."),ue.endScope(o),o}catch(o){throw ue.endScope(null),o}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function CLe(r,e){let t=q(r,"x","cast");if(!QPe(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:t},a={dtype:e};return ue.runKernel(Tx,n,a)}var Je=ee({cast_:CLe});function ALe(r,e){let t=q(r,"a","mul"),n=q(e,"b","mul");[t,n]=Rr(t,n);let a={a:t,b:n};return ue.runKernel(YL,a)}var ve=ee({mul_:ALe});function _Le(r,e=0){let n={x:q(r,"x","step")},a={alpha:e};return ue.runKernel(MB,n,a)}var jh=ee({step_:_Le});var KB={kernelName:YP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(r,jh(Je(t,"float32"),-1))}}};function DLe(r,e){let t=q(r,"a","floorDiv"),n=q(e,"b","floorDiv");[t,n]=Rr(t,n);let a={a:t,b:n};return ue.runKernel(_L,a)}var jB=ee({floorDiv_:DLe});function FLe(r,e){let t=q(r,"a","div"),n=q(e,"b","div");if([t,n]=Rr(t,n),t.dtype==="int32"&&n.dtype==="int32")return jB(t,n);let a={a:t,b:n},i={};return ue.runKernel(SL,a,i)}var dt=ee({div_:FLe});function RLe(r){let t={x:q(r,"x","neg")};return ue.runKernel(ZL,t)}var Yr=ee({neg_:RLe});function Xh(r,e,t,n){if(n==null&&(n=_x(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Gi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){LB(e);let a=ua(e),i=ua(t);Y(a===i,()=>`Based on the provided shape, [${e}], the tensor should have ${a} values but has ${i}`);for(let o=0;o<t.length;++o){let s=t[o],u=o===t.length-1?s!==ua(e.slice(o)):!0;Y(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Gi(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?VB(r,n):Im(r,[],!0),ue.makeTensor(r,e,n)}function yt(r,e){if((Gi(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Gi(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Xh(r,[],[],e)}function MLe(r){let t={x:q(r,"x","sqrt","float32")};return ue.runKernel(kB,t)}var ca=ee({sqrt_:MLe});function OLe(r){let e=q(r,"x","square"),t={};return ue.runKernel("Square",{x:e},t)}var Qt=ee({square_:OLe});function PLe(r,e){let t=q(r,"a","sub"),n=q(e,"b","sub");[t,n]=Rr(t,n);let a={a:t,b:n};return ue.runKernel(CB,a)}var ut=ee({sub_:PLe});var LLe={kernelName:ZP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Qt(Je(t,"float32")),a=ca(ut(yt(1),n));return Yr(dt(r,a))}}}};var BLe={kernelName:QP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=ca(ut(Qt(Je(t,"float32")),1));return dt(r,n)}}}};function on(r,e){let t=[];for(let n=0;n<e.length;n++){let a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Jt(r,e){let t=[],n=Math.max(r.length,e.length);for(let a=0;a<n;a++){let i=r[r.length-a-1];i==null&&(i=1);let o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){let s=`Operands could not be broadcast together with shapes ${r} and ${e}.`;throw Error(s)}else t.unshift(i)}return t}function zLe(r,e){let n={x:q(r,"x","reshape","string_or_numeric")},a={shape:e};return ue.runKernel(sB,n,a)}var he=ee({reshape_:zLe});function $Le(r,e=null,t=!1){let n=q(r,"x","sum");n.dtype==="bool"&&(n=Je(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ue.runKernel(SB,a,i)}var ct=ee({sum_:$Le});var WLe={kernelName:Ex,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Jt(t.shape,n.shape);return{a:()=>{let s=r,u=on(t.shape,a);return u.length>0&&(s=ct(s,u)),he(s,t.shape)},b:()=>{let s=r,u=on(n.shape,a);return u.length>0&&(s=ct(s,u)),he(s,n.shape)}}}};var VLe={kernelName:JP,saveAllInputs:!0,gradFunc:(r,e)=>{let t={};return e.forEach((n,a)=>{t[a]=()=>r.clone()}),t}};function ULe(r){let t={x:q(r,"x","zerosLike")};return ue.runKernel(RB,t)}var Ct=ee({zerosLike_:ULe});var GLe={kernelName:eL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ct(t)}}};var HLe={kernelName:tL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ct(t)}}};var qLe={kernelName:rL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>dt(r,ca(ut(yt(1),Qt(Je(t,"float32")))))}}};function KLe(r,e){let t=q(r,"a","add"),n=q(e,"b","add");[t,n]=Rr(t,n);let a={a:t,b:n};return ue.runKernel(Ex,a)}var et=ee({add_:KLe});var jLe={kernelName:nL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=ca(et(yt(1),Qt(Je(t,"float32"))));return dt(r,n)}}}};var XLe={kernelName:oL,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Jt(t.shape,n.shape);return{a:()=>{let s=et(Qt(t),Qt(n)),u=ve(r,dt(n,s)),l=on(t.shape,a);return l.length>0&&(u=ct(u,l)),he(u,t.shape)},b:()=>{let s=et(Qt(t),Qt(n)),u=Yr(ve(r,dt(t,s))),l=on(n.shape,a);return l.length>0&&(u=ct(u,l)),he(u,n.shape)}}}};var YLe={kernelName:aL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>dt(r,et(Qt(Je(t,"float32")),1))}}};var ZLe={kernelName:iL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>dt(r,ut(yt(1),Qt(Je(t,"float32"))))}}};function QLe(r,e,t,n,a,i,o="channelsLast"){let[s,u]=xm(e),l;if(o==="channelsLast")l=[s,u,r[3],r[3]];else if(o==="channelsFirst")l=[s,u,r[1],r[1]];else throw new Error(`Unknown dataFormat ${o}`);return Ox(r,l,t,n,a,i,!1,o)}function Ox(r,e,t,n,a,i,o=!1,s="channelsLast"){let[u,l,c,f]=[-1,-1,-1,-1];if(s==="channelsLast")[u,l,c,f]=r;else if(s==="channelsFirst")[u,f,l,c]=r;else throw new Error(`Unknown dataFormat ${s}`);let[h,p,,d]=e,[v,m]=xm(t),[g,y]=xm(n),b=dx(h,g),w=dx(p,y),{padInfo:k,outHeight:S,outWidth:E}=tBe(a,l,c,v,m,b,w,i,s),N=o?d*f:d,C;return s==="channelsFirst"?C=[u,N,S,E]:s==="channelsLast"&&(C=[u,S,E,N]),{batchSize:u,dataFormat:s,inHeight:l,inWidth:c,inChannels:f,outHeight:S,outWidth:E,outChannels:N,padInfo:k,strideHeight:v,strideWidth:m,filterHeight:h,filterWidth:p,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:g,dilationWidth:y,inShape:r,outShape:C,filterShape:e}}function JLe(r,e,t,n,a){n==null&&(n=eBe(r,e,t));let i=r[0],o=r[1],s=km((i-e+2*n)/t+1,a),u=km((o-e+2*n)/t+1,a);return[s,u]}function eBe(r,e,t,n=1){let a=dx(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function xm(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function dx(r,e){return e<=1?r:r+(r-1)*(e-1)}function tBe(r,e,t,n,a,i,o,s,u){let l,c,f;if(typeof r=="number"){l={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};let p=JLe([e,t],i,n,r,s);c=p[0],f=p[1]}else if(r==="same"){c=Math.ceil(e/n),f=Math.ceil(t/a);let h=Math.max(0,(c-1)*n+i-e),p=Math.max(0,(f-1)*a+o-t),d=Math.floor(h/2),v=h-d,m=Math.floor(p/2),g=p-m;l={top:d,bottom:v,left:m,right:g,type:"SAME"}}else if(r==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){let h=u==="channelsLast"?r[1][0]:r[2][0],p=u==="channelsLast"?r[1][1]:r[2][1],d=u==="channelsLast"?r[2][0]:r[3][0],v=u==="channelsLast"?r[2][1]:r[3][1];l={top:h,bottom:p,left:d,right:v,type:h===0&&p===0&&d===0&&v===0?"VALID":"EXPLICIT"},c=km((e-i+h+p)/n+1,s),f=km((t-o+d+v)/a+1,s)}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:l,outHeight:c,outWidth:f}}function km(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error(`Unknown roundingMode ${e}`)}}function Iu(r){let[e,t,n]=xm(r);return e===1&&t===1&&n===1}function ko(r,e){return Iu(r)||Iu(e)}function Bn(r,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")Y(Lh(e),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(a=>{Y(Lh(a),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${a}.`)})});else throw Error(`Error in ${r}: Unknown padding parameter: ${e}`)}}function rBe(r,e,t,n,a,i){let o=q(r,"dy","avgPool3dGrad"),s=q(e,"input","avgPool3dGrad"),u=o,l=s,c=!1;s.rank===4&&(c=!0,u=he(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=he(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Y(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),Y(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Bn("avgPool3dGrad",a,i);let f={dy:u,input:l},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ue.runKernel(LOe,f,h);return c?he(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var nBe=ee({avgPool3dGrad_:rBe});var aBe={kernelName:uL,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=t;return{x:()=>nBe(r,n,a,i,o,s)}}};function iBe(r,e,t,n,a){let i=q(r,"dy","avgPoolGrad"),o=q(e,"input","avgPoolGrad");Y(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let s=o,u=i,l=!1;o.rank===3&&(l=!0,s=he(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=he(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Y(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),Y(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);let c={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ue.runKernel(POe,c,f);return l?he(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var oBe=ee({avgPoolGrad_:iBe});var sBe={kernelName:sL,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o}=t;return{x:()=>oBe(r,n,a,i,o)}}};function uBe(r,e,t=!1,n=!1){let a=q(r,"a","matMul"),i=q(e,"b","matMul");[a,i]=Rr(a,i);let o={a,b:i},s={transposeA:t,transposeB:n};return ue.runKernel(lL,o,s)}var Nt=ee({matMul_:uBe});var lBe={kernelName:lL,inputsToSave:["a","b"],gradFunc:(r,e,t)=>{let[n,a]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Nt(r,a,!1,!0),b:()=>Nt(n,r,!0,!1)}:!i&&o?{a:()=>Nt(r,a,!1,!1),b:()=>Nt(r,n,!0,!1)}:i&&!o?{a:()=>Nt(a,r,!1,!0),b:()=>Nt(n,r,!1,!1)}:{a:()=>Nt(a,r,!0,!0),b:()=>Nt(r,n,!0,!0)}}};function cBe(r,e,t){let n=q(r,"x","spaceToBatchND");Y(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),Y(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),Y(n.shape.reduce((o,s,u)=>u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let a={x:n},i={blockShape:e,paddings:t};return ue.runKernel(EB,a,i)}var Px=ee({spaceToBatchND_:cBe});var fBe={kernelName:cL,gradFunc:(r,e,t)=>{let{blockShape:n,crops:a}=t;return{x:()=>Px(r,n,a)}}};var hBe={kernelName:zOe,gradFunc:(r,e,t)=>{let n=t,a=n.inputShape,i=n.shape,o=Array.from(i);for(let u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);let s=[];for(let u=0;u<o.length;u++)o[u]>1&&s.push(u);return{x:()=>ct(r,s,!0)}}};var pBe={kernelName:Tx,gradFunc:r=>({x:()=>r.clone()})};var dBe={kernelName:fL,gradFunc:r=>({x:()=>Ct(r)})};function vBe(r,e){let t=q(r,"a","greaterEqual","string_or_numeric"),n=q(e,"b","greaterEqual","string_or_numeric");[t,n]=Rr(t,n),Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(RL,a)}var Yh=ee({greaterEqual_:vBe});function mBe(r,e){let t=q(r,"a","lessEqual","string_or_numeric"),n=q(e,"b","lessEqual","string_or_numeric");[t,n]=Rr(t,n),Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(fPe,a)}var yc=ee({lessEqual_:mBe});function gBe(r,e){let t=q(r,"a","logicalAnd","bool"),n=q(e,"b","logicalAnd","bool");Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(hPe,a)}var oc=ee({logicalAnd_:gBe});function yBe(r){let t={x:q(r,"x","clone","string_or_numeric")};return ue.runKernel(Ix,t)}var Ph=ee({clone_:yBe});function bBe(r,e){let t=q(r,"broadcastTo","x"),n=t.shape;if(e.some(l=>!(l>0)||l%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let l=t.shape.slice();for(;l.length<e.length;)l.unshift(1);t=he(t,l)}let a=t.shape,i=Array.from(e);for(let l=e.length-1;l>=0;l--)if(a[l]===e[l])i[l]=1;else if(t.shape[l]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(i.map((l,c)=>l>1?c:-1).filter(l=>l>=0).length===0)return Ph(t);let s={x:t},u={reps:i};return ue.runKernel(Nx,s,u)}var vm=ee({broadcastTo_:bBe});function wBe(r,e,t){let n=q(e,"a","where"),a=q(t,"b","where"),i=q(r,"condition","where","bool"),o=Jt(Jt(i.shape,n.shape),a.shape),s=vm(i,o),u=vm(n,o),l=vm(a,o),c={condition:s,t:u,e:l};return ue.runKernel(dB,c)}var Na=ee({where_:wBe});var xBe={kernelName:hL,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{clipValueMin:a,clipValueMax:i}=t;return{x:()=>Na(oc(Yh(n,a),yc(n,i)),r,Ct(r))}}};var kBe={kernelName:pL,inputsToSave:["x"],gradFunc:KB.gradFunc};function SBe(r,e,t=0){let a={x:q(r,"x","split")},i={numOrSizeSplits:e,axis:t};return ue.runKernel(TB,a,i)}var sc=ee({split_:SBe});var EBe={kernelName:dL,saveAllInputs:!0,gradFunc:(r,e,t)=>{let n=e.map(u=>u.shape),{axis:a}=t,i=Ci(a,e[0].shape)[0],o=n.map(u=>u[i]);return sc(r,o,i).map(u=>()=>u)}};function TBe(r,e,t,n,a,i="NHWC",o){let s=r;r.rank===3&&(s=he(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=he(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Y(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),Y(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),Y(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];Y(l===t[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${t[2]}.`),Y(c===t[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${t[3]}).`),Bn("conv2dDerFilter",a,o);let f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ue.runKernel(VOe,f,h)}var Lx=ee({conv2DBackpropFilter_:TBe});function IBe(r,e,t,n,a,i="NHWC",o){Y(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let s=r,u=e,l=!1;e.rank===3&&(l=!0,u=he(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),Y(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),Y(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),Y(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let c=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];Y(c===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[2]}.`),Y(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Bn("conv2dDerInput",a,o);let h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ue.runKernel(mL,h,p);return l?he(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Bx=ee({conv2DBackpropInput_:IBe});var NBe={kernelName:vL,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{dilations:i,strides:o,pad:s,dataFormat:u}=t;return Y(Iu(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>Bx(n.shape,r,a,o,s,u),filter:()=>Lx(n,r,a.shape,o,s,u)}}};function CBe(r,e,t,n,a="NHWC",i=[1,1],o){let s=q(r,"x","conv2d","float32"),u=q(e,"filter","conv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=he(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Y(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),Y(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Bn("conv2d",n,o);let f=a==="NHWC"?l.shape[3]:l.shape[1];Y(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),Y(ko(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ue.runKernel(vL,h,p);return c?he(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Zh=ee({conv2d_:CBe});var ABe={kernelName:mL,inputsToSave:["dy","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{strides:i,pad:o,dataFormat:s,dimRoundingMode:u}=t;return{dy:()=>Zh(r,a,i,o,s,1,u),filter:()=>Lx(r,n,a.shape,i,o,s,u)}}};function _Be(r,e,t,n,a){let i=r;r.rank===4&&(i=he(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));let o=e;o.rank===4&&(o=he(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Y(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),Y(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),Y(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),Y(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),Y(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);let s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ue.runKernel(UOe,s,u)}var DBe=ee({conv3DBackpropFilter_:_Be});function FBe(r,e,t,n,a){Y(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let i=r,o=e,s=!1;e.rank===4&&(s=!0,o=he(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);let u=i[4],l=o.shape[4];Y(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),Y(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),Y(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),Y(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),Y(l===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${t.shape[4]}.`);let c={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ue.runKernel(GOe,c,f);return s?he(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var XB=ee({conv3DBackpropInput_:FBe});var RBe={kernelName:gL,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i}=t;Y(Iu(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);let[o,s]=e;return{x:()=>XB(o.shape,r,s,a,i),filter:()=>DBe(o,r,s.shape,a,i)}}};function MBe(r){let t={x:q(r,"x","sin","float32")};return ue.runKernel(gB,t)}var YB=ee({sin_:MBe});var OBe={kernelName:yL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(Yr(YB(Je(t,"float32"))),r)}}};function PBe(r){let t={x:q(r,"x","sinh")};return ue.runKernel(yB,t)}var ZB=ee({sinh_:PBe});var LBe={kernelName:bL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(ZB(Je(t,"float32")),r)}}};function BBe(r,e){for(let t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function zBe(r,e,t){let n=r.length+e.length,a=[],i=0,o=0;for(let s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function $Be(r,e){let t=[],n=r.length;for(let i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);let a=e.map(i=>r[i]);return[t,a]}function uc(r,e){let t=e.map(n=>1);return zBe(r,t,e)}function QB(r,e){if(BBe(r,e))return null;let t=[];for(let n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(n=>t.push(n)),t}function zx(r){return r.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function WBe(r,e=0,t=!1,n=!1){let i={x:q(r,"x","cumsum")},o={axis:e,exclusive:t,reverse:n};return ue.runKernel(wL,i,o)}var JB=ee({cumsum_:WBe});function VBe(r){Fr().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}bLe(VBe);function Xr(r,e){return ue.tidy(r,e)}function la(r){GB(r).forEach(t=>t.dispose())}function UBe(r){return ue.keep(r)}function GBe(r,e){let t=q(r,"real","complex"),n=q(e,"imag","complex");qi(t.shape,n.shape,`real and imag shapes, ${t.shape} and ${n.shape}, must match in call to tf.complex().`);let a={real:t,imag:n};return ue.runKernel(WOe,a)}var lc=ee({complex_:GBe});function HBe(r){let t={input:q(r,"input","imag")};return ue.runKernel(lPe,t)}var $x=ee({imag_:HBe});function qBe(r){let t={input:q(r,"input","real")};return ue.runKernel(CPe,t)}var Sm=ee({real_:qBe});function KBe(r,e,t){let n=q(r,"x","transpose");if(e==null&&(e=n.shape.map((o,s)=>s).reverse()),Y(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(o=>{Y(o>=0&&o<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();let a={x:n},i={perm:e};return n.dtype==="complex64"?Xr(()=>{let o=Sm(n),s=$x(n);return o=ue.runKernel(hm,{x:o},i),s=ue.runKernel(hm,{x:s},i),t&&(s=Yr(s)),lc(o,s)}):ue.runKernel(hm,a,i)}var Hi=ee({transpose_:KBe});var jBe={kernelName:wL,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a,exclusive:i,reverse:o}=t;return{x:()=>{let s=QB([a],n.rank),u=JB(r,a,i,!o);return s!=null&&(u=Hi(u,s)),u}}}};function XBe(r,e,t,n,a,i=[1,1],o){let s=r;r.rank===3&&(s=he(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=he(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l={x:s,dy:u},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ue.runKernel(XOe,l,c)}var e4=ee({depthwiseConv2dNativeBackpropFilter_:XBe});function YBe(r,e,t,n,a,i=[1,1],o){let s=e,u=!1;e.rank===3&&(u=!0,s=he(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l={dy:s,filter:t},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ue.runKernel(YOe,l,c);return u?he(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var t4=ee({depthwiseConv2dNativeBackpropInput_:YBe});var ZBe={kernelName:xL,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i,dimRoundingMode:o}=t,s=n??[1,1];Y(Iu(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[u,l]=e;return Y(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),Y(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),Y(u.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),Y(ko(a,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${s}'.`),Bn("depthwiseConv2d",i,o),{x:()=>t4(u.shape,r,l,a,i,s,o),filter:()=>e4(u,r,l.shape,a,i,s,o)}}};var QBe={kernelName:kL,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,i={x:n,filter:a,dy:r},o={x:n,filter:a,dy:r};return{x:()=>ue.runKernel(QOe,i,t),filter:()=>ue.runKernel(JOe,o,t)}}};var JBe={kernelName:EL,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e,n={dy:r,y:t};return{x:()=>ue.runKernel(tPe,n)}}};function e4e(r){let t={x:q(r,"x","exp")};return ue.runKernel(IL,t)}var Ni=ee({exp_:e4e});var t4e={kernelName:TL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=ve(Ni(Yr(Qt(t))),2/Math.sqrt(Math.PI));return{x:()=>ve(r,n)}}};var r4e={kernelName:IL,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(r,t)}}};var n4e={kernelName:NL,inputsToSave:["input"],gradFunc:(r,e)=>{let[t]=e;return{input:()=>he(r,t.shape)}}};var a4e={kernelName:CL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(r,Ni(t))}}};var i4e={kernelName:AL,gradFunc:r=>({x:()=>Ct(r)})};var o4e={kernelName:_L,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Jt(t.shape,n.shape);return{a:()=>{let s=dt(r,Je(n,"float32")),u=on(t.shape,a);return u.length>0?he(ct(s,u),t.shape):s},b:()=>{let s=ve(r,Je(t,"float32")),u=on(n.shape,a);u.length>0&&(s=he(ct(s,u),n.shape));let l=Qt(n);return Yr(dt(s,Je(l,"float32")))}}}};function s4e(r){let t={x:q(r,"x","rsqrt","float32")};return ue.runKernel(pB,t)}var r4=ee({rsqrt_:s4e});function u4e(r,e){let t=q(r,"x","tile","string_or_numeric");Y(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let n={x:t},a={reps:e};return ue.runKernel(Nx,n,a)}var nc=ee({tile_:u4e});var l4e={kernelName:DL,inputsToSave:["x","mean","variance","scale"],gradFunc:(r,e,t)=>{let{varianceEpsilon:n}=t,[a,i,o,s]=e,u=s??yt(1),l=on(i.shape,a.shape),c=[];if(i.rank===1){for(let w=0;w<a.shape.length-1;++w)c.push(a.shape[w]);c.push(1)}let f=ut(a,i),h=ve(r,u),p=r4(et(o,yt(n))),d=ve(ve(ve(p,p),p),yt(-.5));return{x:()=>i.rank===1?he(ve(ve(r,nc(he(p,[1,1,1,i.shape[0]]),c)),u),a.shape):he(ve(ve(r,p),u),a.shape),mean:()=>{let w=ve(ve(p,yt(-1)),h);return i.rank===1&&(w=ct(w,l)),he(w,i.shape)},variance:()=>{let w=ve(ve(d,f),h);return i.rank===1&&(w=ct(w,l)),he(w,i.shape)},scale:()=>{let w=ve(f,p),k=ve(r,w);return i.rank===1&&(k=ct(k,l)),he(k,i.shape)},offset:()=>{let w=r;return i.rank===1&&(w=ct(w,l)),he(w,i.shape)}}}};function c4e(r,e,t){let n=q(r,"x","unsortedSegmentSum"),a=q(e,"segmentIds","unsortedSegmentSum","int32");Y(Lh(t),()=>"numSegments must be of dtype int");let i={x:n,segmentIds:a},o={numSegments:t};return ue.runKernel(FB,i,o)}var n4=ee({unsortedSegmentSum_:c4e});var f4e={kernelName:FL,inputsToSave:["x","indices"],gradFunc:(r,e,t)=>{let[n,a]=e,{axis:i}=t,o=Ci(i,n.shape)[0];return{x:()=>{let u=n.shape,l=a.size,c=u.slice(0,o),f=c.length,h=u.slice(i,u.length).slice(1),p=h.length,d=PP(0,f),v=PP(f+1,f+1+p),m=LP([c,[l],h]),g=he(r,m),y=he(a,[l]),b=LP([[f],d,v]),w=Hi(g,b),k=n4(w,y,n.shape[o]),S=zx(b);return k=Hi(k,S),k},indices:()=>a}}};function PP(r,e){let t=[];for(let n=r;n<e;++n)t.push(n);return t}function LP(r){let e=[];for(let t=0;t<r.length;++t)for(let n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var h4e={kernelName:RL,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>Ct(t),b:()=>Ct(n)}}};var p4e={kernelName:Ix,gradFunc:r=>({x:()=>Je(r,"float32")})};var d4e={kernelName:ML,gradFunc:r=>({x:()=>Ct(r)})};var v4e={kernelName:OL,gradFunc:r=>({x:()=>Ct(r)})};var m4e={kernelName:PL,gradFunc:r=>({x:()=>Ct(r)})};function g4e(r,e){let t=q(r,"a","greater","string_or_numeric"),n=q(e,"b","greater","string_or_numeric");[t,n]=Rr(t,n),Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(sPe,a)}var So=ee({greater_:g4e});var y4e={kernelName:LL,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{alpha:a}=t,i=So(n,0);return{x:()=>Na(i,r,ve(r,a))}}};var b4e={kernelName:zL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>dt(r,et(t,1))}}};var w4e={kernelName:BL,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>dt(r,Je(t,"float32"))}}};var x4e={kernelName:vPe,inputsToSave:[],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t;return{logits:()=>{let o=Ni(n);return ut(r,ve(ct(r,a,!0),o))}}}};function k4e(r,e,t,n=5,a=1,i=1,o=.5){let s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ue.runKernel(mPe,s,u)}var S4e=ee({localResponseNormalizationBackprop_:k4e});var E4e={kernelName:$L,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{depthRadius:i,bias:o,alpha:s,beta:u}=t;return{x:()=>S4e(n,a,r,i,o,s,u)}}};function T4e(r,e){let t=q(r,"a","equal","string_or_numeric"),n=q(e,"b","equal","string_or_numeric");[t,n]=Rr(t,n),Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(rPe,a)}var Wx=ee({equal_:T4e});function a4(r,e,t,n){return e.rank<t.rank&&(e=he(e,uc(e.shape,n))),r.rank<t.rank&&(r=he(r,uc(r.shape,n))),{x:()=>ve(r,Je(Wx(t,e),r.dtype))}}var BP={kernelName:WL,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{reductionIndices:a}=n,i=e[0],o=e[1],s=Ci(a,i.shape),u=a4(r,o,i,s);return{x:()=>u.x()}}};function I4e(r,e){let t=q(r,"a","less","string_or_numeric"),n=q(e,"b","less","string_or_numeric");[t,n]=Rr(t,n),Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(cPe,a)}var i4=ee({less_:I4e});var N4e={kernelName:VL,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>ve(r,Je(Yh(t,n),"float32")),b:()=>ve(r,Je(i4(t,n),"float32"))}}};function C4e(r,e,t,n,a,i,o){let s=q(r,"dy","maxPool3dGrad"),u=q(e,"input","maxPool3dGrad"),l=q(t,"output","maxPool3dGrad"),c=s,f=u,h=l,p=!1;u.rank===4&&(p=!0,c=he(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=he(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=he(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),Y(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),Y(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),Y(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Bn("maxPool3dGrad",i,o);let d={dy:c,input:f,output:h},v={filterSize:n,strides:a,pad:i,dimRoundingMode:o},m=ue.runKernel(yPe,d,v);return p?he(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var A4e=ee({maxPool3dGrad_:C4e});var _4e={kernelName:GL,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s,dimRoundingMode:u}=t;return{x:()=>A4e(r,n,a,i,o,s,u)}}};function D4e(r,e,t,n,a,i,o){let s=q(r,"dy","maxPoolGrad"),u=q(e,"input","maxPoolGrad"),l=q(t,"output","maxPoolGrad");Y(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),Y(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),Y(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Bn("maxPoolGrad",i,o);let c={dy:s,input:u,output:l},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ue.runKernel(gPe,c,f)}var F4e=ee({maxPoolGrad_:D4e});var R4e={kernelName:UL,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s}=t;return{x:()=>F4e(r,n,a,i,o,s)}}};function cc(r,e="float32"){if(e==="complex64"){let n=cc(r,"float32"),a=cc(r,"float32");return lc(n,a)}let t=Fx(ua(r),e);return ue.makeTensor(t,r,e)}function Qh(r,e="float32"){if(e==="complex64"){let n=Qh(r,"float32"),a=cc(r,"float32");return lc(n,a)}let t=PB(ua(r),e);return ue.makeTensor(t,r,e)}var M4e={kernelName:HL,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=Ci(a,n.shape),s=$Be(n.shape,i)[1],u=ua(s);return{x:()=>{let c=n.shape.slice();i.forEach(p=>{c[p]=1});let f=he(r,c);return dt(ve(f,Qh(n.shape,"float32")),u)}}}};var O4e={kernelName:qL,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{axis:a}=n,[i,o]=e,s=Ci(a,i.shape),u=a4(r,o,i,s);return{x:()=>u.x()}}};var P4e={kernelName:KL,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>ve(r,Je(yc(t,n),"float32")),b:()=>ve(r,Je(So(t,n),"float32"))}}};function L4e(r,e,t){let n=q(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let a={x:n},i={begin:e,size:t};return ue.runKernel(mB,a,i)}var Ot=ee({slice_:L4e});var B4e={kernelName:jL,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>Ot(r,i,n.shape)}}};function z4e(r){let t={x:q(r,"x","floor","float32")};return ue.runKernel(AL,t)}var Vx=ee({floor_:z4e});var $4e={kernelName:XL,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Jt(t.shape,n.shape);return{a:()=>{let s=on(t.shape,a);return s.length>0?he(ct(r,s),t.shape):r},b:()=>{let s=ve(r,Yr(Vx(dt(t,n)))),u=on(n.shape,a);return u.length>0?he(ct(s,u),n.shape):s}}}};var W4e={kernelName:YL,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Jt(t.shape,n.shape);return{a:()=>{let s=ve(r,Je(n,"float32")),u=on(t.shape,a);return u.length>0?he(ct(s,u),t.shape):s},b:()=>{let s=ve(r,Je(t,"float32")),u=on(n.shape,a);return u.length>0?he(ct(s,u),n.shape):s}}}};var V4e={kernelName:ZL,gradFunc:r=>({x:()=>Yr(r)})};var U4e={kernelName:JL,inputsToSave:["indices"],gradFunc:(r,e)=>{let t=e[0];return{indices:()=>cc(t.shape,"float32")}}};var G4e={kernelName:QL,gradFunc:r=>({x:()=>Ct(r)})};function H4e(r,e=0){let t=q(r,"x","unstack","string_or_numeric");Y(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let n={value:t},a={axis:e};return ue.runKernel(DB,n,a)}var Nm=ee({unstack_:H4e});var q4e={kernelName:eB,saveAllInputs:!0,gradFunc:(r,e,t)=>{let{axis:n}=t;return Nm(r,n).map(i=>()=>i)}};var zP={kernelName:tB,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>Ot(r,i,n.shape)}}};function K4e(r){let t={x:q(r,"x","log","float32")};return ue.runKernel(BL,t)}var fc=ee({log_:K4e});function j4e(r,e){let t=q(r,"base","pow"),n=q(e,"exp","pow");[t,n]=Rr(t,n);let a={a:t,b:n};return ue.runKernel(rB,a)}var Nu=ee({pow_:j4e});var X4e={kernelName:rB,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(r,e)=>{let[t,n,a]=e,i=t,o=n,s=Jt(i.shape,o.shape);return{a:()=>{let c=Je(o,"float32"),f=ve(r,ve(c,Nu(i,ut(c,yt(1))))),h=on(i.shape,s);return h.length>0&&(f=ct(f,h)),he(f,i.shape)},b:()=>{let c=So(i,0),f=Na(c,fc(i),Ct(i)),h=ve(r,ve(a,f)),p=on(o.shape,s);return p.length>0&&(h=ct(h,p)),he(h,o.shape)}}}};var Y4e={kernelName:nB,inputsToSave:["x","alpha"],gradFunc:(r,e)=>{let[t,n]=e,a=So(t,0);return{x:()=>Na(a,r,ve(r,n)),alpha:()=>{let i=Na(a,Ct(r),ve(r,t)),o=on(n.shape,r.shape);return o.length>0&&(i=ct(i,o)),he(i,n.shape)}}}};function Z4e(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var fa=Fr();fa.registerFlag("DEBUG",()=>!1,r=>{r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});fa.registerFlag("IS_BROWSER",()=>Z4e());fa.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");fa.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));fa.registerFlag("PROD",()=>!1);fa.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>fa.getBool("DEBUG"));fa.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);fa.registerFlag("IS_TEST",()=>!1);fa.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);fa.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);fa.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);fa.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);fa.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function Q4e(r,e,t){let n=Kh(r,t);return Xh(r,e,n,t)}var Ux=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function $P(r){return Ux?Buffer.byteLength(r):new Blob([r]).size}function J4e(r){if(Ux)return Buffer.from(r).toString("base64");let e=new Uint8Array(r),t="";for(let n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function eze(r){if(Ux){let n=Buffer.from(r,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t.set([e.charCodeAt(n)],n);return t.buffer}function tze(r){if(r.length===1)return r[0];let e=0;r.forEach(a=>{e+=a.byteLength});let t=new Uint8Array(e),n=0;return r.forEach(a=>{t.set(new Uint8Array(a),n),n+=a.byteLength}),t.buffer}function o4(r,e){let t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function rze(r,e,t){let n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),n}async function nze(r,e){let t,n;return r.weightsManifest!=null&&([t,n]=await e(r.weightsManifest)),rze(r,t,n)}function Cm(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:$P(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:$P(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}function aze(r){let e=[];for(let t of r)e.push(...t.weights);return e}var bo=class r{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return r.instance==null&&(r.instance=new r),r.instance}static registerSaveRouter(e){r.getInstance().saveRouters.push(e)}static registerLoadRouter(e){r.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return r.getHandlers(e,"save")}static getLoadHandlers(e,t){return r.getHandlers(e,"load",t)}static getHandlers(e,t,n){let a=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(o=>{let s=o(e,n);s!==null&&a.push(s)}),a}};var ize="tensorflowjs",oze=1,Oh="models_store",mm="model_info_store";function sze(){if(!Fr().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function uze(r){let e=r.result;e.createObjectStore(Oh,{keyPath:"modelPath"}),e.createObjectStore(mm,{keyPath:"modelPath"})}var hc=class{constructor(e){if(this.indexedDB=sze(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((n,a)=>{let i=this.indexedDB.open(ize,oze);i.onupgradeneeded=()=>uze(i),i.onsuccess=()=>{let o=i.result;if(t==null){let s=o.transaction(Oh,"readonly"),l=s.objectStore(Oh).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return o.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(l.result.modelArtifacts)},l.onerror=c=>(o.close(),a(l.error)),s.oncomplete=()=>o.close()}else{let s=Cm(t),u=o.transaction(mm,"readwrite"),l=u.objectStore(mm),c=l.put({modelPath:this.modelPath,modelArtifactsInfo:s}),f;c.onsuccess=()=>{f=o.transaction(Oh,"readwrite");let p=f.objectStore(Oh).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s});p.onsuccess=()=>n({modelArtifactsInfo:s}),p.onerror=d=>{l=u.objectStore(mm);let v=l.delete(this.modelPath);v.onsuccess=()=>(o.close(),a(p.error)),v.onerror=m=>(o.close(),a(p.error))}},c.onerror=h=>(o.close(),a(c.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>a(i.error)})}};hc.URL_SCHEME="indexeddb://";var s4=r=>Fr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(hc.URL_SCHEME)?lze(r.slice(hc.URL_SCHEME.length)):null;bo.registerSaveRouter(s4);bo.registerLoadRouter(s4);function lze(r){return new hc(r)}var Dh="/",Fh="tensorflowjs_models",cze="info",fze="model_topology",hze="weight_specs",pze="weight_data",dze="model_metadata";function vze(r){return{info:[Fh,r,cze].join(Dh),topology:[Fh,r,fze].join(Dh),weightSpecs:[Fh,r,hze].join(Dh),weightData:[Fh,r,pze].join(Dh),modelMetadata:[Fh,r,dze].join(Dh)}}function mze(r){for(let e of Object.values(r))window.localStorage.removeItem(e)}var pc=class{constructor(e){if(!Fr().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=vze(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=Cm(e);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,J4e(e.weightData));let i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}}catch{throw mze(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=a;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let s=JSON.parse(i);t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,s.signature!=null&&(t.signature=s.signature),s.userDefinedMetadata!=null&&(t.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(t.modelInitializer=s.modelInitializer),s.trainingConfig!=null&&(t.trainingConfig=s.trainingConfig)}let o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=eze(o),t}};pc.URL_SCHEME="localstorage://";var u4=r=>Fr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(pc.URL_SCHEME)?gze(r.slice(pc.URL_SCHEME.length)):null;bo.registerSaveRouter(u4);bo.registerLoadRouter(u4);function gze(r){return new pc(r)}var yze="model",bze=".json",wze=".weights.bin";function WP(r){return new Promise(e=>setTimeout(e)).then(r)}var dc=class r{constructor(e){if(!Fr().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=yze),this.modelJsonFileName=e+bze,this.weightDataFileName=e+wze}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=o4(e,n),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(o.download=this.modelJsonFileName,o.href=i,await WP(()=>o.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;s.download=this.weightDataFileName,s.href=t,await WP(()=>s.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Cm(e)}}}};dc.URL_SCHEME="downloads://";var xze=r=>Fr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(dc.URL_SCHEME)?kze(r.slice(dc.URL_SCHEME.length)):null;bo.registerSaveRouter(xze);function kze(r="model"){return new dc(r)}function VP(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);let a=0,i=u=>(u.then(l=>{let c=t+ ++a/r.length*(n-t);return e(c),l}),u);function o(u){Y(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function s(u,l){Y(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),Y(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),Y(l>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${l}`)}return Promise.all(r.map(i))}async function Sze(r,e){e==null&&(e={});let t=e.fetchFunc==null?Fr().platform.fetch:e.fetchFunc,n=r.map(f=>t(f,e.requestInit,{isBinary:!0})),s=(e.onProgress==null?await Promise.all(n):await VP(n,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(s):await VP(s,e.onProgress,.5,1)}var Eze="application/octet-stream",Tze="application/json",zh=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Y(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=Fr().platform.fetch,Y(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&Y(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=o4(e,n);t.body.append("model.json",new Blob([JSON.stringify(a)],{type:Tze}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:Eze}),"model.weights.bin");let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:Cm(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}let n=t.modelTopology,a=t.weightsManifest;if(n==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return nze(t,i=>this.loadWeights(i))}async loadWeights(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,a]=Ize(t),i=this.weightPathPrefix||n,o=aze(e),s=[],u=[];for(let c of e)for(let f of c.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):s.push(i+f+a);this.weightUrlConverter&&s.push(...await Promise.all(u));let l=await Sze(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,tze(l)]}};zh.URL_SCHEME_REGEX=/^https?:\/\//;function Ize(r){let e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function UP(r){return r.match(zh.URL_SCHEME_REGEX)!=null}var l4=(r,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(r)?t=r.every(n=>UP(n)):t=UP(r),t)return Nze(r,e)}return null};bo.registerSaveRouter(l4);bo.registerLoadRouter(l4);function Nze(r,e){return new zh(r,e)}function Cze(r,e,t=1,n=0,a="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let o={indices:q(r,"indices","oneHot","int32")},s={dtype:a,depth:e,onValue:t,offValue:n};return ue.runKernel(JL,o,s)}var vx=ee({oneHot_:Cze});function Aze(r,e,t){let n=q(r,"labels","confusionMatrix"),a=q(e,"predictions","confusionMatrix");Y(t==null||t>0&&Number.isInteger(t),()=>`If provided, numClasses must be a positive integer, but got ${t}`),Y(n.rank===1,()=>`Expected the rank of labels to be 1, but got ${n.rank}`),Y(a.rank===1,()=>`Expected the rank of predictions to be 1, but got ${a.rank}`),Y(n.shape[0]===a.shape[0],()=>`Mismatch in the number of examples: ${n.shape[0]} vs. ${a.shape[0]}. Labels and predictions should have the same number of elements.`),Y(t>0&&Number.isInteger(t),()=>`numClasses is required to be a positive integer, but got ${t}`);let i=vx(Je(n,"int32"),t),o=vx(Je(a,"int32"),t),s=Hi(i),u=Nt(s,o);return Je(u,"int32")}var uqe=ee({confusionMatrix_:Aze});function _ze(r,e,t){if(Cx(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let n=Kh(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Xh(r,e,n,t)}var Eu;function Dze(r,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${r.constructor.name}`);if(ox(SP,ue.backendName)!=null){let d={pixels:r},v={numChannels:e};return ue.runKernel(SP,d,v)}let[l,c]=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],f;if(o)f=r.getContext("2d").getImageData(0,0,l,c).data;else if(n||t)f=r.data;else if(i||a||s){if(Eu==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Eu=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Eu=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Eu.canvas.width=l,Eu.canvas.height=c,Eu.drawImage(r,0,0,l,c),f=Eu.getImageData(0,0,l,c).data}let h;if(e===4)h=new Int32Array(f);else{let d=l*c;h=new Int32Array(d*e);for(let v=0;v<d;v++)for(let m=0;m<e;++m)h[v*e+m]=f[v*4+m]}return _ze(h,[c,l,e],"int32")}var lqe=ee({fromPixels_:Dze});function Fze(r,e,t){let n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${r}, sliceDim: ${n}, and batchDim: ${a}.`;if(t.rank<a)throw new Error(i+` update.rank < ${a}. `);if(r.length<n+(t.rank-a))throw new Error(i+` Output shape length < ${n+(t.rank-a)}`);if(t.rank!==a+r.length-n)throw new Error(i+` update.rank != ${a+r.length-n}`);for(let o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+` updates.shape[${o+a}] (${t.shape[o+a]}) != shape[${o+a}] (${r[o+a]})`)}function Rze(r,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(r.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${r.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(r.size===0)throw new Error(`Updates specified for empty output. updates shape: ${r.shape}`)}Fze(t,e,r)}function Mze(r,e,t){let n,a=r.shape.length;typeof e=="number"?n=[e,...new Array(a-1).fill(0)]:e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(o=>{Y(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=[t,...new Array(a-1).fill(-1)]:t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map((o,s)=>o>=0?o:(Y(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${s}.`),r.shape[s]-n[s])),[n,i]}var mx=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}},gx=class r{constructor(){this.classNameMap={}}static getMap(){return r.instance==null&&(r.instance=new r),r.instance}static register(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]}};function Cu(r){Y(r.className!=null,()=>"Class being registered does not have the static className property defined."),Y(typeof r.className=="string",()=>"className is required to be a string, but got type "+typeof r.className),Y(r.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),gx.register(r)}function Oze(r){let e=q(r,"x","abs");if(e.dtype==="complex64"){let t={x:e};return ue.runKernel(pL,t)}else{let t={x:e};return ue.runKernel(YP,t)}}var Ia=ee({abs_:Oze});function Pze(r){let t={x:q(r,"x","acos")};return ue.runKernel(ZP,t)}var Lze=ee({acos_:Pze});function Bze(r){let t={x:q(r,"x","acosh")};return ue.runKernel(QP,t)}var zze=ee({acosh_:Bze});function $ze(r){Y(Array.isArray(r),()=>"The argument passed to tf.addN() must be a list of tensors"),Y(r.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${r.length}`);let e=r.map((a,i)=>q(a,`tensors${i}`,"addN")),t=e[0];e.forEach(a=>{if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(a=>{if(!gc(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let n=e;return ue.runKernel(JP,n)}var cqe=ee({addN_:$ze});function Wze(r,e=null,t=!1){let a={x:q(r,"x","all","bool")},i={axis:e,keepDims:t};return ue.runKernel(MOe,a,i)}var Vze=ee({all_:Wze});function Uze(r,e=null,t=!1){let a={x:q(r,"x","any","bool")},i={axis:e,keepDims:t};return ue.runKernel(OOe,a,i)}var Gze=ee({any_:Uze});function Hze(r,e=0){let n={x:q(r,"x","argMax")},a={axis:e};return ue.runKernel(eL,n,a)}var qze=ee({argMax_:Hze});function Kze(r,e=0){let n={x:q(r,"x","argMin")},a={axis:e};return ue.runKernel(tL,n,a)}var jze=ee({argMin_:Kze});function Xze(r){let t={x:q(r,"x","asin")};return ue.runKernel(rL,t)}var Yze=ee({asin_:Xze});function Zze(r){let t={x:q(r,"x","asinh")};return ue.runKernel(nL,t)}var Qze=ee({asinh_:Zze});function Jze(r){let t={x:q(r,"x","atan")};return ue.runKernel(aL,t)}var e$e=ee({atan_:Jze});function t$e(r,e){let t=q(r,"a","atan2"),n=q(e,"b","atan2");[t,n]=Rr(t,n);let a={a:t,b:n};return ue.runKernel(oL,a)}var r$e=ee({atan2_:t$e});function n$e(r){let t={x:q(r,"x","atanh")};return ue.runKernel(iL,t)}var a$e=ee({atanh_:n$e});function i$e(r,e,t,n,a){let i=q(r,"x","avgPool","float32"),o=1;Y(ko(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let s=i,u=!1;i.rank===3&&(u=!0,s=he(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Y(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),Bn("avgPool",n,a);let l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ue.runKernel(sL,l,c);return f=Je(f,i.dtype),u?he(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var c4=ee({avgPool_:i$e});function o$e(r,e,t,n,a,i="NDHWC"){let o=q(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=he(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Y(s.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${s.rank}.`),Y(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Bn("avgPool3d",n,a);let l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=ue.runKernel(uL,l,c);return f=Je(f,s.dtype),u?he(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var fqe=ee({avgPool3d_:o$e});function s$e(r,e=0){Y(r.length>=1,()=>"Pass at least one tensor to concat");let t=wm(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return Ph(t[0]);let n=t,a={axis:e};return ue.runKernel(dL,n,a)}var Ln=ee({concat_:s$e});function u$e(r){let t={x:q(r,"x","sigmoid","float32")};return ue.runKernel(wB,t)}var Tu=ee({sigmoid_:u$e});function l$e(r){let t={x:q(r,"x","tanh","float32")};return ue.runKernel(_B,t)}var yx=ee({tanh_:l$e});function c$e(r,e,t,n,a,i){let o=q(r,"forgetBias","basicLSTMCell"),s=q(e,"lstmKernel","basicLSTMCell"),u=q(t,"lstmBias","basicLSTMCell"),l=q(n,"data","basicLSTMCell"),c=q(a,"c","basicLSTMCell"),f=q(i,"h","basicLSTMCell"),h=Ln([l,f],1),p=Nt(h,s),d=et(p,u),v=d.shape[0],m=d.shape[1]/4,g=[v,m],y=Ot(d,[0,0],g),b=Ot(d,[0,m],g),w=Ot(d,[0,m*2],g),k=Ot(d,[0,m*3],g),S=et(ve(Tu(y),yx(b)),ve(c,Tu(et(o,w)))),E=ve(yx(S),Tu(k));return[S,E]}var hqe=ee({basicLSTMCell_:c$e});function f$e(r,e,t){let n=q(r,"x","batchToSpaceND"),a=e.reduce((s,u)=>s*u);Y(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),Y(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),Y(n.shape[0]%a===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${a}`);let i={x:n},o={blockShape:e,crops:t};return ue.runKernel(cL,i,o)}var Gx=ee({batchToSpaceND_:f$e});function h$e(r){let e;return r.rank===0||r.rank===1?e=he(r,[1,1,1,r.size]):r.rank===2?e=he(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=he(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function p$e(r,e,t,n,a,i){i==null&&(i=.001);let o=q(r,"x","batchNorm"),s=q(e,"mean","batchNorm"),u=q(t,"variance","batchNorm"),l;a!=null&&(l=q(a,"scale","batchNorm"));let c;n!=null&&(c=q(n,"offset","batchNorm")),Y(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Y(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Y(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:h$e(o),scale:l,offset:c,mean:s,variance:u},p={varianceEpsilon:i},d=ue.runKernel(DL,h,p);return he(d,o.shape)}var Am=ee({batchNorm_:p$e});function d$e(r,e,t,n,a,i){let o=q(r,"x","batchNorm"),s=q(e,"mean","batchNorm"),u=q(t,"variance","batchNorm"),l;a!=null&&(l=q(a,"scale","batchNorm"));let c;return n!=null&&(c=q(n,"offset","batchNorm")),Y(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),Y(s.rank===2||s.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${s.rank}.`),Y(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),l!=null&&Y(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&Y(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),Am(o,s,u,c,l,i)}var pqe=ee({batchNorm2d_:d$e});function v$e(r,e,t,n,a,i){let o=q(r,"x","batchNorm"),s=q(e,"mean","batchNorm"),u=q(t,"variance","batchNorm"),l;a!=null&&(l=q(a,"scale","batchNorm"));let c;return n!=null&&(c=q(n,"offset","batchNorm")),Y(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),Y(s.rank===3||s.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${s.rank}.`),Y(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),l!=null&&Y(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&Y(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),Am(o,s,u,c,l,i)}var dqe=ee({batchNorm3d_:v$e});function m$e(r,e,t,n,a,i){let o=q(r,"x","batchNorm"),s=q(e,"mean","batchNorm"),u=q(t,"variance","batchNorm"),l;a!=null&&(l=q(a,"scale","batchNorm"));let c;return n!=null&&(c=q(n,"offset","batchNorm")),Y(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),Y(s.rank===4||s.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${s.rank}.`),Y(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),l!=null&&Y(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&Y(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),Am(o,s,u,c,l,i)}var vqe=ee({batchNorm4d_:m$e});function g$e(r,e,t){let n=q(r,"x","bincount"),a=q(e,"weights","bincount");Y(n.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${n.dtype}`),Y(t>=0,()=>`size must be non-negative, but got ${t}.`),Y(a.size===n.size||a.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${n.shape}, weights shape: ${a.shape}.`);let i={x:n,weights:a},o={size:t};return ue.runKernel(BOe,i,o)}var y$e=ee({bincount_:g$e});function b$e(r,e){let t=q(r,"s0","broadcastArgs","int32"),n=q(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(n.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${n.rank}`);let a={s0:t,s1:n};return ue.runKernel($Oe,a)}var mqe=ee({broadcastArgs_:b$e});function Jh(r,e="float32",t){return e=e||"float32",LB(r),new lx(r,e,t)}function w$e(r){let t={x:q(r,"x","ceil","float32")};return ue.runKernel(fL,t)}var x$e=ee({ceil_:w$e});function _m(r,e,t){let n={shape:r,value:e,dtype:t};return ue.runKernel(aPe,{},n)}function k$e(r,e,t){let n=q(r,"x","clipByValue");if(Y(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return _m(n.shape,e,n.dtype);let a={x:n},i={clipValueMin:e,clipValueMax:t};return ue.runKernel(hL,a,i)}var S$e=ee({clipByValue_:k$e});function E$e(r){return Ln(r,0)}var gqe=ee({concat1d_:E$e});function T$e(r,e){return Ln(r,e)}var yqe=ee({concat2d_:T$e});function I$e(r,e){return Ln(r,e)}var bqe=ee({concat3d_:I$e});function N$e(r,e){return Ln(r,e)}var wqe=ee({concat4d_:N$e});function C$e(r,e,t,n,a="NWC",i=1,o){let s=q(r,"x","conv1d"),u=q(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=he(s,[1,s.shape[0],s.shape[1]])),Y(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),Y(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Bn("conv1d",n,o),Y(l.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`),Y(ko(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),Y(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let f=he(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=he(l,[l.shape[0],1,l.shape[1],l.shape[2]]),m=Zh(h,f,[1,t],n,"NHWC",[1,i],o);return c?he(m,[m.shape[2],m.shape[3]]):he(m,[m.shape[0],m.shape[2],m.shape[3]])}var A$e=ee({conv1d_:C$e});function _$e(r,e,t,n,a,i){let o=q(r,"x","conv2dTranspose"),s=q(e,"filter","conv2dTranspose");return Bx(t,o,s,n,a,"NHWC",i)}var D$e=ee({conv2dTranspose_:_$e});function F$e(r,e,t,n,a="NDHWC",i=[1,1,1]){let o=q(r,"x","conv3d"),s=q(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=he(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Y(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),Y(s.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${s.rank}.`),Y(u.shape[4]===s.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${s.shape[3]}.`),Y(ko(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),Y(a==="NDHWC",()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`);let c={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=ue.runKernel(gL,c,f);return l?he(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var xqe=ee({conv3d_:F$e});function R$e(r,e,t,n,a){let i=q(r,"x","conv3dTranspose"),o=q(e,"filter","conv3dTranspose");return XB(t,i,o,n,a)}var kqe=ee({conv3dTranspose_:R$e});function M$e(r){let t={x:q(r,"x","cos","float32")};return ue.runKernel(yL,t)}var Hx=ee({cos_:M$e});function O$e(r){let t={x:q(r,"x","cosh","float32")};return ue.runKernel(bL,t)}var f4=ee({cosh_:O$e});function P$e(r,e=0,t=!1,n=!1){let i={x:q(r,"x","cumprod")},o={axis:e,exclusive:t,reverse:n};return ue.runKernel(HOe,i,o)}var bx=ee({cumprod_:P$e});function L$e(r,e,t,n=!1){let a=q(r,"x","denseBincount"),i=q(e,"weights","denseBincount");Y(a.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`),Y(a.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`),Y(t>=0,()=>`size must be non-negative, but got ${t}.`),Y(i.size===a.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${i.shape}.`);let o={x:a,weights:i},s={size:t,binaryOutput:n};return ue.runKernel(KOe,o,s)}var Sqe=ee({denseBincount_:L$e});function B$e(r,e,t="NHWC"){let n=q(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];Y(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),Y(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e}  for depthToSpace with input shape
    ${n.shape}`),Y(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${n.shape}`),Y(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${n.shape}`);let s={x:n},u={blockSize:e,dataFormat:t};return ue.runKernel(jOe,s,u)}var z$e=ee({depthToSpace_:B$e});function $$e(r,e,t,n,a="NHWC",i=[1,1],o){let s=q(r,"x","depthwiseConv2d","float32"),u=q(e,"filter","depthwiseConv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=he(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Y(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),Y(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let f=a==="NHWC"?l.shape[3]:l.shape[1];Y(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Bn("depthwiseConv2d",n,o);let h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ue.runKernel(xL,h,p);return c?he(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var qx=ee({depthwiseConv2d_:$$e});function W$e(r){let t={x:q(r,"x","diag")};return ue.runKernel(ZOe,t)}var Eqe=ee({diag_:W$e});function V$e(r,e,t,n,a=[1,1],i="NHWC"){let o=q(r,"x","dilation2d"),s=q(e,"filter","dilation2d");Y(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),Y(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),Y(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,l=!1;o.rank===3&&(u=he(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);let c={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=ue.runKernel(kL,c,f);return l?he(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var U$e=ee({dilation2d_:V$e});function G$e(r,e){let t=q(r,"a","div"),n=q(e,"b","div");[t,n]=Rr(t,n);let a=dt(t,n),i=Ct(a),o=Wx(n,i);return Na(o,i,a)}var H$e=ee({divNoNan_:G$e});function q$e(r,e){let t=q(r,"t1","dot"),n=q(e,"t2","dot");Y((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${n.rank}.`);let a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(Y(a===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`),t.rank===1&&n.rank===1){let o=he(t,[1,-1]),s=he(n,[-1,1]),u=Nt(o,s);return he(u,[])}else if(t.rank===1&&n.rank===2){let o=he(t,[1,-1]),s=he(n,[n.shape[0],n.shape[1]]),u=Nt(o,s);return he(u,[u.size])}else if(t.rank===2&&n.rank===1){let o=he(n,[-1,1]),s=Nt(t,o);return he(s,[s.size])}else{let o=he(n,[n.shape[0],n.shape[1]]);return Nt(t,o)}}var K$e=ee({dot_:q$e});function j$e(r,...e){let t=e.map((a,i)=>q(a,`tensors${i}`,"einsum")),n={equation:r};return ue.runKernel(ePe,t,n)}var Tqe=ee({einsum_:j$e});function X$e(r){let t={x:q(r,"x","elu","float32")};return ue.runKernel(EL,t)}var h4=ee({elu_:X$e});function Y$e(r){let e=q(r,"x","erf");Y(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Je(e,"float32"));let t={x:e};return ue.runKernel(TL,t)}var Z$e=ee({erf_:Y$e});function Q$e(r,e=null,t=!1){let a={x:q(r,"x","max")},i={reductionIndices:e,keepDims:t};return ue.runKernel(WL,a,i)}var ac=ee({max_:Q$e});function J$e(r,e=null,t=!1){let a={x:q(r,"x","min")},i={axis:e,keepDims:t};return ue.runKernel(qL,a,i)}var wx=ee({min_:J$e});function eWe(r,e="euclidean",t=null,n=!1){r=q(r,"x","norm");let a=p4(r,e,t),i=a.shape;if(n){let o=Ci(t,r.shape);i=uc(a.shape,o)}return he(a,i)}function p4(r,e,t=null){if(r.rank===0)return Ia(r);if(r.rank!==1&&t===null)return p4(he(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return ct(Ia(r),t);if(e===1/0)return ac(Ia(r),t);if(e===-1/0)return wx(Ia(r),t);if(e==="euclidean"||e===2)return ca(ct(Nu(Ia(r),yt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return ac(ct(Ia(r),t[0]),t[1]-1);if(e===1/0)return ac(ct(Ia(r),t[1]),t[0]);if(e===-1/0)return wx(ct(Ia(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return ca(ct(Qt(r),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var Dm=ee({norm_:eWe});function tWe(r,e=null,t=!1){return Dm(r,"euclidean",e,t)}var rWe=ee({euclideanNorm_:tWe});function nWe(r,e=0){let t=q(r,"x","expandDims","string_or_numeric");Y(e<=t.rank,()=>"Axis must be <= rank of the tensor");let n={input:t},a={dim:e};return ue.runKernel(NL,n,a)}var is=ee({expandDims_:nWe});function aWe(r){let t={x:q(r,"x","expm1")};return ue.runKernel(CL,t)}var iWe=ee({expm1_:aWe});function oWe(r,e,t,n="float32"){e==null&&(e=r);let a=Jh([r,e],n),i=r<=e?r:e;for(let s=0;s<i;++s)a.set(1,s,s);let o=he(a.toTensor(),[r,e]);if(t==null)return o;if(t.length===1)return nc(is(o,0),[t[0],1,1]);if(t.length===2)return nc(is(is(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return nc(is(is(is(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}var sWe=ee({eye_:oWe});function uWe(r,e,t=0,n=0){let a=q(r,"x","gather"),i=q(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ue.runKernel(FL,o,s)}var d4=ee({gather_:uWe});function lWe(r){let t={x:q(r,"x","isFinite")};return ue.runKernel(ML,t)}var cWe=ee({isFinite_:lWe});function fWe(r){let t={x:q(r,"x","isInf")};return ue.runKernel(OL,t)}var hWe=ee({isInf_:fWe});function pWe(r){let t={x:q(r,"x","isNaN")};return ue.runKernel(PL,t)}var dWe=ee({isNaN_:pWe});function vWe(r,e=.2){let n={x:q(r,"x","leakyRelu")},a={alpha:e};return ue.runKernel(LL,n,a)}var v4=ee({leakyRelu_:vWe});function mWe(r,e=5,t=1,n=1,a=.5){let i=q(r,"x","localResponseNormalization");Y(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),Y(Lh(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,s=!1;i.rank===3&&(s=!0,o=he(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let u={x:o},l={depthRadius:e,bias:t,alpha:n,beta:a},c=ue.runKernel($L,u,l);return s?he(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var gWe=ee({localResponseNormalization_:mWe});function yWe(r){let t={x:q(r,"x","log1p")};return ue.runKernel(zL,t)}var m4=ee({log1p_:yWe});function bWe(r,e){Y(nx(r),()=>"The f passed in variableGrads(f) must be a function"),Y(e==null||Array.isArray(e)&&e.every(l=>l instanceof ic),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let l in ue.registeredVariables)e.push(ue.registeredVariables[l])}let n=t?e.filter(l=>!l.trainable):null,a=e.length;e=e.filter(l=>l.trainable),Y(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let i=!0,{value:o,grads:s}=ue.gradients(r,e,null,i);Y(s.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),Y(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let u={};return e.forEach((l,c)=>{s[c]!=null&&(u[l.name]=s[c])}),n?.forEach(l=>u[l.name]=null),{value:o,grads:u}}function wo(r){return ue.customGrad(r)}function wWe(r){let t={x:q(r,"x","softplus")};return ue.runKernel(xB,t)}var g4=ee({softplus_:wWe});function xWe(r){let e=q(r,"x","logSigmoid");return wo(n=>({value:Yr(g4(Yr(n))),gradFunc:o=>ve(o,Tu(Yr(n)))}))(e)}var kWe=ee({logSigmoid_:xWe});function SWe(r,e=-1){let t=q(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return wo((a,i)=>{let s=ac(a,e,!0),u=ut(a,s),l=ut(Je(u,"float32"),fc(ct(Ni(u),e,!0)));return i([l]),{value:l,gradFunc:(f,h)=>{let[p]=h,d=!0,v=Ni(p);return ut(f,ve(ct(f,e,d),v))}}})(t)}var EWe=ee({logSoftmax_:SWe});function TWe(r,e=null,t=!1){let n=q(r,"x","logSumExp"),a=Ci(e,n.shape),i=ac(n,a,!0),o=ut(n,i),s=Ni(o),u=ct(s,a),l=fc(u),c=et(he(i,l.shape),l);if(t){let f=uc(c.shape,a);return he(c,f)}return c}var y4=ee({logSumExp_:TWe});function IWe(r){let t={x:q(r,"x","logicalNot","bool")};return ue.runKernel(pPe,t)}var Kx=ee({logicalNot_:IWe});function NWe(r,e){let t=q(r,"a","logicalOr","bool"),n=q(e,"b","logicalOr","bool");Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(dPe,a)}var b4=ee({logicalOr_:NWe});function CWe(r,e){let t=q(r,"a","logicalXor","bool"),n=q(e,"b","logicalXor","bool");return Jt(t.shape,n.shape),oc(b4(r,e),Kx(oc(r,e)))}var AWe=ee({logicalXor_:CWe});var fm=2147483648;function _We(r,e,t="left"){let n=q(r,"sortedSequence","searchSorted"),a=q(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=he(n,[-1,i]),u=he(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(ua(u.shape)>=fm)throw new Error(`values tensor size must less than ${fm}`);if(s.shape[1]>=fm)throw new Error(`trailing dim_size must less than ${fm} for int32 output type, was ${s.shape[1]}`);let l={sortedSequence:s,values:u},c={side:t};return ue.runKernel(FPe,l,c)}var Iqe=ee({searchSorted_:_We});function DWe(r,e,t,n,a){let i=q(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=he(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Y(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),Y(ko(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Bn("maxPool",n,a);let l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ue.runKernel(UL,l,c);return u?he(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var w4=ee({maxPool_:DWe});function FWe(r,e=[1,1,1],t,n,a,i="NDHWC"){let o=q(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=he(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Y(s.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${s.rank}.`),Y(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Bn("maxPool3d",n,a);let l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=ue.runKernel(GL,l,c);return u?he(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Nqe=ee({maxPool3d_:FWe});function RWe(r,e,t,n,a=!1){let o={x:q(r,"x","maxPoolWithArgmax")},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=ue.runKernel(bPe,o,s);return{result:u[0],indexes:u[1]}}var Cqe=ee({maxPoolWithArgmax_:RWe});function MWe(r,e){let t=q(r,"a","maximum"),n=q(e,"b","maximum");[t,n]=Rr(t,n),t.dtype==="bool"&&(t=Je(t,"int32"),n=Je(n,"int32")),Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(VL,a)}var jx=ee({maximum_:MWe});function OWe(r,e=null,t=!1){let a={x:q(r,"x","mean")},i={axis:e,keepDims:t};return ue.runKernel(HL,a,i)}var Em=ee({mean_:OWe});function PWe(r,e){let t=q(r,"a","minimum"),n=q(e,"b","minimum");[t,n]=Rr(t,n),t.dtype==="bool"&&(t=Je(t,"int32"),n=Je(n,"int32")),Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(KL,a)}var x4=ee({minimum_:PWe});function LWe(r,e,t){Y(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let n=q(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Y(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);let a=t==="reflect"?1:0;for(let s=0;s<n.rank;s++)Y(e[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Y(e[s][0]>=0&&e[s][0]<=n.shape[s]-a&&e[s][1]>=0&&e[s][1]<=n.shape[s]-a,()=>`Padding in dimension ${s} cannot be greater than or equal to ${n.shape[s]-a} or less than 0 for input of shape ${n.shape}`);let i={paddings:e,mode:t},o={x:n};return ue.runKernel(jL,o,i)}var BWe=ee({mirrorPad_:LWe});function zWe(r,e){let t=q(r,"a","mod"),n=q(e,"b","mod");[t,n]=Rr(t,n);let a={a:t,b:n};return ue.runKernel(XL,a)}var $We=ee({mod_:zWe});function WWe(r,e=null,t=!1){r=q(r,"x","moments");let n=Ci(e,r.shape),a=Em(r,n,t),i=a.shape;t||(i=uc(a.shape,n));let o=Qt(ut(Je(r,"float32"),he(a,i))),s=Em(o,n,t);return{mean:a,variance:s}}var Aqe=ee({moments_:WWe});function VWe(r,e,t,n){let a=q(e,"data","multiRNNCell"),i=wm(t,"c","multiRNNCell"),o=wm(n,"h","multiRNNCell"),s=a,u=[];for(let f=0;f<r.length;f++){let h=r[f](s,i[f],o[f]);u.push(h[0]),u.push(h[1]),s=h[1]}let l=[],c=[];for(let f=0;f<u.length;f+=2)l.push(u[f]),c.push(u[f+1]);return[l,c]}var _qe=ee({multiRNNCell_:VWe});function UWe(r,e,t,n=!1){let a=q(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);t=t||Math.random();let u={logits:o===1?he(a,[1,-1]):a},l={numSamples:e,seed:t,normalized:n},c=ue.runKernel(wPe,u,l);return o===1?he(c,[c.size]):c}var Dqe=ee({multinomial_:UWe});function GWe(r,e){let t=q(r,"a","notEqual","string_or_numeric"),n=q(e,"b","notEqual","string_or_numeric");[t,n]=Rr(t,n),Jt(t.shape,n.shape);let a={a:t,b:n};return ue.runKernel(xPe,a)}var k4=ee({notEqual_:GWe});function HWe(r){let t={x:q(r,"x","onesLike")};return ue.runKernel(QL,t)}var qWe=ee({onesLike_:HWe});function KWe(r,e){let t=q(r,"v1","outerProduct"),n=q(e,"v2","outerProduct");Y(t.rank===1&&n.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${n.rank}.`);let a=he(t,[-1,1]),i=he(n,[1,-1]);return Nt(a,i)}var Fqe=ee({outerProduct_:KWe});function jWe(r,e,t=0){let n=q(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:e,constantValue:t},i={x:n};return ue.runKernel(tB,i,a)}var bc=ee({pad_:jWe});function XWe(r,e,t=0){return Y(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),bc(r,[e],t)}var Rqe=ee({pad1d_:XWe});function YWe(r,e,t=0){return Y(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),bc(r,e,t)}var Mqe=ee({pad2d_:YWe});function ZWe(r,e,t=0){return Y(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),bc(r,e,t)}var Oqe=ee({pad3d_:ZWe});function QWe(r,e,t=0){return Y(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),bc(r,e,t)}var Pqe=ee({pad4d_:QWe});function JWe(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");let s=q(r,"x","maxPool"),u=s,l=!1;s.rank===3&&(l=!0,u=he(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Y(ko(i,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`);let c=QLe(u.shape,e,i,a,n),f=[c.dilationHeight,c.dilationWidth],h;n==="same"?h=tVe([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];let p=f[0]===1&&f[1]===1,[d,v]=eVe([c.inHeight,c.inWidth],f,h),m=p?n:"valid",g=p?u:Px(u,f,d),b=(t==="avg"?()=>c4(g,e,i,m,o):()=>w4(g,e,i,m,o))(),w=p?b:Gx(b,f,v);return l?he(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function eVe(r,e,t){let n=t.map(c=>c[0]),a=t.map(c=>c[1]),i=r.concat(n,a),o=e.map((c,f)=>(c-i[f]%c)%c),s=a.map((c,f)=>c+o[f]),u=e.map((c,f)=>[n[f],s[f]]),l=e.map((c,f)=>[0,o[f]]);return[u,l]}function tVe(r,e){let n=r.map((o,s)=>o+(o-1)*(e[s]-1)).map(o=>o-1),a=n.map(o=>Math.floor(o/2)),i=n.map((o,s)=>o-a[s]);return n.map((o,s)=>[a[s],i[s]])}var rVe=ee({pool_:JWe});function nVe(r,e){let t=q(r,"x","prelu"),n=q(e,"alpha","prelu"),a={x:t,alpha:n};return ue.runKernel(nB,a)}var S4=ee({prelu_:nVe});function aVe(r,e=null,t=!1){let n=q(r,"x","prod");n.dtype==="bool"&&(n=Je(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ue.runKernel(aB,a,i)}var iVe=ee({prod_:aVe});function oVe(r,e,t,n){let a=r.map((c,f)=>q(c,`tensors${f}`,"raggedGather","int32")),i=q(e,"paramsDenseValues","raggedGather"),o=q(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},l=ue.runKernel(TPe,s,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}var Lqe=ee({raggedGather_:oVe});function sVe(r,e,t,n,a){let i=q(r,"shape","raggedTensorToTensor","int32"),o=q(e,"values","raggedTensorToTensor"),s=q(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map((f,h)=>q(f,`tensors${h}`,"raggedTensorToTensor","int32")),l={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},c={rowPartitionTypes:a};return ue.runKernel(IPe,l,c)}var Bqe=ee({raggedTensorToTensor_:sVe});function uVe(r,e,t){let n=ua(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error(`Unknown data type ${t}`);for(let i=0;i<n;i++)a[i]=e();return ue.makeTensor(a,r,t)}var zqe=ee({rand_:uVe}),Au=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _u(r,e){return e={exports:{}},r(e,e.exports),e.exports}var lVe=_u(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Au,r,!1)}),cVe=_u(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Au,r,!1)}),fVe=_u(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Au,r,!1)}),hVe=_u(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p,d;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p,d=[];if(f===(f|0))p=d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?p=d[7]=-1:p=d[h],c.x=d,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Au,r,!1)}),pVe=_u(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=512;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=m,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Au,r,!1)}),dVe=_u(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Au,r,!1)}),Du=_u(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,k,S){var E=[];k=k==!0?{entropy:!0}:k||{};var N=g(m(k.entropy?[w,b(t)]:w??y(),3),E),C=new d(E),R=function(){for(var _=C.g(i),O=u,P=0;_<l;)_=(_+P)*a,O*=a,P=C.g(1);for(;_>=c;)_/=2,O/=2,P>>>=1;return(_+P)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(b(C.S),t),(k.pass||S||function(_,O,P,B){return B&&(B.S&&v(B,C),_.state=function(){return v(C,{})}),P?(n[s]=_,O):_})(R,N,"global"in k?k.global:this==n,k.state)}function d(w){var k,S=w.length,E=this,N=0,C=E.i=E.j=0,R=E.S=[];for(S||(w=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+w[N%S]+(k=R[N])],R[C]=k;(E.g=function(_){for(var O,P=0,B=E.i,W=E.j,L=E.S;_--;)O=L[B=f&B+1],P=P*a+L[f&(L[B]=L[W=f&W+O])+(L[W]=O)];return E.i=B,E.j=W,P})(a)}function v(w,k){return k.i=w.i,k.j=w.j,k.S=w.S.slice(),k}function m(w,k){var S=[],E=typeof w,N;if(k&&E=="object")for(N in w)try{S.push(m(w[N],k-1))}catch{}return S.length?S:E=="string"?w:w+"\0"}function g(w,k){for(var S=w+"",E,N=0;N<S.length;)k[f&N]=f&(E^=k[f&N]*19)+S.charCodeAt(N++);return b(k)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var k=e.navigator,S=k&&k.plugins;return[+new Date,e,S,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=vp()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Au,[],Math)});Du.alea=lVe;Du.xor128=cVe;Du.xorwow=fVe;Du.xorshift7=hVe;Du.xor4096=pVe;Du.tychei=dVe;var vVe=Du,Xx=vVe.alea;var $h=class{constructor(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let o=i||Math.random();this.random=Xx(o.toString())}nextValue(){if(!isNaN(this.nextVal)){let a=this.nextVal;return this.nextVal=NaN,a}let e,t,n=!1;for(;!n;){let a,i,o;do a=2*this.random()-1,i=2*this.random()-1,o=a*a+i*i;while(o>=1||o===0);let s=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*a*s,t=this.mean+this.stdDev*i*s,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}},xx=class{constructor(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;let i=a||Math.random();this.randu=Xx(i.toString()),this.randn=new $h(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,a,i,o;for(;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}},kx=class{constructor(e=0,t=1,n,a){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Xx(a)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function mVe(r,e,t=1,n="float32",a){if(t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error(`Unsupported data type ${n}`);let i=new xx(e,t,n,a),o=Jh(r,n);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var $qe=ee({randomGamma_:mVe});function gVe(r,e=0,t=1,n,a){if(n!=null&&n==="bool")throw new Error(`Unsupported data type ${n}`);let i=new $h(e,t,n,!1,a),o=Jh(r,n);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var yVe=ee({randomNormal_:gVe});function bVe(r,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return yVe(r,0,1,e,t)}var Wqe=ee({randomStandardNormal_:bVe});function wVe(r,e=0,t=1,n="float32",a){let i=Jh(r,n),o=new kx(e,t,null,a);for(let s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var xVe=ee({randomUniform_:wVe});function Tm(r,e,t=1,n="float32"){if(t===0)throw new Error("Cannot have a step of zero");let a={start:r,stop:e,step:t,dtype:n};return ue.runKernel(NPe,{},a)}function kVe(r){let t={x:q(r,"x","reciprocal")};return ue.runKernel(iB,t)}var SVe=ee({reciprocal_:kVe});function EVe(r){let t={x:q(r,"x","relu")};return ue.runKernel(oB,t)}var Fm=ee({relu_:EVe});function TVe(r){let t={x:q(r,"x","relu6")};return ue.runKernel(cB,t)}var E4=ee({relu6_:TVe});function IVe(r,e){let n={x:q(r,"x","reverse")},a={dims:e};return ue.runKernel(fB,n,a)}var os=ee({reverse_:IVe});function NVe(r){let e=q(r,"x","reverse");return Y(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),os(e,0)}var Vqe=ee({reverse1d_:NVe});function CVe(r,e){let t=q(r,"x","reverse");return Y(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),os(t,e)}var Uqe=ee({reverse2d_:CVe});function AVe(r,e){let t=q(r,"x","reverse");return Y(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),os(t,e)}var Gqe=ee({reverse3d_:AVe});function _Ve(r,e){let t=q(r,"x","reverse");return Y(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),os(t,e)}var Hqe=ee({reverse4d_:_Ve});function DVe(r){let t={x:q(r,"x","round")};return ue.runKernel(hB,t)}var T4=ee({round_:DVe});function FVe(r){let t={x:q(r,"x","selu")};return ue.runKernel(vB,t)}var RVe=ee({selu_:FVe});function MVe(r,e,t,n,a,i=[1,1],o="NHWC"){let s=q(r,"x","separableConv2d"),u=q(e,"depthwiseFilter","separableConv2d"),l=q(t,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(s.rank===3&&(f=!0,c=he(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Y(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),Y(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),Y(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),Y(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),Y(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);let h=u.shape[2],p=u.shape[3];Y(l.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${l.shape[2]}.`);let d=qx(c,u,n,a,o,i),m=Zh(d,l,1,"valid",o);return f?he(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var OVe=ee({separableConv2d_:MVe});function PVe(r){let t={x:q(r,"x","sign")};return ue.runKernel(bB,t)}var LVe=ee({sign_:PVe});function BVe(r,e,t){let n=q(r,"x","slice1d");return Y(n.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${n.rank} tensor`),Ot(n,[e],[t])}var qqe=ee({slice1d_:BVe});function zVe(r,e,t){let n=q(r,"x","slice2d");return Y(n.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${n.rank} tensor`),Ot(n,e,t)}var Kqe=ee({slice2d_:zVe});function $Ve(r,e,t){let n=q(r,"x","slice3d");return Y(n.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${n.rank} tensor`),Ot(n,e,t)}var jqe=ee({slice3d_:$Ve});function WVe(r,e,t){let n=q(r,"x","slice4d");return Y(n.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${n.rank} tensor`),Ot(n,e,t)}var Xqe=ee({slice4d_:WVe});function VVe(r,e=-1){let t=q(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let n={logits:t},a={dim:e};return ue.runKernel(IB,n,a)}var UVe=ee({softmax_:VVe});function GVe(r){Y(r.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ue.runKernel(nPe,e)}var I4=ee({fft_:GVe});function HVe(r){Y(r.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ue.runKernel(uPe,e)}var Sx=ee({ifft_:HVe});function qVe(r){let e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){let a=he(r,[t,e]);n=Sx(a)}else{let a=[t,2*(e-1)],i=he(Sm(r),[t,e]),o=he($x(r),[t,e]),s=os(Ot(i,[0,1],[t,e-2]),1),u=ve(os(Ot(o,[0,1],[t,e-2]),1),yt(-1)),l=Ln([i,s],1),c=Ln([o,u],1),f=he(lc(l,c),[a[0],a[1]]);n=Sx(f)}if(n=Sm(n),r.rank===3&&r.shape[0]!==0){let a=n,i=r.shape[0];n=he(n,[i,n.shape[0]/i,n.shape[1]]),a.dispose()}return n}var KVe=ee({irfft_:qVe});function jVe(r,e){Y(r.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${r.dtype}`);let t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){let d=r.shape.map(m=>0),v=r.shape.map(m=>m);v[r.shape.length-1]=e,a=Ot(r,d,v),t=e}else if(e!=null&&e>t){let d=r.shape.map(v=>v);d[r.shape.length-1]=e-t,a=Ln([r,cc(d)],r.shape.length-1),t=e}else a=r;let i=Ct(a),o=he(lc(a,i),[n,t]),s=I4(o),u=Math.floor(t/2)+1,l=Sm(s),c=$x(s),f=sc(l,[u,t-u],l.shape.length-1),h=sc(c,[u,t-u],c.shape.length-1),p=a.shape.slice();return p[a.shape.length-1]=u,he(lc(f[0],h[0]),p)}var N4=ee({rfft_:jVe});function XVe(r,e){let t=q(r,"a","squaredDifference"),n=q(e,"b","squaredDifference");[t,n]=Rr(t,n),Jt(t.shape,n.shape);let a={a:t,b:n},i={};return ue.runKernel(NB,a,i)}var C4=ee({squaredDifference_:XVe});function YVe(r,e){let t=q(r,"x","squeeze","string_or_numeric");return he(t,XPe(t.shape,e).newShape)}var A4=ee({squeeze_:YVe});function ZVe(r,e=0){let t=wm(r,"tensors","stack","string_or_numeric");Y(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&Y(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let n=t,a={axis:e};return ue.runKernel(eB,n,a)}var vc=ee({stack_:ZVe});function QVe(r,e,t,n,a=0,i=0,o=0,s=0,u=0){let c={x:q(r,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ue.runKernel(zPe,c,f)}var JVe=ee({stridedSlice_:QVe});function eUe(r){let t={x:q(r,"x","tan","float32")};return ue.runKernel(AB,t)}var tUe=ee({tan_:eUe});function rc(r,e){Cx(r);let t=Kh(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Xh(r,null,t,e)}function gm(r,e,t){if(Cx(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let n=Kh(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Xh(r,e,n,t)}function rUe(r,e=1,t=!0){let n=q(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${e}`);let i={x:n},o={k:e,sorted:t},[s,u]=ue.runKernel(UPe,i,o);return{values:s,indices:u}}var nUe=ee({topk_:rUe});function aUe(r,e=0,t=1,n,a){if(n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");let i=new $h(e,t,n,!0,a),o=Jh(r,n);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Yqe=ee({truncatedNormal_:aUe});function iUe(r,e=0){let t=q(r,"x","unique","string_or_numeric");Y(t.rank>0,()=>"The input tensor must be at least 1D");let n={x:t},a={axis:e},[i,o]=ue.runKernel(HPe,n,a);return{values:i,indices:o}}var oUe=ee({unique_:iUe});function sUe(r,e,t,n,a=!0){let i=q(r,"v","movingAverage"),o=q(e,"x","movingAverage"),s=q(t,"decay","movingAverage");kLe(i,o),Y(gc(i.shape,o.shape),()=>"Shape mismatch in v and x");let u=yt(1),l=ut(u,s),c=ve(ut(o,i),l);if(a){Y(n!=null,()=>"When using zeroDebias: true, step is required.");let f=q(n,"step","movingAverage");c=dt(c,ut(u,Nu(s,f)))}return et(i,c)}var Zqe=ee({movingAverage_:sUe});function uUe(r,e,t){let n=q(r,"indices","scatterND","int32"),a=q(e,"updates","scatterND");Rze(a,n,t);let i={indices:n,updates:a},o={shape:t};return ue.runKernel(DPe,i,o)}var Qqe=ee({scatterND_:uUe});function lUe(r,e,t,n){if(r.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${r.dtype}.`);if(r.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${r.shape}.`);let a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${i}.`);let o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${a}]`);if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function cUe(r,e,t,n=0){let a=q(r,"sparseIndices","sparseToDense","int32"),i=q(e,"sparseValues","sparseToDense","string_or_numeric"),o=q(n,"defaultValue","sparseToDense",i.dtype);lUe(a,i,t,o);let s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return ue.runKernel(LPe,s,u)}var Jqe=ee({sparseToDense_:cUe});function fUe(r,e){let t=q(e,"indices","gatherND","int32"),a={params:q(r,"x","gatherND","string_or_numeric"),indices:t};return ue.runKernel(oPe,a)}var e6e=ee({gatherND_:fUe});function hUe(r,e){if(e==null)return r.shape.slice();if(gc(r.shape,e))return e;if(r.shape.length===e.length){let t=[];for(let n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function pUe(r,e,t,n){let a=q(r,"x","dropout");if(Y(a.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${a.dtype} tensor instead.`),Y(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return r instanceof pn?a.clone():a;let i=hUe(a,t),o=1-e,s=dt(Vx(et(xVe(i,0,1,"float32",n),o)),o);return ve(a,s)}var t6e=ee({dropout_:pUe});function dUe(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function _4(r,e,t){let n=1-r%2,a=new Float32Array(r);for(let i=0;i<r;++i){let o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return rc(a,"float32")}function Yx(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return ve(r,jh(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function Zx(r,e){let t=e,n=on(r.shape,e.shape);return n.length>0&&(t=ct(t,n)),he(t,r.shape)}function Qx(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Fm(r);if(e==="elu")return h4(r);if(e==="relu6")return E4(r);if(e==="prelu")return S4(r,t);if(e==="leakyrelu")return v4(r,n);if(e==="sigmoid")return Tu(r);throw new Error(`Unknown fused activation ${e}.`)}var Jx=(r,e)=>!(r>0)||e==="linear";function vUe({x:r,filter:e,strides:t,pad:n,dataFormat:a="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:s,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",Jx(ue.state.gradientDepth,u)===!1){Y(a==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${a} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let S=Zh(r,e,t,n,a,i,o);return s!=null&&(S=et(S,s)),Qx(S,u,l,c)}let f=q(r,"x","conv2d","float32"),h=q(e,"filter","conv2d","float32"),p=f,d=!1;f.rank===3&&(d=!0,p=he(f,[1,f.shape[0],f.shape[1],f.shape[2]])),Y(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),Y(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),Bn("fused conv2d",n,o);let v=a==="NHWC"?p.shape[3]:p.shape[1];Y(h.shape[2]===v,()=>`Error in conv2d: depth of input (${v}) must match input depth for filter ${h.shape[2]}.`),Y(ko(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let m=Ox(p.shape,h.shape,t,i,n,o),g;s!=null&&(g=q(s,"bias","fused conv2d"),[g]=Rr(g,f),a==="NHWC"?Jt(m.outShape,g.shape):(Y(g.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`),Y(g.shape.length===0||g.shape[0]===m.outChannels||g.shape[0]===1,()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${m.outChannels})`)));let y;if(l!=null){let S=l.shape;if(Y(S.length<=1||S.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${S.length}.`),S.length===1)Y(S[0]===1||S[0]===m.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the number of output channels (${m.outChannels}).`);else if(S.length===3)try{Jt(S,m.outShape)}catch{let N=`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the output shape of the conv2d (${m.outShape}).`;throw Error(N)}y=q(l,"prelu weights","fused conv2d")}let b=(S,E)=>{Y(a==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${a} but only NHWC is currently supported.`);let[N,C,R,_]=E,O=Yx(S,R,u);Y(Iu(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);let P=Bx(C.shape,O,N,t,n),B=Lx(C,O,N.shape,t,n),W=[P,B];if(_!=null){let L=Zx(_,O);W.push(L)}return W},w={x:p,filter:h,bias:g,preluActivationWeights:y},k={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return s==null?wo((E,N,C)=>{let R=ue.runKernel(TP,w,k);return C([N,E,R]),d&&(R=he(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:b}})(p,h):wo((E,N,C,R)=>{let _=ue.runKernel(TP,w,k);return R([N,E,_,C]),d&&(_=he(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:b}})(p,h,g)}var r6e=ee({fusedConv2d_:vUe});function mUe({x:r,filter:e,strides:t,pad:n,dataFormat:a="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:s,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(Jx(ue.state.gradientDepth,u)===!1){let k=qx(r,e,t,n,a,i,o);return s!=null&&(k=et(k,s)),Qx(k,u,l,c)}let f=q(r,"x","depthwiseConv2d","float32"),h=q(e,"filter","depthwiseConv2d","float32"),p=f,d=!1;f.rank===3&&(d=!0,p=he(f,[1,f.shape[0],f.shape[1],f.shape[2]])),Y(p.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`),Y(h.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`),Y(p.shape[3]===h.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),i==null&&(i=[1,1]),Y(ko(t,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),Bn("fused depthwiseConv2d",n,o);let v=Ox(p.shape,h.shape,t,i,n,o,!0),m;s!=null&&(m=q(s,"bias","fused conv2d"),[m]=Rr(m,f),Jt(v.outShape,m.shape));let g;l!=null&&(g=q(l,"prelu weights","fused depthwiseConv2d"));let y=(k,S)=>{Y(Iu(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);let[E,N,C,R]=S,_=Yx(k,C,u),O=t4(N.shape,_,E,t,n,i,o),P=e4(N,_,E.shape,t,n,i,o);if(R!=null){let B=Zx(m,_);return[O,P,B]}return[O,P]},b={x:p,filter:h,bias:m,preluActivationWeights:g},w={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return s==null?wo((S,E,N)=>{let C=ue.runKernel(IP,b,w);return N([E,S,C]),d&&(C=he(C,[C.shape[1],C.shape[2],C.shape[3]])),{value:C,gradFunc:y}})(p,h):wo((S,E,N,C)=>{let R=ue.runKernel(IP,b,w);return C([E,S,R,N]),d&&(R=he(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:y}})(p,h,m)}var n6e=ee({fusedDepthwiseConv2d_:mUe});function gUe({a:r,b:e,transposeA:t=!1,transposeB:n=!1,bias:a,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:s=.2}){if(Jx(ue.state.gradientDepth,i)===!1){let _=Nt(r,e,t,n);return a!=null&&(_=et(_,a)),Qx(_,i,o,s)}let u=q(r,"a","fused matMul"),l=q(e,"b","fused matMul");[u,l]=Rr(u,l);let c=t?u.shape[u.rank-2]:u.shape[u.rank-1],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],h=t?u.shape[u.rank-1]:u.shape[u.rank-2],p=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=u.shape.slice(0,-2),v=l.shape.slice(0,-2),m=ua(d),g=ua(v);Y(c===f,()=>`Error in fused matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${t} and transposeB=${n} must match.`);let b=Jt(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([h,p]),w=t?he(u,[m,c,h]):he(u,[m,h,c]),k=n?he(l,[g,p,f]):he(l,[g,f,p]),S;a!=null&&(S=q(a,"bias","fused matMul"),[S]=Rr(S,u),Jt(b,S.shape));let E;o!=null&&(E=q(o,"prelu weights","fused matMul"));let N=(_,O)=>{let[P,B,W,L]=O,G=Yx(he(_,W.shape),W,i),M,$;if(!t&&!n?(M=Nt(G,B,!1,!0),$=Nt(P,G,!0,!1)):!t&&n?(M=Nt(G,B,!1,!1),$=Nt(G,P,!0,!1)):t&&!n?(M=Nt(B,G,!1,!0),$=Nt(P,G,!1,!1)):(M=Nt(B,G,!0,!0),$=Nt(G,P,!0,!0)),a!=null){let K=Zx(L,G);return[M,$,K]}else return[M,$]},C={a:w,b:k,bias:S,preluActivationWeights:E},R={transposeA:t,transposeB:n,activation:i,leakyreluAlpha:s};return a==null?wo((O,P,B)=>{let W=ue.runKernel(EP,C,R);return B([O,P,W]),{value:he(W,b),gradFunc:N}})(w,k):wo((O,P,B,W)=>{let L=ue.runKernel(EP,C,R);return W([O,P,L,B]),{value:he(L,b),gradFunc:N}})(w,k,S)}var a6e=ee({fusedMatMul_:gUe});function yUe(r){return _4(r,.54,.46)}var i6e=ee({hammingWindow_:yUe});function bUe(r){return _4(r,.5,.5)}var wUe=ee({hannWindow_:bUe});function xUe(r,e,t,n=!1,a=0){let i=0,o=[];for(;i+e<=r.size;)o.push(Ot(r,i,e)),i+=t;if(n)for(;i<r.size;){let s=i+e-r.size,u=Ln([Ot(r,i,e-s),_m([s],a)]);o.push(u),i+=t}return o.length===0?gm([],[0,e]):he(Ln(o),[o.length,e])}var kUe=ee({frame_:xUe});function SUe(r,e,t,n,a=wUe){n==null&&(n=dUe(e));let i=kUe(r,e,t),o=ve(i,a(e));return N4(o,n)}var o6e=ee({stft_:SUe});function EUe(r,e,t,n,a="bilinear",i=0){let o=q(r,"image","cropAndResize"),s=q(e,"boxes","cropAndResize","float32"),u=q(t,"boxInd","cropAndResize","int32"),l=s.shape[0];Y(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),Y(s.rank===2&&s.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${s.shape}.`),Y(u.rank===1&&u.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${s.shape}.`),Y(n.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${n.length}.`),Y(n[0]>=1&&n[1]>=1,()=>`cropSize must be atleast [1,1], but was ${n}`),Y(a==="bilinear"||a==="nearest",()=>`method must be bilinear or nearest, but was ${a}`);let c={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n};return ue.runKernel(qOe,c,f)}var s6e=ee({cropAndResize_:EUe});function TUe(r){let e=q(r,"image","flipLeftRight","float32");Y(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);let t={image:e};return ue.runKernel(iPe,t,{})}var u6e=ee({flipLeftRight_:TUe});function IUe(r){let e=q(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];Y(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),Y(n===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${n}.`);let a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,nc(e,a)}var l6e=ee({grayscaleToRGB_:IUe});function NUe(r,e,t=0,n=.5){let a=q(r,"image","rotateWithOffset","float32");Y(a.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`);let i={image:a},o={radians:e,fillValue:t,center:n};return ue.runKernel(qPe,i,o)}var c6e=ee({rotateWithOffset_:NUe});function ek(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);let o=r.shape[0];return t=Math.min(t,o),Y(0<=n&&n<=1,()=>`iouThreshold must be in [0, 1], but was '${n}'`),Y(r.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${r.rank}'`),Y(r.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${r.shape[1]}`),Y(e.rank===1,()=>"scores must be a 1D tensor"),Y(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),Y(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function CUe(r,e,t,n=.5,a=Number.NEGATIVE_INFINITY){let i=q(r,"boxes","nonMaxSuppression","float32"),o=q(e,"scores","nonMaxSuppression","float32"),s=ek(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;let u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return ue.runKernel(kPe,{boxes:i,scores:o},u)}var f6e=ee({nonMaxSuppression_:CUe});function AUe(r,e,t,n=.5,a=Number.NEGATIVE_INFINITY,i=0){let o=q(r,"boxes","nonMaxSuppression"),s=q(e,"scores","nonMaxSuppression"),u=ek(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;let l={boxes:o,scores:s},c={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=ue.runKernel(EPe,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}var h6e=ee({nonMaxSuppressionWithScore_:AUe});function _Ue(r,e,t,n=.5,a=Number.NEGATIVE_INFINITY,i=!1){let o=q(r,"boxes","nonMaxSuppression"),s=q(e,"scores","nonMaxSuppression"),u=ek(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:i},d=ue.runKernel(SPe,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var p6e=ee({nonMaxSuppressionPadded_:_Ue});function DUe(r,e,t=!1,n=!1){let a=q(r,"images","resizeBilinear");Y(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),Y(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),Y(n===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=he(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=ue.runKernel(lB,s,u);return o?he(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var FUe=ee({resizeBilinear_:DUe});function RUe(r,e,t=!1,n=!1){let a=q(r,"images","resizeNearestNeighbor");Y(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),Y(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),Y(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),Y(n===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=he(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=ue.runKernel(uB,s,u);return o?he(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var MUe=ee({resizeNearestNeighbor_:RUe});function OUe(r,e="binary",t=!1,n=.5){let a=q(r,"image","threshold"),i=.2989,o=.587,s=.114,u=a.shape[0]*a.shape[1],l=ve(rc([n]),255),c,f,h,p;if(Y(a.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${a.rank}.`),Y(a.shape[2]===3||a.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${a.shape[2]}.`),Y(a.dtype==="int32"||a.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${a.dtype}.`),Y(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),a.shape[2]===3){[c,f,h]=sc(a,[1,1,1],-1);let m=ve(c,i),g=ve(f,o),y=ve(h,s);p=et(et(m,g),y)}else p=r;if(e==="otsu"){let m=y$e(Je(T4(p),"int32"),Q4e([]),256);l=PUe(m,u)}let d=t?yc(p,l):So(p,l);return Je(ve(d,255),"int32")}function PUe(r,e){let t=rc([-1]),n=rc([0]),a=rc([0]),i,o,s,u,l,c;for(let f=0;f<r.size-1;f++){i=Ot(r,0,f+1),o=Ot(r,f+1),l=dt(ct(i),e),c=dt(ct(o),e);let h=ct(ve(i,Tm(0,i.size)));s=dt(h,ct(i));let p=_m(o.shape,i.size),d=et(Tm(0,o.size),p),v=ve(o,d);u=dt(ct(v),ct(o));let m=ut(s,u),g=ut(s,u),y=ve(l,c);a=ve(ve(y,m),g);let b=So(a,n);n=Na(b,a,n),t=Na(b,rc([f]),t)}return t}var d6e=ee({threshold_:OUe});function LUe(r,e,t="nearest",n="constant",a=0,i){let o=q(r,"image","transform","float32"),s=q(e,"transforms","transform","float32");Y(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),Y(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),Y(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);let u={image:o,transforms:s},l={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return ue.runKernel(GPe,u,l)}var v6e=ee({transform_:LUe});function BUe(r,e,t){Y(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),Y(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`);let n=q(r,"a","bandPart");Y(n.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${n.rank}.`);let a=n.shape,[i,o]=n.shape.slice(-2);if(!(e<=i))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`);if(!(t<=o))throw new Error(`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`);e<0&&(e=i),t<0&&(t=o);let s=he(Tm(0,i,1,"int32"),[-1,1]),u=Tm(0,o,1,"int32"),l=ut(s,u),c=oc(yc(l,yt(+e,"int32")),Yh(l,yt(-t,"int32"))),f=cc([i,o],n.dtype);return he(vc(Nm(he(n,[-1,i,o])).map(h=>Na(c,h,f))),a)}var m6e=ee({bandPart_:BUe});function zUe(r){let e;if(Array.isArray(r)){e=!1,Y(r!=null&&r.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let a=r[0].shape[0];for(let i=1;i<r.length;++i)Y(r[i].shape[0]===a,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${r[i].shape[0]} vs. ${a})`)}else e=!0,r=sc(r,r.shape[0],0).map(a=>A4(a,[0]));Y(r.length<=r[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${r.length}) exceeds number of dimensions (${r[0].shape[0]}).`);let t=[],n=r;for(let a=0;a<r.length;++a)t.push(ue.tidy(()=>{let i=n[a];if(a>0)for(let o=0;o<a;++o){let s=ve(ct(ve(t[o],i)),t[o]);i=ut(i,s)}return dt(i,Dm(i,"euclidean"))}));return e?vc(t,0):t}var g6e=ee({gramSchmidt_:zUe});function $Ue(r,e=!1){if(Y(r.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${r.rank}`),r.rank===2)return GP(r,e);{let t=r.shape.slice(0,r.shape.length-2).reduce((u,l)=>u*l),n=Nm(he(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(u=>{let[l,c]=GP(u,e);a.push(l),i.push(c)});let o=he(vc(a,0),r.shape),s=he(vc(i,0),r.shape);return[o,s]}}function GP(r,e=!1){return ue.tidy(()=>{Y(r.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${r.shape.length}D Tensor.`);let t=r.shape[0],n=r.shape[1],a=sWe(t),i=Ph(r),o=gm([[1]],[1,1]),s=Ph(o),u=t>=n?n:t;for(let l=0;l<u;++l){let c=i,f=s,h=a;[s,i,a]=ue.tidy(()=>{let p=Ot(i,[l,l],[t-l,1]),d=Dm(p),v=Ot(i,[l,l],[1,1]),m=Na(So(v,0),gm([[-1]]),gm([[1]])),g=ut(v,ve(m,d)),y=dt(p,g);y.shape[0]===1?s=Ph(o):s=Ln([o,Ot(y,[1,0],[y.shape[0]-1,y.shape[1]])],0);let b=Yr(dt(Nt(m,g),d)),w=Ot(i,[l,0],[t-l,n]),k=ve(b,s),S=Hi(s);if(l===0)i=ut(w,Nt(k,Nt(S,w)));else{let C=ut(w,Nt(k,Nt(S,w)));i=Ln([Ot(i,[0,0],[l,n]),C],0)}let E=Hi(k),N=Ot(a,[0,l],[t,a.shape[1]-l]);if(l===0)a=ut(N,Nt(Nt(N,s),E));else{let C=ut(N,Nt(Nt(N,s),E));a=Ln([Ot(a,[0,0],[t,l]),C],1)}return[s,i,a]}),la([c,f,h])}return!e&&t>n&&(a=Ot(a,[0,0],[t,n]),i=Ot(i,[0,0],[n,n])),[a,i]})}var y6e=ee({qr_:$Ue});var Pn;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Pn||(Pn={}));function WUe(r,e,t=Pn.SUM_BY_NONZERO_WEIGHTS){let n=q(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=q(e,"weights","computeWeightedLoss"));let i=a==null?n:ve(n,a);if(t===Pn.NONE)return i;if(t===Pn.SUM)return ct(i);if(t===Pn.MEAN){if(a==null)return Em(i);{let o=n.size/a.size,s=dt(ct(i),ct(a));return o>1?dt(s,yt(o)):s}}if(t===Pn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return dt(ct(i),yt(n.size));{let o=ve(a,Qh(n.shape)),s=Je(ct(k4(o,yt(0))),"float32");return dt(ct(i),s)}}throw Error(`Unknown reduction: ${t}`)}var ss=ee({computeWeightedLoss_:WUe});function VUe(r,e,t,n=Pn.SUM_BY_NONZERO_WEIGHTS){let a=q(r,"labels","absoluteDifference"),i=q(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=q(t,"weights","absoluteDifference")),qi(a.shape,i.shape,"Error in absoluteDifference: ");let s=Ia(ut(a,i));return ss(s,o,n)}var b6e=ee({absoluteDifference_:VUe});function UUe(r,e,t,n,a=Pn.SUM_BY_NONZERO_WEIGHTS){let i=q(r,"labels","cosineDistance"),o=q(e,"predictions","cosineDistance"),s=null;n!=null&&(s=q(n,"weights","cosineDistance")),qi(i.shape,o.shape,"Error in cosineDistance: ");let u=yt(1),l=ut(u,ct(ve(i,o),t,!0));return ss(l,s,a)}var w6e=ee({cosineDistance_:UUe});function GUe(r,e,t,n=Pn.SUM_BY_NONZERO_WEIGHTS){let a=q(r,"labels","hingeLoss"),i=q(e,"predictions","hingeLoss"),o=null;t!=null&&(o=q(t,"weights","hingeLoss")),qi(a.shape,i.shape,"Error in hingeLoss: ");let s=yt(1);a=ut(ve(yt(2),a),s);let u=Fm(ut(s,ve(a,i)));return ss(u,o,n)}var x6e=ee({hingeLoss_:GUe});function HUe(r,e,t,n=1,a=Pn.SUM_BY_NONZERO_WEIGHTS){let i=q(r,"labels","huberLoss"),o=q(e,"predictions","huberLoss"),s=null;t!=null&&(s=q(t,"weights","huberLoss")),qi(i.shape,o.shape,"Error in huberLoss: ");let u=yt(n),l=Ia(ut(o,i)),c=x4(l,u),f=ut(l,c),h=et(ve(yt(.5),Qt(c)),ve(u,f));return ss(h,s,a)}var k6e=ee({huberLoss_:HUe});function qUe(r,e,t,n=1e-7,a=Pn.SUM_BY_NONZERO_WEIGHTS){let i=q(r,"labels","logLoss"),o=q(e,"predictions","logLoss"),s=null;t!=null&&(s=q(t,"weights","logLoss")),qi(i.shape,o.shape,"Error in logLoss: ");let u=yt(1),l=yt(n),c=Yr(ve(i,fc(et(o,l)))),f=ve(ut(u,i),fc(et(ut(u,o),l))),h=ut(c,f);return ss(h,s,a)}var S6e=ee({logLoss_:qUe});function KUe(r,e,t,n=Pn.SUM_BY_NONZERO_WEIGHTS){let a=q(r,"labels","meanSquaredError"),i=q(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=q(t,"weights","meanSquaredError")),qi(a.shape,i.shape,"Error in meanSquaredError: ");let s=C4(a,i);return ss(s,o,n)}var E6e=ee({meanSquaredError_:KUe});function jUe(r,e){let t=q(r,"labels","sigmoidCrossEntropyWithLogits"),n=q(e,"logits","sigmoidCrossEntropyWithLogits");qi(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");let a=Fm(n),i=ve(n,t),o=m4(Ni(Yr(Ia(n))));return et(ut(a,i),o)}function XUe(r,e,t,n=0,a=Pn.SUM_BY_NONZERO_WEIGHTS){let i=q(r,"multiClassLabels","sigmoidCrossEntropy"),o=q(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=q(t,"weights","sigmoidCrossEntropy")),qi(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){let l=yt(n),c=yt(1),f=yt(.5);i=et(ve(i,ut(c,l)),ve(f,l))}let u=jUe(i,o);return ss(u,s,a)}var T6e=ee({sigmoidCrossEntropy_:XUe});function YUe(r,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return wo((a,i,o)=>{let u=y4(i,[t],!0),l=ut(Je(i,"float32"),u);o([a,l]);let c=Yr(ve(l,a));return{value:ct(c,[t]),gradFunc:(p,d)=>{let[v,m]=d,g=uc(p.shape,[t]);return[ve(he(p,g),ut(Je(v,"float32"),Ni(m))),ve(he(p,g),ut(Ni(m),Je(v,"float32")))]}}})(r,e)}function ZUe(r,e,t,n=0,a=Pn.SUM_BY_NONZERO_WEIGHTS){let i=q(r,"onehotLabels","softmaxCrossEntropy"),o=q(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=q(t,"weights","softmaxCrossEntropy")),qi(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){let l=yt(n),c=yt(1),f=yt(i.shape[1]);i=et(ve(i,ut(c,l)),dt(l,f))}let u=YUe(i,o);return ss(u,s,a)}var I6e=ee({softmaxCrossEntropy_:ZUe});function QUe(r,e,t,n){let a=q(r,"indices","sparseFillEmptyRows","int32"),i=q(e,"values","sparseFillEmptyRows"),o=q(t,"denseShape","sparseFillEmptyRows","int32"),s=q(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${a.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(s.rank!==0)throw new Error(`Default value should be a scalar but received shape ${s.shape}`);let u={indices:a,values:i,denseShape:o,defaultValue:s},l=ue.runKernel(RPe,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}var N6e=ee({sparseFillEmptyRows_:QUe});function JUe(r,e,t){let n=q(r,"inputIndices","sparseReshape","int32"),a=q(e,"inputShape","sparseReshape","int32"),i=q(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${n.shape}`);if(a.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);let o={inputIndices:n,inputShape:a,newShape:i},s=ue.runKernel(MPe,o);return{outputIndices:s[0],outputShape:s[1]}}var C6e=ee({sparseReshape_:JUe});function eGe(r,e,t){let n=q(r,"data","sparseSegmentMean"),a=q(e,"indices","sparseSegmentMean","int32"),i=q(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${a.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);let o={data:n,indices:a,segmentIds:i};return ue.runKernel(OPe,o)}var A6e=ee({sparseSegmentMean_:eGe});function tGe(r,e,t){let n=q(r,"data","sparseSegmentSum"),a=q(e,"indices","sparseSegmentSum","int32"),i=q(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${a.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);let o={data:n,indices:a,segmentIds:i};return ue.runKernel(PPe,o)}var _6e=ee({sparseSegmentSum_:tGe});function rGe(r,e,t,n,a,i,o,s){let u=q(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);let l=q(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");let c={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:l},h=ue.runKernel($Pe,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}var D6e=ee({stringNGrams_:rGe});function nGe(r,e,t=!0){let n=q(r,"input","stringSplit","string"),a=q(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${n.shape}`);if(a.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);let i={skipEmpty:t},o={input:n,delimiter:a},s=ue.runKernel(WPe,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var F6e=ee({stringSplit_:nGe});function aGe(r,e){let t=q(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");let a={input:t};return ue.runKernel(VPe,a,n)}var R6e=ee({stringToHashBucketFast_:aGe});var xo=class extends mx{minimize(e,t=!1,n){let{value:a,grads:i}=this.computeGradients(e,n);if(n!=null){let o=n.map(s=>({name:s.name,tensor:i[s.name]}));this.applyGradients(o)}else this.applyGradients(i);return la(i),t?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return bWe(e,t)}dispose(){this.iterations_!=null&&la(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:yt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(xo,Symbol.hasInstance,{value:r=>r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null});var Wh=class extends xo{constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=ue.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=ue.registeredVariables[n],o=!1;this.accumulatedGrads[a]==null&&(this.accumulatedGrads[a]={originalName:`${n}/accum_grad`,variable:Xr(()=>Ct(i).variable(o))}),this.accumulatedUpdates[a]==null&&(this.accumulatedUpdates[a]={originalName:`${n}/accum_var`,variable:Xr(()=>Ct(i).variable(o))});let s=Array.isArray(e)?e[a].tensor:e[n];if(s==null)return;let u=this.accumulatedGrads[a].variable,l=this.accumulatedUpdates[a].variable;Xr(()=>{let c=et(ve(u,this.rho),ve(Qt(s),1-this.rho)),f=ve(dt(ca(et(l,this.epsilon)),ca(et(u,this.epsilon))),s),h=et(ve(l,this.rho),ve(Qt(f),1-this.rho));u.assign(c),l.assign(h);let p=et(ve(f,-this.learningRate),i);i.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(la(this.accumulatedGrads.map(e=>e.variable)),la(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=e.length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,t*2).map(a=>({originalName:a.name,variable:a.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}};Wh.className="Adadelta";Cu(Wh);var Vh=class extends xo{constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=ue.registeredVariables[n];this.accumulatedGrads[a]==null&&(this.accumulatedGrads[a]={originalName:`${n}/accumulator`,variable:Xr(()=>_m(i.shape,this.initialAccumulatorValue).variable(!1))});let o=Array.isArray(e)?e[a].tensor:e[n];if(o==null)return;let s=this.accumulatedGrads[a].variable;Xr(()=>{let u=et(s,Qt(o));s.assign(u);let l=et(ve(dt(o,ca(et(u,ue.backend.epsilon()))),-this.learningRate),i);i.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&la(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulatedGrads=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}};Vh.className="Adagrad";Cu(Vh);var Uh=class extends xo{constructor(e,t,n,a=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=a,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Xr(()=>{this.accBeta1=yt(t).variable(),this.accBeta2=yt(n).variable()}),a==null&&(this.epsilon=ue.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);Xr(()=>{let n=ut(1,this.accBeta1),a=ut(1,this.accBeta2);t.forEach((i,o)=>{let s=ue.registeredVariables[i],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Xr(()=>Ct(s).variable(u))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:Xr(()=>Ct(s).variable(u))});let l=Array.isArray(e)?e[o].tensor:e[i];if(l==null)return;let c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,h=et(ve(c,this.beta1),ve(l,1-this.beta1)),p=et(ve(f,this.beta2),ve(Qt(l),1-this.beta2)),d=dt(h,n),v=dt(p,a);c.assign(h),f.assign(p);let m=et(ve(dt(d,et(ca(v),this.epsilon)),-this.learningRate),s);s.assign(m)}),this.accBeta1.assign(ve(this.accBeta1,this.beta1)),this.accBeta2.assign(ve(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&la(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&la(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),Xr(()=>{this.accBeta1.assign(Nu(this.beta1,this.iterations_+1)),this.accBeta2.assign(Nu(this.beta2,this.iterations_+1))});let t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(a=>({originalName:a.name,variable:a.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}};Uh.className="Adam";Cu(Uh);var Gh=class extends xo{constructor(e,t,n,a=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=a,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Xr(()=>{this.iteration=yt(0).variable(),this.accBeta1=yt(t).variable()}),a==null&&(this.epsilon=ue.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);Xr(()=>{let n=ut(1,this.accBeta1),a=dt(-this.learningRate,et(ve(this.iteration,this.decay),1));t.forEach((i,o)=>{let s=ue.registeredVariables[i],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Ct(s).variable(u)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:Ct(s).variable(u)});let l=Array.isArray(e)?e[o].tensor:e[i];if(l==null)return;let c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,h=et(ve(c,this.beta1),ve(l,1-this.beta1)),p=ve(f,this.beta2),d=Ia(l),v=jx(p,d);c.assign(h),f.assign(v);let m=et(ve(dt(a,n),dt(h,et(v,this.epsilon))),s);s.assign(m)}),this.iteration.assign(et(this.iteration,1)),this.accBeta1.assign(ve(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&la(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&la(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}};Gh.className="Adamax";Cu(Gh);var mc=class extends xo{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=Array.isArray(e)?e[a].tensor:e[n];if(i==null)return;let o=ue.registeredVariables[n];Xr(()=>{let s=et(ve(this.c,i),o);o.assign(s)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=UBe(yt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}};mc.className="SGD";Cu(mc);var Hh=class extends mc{constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=yt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=ue.registeredVariables[n];this.accumulations[a]==null&&(this.accumulations[a]={originalName:`${n}/momentum`,variable:Xr(()=>Ct(i).variable(!1))});let o=this.accumulations[a].variable,s=Array.isArray(e)?e[a].tensor:e[n];s!=null&&Xr(()=>{let u,l=et(ve(this.m,o),s);this.useNesterov?u=et(ve(this.c,et(s,ve(l,this.m))),i):u=et(ve(this.c,l),i),o.assign(l),i.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&la(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulations=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}};Hh.className="Momentum";Cu(Hh);var qh=class extends xo{constructor(e,t=.9,n=0,a=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=a,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,a==null&&(this.epsilon=ue.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=ue.registeredVariables[n],o=!1;this.accumulatedMeanSquares[a]==null&&(this.accumulatedMeanSquares[a]={originalName:`${n}/rms`,variable:Xr(()=>Ct(i).variable(o))}),this.accumulatedMoments[a]==null&&(this.accumulatedMoments[a]={originalName:`${n}/momentum`,variable:Xr(()=>Ct(i).variable(o))}),this.accumulatedMeanGrads[a]==null&&this.centered&&(this.accumulatedMeanGrads[a]={originalName:`${n}/mg`,variable:Xr(()=>Ct(i).variable(o))});let s=Array.isArray(e)?e[a].tensor:e[n];if(s==null)return;let u=this.accumulatedMeanSquares[a].variable,l=this.accumulatedMoments[a].variable;Xr(()=>{let c=et(ve(u,this.decay),ve(Qt(s),1-this.decay));if(this.centered){let f=this.accumulatedMeanGrads[a].variable,h=et(ve(f,this.decay),ve(s,1-this.decay)),p=dt(ve(s,this.learningRate),ca(ut(c,et(Qt(h),this.epsilon)))),d=et(ve(l,this.momentum),p);u.assign(c),f.assign(h),l.assign(d);let v=ut(i,d);i.assign(v)}else{let f=et(ve(u,this.decay),ve(Qt(s),1-this.decay)),h=et(ve(l,this.momentum),dt(ve(s,this.learningRate),ca(et(f,this.epsilon))));u.assign(f),l.assign(h);let p=ut(i,h);i.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&la(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&la(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&la(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,t*2).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}};qh.className="RMSProp";Cu(qh);var yo=class{static sgd(e){return new mc(e)}static momentum(e,t,n=!1){return new Hh(e,t,n)}static rmsprop(e,t=.9,n=0,a=null,i=!1){return new qh(e,t,n,a,i)}static adam(e=.001,t=.9,n=.999,a=null){return new Uh(e,t,n,a)}static adadelta(e=.001,t=.95,n=null){return new Wh(e,t,n)}static adamax(e=.002,t=.9,n=.999,a=null,i=0){return new Gh(e,t,n,a,i)}static adagrad(e,t=.1){return new Vh(e,t)}};var M6e={sgd:yo.sgd,momentum:yo.momentum,adadelta:yo.adadelta,adagrad:yo.adagrad,rmsprop:yo.rmsprop,adamax:yo.adamax,adam:yo.adam};var HP;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(HP||(HP={}));var iGe=1.7580993408473768,oGe=1.0507009873554805;function sGe(r,e,t){let n=r.shape.slice();n[t]=1;let a=he(e,n),i=bx(r,t,!0,!1),o=bx(r,t,!0,!0),s=ve(i,o);return ve(a,s)}function uGe(r,e,t){let n=r.shape.length,a=n-t.length,i=QB(t,n),o=r;i!=null&&(o=Hi(r,i));let s=o.shape.slice(),l=s.splice(n-t.length,t.length).reduce((h,p)=>h*p,1);s.push(l);let c=o.reshape(s),f=sGe(c,e,a);if(f=f.reshape(o.shape),i!=null){let h=zx(i);f=Hi(f,h)}return f}var lGe={kernelName:aB,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=[];return a==null?i=n.shape.map((o,s)=>s):typeof a=="number"?i=[a]:i=a,{x:()=>uGe(n,r,i)}}};var cGe={kernelName:SL,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Jt(t.shape,n.shape);return{a:()=>{let s=dt(r,Je(n,"float32")),u=on(t.shape,a);return u.length>0?he(ct(s,u),t.shape):s},b:()=>{let s=ve(r,Je(t,"float32")),u=on(n.shape,a);u.length>0&&(s=he(ct(s,u),n.shape));let l=Qt(n);return Yr(dt(s,Je(l,"float32")))}}}};var fGe={kernelName:iB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>dt(r,Yr(Qt(t)))}}};var hGe={kernelName:cB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=ve(yc(t,6),jh(t));return{x:()=>ve(r,Je(n,"float32"))}}};var pGe={kernelName:oB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(r,Je(jh(t),"float32"))}}};var dGe={kernelName:sB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>he(r,t.shape)}}};var vGe={kernelName:lB,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ue.runKernel(_Pe,a,t)}}};var mGe={kernelName:uB,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ue.runKernel(APe,a,t)}}};var gGe={kernelName:fB,gradFunc:(r,e,t)=>{let{dims:n}=t,a=Ci(n,r.shape);return{x:()=>os(r,a)}}};var yGe={kernelName:hB,gradFunc:r=>({x:()=>Ct(r)})};var bGe={kernelName:pB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Yr(dt(r,ve(Nu(t,1.5),2)))}}};var wGe={kernelName:dB,inputsToSave:["condition"],gradFunc:(r,e)=>{let[t]=e;return{condition:()=>Je(Ct(t),"float32"),t:()=>ve(r,Je(t,r.dtype)),e:()=>ve(r,Je(Kx(t),r.dtype))}}};var xGe={kernelName:vB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=So(t,yt(0)),a=yt(iGe),i=yt(oGe),o=ve(r,i),s=ve(ve(r,a),Ni(Je(t,"float32")));return Na(n,o,s)}}}};var kGe={kernelName:wB,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(r,ve(t,ut(yt(1),t)))}}};var SGe={kernelName:bB,gradFunc:r=>({x:()=>Ct(r)})};var EGe={kernelName:gB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(Hx(Je(t,"float32")),r)}}};var TGe={kernelName:yB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(f4(Je(t,"float32")),r)}}};var IGe={kernelName:mB,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{begin:a,size:i}=t,o=n.shape,[s,u]=Mze(n,a,i),l=[];for(let c=0;c<r.rank;c++)l.push([s[c],o[c]-s[c]-u[c]]);return{x:()=>bc(r,l)}}};var NGe={kernelName:IB,outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{dim:a}=t,i=!0,o=ve(r,n);return{logits:()=>ut(o,ve(ct(o,[a],i),n))}}};var CGe={kernelName:xB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(r,Tu(t))}}};var qP={kernelName:EB,gradFunc:(r,e,t)=>{let{blockShape:n,paddings:a}=t;return{x:()=>Gx(r,n,a)}}};var KP={kernelName:TB,gradFunc:(r,e,t)=>{let{axis:n}=t;return{x:()=>Ln(r,n)}}};var AGe={kernelName:kB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>dt(r,ve(ca(Je(t,"float32")),2))}}};var _Ge={kernelName:BPe,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(r,ve(Je(t,"float32"),2))}}};var DGe={kernelName:NB,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=yt(2);return{a:()=>ve(r,ve(a,ut(t,n))),b:()=>ve(r,ve(a,ut(n,t)))}}};var FGe={kernelName:MB,gradFunc:r=>({x:()=>Ct(r)})};var RGe={kernelName:CB,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Jt(t.shape,n.shape);return{a:()=>{let s=r,u=on(t.shape,a);return u.length>0&&(s=ct(s,u)),he(s,t.shape)},b:()=>{let s=r,u=on(n.shape,a);return u.length>0&&(s=ct(s,u)),he(Yr(s),n.shape)}}}};var MGe={kernelName:SB,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,a=n.shape.slice(),{axis:i}=t;Ci(i,n.shape).forEach(l=>{a[l]=1});let s=he(r,a),u=ve(s,Qh(n.shape,"float32"));return{x:()=>u}}};var OGe={kernelName:AB,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>dt(r,Qt(Hx(t)))}}};var PGe={kernelName:_B,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ve(ut(yt(1),Qt(t)),r)}}};var LGe={kernelName:Nx,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{reps:a}=t;return{x:()=>{let o=Ct(n);if(n.rank===1)for(let s=0;s<a[0];++s)o=et(o,Ot(r,[s*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)o=et(o,Ot(r,[s*n.shape[0],u*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let l=0;l<a[2];++l)o=et(o,Ot(r,[s*n.shape[0],u*n.shape[1],l*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let l=0;l<a[2];++l)for(let c=0;c<a[3];++c)o=et(o,Ot(r,[s*n.shape[0],u*n.shape[1],l*n.shape[2],c*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return o}}}};var BGe={kernelName:hm,gradFunc:(r,e,t)=>{let n=t,{perm:a}=n,i=zx(a);return{x:()=>Hi(r,i)}}};var zGe={kernelName:DB,gradFunc:(r,e,t)=>{let n=t,{axis:a}=n;return{value:()=>vc(r,a)}}};var $Ge={kernelName:FB,inputsToSave:["segmentIds"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>WGe(r,t)}}};function WGe(r,e){let t=jx(e,Ct(e)),n=d4(r,t),a=Yh(e,yt(0,"int32")),i=n.rank-a.rank;for(let s=0;s<i;++s)a=is(a,s+1);a=oc(a,Qh(n.shape,"bool"));let o=Ct(n);return Na(a,n,o)}var VGe={kernelName:RB,gradFunc:r=>({x:()=>Ct(r)})};var UGe=[KB,LLe,BLe,WLe,VLe,GLe,HLe,qLe,jLe,XLe,YLe,ZLe,aBe,sBe,lBe,fBe,hBe,pBe,dBe,xBe,kBe,EBe,ABe,NBe,RBe,OBe,LBe,jBe,ZBe,QBe,cGe,JBe,t4e,r4e,n4e,a4e,o4e,i4e,l4e,f4e,h4e,p4e,d4e,v4e,m4e,y4e,b4e,w4e,x4e,E4e,BP,BP,N4e,_4e,R4e,M4e,O4e,P4e,B4e,$4e,W4e,V4e,U4e,G4e,q4e,zP,zP,X4e,Y4e,lGe,fGe,hGe,pGe,dGe,vGe,mGe,gGe,yGe,bGe,wGe,xGe,kGe,SGe,EGe,TGe,IGe,NGe,CGe,qP,qP,KP,KP,AGe,DGe,_Ge,FGe,RGe,MGe,OGe,PGe,LGe,BGe,zGe,$Ge,VGe];for(let r of UGe)sLe(r);xe().prototype.abs=function(){return this.throwIfDisposed(),Ia(this)};xe().prototype.acos=function(){return this.throwIfDisposed(),Lze(this)};xe().prototype.acosh=function(){return this.throwIfDisposed(),zze(this)};xe().prototype.add=function(r){return this.throwIfDisposed(),et(this,r)};xe().prototype.all=function(r,e){return this.throwIfDisposed(),Vze(this,r,e)};xe().prototype.any=function(r,e){return this.throwIfDisposed(),Gze(this,r,e)};xe().prototype.argMax=function(r){return this.throwIfDisposed(),qze(this,r)};xe().prototype.argMin=function(r){return this.throwIfDisposed(),jze(this,r)};xe().prototype.asScalar=function(){return this.throwIfDisposed(),Y(this.size===1,()=>"The array must have only 1 element."),he(this,[])};xe().prototype.asType=function(r){return this.throwIfDisposed(),Je(this,r)};xe().prototype.as1D=function(){return this.throwIfDisposed(),he(this,[this.size])};xe().prototype.as2D=function(r,e){return this.throwIfDisposed(),he(this,[r,e])};xe().prototype.as3D=function(r,e,t){return this.throwIfDisposed(),he(this,[r,e,t])};xe().prototype.as4D=function(r,e,t,n){return this.throwIfDisposed(),he(this,[r,e,t,n])};xe().prototype.as5D=function(r,e,t,n,a){return this.throwIfDisposed(),he(this,[r,e,t,n,a])};xe().prototype.asin=function(){return this.throwIfDisposed(),Yze(this)};xe().prototype.asinh=function(){return this.throwIfDisposed(),Qze(this)};xe().prototype.atan=function(){return this.throwIfDisposed(),e$e(this)};xe().prototype.atan2=function(r){return this.throwIfDisposed(),r$e(this,r)};xe().prototype.atanh=function(){return this.throwIfDisposed(),a$e(this)};xe().prototype.avgPool=function(r,e,t,n){return this.throwIfDisposed(),c4(this,r,e,t,n)};xe().prototype.batchToSpaceND=function(r,e){return this.throwIfDisposed(),Gx(this,r,e)};xe().prototype.batchNorm=function(r,e,t,n,a){return this.throwIfDisposed(),Am(this,r,e,t,n,a)};xe().prototype.broadcastTo=function(r){return this.throwIfDisposed(),vm(this,r)};xe().prototype.cast=function(r){return this.throwIfDisposed(),Je(this,r)};xe().prototype.ceil=function(){return this.throwIfDisposed(),x$e(this)};xe().prototype.clipByValue=function(r,e){return this.throwIfDisposed(),S$e(this,r,e)};xe().prototype.concat=function(r,e){return this.throwIfDisposed(),r instanceof pn&&(r=[r]),Ln([this,...r],e)};xe().prototype.conv1d=function(r,e,t,n,a,i){return this.throwIfDisposed(),A$e(this,r,e,t,n,a,i)};xe().prototype.conv2dTranspose=function(r,e,t,n,a){return this.throwIfDisposed(),D$e(this,r,e,t,n,a)};xe().prototype.conv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),Zh(this,r,e,t,n,a,i)};xe().prototype.cos=function(){return this.throwIfDisposed(),Hx(this)};xe().prototype.cosh=function(){return this.throwIfDisposed(),f4(this)};xe().prototype.cumprod=function(r,e,t){return this.throwIfDisposed(),bx(this,r,e,t)};xe().prototype.cumsum=function(r,e,t){return this.throwIfDisposed(),JB(this,r,e,t)};xe().prototype.depthToSpace=function(r,e){return this.throwIfDisposed(),z$e(this,r,e)};xe().prototype.depthwiseConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),qx(this,r,e,t,n,a,i)};xe().prototype.dilation2d=function(r,e,t,n,a){return this.throwIfDisposed(),U$e(this,r,e,t,n,a)};xe().prototype.divNoNan=function(r){return this.throwIfDisposed(),H$e(this,r)};xe().prototype.div=function(r){return this.throwIfDisposed(),dt(this,r)};xe().prototype.dot=function(r){return this.throwIfDisposed(),K$e(this,r)};xe().prototype.elu=function(){return this.throwIfDisposed(),h4(this)};xe().prototype.equal=function(r){return this.throwIfDisposed(),Wx(this,r)};xe().prototype.erf=function(){return this.throwIfDisposed(),Z$e(this)};xe().prototype.euclideanNorm=function(r,e){return this.throwIfDisposed(),rWe(this,r,e)};xe().prototype.exp=function(){return this.throwIfDisposed(),Ni(this)};xe().prototype.expandDims=function(r){return this.throwIfDisposed(),is(this,r)};xe().prototype.expm1=function(){return this.throwIfDisposed(),iWe(this)};xe().prototype.fft=function(){return this.throwIfDisposed(),I4(this)};xe().prototype.flatten=function(){return this.throwIfDisposed(),he(this,[this.size])};xe().prototype.floor=function(){return this.throwIfDisposed(),Vx(this)};xe().prototype.floorDiv=function(r){return this.throwIfDisposed(),jB(this,r)};xe().prototype.gather=function(r,e){return this.throwIfDisposed(),d4(this,r,e)};xe().prototype.greaterEqual=function(r){return this.throwIfDisposed(),Yh(this,r)};xe().prototype.greater=function(r){return this.throwIfDisposed(),So(this,r)};xe().prototype.ifft=function(){return this.throwIfDisposed(),Sx(this)};xe().prototype.irfft=function(){return this.throwIfDisposed(),KVe(this)};xe().prototype.isFinite=function(){return this.throwIfDisposed(),cWe(this)};xe().prototype.isInf=function(){return this.throwIfDisposed(),hWe(this)};xe().prototype.isNaN=function(){return this.throwIfDisposed(),dWe(this)};xe().prototype.leakyRelu=function(r){return this.throwIfDisposed(),v4(this,r)};xe().prototype.lessEqual=function(r){return this.throwIfDisposed(),yc(this,r)};xe().prototype.less=function(r){return this.throwIfDisposed(),i4(this,r)};xe().prototype.localResponseNormalization=function(r,e,t,n){return this.throwIfDisposed(),gWe(this,r,e,t,n)};xe().prototype.logSigmoid=function(){return this.throwIfDisposed(),kWe(this)};xe().prototype.logSoftmax=function(r){return this.throwIfDisposed(),EWe(this,r)};xe().prototype.logSumExp=function(r,e){return this.throwIfDisposed(),y4(this,r,e)};xe().prototype.log=function(){return this.throwIfDisposed(),fc(this)};xe().prototype.log1p=function(){return this.throwIfDisposed(),m4(this)};xe().prototype.logicalAnd=function(r){return this.throwIfDisposed(),oc(this,r)};xe().prototype.logicalNot=function(){return this.throwIfDisposed(),Kx(this)};xe().prototype.logicalOr=function(r){return this.throwIfDisposed(),b4(this,r)};xe().prototype.logicalXor=function(r){return this.throwIfDisposed(),AWe(this,r)};xe().prototype.matMul=function(r,e,t){return this.throwIfDisposed(),Nt(this,r,e,t)};xe().prototype.maxPool=function(r,e,t,n){return this.throwIfDisposed(),w4(this,r,e,t,n)};xe().prototype.max=function(r,e){return this.throwIfDisposed(),ac(this,r,e)};xe().prototype.maximum=function(r){return this.throwIfDisposed(),jx(this,r)};xe().prototype.mean=function(r,e){return this.throwIfDisposed(),Em(this,r,e)};xe().prototype.min=function(r,e){return this.throwIfDisposed(),wx(this,r,e)};xe().prototype.minimum=function(r){return this.throwIfDisposed(),x4(this,r)};xe().prototype.mirrorPad=function(r,e){return this.throwIfDisposed(),BWe(this,r,e)};xe().prototype.mod=function(r){return this.throwIfDisposed(),$We(this,r)};xe().prototype.mul=function(r){return this.throwIfDisposed(),ve(this,r)};xe().prototype.neg=function(){return this.throwIfDisposed(),Yr(this)};xe().prototype.norm=function(r,e,t){return this.throwIfDisposed(),Dm(this,r,e,t)};xe().prototype.notEqual=function(r){return this.throwIfDisposed(),k4(this,r)};xe().prototype.oneHot=function(r,e=1,t=0){return this.throwIfDisposed(),vx(this,r,e,t)};xe().prototype.onesLike=function(){return this.throwIfDisposed(),qWe(this)};xe().prototype.pad=function(r,e){return this.throwIfDisposed(),bc(this,r,e)};xe().prototype.pool=function(r,e,t,n,a,i){return this.throwIfDisposed(),rVe(this,r,e,t,n,a,i)};xe().prototype.pow=function(r){return this.throwIfDisposed(),Nu(this,r)};xe().prototype.prelu=function(r){return this.throwIfDisposed(),S4(this,r)};xe().prototype.prod=function(r,e){return this.throwIfDisposed(),iVe(this,r,e)};xe().prototype.reciprocal=function(){return this.throwIfDisposed(),SVe(this)};xe().prototype.relu=function(){return this.throwIfDisposed(),Fm(this)};xe().prototype.relu6=function(){return this.throwIfDisposed(),E4(this)};xe().prototype.reshapeAs=function(r){return this.throwIfDisposed(),he(this,r.shape)};xe().prototype.reshape=function(r){return this.throwIfDisposed(),he(this,r)};xe().prototype.resizeBilinear=function(r,e,t){return this.throwIfDisposed(),FUe(this,r,e,t)};xe().prototype.resizeNearestNeighbor=function(r,e,t){return this.throwIfDisposed(),MUe(this,r,e,t)};xe().prototype.reverse=function(r){return this.throwIfDisposed(),os(this,r)};xe().prototype.rfft=function(){return this.throwIfDisposed(),N4(this)};xe().prototype.round=function(){return this.throwIfDisposed(),T4(this)};xe().prototype.rsqrt=function(){return this.throwIfDisposed(),r4(this)};xe().prototype.selu=function(){return this.throwIfDisposed(),RVe(this)};xe().prototype.separableConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),OVe(this,r,e,t,n,a,i)};xe().prototype.sigmoid=function(){return this.throwIfDisposed(),Tu(this)};xe().prototype.sign=function(){return this.throwIfDisposed(),LVe(this)};xe().prototype.sin=function(){return this.throwIfDisposed(),YB(this)};xe().prototype.sinh=function(){return this.throwIfDisposed(),ZB(this)};xe().prototype.slice=function(r,e){return this.throwIfDisposed(),Ot(this,r,e)};xe().prototype.softmax=function(r){return this.throwIfDisposed(),UVe(this,r)};xe().prototype.softplus=function(){return this.throwIfDisposed(),g4(this)};xe().prototype.spaceToBatchND=function(r,e){return this.throwIfDisposed(),Px(this,r,e)};xe().prototype.split=function(r,e){return this.throwIfDisposed(),sc(this,r,e)};xe().prototype.sqrt=function(){return this.throwIfDisposed(),ca(this)};xe().prototype.square=function(){return this.throwIfDisposed(),Qt(this)};xe().prototype.squaredDifference=function(r){return this.throwIfDisposed(),C4(this,r)};xe().prototype.squeeze=function(r){return this.throwIfDisposed(),A4(this,r)};xe().prototype.stack=function(r,e){this.throwIfDisposed();let t=r instanceof pn?[this,r]:[this,...r];return vc(t,e)};xe().prototype.step=function(r){return this.throwIfDisposed(),jh(this,r)};xe().prototype.stridedSlice=function(r,e,t,n,a,i,o,s){return this.throwIfDisposed(),JVe(this,r,e,t,n,a,i,o,s)};xe().prototype.sub=function(r){return this.throwIfDisposed(),ut(this,r)};xe().prototype.sum=function(r,e){return this.throwIfDisposed(),ct(this,r,e)};xe().prototype.tan=function(){return this.throwIfDisposed(),tUe(this)};xe().prototype.tanh=function(){return this.throwIfDisposed(),yx(this)};xe().prototype.tile=function(r){return this.throwIfDisposed(),nc(this,r)};xe().prototype.toBool=function(){return this.throwIfDisposed(),Je(this,"bool")};xe().prototype.toFloat=function(){return this.throwIfDisposed(),Je(this,"float32")};xe().prototype.toInt=function(){return this.throwIfDisposed(),Je(this,"int32")};xe().prototype.topk=function(r,e){return this.throwIfDisposed(),nUe(this,r,e)};xe().prototype.transpose=function(r){return this.throwIfDisposed(),Hi(this,r)};xe().prototype.unique=function(r){return this.throwIfDisposed(),oUe(this,r)};xe().prototype.unsortedSegmentSum=function(r,e){return this.throwIfDisposed(),n4(this,r,e)};xe().prototype.unstack=function(r){return this.throwIfDisposed(),Nm(this,r)};xe().prototype.where=function(r,e){return this.throwIfDisposed(),Na(r,this,e)};xe().prototype.zerosLike=function(){return this.throwIfDisposed(),Ct(this)};var GGe="3.21.0";var HGe={"tfjs-core":Jw.version_core,"tfjs-backend-cpu":FOe.version_cpu,"tfjs-backend-webgl":ROe.version_webgl,"tfjs-data":XP.version_data,"tfjs-layers":ex.version_layers,"tfjs-converter":tx.version_converter,tfjs:GGe};Object.keys(Jw).forEach(function(r){r!=="default"&&Object.defineProperty(Fu,r,{enumerable:!0,get:function(){return Jw[r]}})});Object.keys(ex).forEach(function(r){r!=="default"&&Object.defineProperty(Fu,r,{enumerable:!0,get:function(){return ex[r]}})});Object.keys(tx).forEach(function(r){r!=="default"&&Object.defineProperty(Fu,r,{enumerable:!0,get:function(){return tx[r]}})});Fu.data=XP;Fu.version=HGe});var P4=gr(Ki=>{"use strict";var qGe=Ki&&Ki.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,a)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),KGe=Ki&&Ki.__setModuleDefault||(Object.create?(function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}):function(r,e){r.default=e}),jGe=Ki&&Ki.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&qGe(e,r,t);return KGe(e,r),e};Object.defineProperty(Ki,"__esModule",{value:!0});Ki.BasicPitch=void 0;var Ru=jGe(D4()),tk={contours:"Identity",onsets:"Identity_2",frames:"Identity_1"},F4=1,ep=22050,nk=256,XGe=Math.floor(ep/nk),YGe=2,M4=ep*YGe-nk,O4=30,R4=Math.floor(O4/2),Rm=O4*nk,ZGe=M4-Rm,rk=class{constructor(e){if(Rm%2!==0)throw new Error(`OVERLAP_LENGTH_FRAMES is not divisible by 2! Is ${Rm}`);this.model=typeof e=="string"?Ru.loadGraphModel(e):e}adjustNoteStart(e,t){return e.map(n=>({startTimeSeconds:n.startTimeSeconds+t,durationSeconds:n.durationSeconds,pitch_midi:n.pitchMidi,amplitude:n.amplitude,pitchBends:n.pitchBends}))}async evaluateSingleFrame(e,t){let n=await this.model,a=Ru.slice(e,t,1),i=n.execute(a,[tk.frames,tk.onsets,tk.contours]);return[i[0],i[1],i[2]]}async prepareData(e){let t=Ru.concat1d([Ru.zeros([Math.floor(Rm/2)],"float32"),Ru.tensor(e)]);return[Ru.expandDims(Ru.signal.frame(t,M4,ZGe,!0,0),-1),e.length]}unwrapOutput(e){let t=e;t=e.slice([0,R4,0],[-1,e.shape[1]-2*R4,-1]);let n=t.shape;return t.reshape([n[0]*n[1],n[2]])}async evaluateModel(e,t,n){let a;if(e instanceof Float32Array)a=e;else{if(e.sampleRate!==ep)throw new Error(`Input audio buffer is not at correct sample rate! Is ${e.sampleRate}. Should be ${ep}`);if(e.numberOfChannels!==F4)throw new Error(`Input audio buffer is not mono! Number of channels is ${e.numberOfChannels}. Should be ${F4}`);a=e.getChannelData(0)}let[i,o]=await this.prepareData(a),s=Math.floor(o*(XGe/ep)),u=0;for(let l=0;l<i.shape[0];++l){n(l/i.shape[0]);let[c,f,h]=await this.evaluateSingleFrame(i,l),p=this.unwrapOutput(c),d=this.unwrapOutput(f),v=this.unwrapOutput(h),m=p.shape[0];if(!(u>=s)){if(m+u>=s){let g=s-u;p=p.slice([0,0],[g,-1]),d=d.slice([0,0],[g,-1]),v=v.slice([0,0],[g,-1])}u+=m,t(await p.array(),await d.array(),await v.array())}}n(1)}};Ki.BasicPitch=rk});var L4=gr((tp,ak)=>{(function(r,e){if(typeof tp=="object"&&typeof ak=="object")ak.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var t=e();for(var n in t)(typeof tp=="object"?tp:r)[n]=t[n]}})(typeof self<"u"?self:tp,(function(){return(()=>{var r={507:(n,a,i)=>{"use strict";function o(u){var l=[];return s(u,l),l}function s(u,l){for(var c=0;c<u.length;c++){var f=u[c];Array.isArray(f)?s(f,l):l.push(f)}}i.r(a),i.d(a,{flatten:()=>o})},289:(n,a,i)=>{a.parseMidi=i(666),a.writeMidi=i(865)},666:n=>{function a(o){for(var s,u=new i(o),l=[];!u.eof();){var c=f();l.push(c)}return l;function f(){var h={};h.deltaTime=u.readVarInt();var p=u.readUInt8();if((240&p)==240){if(p!==255){if(p==240)return h.type="sysEx",v=u.readVarInt(),h.data=u.readBytes(v),h;if(p==247)return h.type="endSysEx",v=u.readVarInt(),h.data=u.readBytes(v),h;throw"Unrecognised MIDI event type byte: "+p}h.meta=!0;var d=u.readUInt8(),v=u.readVarInt();switch(d){case 0:if(h.type="sequenceNumber",v!==2)throw"Expected length for sequenceNumber event is 2, got "+v;return h.number=u.readUInt16(),h;case 1:return h.type="text",h.text=u.readString(v),h;case 2:return h.type="copyrightNotice",h.text=u.readString(v),h;case 3:return h.type="trackName",h.text=u.readString(v),h;case 4:return h.type="instrumentName",h.text=u.readString(v),h;case 5:return h.type="lyrics",h.text=u.readString(v),h;case 6:return h.type="marker",h.text=u.readString(v),h;case 7:return h.type="cuePoint",h.text=u.readString(v),h;case 32:if(h.type="channelPrefix",v!=1)throw"Expected length for channelPrefix event is 1, got "+v;return h.channel=u.readUInt8(),h;case 33:if(h.type="portPrefix",v!=1)throw"Expected length for portPrefix event is 1, got "+v;return h.port=u.readUInt8(),h;case 47:if(h.type="endOfTrack",v!=0)throw"Expected length for endOfTrack event is 0, got "+v;return h;case 81:if(h.type="setTempo",v!=3)throw"Expected length for setTempo event is 3, got "+v;return h.microsecondsPerBeat=u.readUInt24(),h;case 84:if(h.type="smpteOffset",v!=5)throw"Expected length for smpteOffset event is 5, got "+v;var m=u.readUInt8();return h.frameRate={0:24,32:25,64:29,96:30}[96&m],h.hour=31&m,h.min=u.readUInt8(),h.sec=u.readUInt8(),h.frame=u.readUInt8(),h.subFrame=u.readUInt8(),h;case 88:if(h.type="timeSignature",v!=4)throw"Expected length for timeSignature event is 4, got "+v;return h.numerator=u.readUInt8(),h.denominator=1<<u.readUInt8(),h.metronome=u.readUInt8(),h.thirtyseconds=u.readUInt8(),h;case 89:if(h.type="keySignature",v!=2)throw"Expected length for keySignature event is 2, got "+v;return h.key=u.readInt8(),h.scale=u.readUInt8(),h;case 127:return h.type="sequencerSpecific",h.data=u.readBytes(v),h;default:return h.type="unknownMeta",h.data=u.readBytes(v),h.metatypeByte=d,h}}else{var g;if((128&p)==0){if(s===null)throw"Running status byte encountered before status byte";g=p,p=s,h.running=!0}else g=u.readUInt8(),s=p;var y=p>>4;switch(h.channel=15&p,y){case 8:return h.type="noteOff",h.noteNumber=g,h.velocity=u.readUInt8(),h;case 9:var b=u.readUInt8();return h.type=b===0?"noteOff":"noteOn",h.noteNumber=g,h.velocity=b,b===0&&(h.byte9=!0),h;case 10:return h.type="noteAftertouch",h.noteNumber=g,h.amount=u.readUInt8(),h;case 11:return h.type="controller",h.controllerType=g,h.value=u.readUInt8(),h;case 12:return h.type="programChange",h.programNumber=g,h;case 13:return h.type="channelAftertouch",h.amount=g,h;case 14:return h.type="pitchBend",h.value=g+(u.readUInt8()<<7)-8192,h;default:throw"Unrecognised MIDI event type: "+y}}}}function i(o){this.buffer=o,this.bufferLen=this.buffer.length,this.pos=0}i.prototype.eof=function(){return this.pos>=this.bufferLen},i.prototype.readUInt8=function(){var o=this.buffer[this.pos];return this.pos+=1,o},i.prototype.readInt8=function(){var o=this.readUInt8();return 128&o?o-256:o},i.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},i.prototype.readInt16=function(){var o=this.readUInt16();return 32768&o?o-65536:o},i.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},i.prototype.readInt24=function(){var o=this.readUInt24();return 8388608&o?o-16777216:o},i.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},i.prototype.readBytes=function(o){var s=this.buffer.slice(this.pos,this.pos+o);return this.pos+=o,s},i.prototype.readString=function(o){var s=this.readBytes(o);return String.fromCharCode.apply(null,s)},i.prototype.readVarInt=function(){for(var o=0;!this.eof();){var s=this.readUInt8();if(!(128&s))return o+s;o+=127&s,o<<=7}return o},i.prototype.readChunk=function(){var o=this.readString(4),s=this.readUInt32();return{id:o,length:s,data:this.readBytes(s)}},n.exports=function(o){var s=new i(o),u=s.readChunk();if(u.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+u.id+"'";for(var l=(function(d){var v=new i(d),m={format:v.readUInt16(),numTracks:v.readUInt16()},g=v.readUInt16();return 32768&g?(m.framesPerSecond=256-(g>>8),m.ticksPerFrame=255&g):m.ticksPerBeat=g,m})(u.data),c=[],f=0;!s.eof()&&f<l.numTracks;f++){var h=s.readChunk();if(h.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+h.id+"'";var p=a(h.data);c.push(p)}return{header:l,tracks:c}}},865:n=>{function a(s,u,l){var c,f=new o,h=u.length,p=null;for(c=0;c<h;c++)l.running!==!1&&(l.running||u[c].running)||(p=null),p=i(f,u[c],p,l.useByte9ForNoteOff);s.writeChunk("MTrk",f.buffer)}function i(s,u,l,c){var f=u.type,h=u.deltaTime,p=u.text||"",d=u.data||[],v=null;switch(s.writeVarInt(h),f){case"sequenceNumber":s.writeUInt8(255),s.writeUInt8(0),s.writeVarInt(2),s.writeUInt16(u.number);break;case"text":s.writeUInt8(255),s.writeUInt8(1),s.writeVarInt(p.length),s.writeString(p);break;case"copyrightNotice":s.writeUInt8(255),s.writeUInt8(2),s.writeVarInt(p.length),s.writeString(p);break;case"trackName":s.writeUInt8(255),s.writeUInt8(3),s.writeVarInt(p.length),s.writeString(p);break;case"instrumentName":s.writeUInt8(255),s.writeUInt8(4),s.writeVarInt(p.length),s.writeString(p);break;case"lyrics":s.writeUInt8(255),s.writeUInt8(5),s.writeVarInt(p.length),s.writeString(p);break;case"marker":s.writeUInt8(255),s.writeUInt8(6),s.writeVarInt(p.length),s.writeString(p);break;case"cuePoint":s.writeUInt8(255),s.writeUInt8(7),s.writeVarInt(p.length),s.writeString(p);break;case"channelPrefix":s.writeUInt8(255),s.writeUInt8(32),s.writeVarInt(1),s.writeUInt8(u.channel);break;case"portPrefix":s.writeUInt8(255),s.writeUInt8(33),s.writeVarInt(1),s.writeUInt8(u.port);break;case"endOfTrack":s.writeUInt8(255),s.writeUInt8(47),s.writeVarInt(0);break;case"setTempo":s.writeUInt8(255),s.writeUInt8(81),s.writeVarInt(3),s.writeUInt24(u.microsecondsPerBeat);break;case"smpteOffset":s.writeUInt8(255),s.writeUInt8(84),s.writeVarInt(5);var m=31&u.hour|{24:0,25:32,29:64,30:96}[u.frameRate];s.writeUInt8(m),s.writeUInt8(u.min),s.writeUInt8(u.sec),s.writeUInt8(u.frame),s.writeUInt8(u.subFrame);break;case"timeSignature":s.writeUInt8(255),s.writeUInt8(88),s.writeVarInt(4),s.writeUInt8(u.numerator);var g=255&Math.floor(Math.log(u.denominator)/Math.LN2);s.writeUInt8(g),s.writeUInt8(u.metronome),s.writeUInt8(u.thirtyseconds||8);break;case"keySignature":s.writeUInt8(255),s.writeUInt8(89),s.writeVarInt(2),s.writeInt8(u.key),s.writeUInt8(u.scale);break;case"sequencerSpecific":s.writeUInt8(255),s.writeUInt8(127),s.writeVarInt(d.length),s.writeBytes(d);break;case"unknownMeta":u.metatypeByte!=null&&(s.writeUInt8(255),s.writeUInt8(u.metatypeByte),s.writeVarInt(d.length),s.writeBytes(d));break;case"sysEx":s.writeUInt8(240),s.writeVarInt(d.length),s.writeBytes(d);break;case"endSysEx":s.writeUInt8(247),s.writeVarInt(d.length),s.writeBytes(d);break;case"noteOff":(v=(c!==!1&&u.byte9||c&&u.velocity==0?144:128)|u.channel)!==l&&s.writeUInt8(v),s.writeUInt8(u.noteNumber),s.writeUInt8(u.velocity);break;case"noteOn":(v=144|u.channel)!==l&&s.writeUInt8(v),s.writeUInt8(u.noteNumber),s.writeUInt8(u.velocity);break;case"noteAftertouch":(v=160|u.channel)!==l&&s.writeUInt8(v),s.writeUInt8(u.noteNumber),s.writeUInt8(u.amount);break;case"controller":(v=176|u.channel)!==l&&s.writeUInt8(v),s.writeUInt8(u.controllerType),s.writeUInt8(u.value);break;case"programChange":(v=192|u.channel)!==l&&s.writeUInt8(v),s.writeUInt8(u.programNumber);break;case"channelAftertouch":(v=208|u.channel)!==l&&s.writeUInt8(v),s.writeUInt8(u.amount);break;case"pitchBend":(v=224|u.channel)!==l&&s.writeUInt8(v);var y=8192+u.value,b=127&y,w=y>>7&127;s.writeUInt8(b),s.writeUInt8(w);break;default:throw"Unrecognized event type: "+f}return v}function o(){this.buffer=[]}o.prototype.writeUInt8=function(s){this.buffer.push(255&s)},o.prototype.writeInt8=o.prototype.writeUInt8,o.prototype.writeUInt16=function(s){var u=s>>8&255,l=255&s;this.writeUInt8(u),this.writeUInt8(l)},o.prototype.writeInt16=o.prototype.writeUInt16,o.prototype.writeUInt24=function(s){var u=s>>16&255,l=s>>8&255,c=255&s;this.writeUInt8(u),this.writeUInt8(l),this.writeUInt8(c)},o.prototype.writeInt24=o.prototype.writeUInt24,o.prototype.writeUInt32=function(s){var u=s>>24&255,l=s>>16&255,c=s>>8&255,f=255&s;this.writeUInt8(u),this.writeUInt8(l),this.writeUInt8(c),this.writeUInt8(f)},o.prototype.writeInt32=o.prototype.writeUInt32,o.prototype.writeBytes=function(s){this.buffer=this.buffer.concat(Array.prototype.slice.call(s,0))},o.prototype.writeString=function(s){var u,l=s.length,c=[];for(u=0;u<l;u++)c.push(s.codePointAt(u));this.writeBytes(c)},o.prototype.writeVarInt=function(s){if(s<0)throw"Cannot write negative variable-length integer";if(s<=127)this.writeUInt8(s);else{var u=s,l=[];for(l.push(127&u),u>>=7;u;){var c=127&u|128;l.push(c),u>>=7}this.writeBytes(l.reverse())}},o.prototype.writeChunk=function(s,u){this.writeString(s),this.writeUInt32(u.length),this.writeBytes(u)},n.exports=function(s,u){if(typeof s!="object")throw"Invalid MIDI data";u=u||{};var l,c=s.header||{},f=s.tracks||[],h=f.length,p=new o;for((function(d,v,m){var g=v.format==null?1:v.format,y=128;v.timeDivision?y=v.timeDivision:v.ticksPerFrame&&v.framesPerSecond?y=-(255&v.framesPerSecond)<<8|255&v.ticksPerFrame:v.ticksPerBeat&&(y=32767&v.ticksPerBeat);var b=new o;b.writeUInt16(g),b.writeUInt16(m),b.writeUInt16(y),d.writeChunk("MThd",b.buffer)})(p,c,h),l=0;l<h;l++)a(p,f[l],u);return p.buffer}},805:(n,a)=>{"use strict";function i(o,s,u){u===void 0&&(u="ticks");var l=0,c=o.length,f=c;if(c>0&&o[c-1][u]<=s)return c-1;for(;l<f;){var h=Math.floor(l+(f-l)/2),p=o[h],d=o[h+1];if(p[u]===s){for(var v=h;v<o.length;v++)o[v][u]===s&&(h=v);return h}if(p[u]<s&&d[u]>s)return h;p[u]>s?f=h:p[u]<s&&(l=h+1)}return-1}Object.defineProperty(a,"__esModule",{value:!0}),a.insert=a.search=void 0,a.search=i,a.insert=function(o,s,u){if(u===void 0&&(u="ticks"),o.length){var l=i(o,s[u],u);o.splice(l+1,0,s)}else o.push(s)}},543:(n,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ControlChange=a.controlChangeIds=a.controlChangeNames=void 0,a.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},a.controlChangeIds=Object.keys(a.controlChangeNames).reduce((function(u,l){return u[a.controlChangeNames[l]]=l,u}),{});var i=new WeakMap,o=new WeakMap,s=(function(){function u(l,c){i.set(this,c),o.set(this,l.controllerType),this.ticks=l.absoluteTime,this.value=l.value}return Object.defineProperty(u.prototype,"number",{get:function(){return o.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"name",{get:function(){return a.controlChangeNames[this.number]?a.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"time",{get:function(){return i.get(this).ticksToSeconds(this.ticks)},set:function(l){var c=i.get(this);this.ticks=c.secondsToTicks(l)},enumerable:!1,configurable:!0}),u.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},u})();a.ControlChange=s},906:(n,a,i)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createControlChanges=void 0;var o=i(543);a.createControlChanges=function(){return new Proxy({},{get:function(s,u){return s[u]?s[u]:o.controlChangeIds.hasOwnProperty(u)?s[o.controlChangeIds[u]]:void 0},set:function(s,u,l){return o.controlChangeIds.hasOwnProperty(u)?s[o.controlChangeIds[u]]=l:s[u]=l,!0}})}},54:function(n,a,i){"use strict";var o=this&&this.__spreadArray||function(h,p,d){if(d||arguments.length===2)for(var v,m=0,g=p.length;m<g;m++)!v&&m in p||(v||(v=Array.prototype.slice.call(p,0,m)),v[m]=p[m]);return h.concat(v||Array.prototype.slice.call(p))};Object.defineProperty(a,"__esModule",{value:!0}),a.encode=void 0;var s=i(289),u=i(535),l=i(507);function c(h,p){return{absoluteTime:h.ticks,channel:p,controllerType:h.number,deltaTime:0,type:"controller",value:Math.floor(127*h.value)}}function f(h){return{absoluteTime:0,channel:h.channel,deltaTime:0,programNumber:h.instrument.number,type:"programChange"}}a.encode=function(h){var p={header:{format:1,numTracks:h.tracks.length+1,ticksPerBeat:h.header.ppq},tracks:o([o(o(o(o([{absoluteTime:0,deltaTime:0,meta:!0,text:h.header.name,type:"trackName"}],h.header.keySignatures.map((function(d){return(function(v){var m=u.keySignatureKeys.indexOf(v.key);return{absoluteTime:v.ticks,deltaTime:0,key:m+7,meta:!0,scale:v.scale==="major"?0:1,type:"keySignature"}})(d)})),!0),h.header.meta.map((function(d){return{absoluteTime:(v=d).ticks,deltaTime:0,meta:!0,text:v.text,type:v.type};var v})),!0),h.header.tempos.map((function(d){return(function(v){return{absoluteTime:v.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/v.bpm),type:"setTempo"}})(d)})),!0),h.header.timeSignatures.map((function(d){return(function(v){return{absoluteTime:v.ticks,deltaTime:0,denominator:v.timeSignature[1],meta:!0,metronome:24,numerator:v.timeSignature[0],thirtyseconds:8,type:"timeSignature"}})(d)})),!0)],h.tracks.map((function(d){return o(o(o([(v=d.name,{absoluteTime:0,deltaTime:0,meta:!0,text:v,type:"trackName"}),f(d)],(function(m){return(0,l.flatten)(m.notes.map((function(g){return(function(y,b){return[{absoluteTime:y.ticks,channel:b,deltaTime:0,noteNumber:y.midi,type:"noteOn",velocity:Math.floor(127*y.velocity)},{absoluteTime:y.ticks+y.durationTicks,channel:b,deltaTime:0,noteNumber:y.midi,type:"noteOff",velocity:Math.floor(127*y.noteOffVelocity)}]})(g,m.channel)})))})(d),!0),(function(m){for(var g=[],y=0;y<127;y++)m.controlChanges.hasOwnProperty(y)&&m.controlChanges[y].forEach((function(b){g.push(c(b,m.channel))}));return g})(d),!0),(function(m){var g=[];return m.pitchBends.forEach((function(y){g.push((function(b,w){return{absoluteTime:b.ticks,channel:w,deltaTime:0,type:"pitchBend",value:b.value}})(y,m.channel))})),g})(d),!0);var v})),!0)};return p.tracks=p.tracks.map((function(d){d=d.sort((function(m,g){return m.absoluteTime-g.absoluteTime}));var v=0;return d.forEach((function(m){m.deltaTime=m.absoluteTime-v,v=m.absoluteTime,delete m.absoluteTime})),d.push({deltaTime:0,meta:!0,type:"endOfTrack"}),d})),new Uint8Array((0,s.writeMidi)(p))}},535:(n,a,i)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Header=a.keySignatureKeys=void 0;var o=i(805),s=new WeakMap;a.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var u=(function(){function l(c){var f=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",s.set(this,480),c){s.set(this,c.header.ticksPerBeat),c.tracks.forEach((function(p){p.forEach((function(d){d.meta&&(d.type==="timeSignature"?f.timeSignatures.push({ticks:d.absoluteTime,timeSignature:[d.numerator,d.denominator]}):d.type==="setTempo"?f.tempos.push({bpm:6e7/d.microsecondsPerBeat,ticks:d.absoluteTime}):d.type==="keySignature"&&f.keySignatures.push({key:a.keySignatureKeys[d.key+7],scale:d.scale===0?"major":"minor",ticks:d.absoluteTime}))}))}));var h=0;c.tracks[0].forEach((function(p){h+=p.deltaTime,p.meta&&(p.type==="trackName"?f.name=p.text:p.type!=="text"&&p.type!=="cuePoint"&&p.type!=="marker"&&p.type!=="lyrics"||f.meta.push({text:p.text,ticks:h,type:p.type}))})),this.update()}}return l.prototype.update=function(){var c=this,f=0,h=0;this.tempos.sort((function(p,d){return p.ticks-d.ticks})),this.tempos.forEach((function(p,d){var v=d>0?c.tempos[d-1].bpm:c.tempos[0].bpm,m=p.ticks/c.ppq-h,g=60/v*m;p.time=g+f,f=p.time,h+=m})),this.timeSignatures.sort((function(p,d){return p.ticks-d.ticks})),this.timeSignatures.forEach((function(p,d){var v=d>0?c.timeSignatures[d-1]:c.timeSignatures[0],m=(p.ticks-v.ticks)/c.ppq/v.timeSignature[0]/(v.timeSignature[1]/4);v.measures=v.measures||0,p.measures=m+v.measures}))},l.prototype.ticksToSeconds=function(c){var f=(0,o.search)(this.tempos,c);if(f!==-1){var h=this.tempos[f],p=h.time,d=(c-h.ticks)/this.ppq;return p+60/h.bpm*d}return c/this.ppq*.5},l.prototype.ticksToMeasures=function(c){var f=(0,o.search)(this.timeSignatures,c);if(f!==-1){var h=this.timeSignatures[f],p=(c-h.ticks)/this.ppq;return h.measures+p/(h.timeSignature[0]/h.timeSignature[1])/4}return c/this.ppq/4},Object.defineProperty(l.prototype,"ppq",{get:function(){return s.get(this)},enumerable:!1,configurable:!0}),l.prototype.secondsToTicks=function(c){var f=(0,o.search)(this.tempos,c,"time");if(f!==-1){var h=this.tempos[f],p=(c-h.time)/(60/h.bpm);return Math.round(h.ticks+p*this.ppq)}var d=c/.5;return Math.round(d*this.ppq)},l.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map((function(c){return{bpm:c.bpm,ticks:c.ticks}})),timeSignatures:this.timeSignatures}},l.prototype.fromJSON=function(c){this.name=c.name,this.tempos=c.tempos.map((function(f){return Object.assign({},f)})),this.timeSignatures=c.timeSignatures.map((function(f){return Object.assign({},f)})),this.keySignatures=c.keySignatures.map((function(f){return Object.assign({},f)})),this.meta=c.meta.map((function(f){return Object.assign({},f)})),s.set(this,c.ppq),this.update()},l.prototype.setTempo=function(c){this.tempos=[{bpm:c,ticks:0}],this.update()},l})();a.Header=u},362:(n,a,i)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Instrument=void 0;var o=i(438),s=new WeakMap,u=(function(){function l(c,f){if(this.number=0,s.set(this,f),this.number=0,c){var h=c.find((function(p){return p.type==="programChange"}));h&&(this.number=h.programNumber)}}return Object.defineProperty(l.prototype,"name",{get:function(){return this.percussion?o.DrumKitByPatchID[this.number]:o.instrumentByPatchID[this.number]},set:function(c){var f=o.instrumentByPatchID.indexOf(c);f!==-1&&(this.number=f)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"family",{get:function(){return this.percussion?"drums":o.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"percussion",{get:function(){return s.get(this).channel===9},enumerable:!1,configurable:!0}),l.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},l.prototype.fromJSON=function(c){this.number=c.number},l})();a.Instrument=u},438:(n,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.DrumKitByPatchID=a.InstrumentFamilyByID=a.instrumentByPatchID=void 0,a.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],a.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],a.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},233:function(n,a,i){"use strict";var o=this&&this.__awaiter||function(v,m,g,y){return new(g||(g=Promise))((function(b,w){function k(N){try{E(y.next(N))}catch(C){w(C)}}function S(N){try{E(y.throw(N))}catch(C){w(C)}}function E(N){var C;N.done?b(N.value):(C=N.value,C instanceof g?C:new g((function(R){R(C)}))).then(k,S)}E((y=y.apply(v,m||[])).next())}))},s=this&&this.__generator||function(v,m){var g,y,b,w,k={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return w={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(w[Symbol.iterator]=function(){return this}),w;function S(E){return function(N){return(function(C){if(g)throw new TypeError("Generator is already executing.");for(;k;)try{if(g=1,y&&(b=2&C[0]?y.return:C[0]?y.throw||((b=y.return)&&b.call(y),0):y.next)&&!(b=b.call(y,C[1])).done)return b;switch(y=0,b&&(C=[2&C[0],b.value]),C[0]){case 0:case 1:b=C;break;case 4:return k.label++,{value:C[1],done:!1};case 5:k.label++,y=C[1],C=[0];continue;case 7:C=k.ops.pop(),k.trys.pop();continue;default:if(!((b=(b=k.trys).length>0&&b[b.length-1])||C[0]!==6&&C[0]!==2)){k=0;continue}if(C[0]===3&&(!b||C[1]>b[0]&&C[1]<b[3])){k.label=C[1];break}if(C[0]===6&&k.label<b[1]){k.label=b[1],b=C;break}if(b&&k.label<b[2]){k.label=b[2],k.ops.push(C);break}b[2]&&k.ops.pop(),k.trys.pop();continue}C=m.call(v,k)}catch(R){C=[6,R],y=0}finally{g=b=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}})([E,N])}}};Object.defineProperty(a,"__esModule",{value:!0}),a.Header=a.Track=a.Midi=void 0;var u=i(289),l=i(535),c=i(334),f=i(54),h=(function(){function v(m){var g=this,y=null;if(m){var b=m instanceof ArrayBuffer?new Uint8Array(m):m;(y=(0,u.parseMidi)(b)).tracks.forEach((function(w){var k=0;w.forEach((function(S){k+=S.deltaTime,S.absoluteTime=k}))})),y.tracks=(function(w){for(var k=[],S=0;S<w.length;S++)for(var E=k.length,N=new Map,C=Array(16).fill(0),R=0,_=w[S];R<_.length;R++){var O=_[R],P=E,B=O.channel;if(B!==void 0){O.type==="programChange"&&(C[B]=O.programNumber);var W=C[B],L="".concat(W," ").concat(B);N.has(L)?P=N.get(L):(P=E+N.size,N.set(L,P))}k[P]||k.push([]),k[P].push(O)}return k})(y.tracks)}this.header=new l.Header(y),this.tracks=[],m&&(this.tracks=y.tracks.map((function(w){return new c.Track(w,g.header)})),y.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return v.fromUrl=function(m){return o(this,void 0,void 0,(function(){var g;return s(this,(function(y){switch(y.label){case 0:return[4,fetch(m)];case 1:return(g=y.sent()).ok?[4,g.arrayBuffer()]:[3,3];case 2:return[2,new v(y.sent())];case 3:throw new Error("Could not load '".concat(m,"'"))}}))}))},Object.defineProperty(v.prototype,"name",{get:function(){return this.header.name},set:function(m){this.header.name=m},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"duration",{get:function(){var m=this.tracks.map((function(g){return g.duration}));return Math.max.apply(Math,m)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"durationTicks",{get:function(){var m=this.tracks.map((function(g){return g.durationTicks}));return Math.max.apply(Math,m)},enumerable:!1,configurable:!0}),v.prototype.addTrack=function(){var m=new c.Track(void 0,this.header);return this.tracks.push(m),m},v.prototype.toArray=function(){return(0,f.encode)(this)},v.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map((function(m){return m.toJSON()}))}},v.prototype.fromJSON=function(m){var g=this;this.header=new l.Header,this.header.fromJSON(m.header),this.tracks=m.tracks.map((function(y){var b=new c.Track(void 0,g.header);return b.fromJSON(y),b}))},v.prototype.clone=function(){var m=new v;return m.fromJSON(this.toJSON()),m},v})();a.Midi=h;var p=i(334);Object.defineProperty(a,"Track",{enumerable:!0,get:function(){return p.Track}});var d=i(535);Object.defineProperty(a,"Header",{enumerable:!0,get:function(){return d.Header}})},518:(n,a)=>{"use strict";function i(f){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][f%12]}Object.defineProperty(a,"__esModule",{value:!0}),a.Note=void 0;var o,s,u=(o=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,s={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(f){var h=o.exec(f),p=h[1],d=h[2];return s[p.toLowerCase()]+12*(parseInt(d,10)+1)}),l=new WeakMap,c=(function(){function f(h,p,d){l.set(this,d),this.midi=h.midi,this.velocity=h.velocity,this.noteOffVelocity=p.velocity,this.ticks=h.ticks,this.durationTicks=p.ticks-h.ticks}return Object.defineProperty(f.prototype,"name",{get:function(){return h=this.midi,p=Math.floor(h/12)-1,i(h)+p.toString();var h,p},set:function(h){this.midi=u(h)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(h){var p=h-this.octave;this.midi+=12*p},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"pitch",{get:function(){return i(this.midi)},set:function(h){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(h)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"duration",{get:function(){var h=l.get(this);return h.ticksToSeconds(this.ticks+this.durationTicks)-h.ticksToSeconds(this.ticks)},set:function(h){var p=l.get(this).secondsToTicks(this.time+h);this.durationTicks=p-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"time",{get:function(){return l.get(this).ticksToSeconds(this.ticks)},set:function(h){var p=l.get(this);this.ticks=p.secondsToTicks(h)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"bars",{get:function(){return l.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),f.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},f})();a.Note=c},882:(n,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.PitchBend=void 0;var i=new WeakMap,o=(function(){function s(u,l){i.set(this,l),this.ticks=u.absoluteTime,this.value=u.value}return Object.defineProperty(s.prototype,"time",{get:function(){return i.get(this).ticksToSeconds(this.ticks)},set:function(u){var l=i.get(this);this.ticks=l.secondsToTicks(u)},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},s})();a.PitchBend=o},334:(n,a,i)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Track=void 0;var o=i(805),s=i(543),u=i(906),l=i(882),c=i(362),f=i(518),h=new WeakMap,p=(function(){function d(v,m){var g=this;if(this.name="",this.notes=[],this.controlChanges=(0,u.createControlChanges)(),this.pitchBends=[],h.set(this,m),v){var y=v.find((function(N){return N.type==="trackName"}));this.name=y?y.text:""}if(this.instrument=new c.Instrument(v,this),this.channel=0,v){for(var b=v.filter((function(N){return N.type==="noteOn"})),w=v.filter((function(N){return N.type==="noteOff"})),k=function(){var N=b.shift();S.channel=N.channel;var C=w.findIndex((function(_){return _.noteNumber===N.noteNumber&&_.absoluteTime>=N.absoluteTime}));if(C!==-1){var R=w.splice(C,1)[0];S.addNote({durationTicks:R.absoluteTime-N.absoluteTime,midi:N.noteNumber,noteOffVelocity:R.velocity/127,ticks:N.absoluteTime,velocity:N.velocity/127})}},S=this;b.length;)k();v.filter((function(N){return N.type==="controller"})).forEach((function(N){g.addCC({number:N.controllerType,ticks:N.absoluteTime,value:N.value/127})})),v.filter((function(N){return N.type==="pitchBend"})).forEach((function(N){g.addPitchBend({ticks:N.absoluteTime,value:N.value/Math.pow(2,13)})}));var E=v.find((function(N){return N.type==="endOfTrack"}));this.endOfTrackTicks=E!==void 0?E.absoluteTime:void 0}}return d.prototype.addNote=function(v){var m=h.get(this),g=new f.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},m);return Object.assign(g,v),(0,o.insert)(this.notes,g,"ticks"),this},d.prototype.addCC=function(v){var m=h.get(this),g=new s.ControlChange({controllerType:v.number},m);return delete v.number,Object.assign(g,v),Array.isArray(this.controlChanges[g.number])||(this.controlChanges[g.number]=[]),(0,o.insert)(this.controlChanges[g.number],g,"ticks"),this},d.prototype.addPitchBend=function(v){var m=h.get(this),g=new l.PitchBend({},m);return Object.assign(g,v),(0,o.insert)(this.pitchBends,g,"ticks"),this},Object.defineProperty(d.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var v=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,m=0;m<this.notes.length-1;m++){var g=this.notes[m].time+this.notes[m].duration;v<g&&(v=g)}return v},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var v=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,m=0;m<this.notes.length-1;m++){var g=this.notes[m].ticks+this.notes[m].durationTicks;v<g&&(v=g)}return v},enumerable:!1,configurable:!0}),d.prototype.fromJSON=function(v){var m=this;for(var g in this.name=v.name,this.channel=v.channel,this.instrument=new c.Instrument(void 0,this),this.instrument.fromJSON(v.instrument),v.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=v.endOfTrackTicks),v.controlChanges)v.controlChanges[g]&&v.controlChanges[g].forEach((function(y){m.addCC({number:y.number,ticks:y.ticks,value:y.value})}));v.notes.forEach((function(y){m.addNote({durationTicks:y.durationTicks,midi:y.midi,ticks:y.ticks,velocity:y.velocity})}))},d.prototype.toJSON=function(){for(var v={},m=0;m<127;m++)this.controlChanges.hasOwnProperty(m)&&(v[m]=this.controlChanges[m].map((function(y){return y.toJSON()})));var g={channel:this.channel,controlChanges:v,pitchBends:this.pitchBends.map((function(y){return y.toJSON()})),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map((function(y){return y.toJSON()}))};return this.endOfTrackTicks!==void 0&&(g.endOfTrackTicks=this.endOfTrackTicks),g},d})();a.Track=p}},e={};function t(n){var a=e[n];if(a!==void 0)return a.exports;var i=e[n]={exports:{}};return r[n].call(i.exports,i,i.exports,t),i.exports}return t.d=(n,a)=>{for(var i in a)t.o(a,i)&&!t.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:a[i]})},t.o=(n,a)=>Object.prototype.hasOwnProperty.call(n,a),t.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t(233)})()}))});var ez=gr(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.testables=Ca.generateFileData=Ca.noteFramesToTime=Ca.addPitchBendsToNoteEvents=Ca.outputToNotesPoly=void 0;var QGe=L4(),Om=21,Lm=22050,z4=2,rp=256,JGe=Math.floor(Lm/rp),$4=JGe*z4,eHe=Lm*z4-rp,tHe=rp/Lm*($4-eHe/rp)+.0018,ik=87,W4=3,rHe=27.5,nHe=88,B4=nHe*W4,ok=r=>12*(Math.log2(r)-Math.log2(440))+69,V4=r=>440*2**((r-69)/12),Mm=r=>r*rp/Lm-tHe*Math.floor(r/$4);function sk(r){return r.length===0?null:r.reduce((e,t,n)=>r[e]>t?e:n,-1)}var U4=r=>r.map(e=>sk(e));function G4(r,e){let t=[],n=[];for(let a=0;a<r.length;a++)for(let i=0;i<r[a].length;i++)r[a][i]>e&&(t.push(a),n.push(i));return[t,n]}function H4(r){let[e,t,n]=r.reduce((o,s)=>{let[u,l,c]=s.reduce((f,h)=>[f[0]+h,f[1]+h*h,f[2]+1],[0,0,0]);return[o[0]+u,o[1]+l,o[2]+c]},[0,0,0]),a=e/n,i=Math.sqrt(1/(n-1)*(t-e*e/n));return[a,i]}function Pm(r){return r.reduce((e,t)=>Math.max(e,...t),0)}function q4(r){let e=r[0].map(t=>t.slice());for(let t=1;t<r.length;++t)for(let n=0;n<r[0].length;++n)for(let a=0;a<r[0][0].length;++a)e[n][a]=Math.min(e[n][a],r[t][n][a]);return e}function K4(r,e=1){let t=[];for(let n=0;n<r[0].length;++n)for(let a=0;a<r.length;++a){let i=!0;for(let o=Math.max(0,a-e);i&&o<=Math.min(r.length-1,a+e);++o)o!==a&&(i=i&&r[a][n]>r[o][n]);i&&t.push([a,n])}return t}function j4(r){let e=r[0].map(t=>t.slice());for(let t=1;t<r.length;++t)for(let n=0;n<r[0].length;++n)for(let a=0;a<r[0][0].length;++a)e[n][a]=Math.max(e[n][a],r[t][n][a]);return e}function aHe(r){return r!==null}function X4(r,e,t,n){if(t){let a=ok(t)-Om;for(let i=0;i<r.length;i++)r[i].fill(0,a);for(let i=0;i<e.length;i++)e[i].fill(0,a)}if(n){let a=ok(n)-Om;for(let i=0;i<r.length;i++)r[i].fill(0,0,a);for(let i=0;i<e.length;i++)e[i].fill(0,0,a)}}function Y4(r,e,t=2){let n=Array.from(Array(t).keys()).map(s=>s+1).map(s=>{let u=Array(s).fill(Array(e[0].length).fill(0)).concat(e),l=u.slice(s),c=u.slice(0,-s);if(l.length!==c.length)throw new Error(`nPlus length !== minusN length: ${l.length} !== ${c.length}`);return l.map((f,h)=>f.map((p,d)=>p-c[h][d]))}),a=q4(n);a=a.map(s=>s.map(u=>Math.max(u,0))),a=a.map((s,u)=>u<t?s.fill(0):s);let i=Pm(r),o=Pm(a);return a=a.map(s=>s.map(u=>i*u/o)),j4([r,a])}function iHe(r,e,t=.5,n=.3,a=5,i=!0,o=null,s=null,u=!0,l=11){let c=n;if(c===null){let[y,b]=H4(r);c=y+b}let f=r.length;X4(e,r,o,s);let h=e;i&&(h=Y4(e,r));let p=h.map(y=>y.map(()=>0));K4(h).forEach(([y,b])=>{p[y][b]=h[y][b]});let[d,v]=G4(p,t);d.reverse(),v.reverse();let m=r.map(y=>y.slice()),g=d.map((y,b)=>{let w=v[b];if(y>=f-1)return null;let k=y+1,S=0;for(;k<f-1&&S<l;)m[k][w]<c?S+=1:S=0,k+=1;if(k-=S,k-y<=a)return null;for(let N=y;N<k;++N)m[N][w]=0,w<ik&&(m[N][w+1]=0),w>0&&(m[N][w-1]=0);let E=r.slice(y,k).reduce((N,C)=>N+C[w],0)/(k-y);return{startFrame:y,durationFrames:k-y,pitchMidi:w+Om,amplitude:E}}).filter(aHe);if(u===!0)for(;Pm(m)>c;){let[y,b]=m.reduce((C,R,_)=>{let O=sk(R);return R[O]>m[C[0]][C[1]]?[_,O]:C},[0,0]);m[y][b]=0;let w=y+1,k=0;for(;w<f-1&&k<l;)m[w][b]<c?k+=1:k=0,m[w][b]=0,b<ik&&(m[w][b+1]=0),b>0&&(m[w][b-1]=0),w+=1;let S=w-1-k;for(w=y-1,k=0;w>0&&k<l;)m[w][b]<c?k+=1:k=0,m[w][b]=0,b<ik&&(m[w][b+1]=0),b>0&&(m[w][b-1]=0),w-=1;let E=w+1+k;if(E<0)throw new Error(`iStart is not positive! value: ${E}`);if(S>=f)throw new Error(`iEnd is past end of times. (iEnd, times.length): (${S}, ${f})`);let N=r.slice(E,S).reduce((C,R)=>C+R[b],0)/(S-E);S-E<=a||g.push({startFrame:E,durationFrames:S-E,pitchMidi:b+Om,amplitude:N})}return g}Ca.outputToNotesPoly=iHe;var Z4=(r,e)=>Array.from(Array(r).keys()).map(t=>Math.exp(-1*(t-(r-1)/2)**2/(2*e**2))),Q4=r=>12*W4*Math.log2(V4(r)/rHe);function oHe(r,e,t=25){let n=t*2+1,a=Z4(n,5);return e.map(i=>{let o=Math.floor(Math.round(Q4(i.pitchMidi))),s=Math.max(o-t,0),u=Math.min(B4,o+t+1),l=a.slice(Math.max(0,t-o),n-Math.max(0,o-(B4-t-1))),c=r.slice(i.startFrame,i.startFrame+i.durationFrames).map(p=>p.slice(s,u).map((d,v)=>d*l[v])),f=t-Math.max(0,t-o),h=U4(c).map(p=>p-f);return Object.assign(Object.assign({},i),{pitchBends:h})})}Ca.addPitchBendsToNoteEvents=oHe;var sHe=r=>r.map(e=>({pitchMidi:e.pitchMidi,amplitude:e.amplitude,pitchBends:e.pitchBends,startTimeSeconds:Mm(e.startFrame),durationSeconds:Mm(e.startFrame+e.durationFrames)-Mm(e.startFrame)}));Ca.noteFramesToTime=sHe;function J4(r){let e=new QGe.Midi,t=e.addTrack();return r.forEach(n=>{t.addNote({midi:n.pitchMidi,time:n.startTimeSeconds,duration:n.durationSeconds,velocity:n.amplitude}),n.pitchBends!==void 0&&n.pitchBends!==null&&n.pitchBends.forEach((a,i)=>{t.addPitchBend({time:n.startTimeSeconds+i*n.durationSeconds/n.pitchBends.length,value:a})})}),Buffer.from(e.toArray())}Ca.generateFileData=J4;Ca.testables={argRelMax:K4,argMax:sk,argMaxAxis1:U4,whereGreaterThanAxis1:G4,meanStdDev:H4,globalMax:Pm,min3dForAxis0:q4,max3dForAxis0:j4,getInferredOnsets:Y4,constrainFrequency:X4,modelFrameToTime:Mm,hzToMidi:ok,generateFileData:J4,noteFramesToTime:Ca.noteFramesToTime,gaussian:Z4,midiPitchToContourBin:Q4,midiToHz:V4}});var np=gr(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.outputToNotesPoly=ji.noteFramesToTime=ji.addPitchBendsToNoteEvents=ji.BasicPitch=void 0;var uHe=P4();Object.defineProperty(ji,"BasicPitch",{enumerable:!0,get:function(){return uHe.BasicPitch}});var uk=ez();Object.defineProperty(ji,"addPitchBendsToNoteEvents",{enumerable:!0,get:function(){return uk.addPitchBendsToNoteEvents}});Object.defineProperty(ji,"noteFramesToTime",{enumerable:!0,get:function(){return uk.noteFramesToTime}});Object.defineProperty(ji,"outputToNotesPoly",{enumerable:!0,get:function(){return uk.outputToNotesPoly}})});var Ai=null;var z6e=(async function(){try{if(typeof Ck=="function")try{console.log("BasicPitch: trying require()");let e=np();return Ai=e&&e.__esModule&&e.default||e,console.log("BasicPitch: loaded via require()",!!Ai),Ai}catch(e){console.warn("BasicPitch: require() failed:",e&&e.message)}}catch(e){console.warn("BasicPitch: require check threw:",e&&e.message)}try{if(typeof window<"u"){console.log("BasicPitch: trying dynamic import()");let e=await Promise.resolve().then(()=>Xm(np())).catch(t=>null);if(e)return Ai=e.default||e,console.log("BasicPitch: loaded via dynamic import()",!!Ai),Ai;try{let t=await Promise.resolve().then(()=>Xm(np()));return Ai=t.default||t,console.log("BasicPitch: loaded via dynamic import() (fallback)",!!Ai),Ai}catch(t){console.warn("BasicPitch: dynamic import() failed:",t&&t.message)}}}catch(e){console.warn("BasicPitch: import() threw:",e&&e.message)}try{if(typeof window<"u"&&window.BasicPitch)return Ai=window.BasicPitch,console.log("BasicPitch: found on window.BasicPitch"),Ai}catch{}return console.warn("BasicPitch: not available \u2014 will use legacy pipeline."),null})();var us=parseInt(sliders[11][0].max),oz=[{type:"low_shelf",freq:0,gain:0},{type:"peaking",freq:sampleRate/128},{type:"peaking",freq:sampleRate/32},{type:"peaking",freq:sampleRate/16},{type:"peaking",freq:sampleRate/8},{type:"peaking",freq:sampleRate/4},{type:"high_shelf",freq:sampleRate/2}],Sr=oz.map(r=>({...r})),tz=7.5,rz=7.5,Mu=-1,wc=-1,zm={x:0,y:0},lk=null,nz=0,az=0,xc=!0,ck=!1;Sr.forEach(r=>{typeof r.angle!="number"&&(r.angle=Math.PI/2),typeof r.tLen!="number"&&(r.tLen=60),r.gain=0,r.Q=1,r.mx=Math.cos(r.angle)*r.tLen,r.my=Math.sin(r.angle)*r.tLen});var Ou=(r,e,t)=>Math.max(e,Math.min(t,r));function Tc(r,e){let t=sampleRate*.5,n=r<=0?0:r/t;return n<=0?0:n>=1?e:Math.pow(n,1/2)*e}function kc(r,e){let t=sampleRate*.5,n=Ou(r/e,0,1);return Ou(Math.pow(n,2)*t,0,t)}function Sc(r,e){return(r+us)/(us*2)*e}function Ec(r,e){return Ou(r,0,e)/e*(us*2)-us}function sz(r,e){if(!xc&&lk&&nz===r&&az===e)return lk;let t=new Array(Sr.length);for(let n=0;n<Sr.length;n++){let a=Sr[n];(a._cachedAngle!==a.angle||a._cachedTLen!==a.tLen)&&(a.mx=Math.cos(a.angle)*(a.tLen||40),a.my=Math.sin(a.angle)*(a.tLen||40),a._cachedAngle=a.angle,a._cachedTLen=a.tLen);let i=Tc(a.freq,e),o=Sc(a.gain||0,r);t[n]={i:n,b:a,x:o,y:i,mx:a.mx,my:a.my}}return t.sort((n,a)=>n.y-a.y),lk=t,nz=r,az=e,xc=!1,t}function pk(){ck||(ck=!0,requestAnimationFrame(()=>{ck=!1,uz()}))}function uz(){if(!EQcanvas||!eCtx||currentPanel!=="2")return;let r=EQcanvas.width,e=EQcanvas.height;eCtx.clearRect(0,0,r,e),eCtx.fillStyle="#111",eCtx.fillRect(0,0,r,e);let t=sz(r,e);eCtx.lineWidth=1,eCtx.strokeStyle="#444",eCtx.beginPath();let n=Sc(0,r);eCtx.moveTo(n,0),eCtx.lineTo(n,e);let a=Sc(globalGain||0,r);if(eCtx.moveTo(a,0),eCtx.lineTo(a,e),eCtx.stroke(),eCtx.lineWidth=2,eCtx.strokeStyle="#fff",eCtx.beginPath(),t.length>0){eCtx.moveTo(t[0].x,t[0].y);for(let i=0;i<t.length-1;i++){let o=t[i],s=t[i+1],u=s.x-o.x,l=s.y-o.y,c=Math.sqrt(u*u+l*l),f=Math.max(8,Math.floor(c/6));for(let h=1;h<=f;h++){let p=h/f,d=p*p,v=d*p,m=2*v-3*d+1,g=v-2*d+p,y=-2*v+3*d,b=v-d,w=m*o.x+g*o.mx+y*s.x+b*s.mx,k=m*o.y+g*o.my+y*s.y+b*s.my;eCtx.lineTo(w,k)}}}eCtx.stroke(),eCtx.font="12px 'Inter', 'Segoe UI', sans-serif",eCtx.textBaseline="middle";for(let i=0;i<t.length;i++){let o=t[i];eCtx.beginPath(),eCtx.fillStyle="#fff",eCtx.arc(o.x,o.y,5,0,Math.PI*2),eCtx.fill(),eCtx.strokeStyle="#f00",eCtx.lineWidth=2,eCtx.beginPath(),eCtx.moveTo(o.x-o.mx/3,o.y-o.my/3),eCtx.lineTo(o.x+o.mx/3,o.y+o.my/3),eCtx.stroke();let s,u;o.b.type==="high_shelf"?(s=o.x-o.mx/3,u=o.y-o.my/3):(s=o.x+o.mx/3,u=o.y+o.my/3),eCtx.beginPath(),eCtx.fillStyle="#ff0",eCtx.arc(s,u,3,0,Math.PI*2),eCtx.fill();let l=`${Math.round(o.b.freq)} Hz`,c=`${o.b.gain>=0?"+":""}${Number((o.b.gain||0).toFixed(1))} dB`,f=`${l} / ${c}`,h=eCtx.measureText(f).width,p=o.x+12,d=o.y;p+h>r-4&&(p=o.x-12-h),d<8&&(d=8),d>e-8&&(d=e-8);let v=h+8,m=18;eCtx.fillStyle="rgba(0,0,0,0.6)",eCtx.fillRect(p-4,d-m/2,v,m),eCtx.fillStyle="#fff",eCtx.fillText(f,p,d)}lHe()}function lHe(){let e=currentCursorX*hop;if(e+fftSize>pcm.length)return rendering=!1,status.style.display="none",!1;let t=new Float32Array(fftSize),n=new Float32Array(fftSize);for(let i=0;i<fftSize;i++)t[i]=(pcm[e+i]||0)*win[i],n[i]=0;fft_inplace(t,n);let a=[];for(let i=0;i<128;i++){let o=Math.floor(kc(i/128,1)/(sampleRate/2)*specHeight),s=Math.hypot(t[o]||0,n[o]||0);a[o]=s}eCtx.strokeStyle="rgba(255, 255, 255, 0.48)",eCtx.lineWidth=EQcanvas.height/128/1.25;for(let i=0;i<128;i++){let o=Math.floor(kc(i/128,1)/(sampleRate/2)*specHeight),s=a[o]||0;eCtx.beginPath(),eCtx.moveTo(0,i/128*EQcanvas.height);let u=h=>20*Math.log10(h),l=Ec($m(i/128*EQcanvas.height),EQcanvas.width),f=(u(s/256)+(l||0)+128)/128*(EQcanvas.width/2);eCtx.lineTo(f,i/128*EQcanvas.height),eCtx.stroke()}}function dk(r){if(!EQcanvas)return null;let e=EQcanvas.width,t=EQcanvas.height;for(let n=0;n<Sr.length;n++){let a=Sr[n],i=Tc(a.freq,t),o=Sc(a.gain||0,e),s=typeof a.mx=="number"?a.mx:Math.cos(a.angle||0)*(a.tLen||40),u=typeof a.my=="number"?a.my:Math.sin(a.angle||0)*(a.tLen||40),l=o+s/3,c=i+u/3;a.type=="high_shelf"&&(l=o-s/3,c=i-u/3);let f=r.x-l,h=r.y-c;if(f*f+h*h<=rz*rz)return{type:"handle",index:n};let p=r.x-o,d=r.y-i;if(p*p+d*d<=tz*tz)return{type:"point",index:n}}return null}function cHe(r,e=16,t=16){let n=r.replace(/\n/g," ");return`url("data:image/svg+xml;utf8,${encodeURIComponent(n)}") ${e} ${t}, auto`}var fHe=`<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 32 32'>
  <path d='M16 4 a12 12 0 1 0 12 12 h-2 a10 10 0 1 1 -10 -10 v-3 l5 4 -5 4 v-3z' fill='white' />
</svg>`,lz=cHe(fHe,16,16);function cz(r){let e=dk(r);!e&&Mu===-1&&wc===-1?EQcanvas&&(EQcanvas.style.cursor="crosshair"):Mu!==-1||e&&e.type==="point"?EQcanvas.style.cursor="pointer":EQcanvas.style.cursor=lz}function Bm(r,e,t){let n=t*t,a=n*t,i=2*a-3*n+1,o=a-2*n+t,s=-2*a+3*n,u=a-n,l=i*r.x+o*r.mx+s*e.x+u*e.mx,c=i*r.y+o*r.my+s*e.y+u*e.my;return{X:l,Y:c}}function hHe(r,e,t){let n=Math.min(r.y,e.y)-Math.abs(r.my)-Math.abs(e.my)-1,a=Math.max(r.y,e.y)+Math.abs(r.my)+Math.abs(e.my)+1;if(t<n||t>a)return null;let i=24,o=0,s=Bm(r,e,0).Y-t;if(Math.abs(s)<.5)return 0;for(let u=1;u<=i;u++){let l=u/i,c=Bm(r,e,l).Y-t;if(Math.abs(c)<.5)return l;if(s*c<=0){let f=o,h=l,p=s,d=c;for(let v=0;v<28;v++){let m=.5*(f+h),g=Bm(r,e,m).Y-t;if(Math.abs(g)<.5)return m;p*g<=0?(h=m,d=g):(f=m,p=g)}return .5*(f+h)}o=l,s=c}return null}function $m(r){if(!EQcanvas)return null;let e=EQcanvas.width,t=EQcanvas.height,n=sz(e,t);if(n.length===0)return null;if(r<=n[0].y)return n[0].x;if(r>=n[n.length-1].y)return n[n.length-1].x;for(let a=0;a<n.length-1;a++){let i=n[a],o=n[a+1];if(!!(r<Math.min(i.y,o.y)-Math.abs(i.my)-Math.abs(o.my)||r>Math.max(i.y,o.y)+Math.abs(i.my)+Math.abs(o.my)))continue;let u=hHe(i,o,r);if(u!==null)return Bm(i,o,u).X}return null}function ap(r){let e=EQcanvas.getBoundingClientRect(),t,n;return r.touches&&r.touches[0]?(t=r.touches[0].clientX,n=r.touches[0].clientY):(t=r.clientX,n=r.clientY),{x:t-e.left,y:n-e.top}}EQcanvas.addEventListener("pointerdown",r=>{ensureAudioCtx(),!sineOsc&&!playing&&document.getElementById("drawVolume").checked&&(sineOsc=audioCtx.createOscillator(),sineOsc.type="sine",sineGain=audioCtx.createGain(),sineGain.gain.value=.2,sineOsc.connect(sineGain).connect(audioCtx.destination),sineOsc.frequency.setTargetAtTime(kc(ap(r).y,EQcanvas.height),audioCtx.currentTime,.01),sineOsc.start())});function pHe(r){r.preventDefault();let e=ap(r),t=dk(e);if(r.pointerId&&EQcanvas.setPointerCapture)try{EQcanvas.setPointerCapture(r.pointerId)}catch{}if(!t){Mu=-1,wc=-1,EQcanvas&&(EQcanvas.style.cursor="crosshair"),window.addEventListener("pointermove",fk),window.addEventListener("pointerup",iz,{once:!0});return}if(t.type==="point"){EQcanvas.style.cursor="pointer",Mu=t.index;let n=Sr[t.index],a=Sc(n.gain,EQcanvas.width),i=Tc(n.freq,EQcanvas.height);zm.x=e.x-a,zm.y=e.y-i}else t.type==="handle"&&(EQcanvas.style.cursor=lz,wc=t.index);window.addEventListener("pointermove",fk),window.addEventListener("pointerup",iz,{once:!0})}function dHe(r){let e=ap(r);cz(e);let t=EQcanvas.width,n=EQcanvas.height,a=kc(e.y,n),i=$m(e.y),o;i===null?o=`${Ec(e.x,t).toFixed(1)} dB (raw X)`:(o=`${Ec(i,t).toFixed(1)} dB (curve)`,uz(),dk(ap(r))||(eCtx.save(),eCtx.fillStyle="limegreen",eCtx.beginPath(),eCtx.arc(i,e.y,3,0,Math.PI*2),eCtx.fill(),eCtx.restore())),typeof info<"u"&&info&&(info.innerHTML=`Freq: ${a.toFixed(0)} Hz<br>Gain: ${o}<br>`)}function fk(r){r.preventDefault();let e=ap(r);if(cz(e),sineOsc&&sineOsc.frequency.setTargetAtTime(kc(e.y,EQcanvas.height),audioCtx.currentTime,.01),Mu!==-1){let n=Sr[Mu],a=e.x-zm.x,i=e.y-zm.y,o=Ec(a,EQcanvas.width),s=kc(i,EQcanvas.height);n.type!=="low_shelf"&&n.type!=="high_shelf"&&(n.freq=Ou(s,20,sampleRate/2)),n.gain=Ou(Number(o.toFixed(2)),0-us,us),xc=!0}else if(wc!==-1){let n=Sr[wc],a=Sc(n.gain,EQcanvas.width),i=Tc(n.freq,EQcanvas.height),o=(n.type!=="high_shelf"?0:Math.PI)+Math.atan2(e.y-i,e.x-a);n.angle=o,n.mx=Math.cos(n.angle)*(n.tLen||40),n.my=Math.sin(n.angle)*(n.tLen||40),n._cachedAngle=n.angle,n._cachedTLen=n.tLen,xc=!0}pk(),vk(),fz()}function iz(r){Mu=-1,wc=-1,window.removeEventListener("pointermove",fk),xc=!0,pk(),vk(),sineOsc&&(sineOsc.stop(),sineOsc.disconnect(),sineOsc=null,sineGain=null)}EQcanvas&&(EQcanvas.style.touchAction="none",EQcanvas.addEventListener("pointerdown",pHe),EQcanvas.addEventListener("pointermove",dHe));function fz(){if(!Sr||Sr.length===0)globalGain=0;else{let r=0;for(let e=0;e<Sr.length;e++)r+=Sr[e].gain||0;globalGain=r/Sr.length}try{sliders&&sliders[11]&&(sliders[11][0]&&(sliders[11][0].value=globalGain),sliders[11][1]&&(sliders[11][1].value=globalGain))}catch{}return globalGain}var Gt={eqInput:null,eqOutput:null,filters:[],bandCount:24,inited:!1};function hz(r=24){if(ensureAudioCtx(),!(Gt.inited&&Gt.bandCount===r)){Gt.bandCount=r;try{Gt.eqInput&&Gt.eqInput.disconnect()}catch{}Gt.filters.forEach(e=>{try{e.disconnect()}catch{}});try{Gt.eqOutput&&Gt.eqOutput.disconnect()}catch{}if(Gt.eqInput=audioCtx.createGain(),Gt.eqOutput=audioCtx.createGain(),Gt.eqOutput.connect(audioCtx.destination),Gt.filters=new Array(r).fill(0).map(()=>audioCtx.createBiquadFilter()),Gt.filters.length===0)Gt.eqInput.connect(Gt.eqOutput);else{Gt.eqInput.connect(Gt.filters[0]);for(let e=0;e<Gt.filters.length-1;e++)Gt.filters[e].connect(Gt.filters[e+1]);Gt.filters[Gt.filters.length-1].connect(Gt.eqOutput)}Gt.inited=!0,pz(r)}}function pz(r=24){if(!EQcanvas){console.warn("buildCurveEQ: need EQcanvas for screen mapping; using defaults (no curve).");return}hz(r);let e=sampleRate*.5,t=20,a=Math.pow(e/t,1/Math.max(1,r-1)),i=new Array(r);i[0]=t;for(let u=1;u<r;u++)i[u]=i[u-1]*a;let o=EQcanvas.width,s=EQcanvas.height;for(let u=0;u<r;u++){let l=i[u],c=Tc(l,s),f=$m(c),h=f===null?0:Ec(f,o),p=u===0?l/a:i[u-1],d=u===r-1?l*a:i[u+1],v=Math.max(1e-6,d-p),m=l/v;m=Ou(m,.3,18);let g=Gt.filters[u];g.type="peaking",g.frequency.value=Math.min(Math.max(l,1),e-1),g.Q.value=m,g.gain.value=h}}function vk(){if(!Gt.inited||Gt.filters.length===0||!EQcanvas)return;let r=Gt.filters.length,e=EQcanvas.width,t=EQcanvas.height;for(let n=0;n<r;n++){let a=Gt.filters[n],i=a.frequency.value,o=Tc(i,t),s=$m(o),u=s===null?0:Ec(s,e);a.gain.setTargetAtTime(u,audioCtx.currentTime,.01)}}hz(24);pz(24);var Wm={Flat:[0,0,0,0,0,0,0],"Bass boost":[6,4,3,1,0,-1,-2],Lowpass:[0,-2,-4,-6,-8,-10,-12],"Mid boost":[0,0,6,6,0,0,0],Midpass:[-6,-4,0,4,0,-4,-6],"High boost":[-2,-1,0,1,3,5,7],Highpass:[-12,-10,-8,-6,-4,-2,0],Custom:null};function vHe(r){(!Array.isArray(r)||r.length!==Sr.length)&&(Sr=oz);for(let e=0;e<Sr.length;e++)Sr[e].gain=Ou(Number(r[e]||0),-us,us),Sr[e].angle=Math.PI/2;xc=!0,pk(),vk(),fz(),mHe()}function mHe(){try{if(typeof sliders<"u"&&Array.isArray(sliders)){for(let r=0;r<Sr.length&&r<sliders.length;r++)sliders[r]&&sliders[r][0]&&(sliders[r][0].value=Sr[r].gain),sliders[r]&&sliders[r][1]&&(sliders[r][1].value=Sr[r].gain);return}}catch{}for(let r=0;r<Sr.length;r++)document.querySelectorAll(`[data-eq-band="${r}"]`).forEach(t=>{"value"in t&&(t.value=Sr[r].gain)})}function mk(r){if(!r||r.toLowerCase()==="custom")return;let e=Wm[r];if(!e){console.warn("Preset not found:",r);return}vHe(e)}function gHe(r){if(!r)return;let e=Sr.map(n=>Number(n.gain||0));if(Wm[r]=e,!!!document.querySelector(`#eqPresets option[value="${r}"]`)){let n=document.createElement("option");n.value=r,n.textContent=r,document.getElementById("eqPresets").appendChild(n)}}var Eo=document.getElementById("eqPresets");Eo&&Eo.addEventListener("change",r=>{let e=Eo.value;e&&e.toLowerCase()!=="custom"&&(Wm[e]?mk(e):console.warn("No preset data for:",e))});function hk(){if(!Eo)return;Eo.value!=="Custom"&&(Eo.value="Custom")}function yHe(){let r=document.querySelectorAll("[data-eq-band]");r.length&&r.forEach(t=>t.addEventListener("input",hk));let e=document.querySelectorAll(".eq-band-slider");e.length&&e.forEach(t=>t.addEventListener("input",hk))}yHe();typeof EQcanvas<"u"&&EQcanvas&&EQcanvas.addEventListener("pointerup",r=>{hk()},{passive:!0});window.eqPresets=window.eqPresets||{};window.eqPresets.apply=mk;window.eqPresets.save=gHe;window.eqPresets.data=Wm;Eo&&Eo.value===""&&(Eo.value="Flat",mk("Flat"));(function(){let t=[{id:"spectrogram",label:"Welcome to SpectroDraw!",subtitle:"Click & drag to draw (mouseup to finish)",target:"#canvas, #timeline, #logscale, #freq",dialog:"Welcome! This is the spectrogram. It\u2019s a visual map of your sound. \u{1F449} Click and drag your mouse across it to draw.",waitFor:{type:"mouseup",selector:"#canvas"},showNext:!1,preAction:null,mouseLoop:!0,dialogOffset:{x:600,y:108}},{id:"playPause",label:"Play / Pause",subtitle:"Press Spacebar or click Play",target:"#playPause, #stop, #canvas, #timeline, #logscale, #freq",dialog:"Press Spacebar to play or pause your audio at any time. \u{1F3B5}",waitFor:{type:"complexPlayback"},showNext:!1,preAction:null,mouseLoop:!1,dialogOffset:{x:208,y:108}},{id:"addSound",label:"Add audio / presets",subtitle:"Upload a file or choose a preset",target:"#uploadBtn, #presets, #rec, #canvas, #timeline, #logscale, #freq, #midiv",dialog:`Let\u2019s add some sound! Upload an audio or video file, record with
your microphone, or pick one of the built-in presets.`,waitFor:{type:"renderCycle",varName:"rendering"},showNext:!1,preAction:null,mouseLoop:!1,dialogOffset:{x:258,y:108}},{id:"tools",label:"Tools: Rectangle, Line, Blur, Eraser, Amplify, Image",subtitle:"Try one of the tools",target:"#brushBtn, #rectBtn, #lineBtn, #blurBtn, #eraserBtn, #amplifierBtn, #imageBtn, #playPause, #stop, #canvas, #timeline, #logscale, #freq, #overlay, #d1",dialog:"Try out the tools: Rectangle, Line, Blur, Eraser, Amplifier, and Image Overlay (turns pictures into sound!). \u{1F5BC}\uFE0F\u{1F3B6}",waitFor:{type:"oneToolClickOrNext",selector:".tool-btn"},showNext:!0,preAction:null,mouseLoop:!1,dialogOffset:{x:358,y:58}},{id:"brushSettings",label:"Brush settings",subtitle:"Try changing the brush settings",target:"#brushBtn, #rectBtn, #lineBtn, #blurBtn, #eraserBtn, #amplifierBtn, #imageBtn, #playPause, #stop, #canvas, #timeline, #logscale, #freq, #overlay, #d1",dialog:"Try changing the brush settings while using tools like Brush, Image, Line, or Amplify to discover different effects! \u{1F50D}\u{1F3A8}",waitFor:{type:"modifyBrush",selectors:["#brushSettings, #canvas, #timeline, #logscale, #freq"]},showNext:!0,preAction:null,mouseLoop:!1,dialogOffset:{x:368,y:500}},{id:"changeFFT",label:"FFT parameters",subtitle:"These control the quality of the spectrogram",target:"#fftParameters, #canvas, #timeline, #logscale, #freq",dialog:`Play around with the pitch and time resolution and see how they
shape audio quality and phase (color).`,waitFor:{type:"awaitNext"},showNext:!0,preAction:null,mouseLoop:!1,dialogOffset:{x:378,y:128}},{id:"save",label:"Download / Export",subtitle:"Download Audio or Spectrogram",target:"#downloadWav, #downloadSpectrogram",dialog:"Ready to save? Click Download Audio or Download Spectrogram to export your work.",waitFor:{type:"clickEither",selectors:["#downloadWav","#downloadSpectrogram"]},showNext:!1,preAction:null,mouseLoop:!1,dialogOffset:{x:718,y:58}},{id:"midi",label:"Export MIDI (piano)",subtitle:"Open piano, export MIDI (pulsing export button)",target:"#pianoBtn, #exportMIDI, .left-panel",dialog:"Want to make music notation? Try exporting as a MIDI file (you can even turn it into sheet music later). \u{1F3B9}",waitFor:{type:"clickThenNext",clickSelector:"#exportMIDI"},showNext:!0,preAction:function(){let M=document.getElementById("pianoBtn");M&&M.click()},mouseLoop:!1,dialogOffset:{x:308,y:500}},{id:"equalizer",label:"Equalizer",subtitle:"Open EQ and tweak points",target:"#eqBtn, #eqCanvas, .left-panel",dialog:`Finally, open the Equalizer and tweak some points \u2014 hear how it
changes your sound in real time.`,preAction:function(){let M=document.getElementById("eqBtn");M&&M.click()},waitFor:{type:"eqCanvasClick"},showNext:!0,mouseLoop:!1,mouseLoopSelector:"#eqCanvas",dialogOffset:{x:408,y:308}},{id:"done",label:"Done",subtitle:"Finish the tutorial",target:"#resetButton",dialog:`That\u2019s it! \u{1F389} You\u2019ve completed the tutorial. Clicking this button
resets the spectrogram to silence. Now go make something
amazing.`,preAction:function(){let M=document.getElementById("settingsBtn");M&&M.click()},waitFor:{type:"none"},showNext:!0,dialogOffset:{x:708,y:108}}],n=document.getElementById("tutorialDialog"),a=document.getElementById("tdTitle"),i=document.getElementById("tdText"),o=document.getElementById("tdActions"),s=document.getElementById("tutorialSkip"),u=0,l=[],c=[],f=null,h=null,p=null,d=[],v=new Map;function m(M,$){M&&(M.textContent=$)}function g(M,$=25){if(!M)return;let K=M.textContent||"";M.innerHTML="";let j=K.split(`
`);j.forEach((te,Q)=>{(te.match(/(\p{Emoji_Presentation}|\p{Emoji}\uFE0F|\S|\s)/gu)||[]).forEach((le,de)=>{let we=document.createElement("span");we.textContent=le===" "?"\xA0":le,we.style.opacity=0,we.style.display="inline-block",we.style.transition="opacity 0.3s ease",M.appendChild(we),setTimeout(()=>{we.style.opacity=1},de*$)}),Q<j.length-1&&M.appendChild(document.createElement("br"))})}function y(M){if(playingTutorial)try{(typeof M!="number"||M<0||M>=t.length)&&(M=0),R(),u=M;let $=t[M];if(!$)return;if(document.querySelectorAll(".tutorial-step-btn").forEach(K=>K.classList.remove("active")),m(a,$.label),m(i,$.dialog),o&&(o.innerHTML=""),M!=t.length-1){let K=document.createElement("button");K.textContent="Skip tutorial",K.addEventListener("click",L),o&&o.appendChild(K)}if($.showNext){let K=document.createElement("button");K.className="primary",K.textContent=M===t.length-1?"Finish":"Next",($.id==="tools"||$.id==="midi"||$.id==="equalizer"||$.id==="brushSettings")&&(K.disabled=!0,K.classList.add("disabled")),K.addEventListener("click",()=>{M===t.length-1?L():W()}),o&&o.appendChild(K),$._nextBtn=K}n&&(n.classList.remove("hide"),n.classList.add("show"),setTimeout(()=>{g(i,25)},60),n.style.transform="translateY(8px)",setTimeout(()=>{n.style.transform="translateY(0)"},1)),setTimeout(()=>{try{if(w($),typeof $.preAction=="function"){try{$.preAction()}catch(K){console.warn("preAction error",K)}l&&l.length?E(l):w($)}try{b($)}catch{}O($)}catch(K){console.warn("openStep inner error",K)}},180)}catch($){console.error("openStep error",$)}}function b(M){if(!n)return;n.style.position="fixed",n.style.zIndex="100001",n.style.maxWidth="420px";let $=M&&M.dialogOffset?M.dialogOffset:{x:16,y:16},K=typeof $.x=="number"?$.x:16,j=typeof $.y=="number"?$.y:16;n.style.right="",n.style.bottom="",n.style.left=`${K}px`,n.style.top=`${j}px`}function w(M){if(R(),!M)return;let $=M.target;if(!$)return;let K=[];try{document.querySelectorAll($).forEach(ie=>K.push(ie));let te=Array.from(new Set(K));if(!te.length)return;l=te.slice(),k(l,M),te.forEach(ie=>{if(v.set(ie,{position:ie.style.position||"",boxShadow:ie.style.boxShadow||"",outline:ie.style.outline||""}),M.pulseOutline){ie.classList.add("tutorial-pulse-outline");let le=document.createElement("div");le.className="tutorial-target-marker",le.style.position="fixed",le.style.pointerEvents="none",le.style.borderRadius="8px",le.style.boxSizing="border-box",le.style.border="2px solid rgba(255,255,255,0.06)",le.style.boxShadow="0 20px 50px rgba(0,0,0,0.6)",le.style.transition="left 160ms ease, top 160ms ease, width 160ms ease, height 160ms ease",document.body.appendChild(le),c.push(le),N(ie,le)}});let Q=()=>{try{E(l),l.forEach((ie,le)=>{c[le]&&N(ie,c[le])}),M._arrowEl&&l[0]&&C(M._arrowEl,l[0]);try{b(M)}catch{}}catch{}};window.addEventListener("resize",Q),window.addEventListener("scroll",Q,!0),M._reposition=Q,M.id==="addSound"?(document.querySelector("#uploadBtn").classList.add("tutorial-pulse-glow"),document.querySelector("#presets").classList.add("tutorial-pulse-glow"),document.querySelector("#rec").classList.add("tutorial-pulse-glow")):M.id==="midi"?document.querySelector("#exportMIDI").classList.add("tutorial-pulse-glow"):M.id==="playPause"?(document.querySelector("#playPause").classList.add("tutorial-pulse-glow"),document.querySelector("#stop").classList.add("tutorial-pulse-glow")):M.id==="done"?document.querySelector("#resetButton").classList.add("tutorial-pulse-glow"):M.id==="changeFFT"&&(document.querySelector("#fftSize").classList.add("tutorial-pulse-glow"),document.querySelector("#hopSize").classList.add("tutorial-pulse-glow"))}catch(j){console.warn("setupHighlightFor error",j)}}function k(M,$){if(h||(h="tutorial-spotlight-mask-"+Math.floor(Math.random()*1e9)),!f){let K="http://www.w3.org/2000/svg",j=document.createElementNS(K,"svg");j.classList.add("tutorial-spotlight"),j.setAttribute("width","100%"),j.setAttribute("height","100%"),j.setAttribute("viewBox","0 0 "+window.innerWidth+" "+window.innerHeight),j.style.position="fixed",j.style.left="0",j.style.top="0",j.style.width="100%",j.style.height="100%",j.style.pointerEvents="none",j.style.zIndex="99990",j.style.touchAction="none",j.setAttribute("aria-hidden","true");let te=document.createElementNS(K,"defs"),Q=document.createElementNS(K,"mask");Q.setAttribute("id",h);let ie=document.createElementNS(K,"rect");ie.setAttribute("x","0"),ie.setAttribute("y","0"),ie.setAttribute("width","100%"),ie.setAttribute("height","100%"),ie.setAttribute("fill","white"),Q.appendChild(ie),te.appendChild(Q),j.appendChild(te);let le=document.createElementNS(K,"rect");le.setAttribute("x","0"),le.setAttribute("y","0"),le.setAttribute("width","100%"),le.setAttribute("height","100%"),le.setAttribute("fill","rgba(0,0,0,0.8)"),le.setAttribute("mask",`url(#${h})`),j.appendChild(le),document.body.appendChild(j),f=j}E(M)}window.addEventListener("resize",function(){f&&f.setAttribute("viewBox","0 0 "+window.innerWidth+" "+window.innerHeight),l&&l.length&&E(l)});function S(){if(!f)return{};let M=f.querySelector("mask#"+h),$=f.querySelector("rect[mask]");return{mask:M,overlayRect:$}}function E(M,{animate:$=!0}={}){if(!f)return;let K="http://www.w3.org/2000/svg",{mask:j}=S();if(!j||!j.children[0])return;let Q=new Set,ie=[];M.forEach(we=>{try{let pe=we.getBoundingClientRect();if(pe.width<=0||pe.height<=0)return;let Se=8,Ee=Math.max(0,Math.floor(pe.left)-Se),Ne=Math.max(0,Math.floor(pe.top)-Se),Ge=Math.floor(pe.width)+Se*2,Ke=Math.floor(pe.height)+Se*2,Ue=`${Ee}:${Ne}:${Ge}:${Ke}`;Q.add(Ue),ie.push({key:Ue,x:Ee,y:Ne,w:Ge,h:Ke})}catch(pe){console.warn("spotlight: getBoundingClientRect failed",pe)}});let le=Array.from(j.querySelectorAll("rect.tutorial-hole")),de=new Map;le.forEach(we=>{let pe=we.getAttribute("data-hole-key");pe&&de.set(pe,we)}),de.forEach((we,pe)=>{if(!Q.has(pe))try{we.style.transition="fill-opacity 820ms ease",we.setAttribute("fill-opacity","0"),setTimeout(()=>{try{we.remove()}catch{}},860)}catch(Se){console.warn("spotlight: failed removing old hole",Se)}}),ie.forEach(we=>{let{key:pe,x:Se,y:Ee,w:Ne,h:Ge}=we;try{let Ke=document.createElementNS(K,"rect");Ke.classList.add("tutorial-hole"),Ke.setAttribute("data-hole-key",pe),Ke.setAttribute("x",Se),Ke.setAttribute("y",Ee),Ke.setAttribute("width",Ne),Ke.setAttribute("height",Ge),Ke.setAttribute("rx","8"),Ke.setAttribute("ry","8"),Ke.setAttribute("fill","black"),Ke.setAttribute("fill-opacity","0"),Ke.style.transition="fill-opacity 820ms ease",j.appendChild(Ke),requestAnimationFrame(()=>{try{Ke.setAttribute("fill-opacity","1")}catch{}})}catch(Ke){console.warn("spotlight: failed creating hole",Ke)}})}function N(M,$){if(!$||!M||!M.getBoundingClientRect)return;let K=M.getBoundingClientRect();$.style.left=Math.max(8,K.left-8)+"px",$.style.top=Math.max(8,K.top-8)+"px",$.style.width=K.width+16+"px",$.style.height=K.height+16+"px"}function C(M,$){if(!M||!$)return;let K=$.getBoundingClientRect(),j=M.parentElement?.getBoundingClientRect?M.parentElement.getBoundingClientRect():{left:0,top:0,width:0,height:0},te=j.left+j.width/2,Q=j.top+j.height/2,ie=K.left+K.width/2,le=K.top+K.height/2,de=Math.atan2(le-Q,ie-te)*180/Math.PI;M.style.transform=`translate(0px, -50%) rotate(${de}deg)`;let we=ie-te,pe=le-Q,Se=Math.min(Math.hypot(we,pe),420),Ee=Math.min(90,Se/3+20);M.style.right=-(Ee+36)+"px",M.style.top="50%"}function R(){if(l&&l.length&&(l.forEach(M=>{let $=v.get(M);if($)try{M.style.position=$.position,M.style.boxShadow=$.boxShadow,M.style.outline=$.outline}catch{}try{M.classList.remove("tutorial-pulse-outline")}catch{}v.delete(M)}),l=[]),c&&c.length&&(c.forEach(M=>{try{M.remove()}catch{}}),c=[]),f)try{E([])}catch{}document.querySelectorAll("#uploadBtn, #presets, #rec, #exportMIDI, #playPause, #stop, #resetButton, #fftSize, #hopSize").forEach(M=>M.classList.remove("tutorial-pulse-glow")),t.forEach(M=>{M._reposition&&(window.removeEventListener("resize",M._reposition),window.removeEventListener("scroll",M._reposition,!0),delete M._reposition)})}function _(){d.forEach(M=>{try{if(M.type==="interval")clearInterval(M.id);else if(M.type==="event"){let{node:$,ev:K,fn:j}=M;$&&K&&j&&$.removeEventListener(K,j)}else if(M.type==="timeout")clearTimeout(M.id);else if(M.type==="cleanup")try{typeof M.fn=="function"&&M.fn()}catch{}}catch{}}),d=[]}function O(M){if(_(),!M)return;let $=M.waitFor||{type:"none"},K=(te,Q)=>{if(!te||!Q)return;let ie=()=>Q.style.opacity="0.15",le=()=>Q.style.opacity="0.95";te.addEventListener("mousemove",ie,{once:!0}),setTimeout(()=>{te.removeEventListener("mousemove",ie)},900)},j=null;if(M.mouseLoop){let te=M.mouseLoopSelector?document.querySelector(M.mouseLoopSelector):document.querySelector(M.target);if(te){j=document.createElement("div"),j.style.position="absolute",j.id="mouseloop",j.style.pointerEvents="auto",j.style.cursor="crosshair",j.style.zIndex=1e6;let Q=600,ie=250;j.innerHTML=`
                    <img src="mouseloop.gif" width="500" height="500"
                    style="opacity:1; filter: drop-shadow(0 6px 14px rgba(0,0,0,0.6));
                        position:fixed; left:${Q}px; top:${ie}px" />`,document.body.appendChild(j),j.style.transition="opacity 0.8s ease";let le=de=>{j.style.pointerEvents="none",canvasMouseDown(de,!1),setTimeout(()=>{j.style.opacity="0",setTimeout(()=>j.remove(),800)},3e3)};j.addEventListener("pointerdown",de=>le(de),{once:!0}),d.push({type:"event",node:te,ev:"mousemove",fn:de=>{}})}}if($.type==="mouseup"&&$.selector){let te=document.querySelector($.selector);if(te){let Q=()=>{B(M)};te.addEventListener("pointerup",Q,{once:!0}),d.push({type:"event",node:te,ev:"mouseup",fn:Q})}else{let Q=document.getElementById("canvas");if(Q){let ie=()=>B(M);Q.addEventListener("mouseup",ie,{once:!0}),d.push({type:"event",node:Q,ev:"mouseup",fn:ie})}else{let ie=setTimeout(()=>B(M),900);d.push({type:"interval",id:ie})}}return}if($.type==="complexPlayback"){let te=setInterval(()=>{try{typeof playing<"u"&&typeof currentCursorX<"u"&&typeof specWidth<"u"&&playing&&currentCursorX>specWidth*.9&&(clearInterval(te),B(M))}catch{}},860);d.push({type:"interval",id:te});return}if($.type==="renderCycle"){let te=["rendering","recording"],Q={};te.forEach(le=>Q[le]=!1);let ie=setInterval(()=>{try{for(let le of te){let de=le==="rendering"?rendering:recording;if(!Q[le]&&de===!0&&(Q[le]=!0),Q[le]&&de===!1){clearInterval(ie),B(M);return}}}catch{}},820);d.push({type:"interval",id:ie}),(function(){let le=document.querySelector("#file"),de=document.querySelector("#presets");if(le){let we=()=>{clearInterval(ie),B(M)};le.addEventListener("change",we,{once:!0}),d.push({type:"event",node:le,ev:"change",fn:we})}if(de){let we=()=>{clearInterval(ie),B(M)};de.addEventListener("change",we,{once:!0}),d.push({type:"event",node:de,ev:"change",fn:we})}})();return}if($.type==="oneToolClickOrNext"){let te=document.querySelectorAll($.selector);if(te&&te.length){let Q=()=>{M._nextBtn&&(M._nextBtn.disabled=!1,M._nextBtn.classList.remove("disabled"))};te.forEach(ie=>ie.addEventListener("click",Q,{once:!0})),d.push({type:"event",node:document,ev:"click",fn:Q})}return}if($.type==="modifyBrush"){let te=document.querySelector("#brushSettings");if(te&&M._nextBtn){let Q=te.querySelectorAll("input, select, textarea, button"),ie=()=>{M._nextBtn.disabled=!1,M._nextBtn.classList.remove("disabled")};Q.forEach(le=>{le.addEventListener("input",ie,{once:!0}),le.addEventListener("change",ie,{once:!0}),d.push({type:"event",node:le,ev:"input",fn:ie}),d.push({type:"event",node:le,ev:"change",fn:ie})})}return}if($.type==="awaitNext"){M._nextBtn&&(M._nextBtn.disabled=!1,M._nextBtn.classList.remove("disabled"));return}if($.type==="clickEither"){let te=$.selectors||[],Q=!1;te.forEach(ie=>{let le=document.querySelector(ie);if(le){let de=()=>B(M);le.addEventListener("click",de,{once:!0}),d.push({type:"event",node:le,ev:"click",fn:de}),Q=!0}}),Q||setTimeout(()=>B(M),1600);return}if($.type==="clickThenNext"){let te=document.querySelector($.clickSelector);if(te){let Q=()=>{M._clicked=!0,M._nextBtn&&(M._nextBtn.disabled=!1,M._nextBtn.classList.remove("disabled"))};te.addEventListener("click",Q,{once:!0}),d.push({type:"event",node:te,ev:"click",fn:Q})}return}if($.type==="eqCanvasClick"){let te=document.querySelector("#eqCanvas");if(te){let Q=()=>{M._nextBtn&&(M._nextBtn.disabled=!1,M._nextBtn.classList.remove("disabled"))};te.addEventListener("click",Q,{once:!0}),d.push({type:"event",node:te,ev:"click",fn:Q})}return}setTimeout(()=>B(M),900)}function P(M=520){return new Promise($=>{if(!n)return $();let K=getComputedStyle(n);if(K.opacity==="0"||K.display==="none"||n.classList.contains("hide"))return setTimeout($,8);let j=!1,te=()=>{j||(j=!0,n.removeEventListener("transitionend",Q),n.removeEventListener("animationend",ie),clearTimeout(le),$())};function Q(de){de.propertyName&&de.propertyName.toLowerCase().includes("opacity")&&te()}function ie(de){te()}n.addEventListener("transitionend",Q),n.addEventListener("animationend",ie);let le=setTimeout(te,M)})}async function B(M){n.classList.remove("show"),n.classList.add("hide"),R(),_();let $=Math.min(t.indexOf(M)+1,t.length-1),K=M.waitFor?.type||"none";if(M.showNext&&(K==="clickThenNext"||K==="awaitNext")){n.classList.remove("hide"),n.classList.add("show");return}if(M.id==="done"){n.classList.remove("hide"),n.classList.add("show");return}await P();try{let j=t[$];j&&b(j)}catch{}y($)}function W(){let M=t[u];if(M.waitFor&&M.waitFor.type==="clickThenNext"&&!M._clicked){n.animate([{transform:"translateX(0)"},{transform:"translateX(-8px)"},{transform:"translateX(8px)"},{transform:"translateX(0)"}],{duration:240});return}n.classList.remove("show"),n.classList.add("hide"),R(),_();let $=Math.min(u+1,t.length-1);P().then(()=>{try{let K=t[$];K&&b(K)}catch{}y($)})}function L(){playingTutorial=!1,R(),_(),localStorage.setItem("tutorialSeen","true");let M=document.getElementById("tutorialDialog"),$=document.querySelector(".tutorial-spotlight"),K=document.getElementById("mouseloop");if($){try{$.remove()}catch{}f=null}K&&(K.style.display="none"),M&&(M.style.display="none");try{setTimeout(()=>{try{G()}catch{}},3e3)}catch(j){console.warn("delayed replay show failed",j)}}document.addEventListener("DOMContentLoaded",()=>{if(!(localStorage.getItem("tutorialSeen")&&!0))playingTutorial=!0,y(0);else{document.getElementById("tutorialDialog").style.display="none";let $=document.querySelector(".tutorial-spotlight");$&&($.style.display="none"),$=document.getElementById("mouseloop"),$&&($.style.display="none")}});function G(){try{if(localStorage.getItem("tutorialReplayHidden")==="true"||document.getElementById("replayTutorialBox"))return;let M=document.createElement("div");M.id="replayTutorialBox",M.style.position="fixed",M.style.top="5px",M.style.right="20px",M.style.zIndex="100005",M.style.display="flex",M.style.alignItems="center",M.style.gap="8px",M.style.padding="8px 10px",M.style.borderRadius="10px",M.style.boxShadow="0 10px 30px rgba(0,0,0,0.35)",M.style.background="rgba(22,22,22,0.95)",M.style.color="#fff",M.style.fontSize="13px",M.style.opacity="0",M.style.transform="translateY(8px)",M.style.transition="opacity 420ms ease, transform 420ms ease",M.style.pointerEvents="auto",M.setAttribute("role","dialog"),M.setAttribute("aria-label","Replay tutorial");let $=document.createElement("button");$.id="replayTutorialBtn",$.type="button",$.textContent="Replay tutorial",$.style.border="none",$.style.padding="6px 10px",$.style.borderRadius="8px",$.style.cursor="pointer",$.style.fontSize="13px",$.style.background="var(--accent-gradient)",$.style.color="#000",$.style.boxShadow="0 6px 18px rgba(31,142,241,0.15)",$.onfocus=()=>$.style.outline="2px solid rgba(255,255,255,0.12)",$.onblur=()=>$.style.outline="none";let K=document.createElement("button");K.id="replayTutorialClose",K.type="button",K.innerHTML="&times;",K.title="Don't show again",K.setAttribute("aria-label","Don't show this again"),K.style.border="none",K.style.background="transparent",K.style.color="rgba(255,255,255,0.9)",K.style.fontSize="16px",K.style.cursor="pointer",K.style.padding="4px",K.style.marginLeft="2px",M.appendChild($),M.appendChild(K),document.body.appendChild(M),requestAnimationFrame(()=>{requestAnimationFrame(()=>{M.style.opacity="1",M.style.transform="translateY(0)"})}),$.addEventListener("click",j=>{j.preventDefault();try{M.style.opacity="0",M.style.transform="translateY(8px)",setTimeout(()=>{try{M.remove()}catch{}},420),playingTutorial=!0;try{y(0),document.getElementById("tutorialDialog").style.display=""}catch(te){console.warn("openStep failed",te)}}catch(te){console.warn("replay click error",te)}}),K.addEventListener("click",j=>{j.preventDefault();try{localStorage.setItem("tutorialReplayHidden","true"),M.style.opacity="0",M.style.transform="translateY(8px)",setTimeout(()=>{try{M.remove()}catch{}},420)}catch(te){console.warn("replay close error",te)}})}catch(M){console.warn("showReplayTutorialBox error",M)}}window.showAppTutorial=function(){localStorage.removeItem("tutorialSeen");let M=document.getElementById("replayTutorialBox");if(M)try{M.remove()}catch{}y(0)},(function(){try{let pe=function(){try{let Ue=document.getElementById("canvas");if(!Ue||Q.x<0)return!1;let tt=Ue.getBoundingClientRect();return Q.x>=tt.left&&Q.x<=tt.right&&Q.y>=tt.top&&Q.y<=tt.bottom}catch{return!1}},Se=function(){ie&&(clearTimeout(ie),ie=null)},Ee=function(Ue){if(de)return;let tt=document.createElement("div");de=!0;try{localStorage.setItem(te,"true")}catch{}let st=document.getElementById("canvas"),je=document.createElement("div");je.id="mouseloop",je.style.position="fixed",je.style.pointerEvents="auto",je.style.cursor="crosshair",je.style.zIndex=1e6,je.style.transition="opacity 1.8s ease",je.style.opacity="1";let Xe=900,at=400;try{if(st){let Pe=st.getBoundingClientRect();Xe=Math.max(8,Math.floor(Pe.left+Pe.width/2-150)),at=Math.max(8,Math.floor(Pe.top+Pe.height/2-150))}}catch{}je.innerHTML=`
                    <img src="click.gif" width="300" height="300"
                        style="opacity:1; filter: drop-shadow(0 6px 14px rgba(0,0,0,0.6));
                        position:fixed; left:${Xe}px; top:${at}px" />`,document.body.appendChild(je);let it=Pe=>{try{je.style.pointerEvents="none";try{canvasMouseDown(Pe,!1)}catch{}}catch{}setTimeout(()=>{je.style.opacity="0",setTimeout(()=>{try{je.remove()}catch{}},800)},3e3)};je.addEventListener("pointerdown",Pe=>it(Pe),{once:!0});let Kt=()=>{try{je.parentElement&&je.remove()}catch{}};window.addEventListener("tutorialStartRemoveMouseloop",Kt,{once:!0})};var $=pe,K=Se,j=Ee;let te="imageMouseLoopShown",Q={x:-1,y:-1},ie=null,le=null,de=!1,we=Ue=>{Q.x=Ue.clientX,Q.y=Ue.clientY};window.addEventListener("mousemove",we,{passive:!0}),window.addEventListener("pointermove",we,{passive:!0});let Ne=()=>{try{return localStorage.getItem(te)==="true"}catch{return!1}};le=window.setInterval(()=>{try{if(de||typeof playingTutorial<"u"&&playingTutorial)return;if(Ne()){de=!0;return}if(typeof currentTool>"u"||currentTool!=="image"||!pe()){Se();return}ie||(ie=setTimeout(()=>{Ee({clientX:Q.x,clientY:Q.y}),ie=null},1e4))}catch(Ue){console.warn("image mouseloop checker error",Ue)}},50),window.addEventListener("beforeunload",()=>{try{Se(),clearInterval(le)}catch{}});let Ge=setInterval(()=>{try{typeof playingTutorial<"u"&&playingTutorial&&window.dispatchEvent(new Event("tutorialStartRemoveMouseloop"))}catch{}},800),Ke=setInterval(()=>{de&&(clearInterval(Ge),clearInterval(Ke))},1e3)}catch(te){console.warn("setupImageToolMouseLoopHint failed",te)}})()})();function dz(r){let e=new ArrayBuffer(r.length*2),t=new DataView(e);for(let n=0;n<r.length;n++){let a=Math.max(-1,Math.min(1,r[n]));t.setInt16(n*2,a<0?a*32768:a*32767,!0)}return t}function vz(r,e,t){let a=e*2;function i(o,s,u){for(let l=0;l<u.length;l++)o.setUint8(s+l,u.charCodeAt(l))}i(r,0,"RIFF"),r.setUint32(4,36+t*2,!0),i(r,8,"WAVE"),i(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,e,!0),r.setUint32(28,a,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),i(r,36,"data"),r.setUint32(40,t*2,!0)}async function bHe(r=typeof curveEQ<"u"&&curveEQ&&curveEQ.bandCount?curveEQ.bandCount:24){if(!pcm)throw new Error("No PCM to render.");let e=sampleRate*.5,t=20,n=e,a=pcm.length,i=Math.pow(n/t,1/Math.max(1,r-1)),o=new Array(r);o[0]=t;for(let d=1;d<r;d++)o[d]=o[d-1]*i;function s(d){try{if(typeof eqCanvas<"u"&&eqCanvas&&typeof evalEQGainAtY=="function"){let v=freqToY(d,eqCanvas.height),m=evalEQGainAtY(v);return m===null?0:xToGain(m,eqCanvas.width)}}catch{}if(Array.isArray(eqBands)&&eqBands.length>0){let v=eqBands[0],m=Math.abs((v.freq||0)-d);for(let g of eqBands){let y=Math.abs((g.freq||0)-d);y<m&&(v=g,m=y)}return v&&typeof v.gain=="number"?v.gain:0}return 0}if(typeof OfflineAudioContext>"u")throw new Error("OfflineAudioContext not supported");let u=new OfflineAudioContext(1,a,sampleRate),l=u.createBuffer(1,a,sampleRate);l.copyToChannel(pcm,0);let c=u.createBufferSource();c.buffer=l;let f=[];for(let d=0;d<r;d++){let v=o[d],m=d===0?v/i:o[d-1],g=d===r-1?v*i:o[d+1],y=Math.max(1e-6,g-m),b=v/y;b=clamp(b,.3,18);let w=s(v),k=u.createBiquadFilter();k.type="peaking",k.frequency.value=Math.min(Math.max(v,1),e-1),k.Q.value=b,k.gain.value=w,f.push(k)}if(f.length===0)c.connect(u.destination);else{c.connect(f[0]);for(let d=0;d<f.length-1;d++)f[d].connect(f[d+1]);f[f.length-1].connect(u.destination)}c.start(0);let h=await u.startRendering(),p=new Float32Array(h.length);return h.copyFromChannel(p,0),p}document.getElementById("downloadWav").addEventListener("click",async()=>{if(!pcm)return alert("No PCM loaded!");try{let r=typeof curveEQ<"u"&&curveEQ&&curveEQ.bandCount?curveEQ.bandCount:24,e=await bHe(r),t=e.length,n=new ArrayBuffer(44+t*2),a=new DataView(n);vz(a,sampleRate,t);let i=dz(e);for(let l=0;l<i.byteLength;l++)a.setUint8(44+l,i.getUint8(l));let o=new Blob([a],{type:"audio/wav"}),s=URL.createObjectURL(o),u=document.createElement("a");u.href=s,u.download="output.wav",u.click(),setTimeout(()=>URL.revokeObjectURL(s),1e3)}catch(r){console.warn("EQ render failed or unsupported \u2014 falling back to raw PCM download:",r);let e=pcm.length,t=new ArrayBuffer(44+e*2),n=new DataView(t);vz(n,sampleRate,e);let a=dz(pcm);for(let u=0;u<a.byteLength;u++)n.setUint8(44+u,a.getUint8(u));let i=new Blob([n],{type:"audio/wav"}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download="output.wav",s.click(),setTimeout(()=>URL.revokeObjectURL(o),1e3)}});document.getElementById("downloadSpectrogram").addEventListener("click",function(){let r=iLow;oih=iHigh,ofl=fLow,ofh=fHigh,iLow=0,iHigh=framesTotal,fLow=0,fHigh=sampleRate/2,updateCanvasScroll();let e=canvas.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download="spectrodraw.png",t.click(),t.remove(),iLow=r,iHigh=oih,fLow=ofl,fHigh=ofh});function mz(r,e,t={}){if(!pcm||!mags||!phases||(r=Math.max(0,Math.floor(r)),e=Math.min(specWidth-1,Math.floor(e)),e<r))return;let n=Math.ceil(fftSize/hop)+2,a=Math.max(0,r-n),i=Math.min(specWidth-1,e+n),o=Math.max(0,a*hop),s=Math.min(pcm.length,i*hop+fftSize),u=s-o;if(u<=0)return;let l=t&&t.oldMags&&t.oldPhases,c=specHeight,f=typeof win<"u"&&win&&win.length===fftSize?win:(function(){let k=new Float32Array(fftSize);for(let S=0;S<fftSize;S++)k[S]=.5*(1-Math.cos(2*Math.PI*S/(fftSize-1)));return k})();function h(w,k,S,E){let N=new Float32Array(fftSize),C=new Float32Array(fftSize);for(let _=0;_<u;_++)S[_]=0,E[_]=0;for(let _=a;_<=i;_++){N.fill(0),C.fill(0);for(let P=0;P<c&&P<fftSize;P++){let B=_*c+P,W=w[B]||0,L=k[B]||0;if(N[P]=W*Math.cos(L),C[P]=W*Math.sin(L),P>0&&P<fftSize/2){let G=fftSize-P;N[G]=N[P],C[G]=-C[P]}}if(C[0]=0,fftSize%2===0&&(C[fftSize/2]=0),typeof ifft_inplace=="function")ifft_inplace(N,C);else if(typeof fft_inplace=="function")fft_inplace(N,C,!0);else throw new Error("No inverse FFT function available (replace with your ifft call).");let O=_*hop;for(let P=0;P<fftSize;P++){let B=O+P;if(B<o||B>=s)continue;let W=B-o;S[W]+=N[P]*f[P],E[W]+=f[P]*f[P]}}let R=1e-8;for(let _=0;_<u;_++)E[_]>R?S[_]/=E[_]:S[_]=0}if(l){let w=t.oldMags,k=t.oldPhases,S=new Float32Array(u),E=new Float32Array(u),N=new Float32Array(u),C=new Float32Array(u);h(mags,phases,S,E),h(w,k,N,C);for(let R=0;R<u;R++)pcm[o+R]=(pcm[o+R]||0)+(S[R]-N[R]);gk(a,i),playing&&(stopSource(!0),playPCM(!0));return}let p=new Float32Array(u),d=new Float32Array(u),v=new Float32Array(fftSize),m=new Float32Array(fftSize);for(let w=a;w<=i;w++){v.fill(0),m.fill(0);for(let S=0;S<c&&S<fftSize;S++){let E=w*c+S,N=mags[E]||0,C=phases[E]||0;if(v[S]=N*Math.cos(C),m[S]=N*Math.sin(C),S>0&&S<fftSize/2){let R=fftSize-S;v[R]=v[S],m[R]=-m[S]}}m[0]=0,fftSize%2===0&&(m[fftSize/2]=0),ifft_inplace(v,m);let k=w*hop;for(let S=0;S<fftSize;S++){let E=k+S;if(E<o||E>=s)continue;let N=E-o;p[N]+=v[S]*f[S],d[N]+=f[S]*f[S]}}let g=1e-8;for(let w=0;w<u;w++)d[w]>g?p[w]/=d[w]:p[w]=0;let y=pcm.slice(o,s),b=Math.min(Math.max(1,hop),128);for(let w=0;w<b;w++){let k=w/b;p[w]=p[w]*k+y[w]*(1-k);let S=u-1-w;if(S>=0&&S<u){let E=y.length-1-w;p[S]=p[S]*k+y[E]*(1-k)}}pcm.set(p,o),gk(a,i),playing&&(stopSource(!0),playPCM(!0))}function gk(r,e){if(r=Math.max(0,Math.floor(r)),e=Math.min(specWidth-1,Math.floor(e)),!imageBuffer||!specCtx)return;let t=specHeight,n=specWidth;for(let a=r;a<=e;a++)for(let i=0;i<t;i++){let o=displayYToBin(i,t),s=a*t+o,u=mags[s]||0,l=phases[s]||0,[c,f,h]=magPhaseToRGB(u,l),p=(i*n+a)*4;imageBuffer.data[p]=c,imageBuffer.data[p+1]=f,imageBuffer.data[p+2]=h,imageBuffer.data[p+3]=255}specCtx.putImageData(imageBuffer,0,0,r,0,e-r+1,specHeight),renderView(),drawCursor()}document.addEventListener("keydown",r=>{let e=r.key.toLowerCase();(r.ctrlKey||r.metaKey)&&e==="z"?(r.preventDefault(),r.shiftKey?yk():gz()):(r.ctrlKey||r.metaKey)&&e==="y"&&(r.preventDefault(),yk())});document.getElementById("undoBtn").addEventListener("click",()=>{gz()});document.getElementById("redoBtn").addEventListener("click",()=>{yk()});async function gz(){if(historyStack.length===0){console.log("Nothing to undo");return}let r=historyStack.pop(),e=r.maxCols??r.maxSize??r.maxSizeCols??null;if(r.type==="paint"){let t=r.indices,n=r.prevMags,a=r.prevPhases,i=t.length,o=new Float32Array(i),s=new Float32Array(i);for(let f=0;f<i;f++){let h=t[f];o[f]=mags[h]||0,s[f]=phases[h]||0}for(let f=0;f<i;f++){let h=t[f];mags[h]=n[f],phases[h]=a[f]}let u=Math.max(0,r.minCol??0),l=Math.max(r.maxCol??0,specWidth-1),c=Math.min(specWidth-1,l);for(mz(u,c),restartRender(!1),iLow=0,iHigh=specWidth,updateCanvasScroll();redoStack.length>=MAX_HISTORY_ENTRIES;)redoStack.shift();redoStack.push({type:"paint",indices:t,nextMags:o,nextPhases:s,minCol:u,maxCol:c,maxCols:e,hopSize:r.hopSize,fftSize:r.fftSize}),playing&&(stopSource(!0),playPCM(!0))}else console.warn("Unknown history entry type:",r.type)}async function yk(){if(redoStack.length===0){console.log("Nothing to redo");return}let r=redoStack.pop(),e=r.maxCols??r.maxSize??null;if(r.type==="paint"){let t=r.indices,n=r.nextMags,a=r.nextPhases,i=t.length,o=new Float32Array(i),s=new Float32Array(i);for(let c=0;c<i;c++){let f=t[c];o[c]=mags[f]||0,s[c]=phases[f]||0}for(let c=0;c<i;c++){let f=t[c];mags[f]=n[c],phases[f]=a[c]}let u=Math.max(0,r.minCol??0),l=Math.min(specWidth-1,r.maxCol??specWidth-1);gk(u,l),mz(u,l),pushHistory({type:"paint",indices:t,prevMags:o,prevPhases:s,minCol:u,maxCol:l,maxCols:e??specWidth,hopSize:r.hopSize,fftSize:r.fftSize},!1),playing&&(stopSource(!0),playPCM(!0))}else console.warn("Unknown redo entry type:",r.type)}function bk(){toolButtons.forEach(r=>{r.classList.toggle("active",r.dataset.tool===currentTool),r.style.background=r.dataset.tool===currentTool?"#4af":"var(--accent-gradient)"}),currentTool==="image"&&overlayFile.click(),updateBrushPreview()}function yz(){updateGlobalGain(),updateEQ(),scheduleDraw()}function wHe(r,e,t=void 0,n=void 0){let a=r*specHeight+e;mags[a]=t,phases[a]=n;let i=binToDisplayY(e-.5,specHeight),o=binToDisplayY(e+.5,specHeight),s=Math.min(i,o),u=Math.max(i,o),l=Math.max(0,Math.floor(s)),c=Math.min(specHeight-1,Math.ceil(u)),[f,h,p]=magPhaseToRGB(mags[a],phases[a]);for(let d=l;d<=c;d++){let v=(d*specWidth+r)*4;imageBuffer.data[v]=f,imageBuffer.data[v+1]=h,imageBuffer.data[v+2]=p,imageBuffer.data[v+3]=255}}function xHe(){iLow=0,iHigh=framesTotal,iWidth=iHigh-iLow,updateCanvasScroll(),drawTimeline(),ha()}function kHe(){fLow=0,fHigh=sampleRate/2,fWidth=fHigh-fLow,drawYAxis(),ha()}var wk=document.createElement("div");document.body.appendChild(wk);function ip(r){let e=document.createElement("div");return e.className="ctx-menu",e.addEventListener("mouseleave",()=>{ha()}),r.forEach(t=>{if(t.type==="separator"){let s=document.createElement("div");s.className="ctx-sep",e.appendChild(s);return}let n=document.createElement("div");n.className="ctx-item",t.group&&(n.dataset.group=t.group),typeof t.value<"u"&&(n.dataset.value=String(t.value));let a=document.createElement("div");a.className="ctx-label";let i=document.createElement("div");t.type==="toggle"||t.type==="check"?(i.className="ctx-check"+(t.checked?" checked":""),i.innerHTML=t.checked?"\u2713":""):t.type==="radio"?(i.className="ctx-radio"+(t.checked?" selected":""),i.style.width="18px",i.style.display="inline-flex",i.style.alignItems="center",i.style.justifyContent="center",i.innerHTML=t.checked?"\u2713":""):i.style.width="18px";let o=document.createElement("div");if(o.textContent=t.label,o.style.flex="1",o.style.fontWeight=t.bold?"600":"500",a.appendChild(i),a.appendChild(o),t.rightText){let s=document.createElement("div");s.textContent=t.rightText,s.style.opacity=.8,a.appendChild(s)}if(n.appendChild(a),t.desc){let s=document.createElement("div");s.className="ctx-desc",s.textContent=t.desc,n.appendChild(s)}if(t.submenu&&Array.isArray(t.submenu)){let s=document.createElement("div");s.className="ctx-submenu",t.submenu.forEach(u=>{let l=document.createElement("div");l.className="ctx-item";let c=document.createElement("div");c.className="ctx-label";let f=document.createElement("div");f.style.width="18px";let h=document.createElement("div");if(h.textContent=u.label,c.appendChild(f),c.appendChild(h),l.appendChild(c),u.desc){let p=document.createElement("div");p.className="ctx-desc",p.textContent=u.desc,l.appendChild(p)}s.appendChild(l)}),n.appendChild(s)}if(t.type==="input"){let s=document.createElement("input");s.className="ctx-input",s.value=t.value??"",s.placeholder=t.placeholder??"",s.addEventListener("keydown",u=>{u.key==="Enter"?(t.onConfirm&&t.onConfirm(s.value),ha()):u.key==="Escape"&&ha()}),n.appendChild(s),setTimeout(()=>s.focus(),30)}n.addEventListener("click",s=>{if(s.stopPropagation(),t.type==="toggle"||t.type==="check")t.checked=!t.checked,i&&(i.classList.toggle("checked",t.checked),i.innerHTML=t.checked?"\u2713":""),t.onToggle&&t.onToggle(t.checked);else if(t.type==="radio")if(t.group){r.forEach(c=>{c.type==="radio"&&c.group===t.group&&(c.checked=c===t)});let u=t.group,l=typeof t.value>"u"?"":String(t.value);e.querySelectorAll(".ctx-item").forEach(c=>{if(c.dataset.group===u){let f=c.querySelector(".ctx-radio, .ctx-radio-dot, .ctx-check");if(!f)return;let p=(c.dataset.value??"")===l;f.classList.toggle("selected",p),f.innerHTML=p?"\u2713":""}}),t.checked=!0,t.onSelect&&t.onSelect(t.value)}else t.onClick&&t.onClick();else t.onClick&&t.onClick()}),e.appendChild(n)}),e}function SHe(r,e,t){ha(),wk.appendChild(r);let n=8,a=r.getBoundingClientRect(),i=document.documentElement.clientWidth,o=document.documentElement.clientHeight;e+a.width+n>i&&(e=i-a.width-n),t+a.height+n>o&&(t=o-a.height-n),r.style.left=e+"px",r.style.top=t+"px",setTimeout(()=>{document.addEventListener("click",bz),document.addEventListener("keydown",wz)},0)}function ha(){wk.innerHTML="",document.removeEventListener("click",bz),document.removeEventListener("keydown",wz)}function bz(r){ha()}function wz(r){r.key==="Escape"&&ha()}var EHe=["brush","rectangle","line","blur","eraser","amplifier","image"];function THe(r,e){let t=canvas.getBoundingClientRect(),n=r*canvas.width/t.width+iLow,a=e*canvas.height/t.height,i=0,o=0,s=-1,u=0,l=-200,c=0;try{i=getSineFreq(visibleToSpecY(a)),o=Math.floor(n/(Number(sampleRate)/Number(hopSizeEl.value))*1e4)/1e4;let C=Math.floor(n),R=Math.floor(i/(sampleRate/fftSize));s=C*(specHeight||1)+R,u=Math.min(1,mags[s]/256),l=u>0?20*Math.log10(u):-200,c=Number(phases[s])||0}catch(C){console.warn(C)}let f=[{label:"",onClick:null},{type:"separator"},{type:"input",label:"Magnitude",value:u},{type:"input",label:"dB",value:l},{type:"input",label:"Phase",value:c},{type:"separator"},...EHe.map(C=>({type:"radio",label:C[0].toUpperCase()+C.slice(1),group:"tool",value:C,checked:currentTool===C,onSelect:R=>{currentTool=R,bk()}})),{type:"separator"},{type:"toggle",label:"Align pitch",checked:alignPitch,onToggle:C=>{alignPitch=C,bk()}},{type:"toggle",label:"Align time",checked:alignTime,onToggle:C=>{alignTime=C,bk()}},{label:"Remove harmonics",onClick:()=>removeHarmonics()}],h=ip(f);h.firstChild&&(h.firstChild.innerHTML=`
      <div class="ctx-label" style="font-weight:600;font-size:13px">
        Pitch: ${i?i.toFixed(0)+"hz":"\u2014"} ${typeof hzToNoteName=="function"?"("+hzToNoteName(i)+")":""}
      </div>
      <div class="ctx-label" style="opacity:.85;font-size:12px">Time: ${o}</div>
    `,Object.assign(h.firstChild.style,{pointerEvents:"none",padding:"6px 8px",margin:"0 0 4px 0"}));let p=Array.from(h.querySelectorAll(".ctx-input")),[d,v,m]=[p[0].closest(".ctx-item"),p[1].closest(".ctx-item"),p[2].closest(".ctx-item")];d.innerHTML=`<div class="slider-row2">
    <label>Magnitude</label>
    <input type="range" class="mag-slider" min="0" max="128" step="0.1" value="${u}" style="position:absolute;left:70px;width:60px;">
    <input type="number" class="ctx-input" step="0.001" min="0" max="128" value="${u}" style="flex:0 0 70px;margin-left:auto">
  </div>`,v.innerHTML=`<div class="slider-row2">
    <label>dB</label>
    <input type="number" class="ctx-input" step="0.1" value="${isFinite(l)&&l>-199?l.toFixed(1):"-\u221E"}" style="flex:0 0 70px;margin-left:auto">
  </div>`,m.innerHTML=`
    <div class="slider-row2">
      <label>Phase</label>
      <input type="range" class="phase-slider" min="${-Math.PI}" max="${Math.PI}" step="0.001" style="flex:0 0 120px;margin-left:8px">
      <input type="number" class="ctx-input" id="phase-num-input" step="0.001" min="${-Math.PI}" max="${Math.PI}" style="flex:0 0 70px;margin-left:8px" value="${c.toFixed(3)}">
    </div>`;let g=d.querySelector(".ctx-input"),y=d.querySelector(".mag-slider"),b=v.querySelector(".ctx-input"),w=m.querySelector(".phase-slider"),k=m.querySelector(".ctx-input");w.value=k.value=c;let S=C=>{let R=Math.max(Number(C)||0,1e-9);return 20*Math.log10(R/256)},E=C=>isFinite(Number(C))?Math.min(1,Math.pow(10,Number(C)/20))*256:0,N=()=>requestAnimationFrame(()=>{let C=Math.max(0,Math.min(128,Number(g.value)||0)),R=Math.max(-Math.PI,Math.min(Math.PI,Number(k.value)||0)),_=Math.floor(i/(sampleRate/fftSize));wHe(Math.floor(n),_,C,R),specCtx.putImageData(imageBuffer,0,0),pos=Math.floor(n)*hop,autoRecomputePCM(Math.floor(n),Math.floor(n)),drawFrame(specWidth,specHeight)});return g.addEventListener("input",()=>{b.value=S(g.value).toFixed(1),N()}),y.addEventListener("input",C=>{g.value=Number(C.target.value),b.value=S(g.value).toFixed(1),N()}),b.addEventListener("input",()=>{g.value=E(b.value).toFixed(3),N()}),w.addEventListener("input",C=>{k.value=Number(C.target.value).toFixed(3),N()}),k.addEventListener("input",()=>{let C=Math.max(-Math.PI,Math.min(Math.PI,Number(k.value)||0));k.value=C.toFixed(3),w.value=C,N()}),h}function IHe(){let r=sampleRate/hopSizeEl.value,e=iLow/r,t=iHigh/r,a=ip([{label:"Zoom to fit",onClick:()=>xHe()},{type:"separator"},{type:"input",label:"Set min",value:e},{type:"input",label:"Set max",value:t}]),i=Array.from(a.querySelectorAll(".ctx-input")),o=i[0]?.closest(".ctx-item"),s=i[1]?.closest(".ctx-item");function u(c,f){return`
      <div class="slide-row2" style="display:flex;align-items:center;gap:8px">
        <label style="flex:1">${c}</label>
        <input type="number" class="ctx-input timeline-sec-input" step="0.01" min="0" value="${isFinite(f)?f:"0"}"
          style="flex:0 0 90px;
                 border-radius:6px;
                 background-color:#333;
                 color:#fff;
                 border:1px solid #aaa;
                 padding:2px 6px">
      </div>`}o&&(o.innerHTML=u("Set min",e)),s&&(s.innerHTML=u("Set max",t));function l(c,f){if(!c)return;let h=c.querySelector(".timeline-sec-input");h.addEventListener("blur",()=>apply(h.value)),h.addEventListener("keydown",p=>{p.key==="Enter"&&(f?h.value>=0?iLow=Math.floor(h.value*r):h.value=0:h.value<=specWidth/r?iHigh=Math.floor(h.value*r):h.value=specWidth/r),p.key==="Escape"&&ha()}),h.addEventListener("keydown",p=>{p.key==="Escape"&&ha()})}return l(o,!0),l(s,!1),a}function NHe(r){let e=Math.log(1+(logScaleVal-.999999999)*specHeight),t=Math.log(1+(logScaleVal-.999999999)*(r/(sampleRate/fftSize)))/e;return Math.floor(t*sampleRate/2)}function Vm(r){let e=Math.log(1+(logScaleVal-.999999999)*specHeight),t=2*r/sampleRate;return Math.floor(sampleRate/fftSize*(Math.exp(t*e)-1)/(logScaleVal-.999999999))}function CHe(){let r=[{type:"check",label:"Show Hz / Note",checked:useHz},{label:"Zoom to fit",onClick:()=>kHe()},{type:"separator"},{type:"input",label:"Set min",value:Vm(fLow)},{type:"input",label:"Set max",value:Vm(fHigh)},{type:"separator"},{type:"input",label:"Logscale",value:Number(logscaleEl.value)}],e=ip(r),t=Array.from(e.querySelectorAll(".ctx-input")),n=t[0]?.closest(".ctx-item"),a=t[1]?.closest(".ctx-item"),i=t[2]?.closest(".ctx-item");function o(l,c,f=0,h=100,p=.01){return`
      <div class="slide-row2" style="display:flex;align-items:center;gap:8px">
        <label style="wrap:nowrap;">${l}</label>
        <input type="range" class="ctx-slider" min="${f}" max="${h}" step="${p}" value="${c}" style="flex:1; width:50px">
        <input type="number" class="ctx-input" value="${c}" step="${p}" min="${f}" max="${h}"
          style="flex:0 0 70px;
                 border-radius:6px;
                 background-color:#333;
                 color:#fff;
                 border:1px solid #aaa;
                 padding:2px 6px">
      </div>`}n&&(n.innerHTML=o("Set min",Vm(fLow),0,fHigh,1)),a&&(a.innerHTML=o("Set max",Vm(fHigh),fLow,sampleRate/2,1)),i&&(i.innerHTML=o("Log scale",Number(logScaleVal),1,2,.01));function s(l,c,f,h,p){if(!l)return;let d=l.querySelector(".ctx-slider"),v=l.querySelector(".ctx-input"),m=g=>{let y=Math.max(h,Math.min(p,Number(g)));f(NHe(y)),d.value=v.value=y,drawYAxis()};d.addEventListener("input",g=>m(g.target.value)),v.addEventListener("blur",()=>m(v.value)),v.addEventListener("keydown",g=>{g.key==="Enter"&&m(v.value),g.key==="Escape"&&ha()})}s(n,()=>fLow,l=>{fLow=l,l>fHigh&&(fHigh=l)},0,fHigh),s(a,()=>fHigh,l=>{fHigh=l,l<fLow&&(fLow=l)},fLow,sampleRate/2),s(i,()=>Number(logscaleEl.value),l=>{logscaleEl.value=l,logScaleVal=l,logscaleEl.dispatchEvent&&logscaleEl.dispatchEvent(new Event("change")),buildBinDisplayLookup(),restartRender(),drawYAxis()},1,2);let u=e.querySelector(".ctx-item");return u&&u.addEventListener("click",l=>{l.stopPropagation(),useHz=!useHz;let c=u.querySelector(".ctx-check");c&&(c.classList.toggle("checked",useHz),c.innerHTML=useHz?"\u2713":""),drawYAxis()}),e}function AHe(){let r=logScaleVal,t=ip([{type:"input",label:"Logscale",value:r},{label:"Reset",onClick:()=>o(1.12)}]),n=t.querySelector(".ctx-item");if(!n)return t;n.innerHTML=`
    <div class="slide-row2" style="display:flex;align-items:center;gap:8px">
      <label style="flex:1">Logscale</label>
      <input type="range" class="ctx-slider" min="1" max="2" step="0.01" value="${r}" style="flex:1; width:50px">
      <input type="number" class="ctx-input" value="${r}" step="0.01" min="1" max="2"
        style="flex:0 0 70px;
               border-radius:6px;
               background-color:#333;
               color:#fff;
               border:1px solid #aaa;
               padding:2px 6px">
    </div>
  `;let a=n.querySelector(".ctx-slider"),i=n.querySelector(".ctx-input"),o=s=>{let u=Math.max(1,Math.min(2,Number(s)));logscaleEl.value=u,logScaleVal=u,a.value=i.value=u,logscaleEl.dispatchEvent&&logscaleEl.dispatchEvent(new Event("change")),buildBinDisplayLookup(),drawYAxis(),restartRender()};return a.addEventListener("input",s=>o(s.target.value)),i.addEventListener("blur",()=>o(i.value)),i.addEventListener("keydown",s=>{s.key==="Enter"&&o(i.value),s.key==="Escape"&&ha()}),t}function _He(r,e){let t=EQcanvas.height,n=EQcanvas.width;return ip([{label:"Add point",onClick:()=>{let s={type:"peaking",freq:yToFreq(e,t),gain:xToGain(r,n),Q:1,angle:Math.PI/2,tLen:60},u=eqBands.findIndex(l=>l.freq>s.freq);u===-1&&(u=eqBands.length),eqBands.splice(u,0,s),yz()}},{label:"Remove point",onClick:()=>{let s={x:r,y:e},u=findHit(s);u&&u.type==="point"&&(eqBands.splice(u.index,1),yz())}}])}function op(r,e){r.preventDefault(),r.stopPropagation();let t=e(r.clientX,r.clientY);SHe(t,r.clientX,r.clientY)}canvas&&canvas.addEventListener("contextmenu",r=>{let e=canvas.getBoundingClientRect(),t=Math.floor(r.clientX-e.left),n=Math.floor(r.clientY-e.top);op(r,()=>THe(t,n))});timeline&&timeline.addEventListener("contextmenu",r=>op(r,IHe));yAxis&&yAxis.addEventListener("contextmenu",r=>op(r,CHe));logscaleEl&&logscaleEl.addEventListener("contextmenu",r=>op(r,AHe));EQcanvas&&EQcanvas.addEventListener("contextmenu",r=>{let e=EQcanvas.getBoundingClientRect(),t=Math.floor(r.clientX-e.left),n=Math.floor(r.clientY-e.top);op(r,()=>_He(t,n))});window.addEventListener("resize",ha);window.addEventListener("scroll",ha,!0);[canvas,timeline,yAxis,EQcanvas].forEach(r=>{r&&r.addEventListener("mousedown",e=>{e.preventDefault()})});var lp=!1,sp=null,up=null,Um=null,Gm=null;function DHe(r){let e=document.getElementById("countdown-overlay");e||(e=document.createElement("div"),e.id="countdown-overlay",document.body.appendChild(e),Object.assign(e.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"10rem",fontWeight:"bold",color:"white",textAlign:"center",pointerEvents:"none",zIndex:9999,opacity:1,transition:"opacity 0.3s ease-out"})),e.textContent=r,e.style.opacity=1,setTimeout(()=>e.style.opacity=0,700)}function FHe(r){return new Promise(e=>{let t=r,n=new Audio("beep.mp3");n.load();function a(){if(!lp)return e();t>0?(DHe(t),info.innerHTML=`Recording in ${t}<br><br>`,n.currentTime=0,n.play(),t--,setTimeout(a,1e3)):e()}a()})}async function RHe(){if(xk(),fHigh=sampleRate/2,fWidth=fHigh,stopSource(),new Audio("beep.mp3").load(),await FHe(3),status.textContent="Recording...",recordBtn.innerHTML=recHTML,!!lp){pcmChunks=[],pcm=new Float32Array(0),pos=0,x=0,rendering=!1;try{sp=await navigator.mediaDevices.getUserMedia({audio:!0}),up=ni.createMediaStreamSource(sp),await ni.resume(),sampleRate=ni.sampleRate||sampleRate;let e=new Blob([WORKLET_CODE],{type:"application/javascript"}),t=URL.createObjectURL(e);await ni.audioWorklet.addModule(t),Gm=new AudioWorkletNode(ni,"recorder-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[1],channelCount:1}),pcmChunks=[],pcm=new Float32Array(0),Gm.port.onmessage=a=>{let i=a.data;if(!(i instanceof Float32Array))return;try{pcmChunks.push(i)}catch{}let o=0;for(let c of pcmChunks)o+=c.length;let s=new Float32Array(o),u=0;for(let c of pcmChunks)s.set(c,u),u+=c.length;pcm=s,processPendingFramesLive(),iLow=0;let l=Math.max(1,Math.floor((pcm.length-fftSize)/hop)+1);iHigh=Math.max(1e3,l),updateCanvasScroll(),info.innerHTML=`Recording...<br>${(l/(sampleRate/hopSizeEl.value)).toFixed(1)} secs<br>Press record or ctrl+space to stop`};let n=ni.createGain();n.gain.value=0,up.connect(Gm),Gm.connect(n),n.connect(ni.destination)}catch(e){console.error("Mic error:",e),status.textContent="Microphone access denied.",xz()}}}function xz(){if(recordBtn.innerHTML=micHTML,lp=!1,status.textContent="Recording stopped.",info.textContent="",Um&&(Um.disconnect(),Um.onaudioprocess=null,Um=null),up&&(up.disconnect(),up=null),sp&&(sp.getTracks().forEach(e=>e.stop()),sp=null),pcm&&Array.isArray(pcm)){let e=pcm.reduce((a,i)=>a+i.length,0),t=new Float32Array(e),n=0;for(let a of pcm)t.set(a,n),n+=a.length;pcm=t}iLow=null,pcmChunks=null;let r=pcm.length/sampleRate;hopSizeEl.value=r<.5?128:r<5?512:1024,restartRender(!0)}recordBtn.addEventListener("click",async()=>{lp?xz():(lp=!0,await RHe())});var ni=null;function xk(){ni||(ni=new(window.AudioContext||window.webkitAudioContext)),sampleRate=ni.sampleRate||sampleRate}fileEl.addEventListener("change",async r=>{let e=r.target.files[0];if(!e)return;let t=await e.arrayBuffer();snapshotMags=mags,snapshotPhases=phases,xk(),fHigh=sampleRate/2,fWidth=fHigh;let n;try{n=await ni.decodeAudioData(t.slice(0)),pcm=new Float32Array(n.getChannelData(0)),sampleRate=n.sampleRate||48e3,status.textContent=`Loaded ${e.name}, ${pcm.length} samples @ ${sampleRate} Hz`,status.style.display="block",await restartRender(!0);let a=pcm.length/sampleRate;hopSizeEl.value=a<.5?128:a<5?512:1024,iLow=0,iHigh=framesTotal}catch{alert("Error decoding video. Please try a different video.")}});preset.addEventListener("change",async r=>{let e=r.target.value;if(e==="silence"){initEmptyPCM();return}let n={dog:"presets/dog.wav",flute:"presets/flute.wav",trumpet:"presets/trumpet.wav",bomb:"presets/bomb.wav",male:"presets/male.wav",female:"presets/female.wav",birdChirp:"presets/birdChirp.mp3",lionRoar:"presets/lionRoar.wav",seaLion:"presets/seaLion.mp3",violin:"presets/violin.mp3",timpani:"presets/timpani.wav",piano:"presets/piano.ogg",cymbal:"presets/cymbal.wav",computerBeeps:"presets/computerBeeps.mp3",scream:"presets/scream.mp3",engine:"presets/engine.mp3",fullSpectra:"presets/fullSpectra.wav",bass808:"presets/808bass.wav",hardstyle:"presets/hardstyle.wav",kick:"presets/kick.wav",hihat:"presets/hihat.wav",clap:"presets/clap.wav",cave14:"presets/cave14.mp3",sine:"presets/sine.wav",triangle:"presets/triangle.wav",square:"presets/square.wav",saw:"presets/saw.wav"}[e];if(!n){console.warn("No URL defined for preset:",e);return}try{status.textContent=`Loading preset "${e}"\u2026`,xk();let a=await fetch(n);if(!a.ok)throw new Error(`Failed to fetch ${n}: ${a.status}`);let i=await a.arrayBuffer(),o=await ni.decodeAudioData(i.slice(0));pcm=new Float32Array(o.getChannelData(0)),sampleRate=o.sampleRate||sampleRate,status.textContent=`Loaded preset "${e}", ${pcm.length} samples @ ${sampleRate} Hz`;let s=pcm.length/sampleRate;hopSizeEl.value=lockHop?Math.pow(2,fftSizeEl.value):s<.5?128:s<5?512:1024,restartRender(!0),iLow=0,iHigh=framesTotal}catch(a){console.error("Preset load error:",a),status.textContent="Error loading preset: "+(a.message||a)}});var Ft=document.getElementById("timeline"),vr=Ft.getContext("2d"),W6e=Ft.width;var ls=0,Hm=!1,cp=!1,To=-1,kk=null,Aa=iHigh-iLow;function Ac(){vr.clearRect(0,0,Ft.width,Ft.height),vr.fillStyle="#333",vr.fillRect(0,0,Ft.width,Ft.height);let r=20,e=(ls-iLow)*Ft.width/(iHigh-iLow),t=ls*Ft.width/framesTotal;if(vr.fillStyle="#0f0",vr.beginPath(),vr.moveTo(e,r+10),vr.lineTo(e-r,10),vr.lineTo(e+r,10),vr.closePath(),vr.fill(),!pcm)return;Aa=iHigh-iLow;let n=Aa*hopSizeEl.value/sampleRate,a=.01;n>.3&&(a=.1),n>1&&(a=.3),n>3&&(a=1),n>10&&(a=3),n>30&&(a=10),n>100&&(a=30),vr.fillStyle="#eee",vr.font="15px sans-serif",vr.textAlign="center",vr.textBaseline="top";let i=Ft.width/framesTotal,o=iHigh-iLow,s=hopSizeEl.value/sampleRate,u=iLow*s,l=iHigh*s,c=Math.ceil(u/a)*a;for(let f=c;f<=l;f+=a){let p=(f/s-iLow)/o*Ft.width,d=Ft.width/Ft.getBoundingClientRect().width;vr.save(),vr.scale(d,1),vr.fillText(f.toFixed(a<1?2:a<10?1:0),p/d,25),vr.restore()}vr.fillStyle="#222",vr.fillRect(0,0,Ft.width,20),vr.fillStyle="#555",vr.fillRect(iLow*i,0,(iHigh-iLow)*i,20),vr.strokeStyle="#777",vr.strokeRect(iLow*i,0,(iHigh-iLow)*i,20),vr.fillStyle="#af0",vr.fillRect(t-1,0,2,20)}function kz(r){return iLow+r/Ft.getBoundingClientRect().width*Aa}function Sz(r,e){if(r.button!==0)return;let t=Ft.getBoundingClientRect();(e?r.touches[0].clientY:r.clientY)-t.top>20?(Hm=!0,wasPlayingDuringDrag=playing,stopSource(!0),ls=kz(r.clientX-t.left),currentCursorX=ls,Ac(),_c(),drawLogScale(),drawCursor(!0)):(cp=!0,kk=(e?r.touches[0].clientX:r.clientX)-t.left,Aa=iHigh-iLow)}Ft.addEventListener("mousedown",r=>{Sz(r,!1)});Ft.addEventListener("touchstart",r=>{Sz(r,!0)});function Ez(r,e){let t=sampleRate/hopSizeEl.value/Aa;t>2?subBeat=16:t>1?subBeat=8:t>.5?subBeat=4:t>1/4?subBeat=2:t>1/8?subBeat=1:subBeat=1/2;let n=Ft.getBoundingClientRect(),a=(e?r.touches[0].clientY:r.clientY)-n.top,i=(e?r.touches[0].clientX:r.clientX)-n.left;if(a>20&&To==-1){if(Ft.style.cursor="pointer",!Hm)return;ls=kz(i),currentCursorX=ls}else{let o=iLow*n.width/framesTotal,s=iHigh*n.width/framesTotal;if(Aa=iHigh-iLow,Math.abs(i-o)<15&&To==-1||To===0){if(Ft.style.cursor="e-resize",!cp)return;updateCanvasScroll(),To=0,iLow=i/n.width*framesTotal,iLow<0&&(iLow=0),iLow>iHigh&&(iLow=iHigh-1)}else if(Math.abs(i-s)<15&&To==-1||To==1){if(Ft.style.cursor="w-resize",!cp)return;updateCanvasScroll(),To=1,iHigh=i/n.width*framesTotal,iHigh>framesTotal&&(iHigh=framesTotal),iHigh<iLow&&(iHigh=iLow+1)}else{if(Ft.style.cursor="move",!cp)return;updateCanvasScroll(),To=2;let u=(i-kk)/n.width*framesTotal;iLow+=u,iLow<0&&(iLow=0),iHigh>framesTotal&&(iLow=framesTotal-Aa),iHigh=iLow+Aa,kk=i}}Ac(),_c(),drawLogScale(),drawCursor(!1)}window.addEventListener("mousemove",r=>{Ez(r,!1)});window.addEventListener("touchmove",r=>{Ez(r,!0)});function Tz(r){if(To=-1,cp=!1,!Hm)return;Hm=!1;let e=ls;pausedAtSample=e*hop,wasPlayingDuringDrag?(playPCM(!0,e),document.getElementById("playPause").innerHtml=`
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="black" viewBox="0 0 20 20">
        <rect x="2" y="0" width="5" height="18" rx="2" ry="2"/>
        <rect x="12" y="0" width="5" height="18" rx="2" ry="2"/>
      </svg>
        `):(specCtx.putImageData(imageBuffer,0,0),renderView(),drawCursor(!0)),Ac(),drawLogScale(),_c()}window.addEventListener("mouseup",r=>{Tz(r)});window.addEventListener("touchend",r=>{Tz(r)});fLow=0;fHigh=sampleRate/2;var Xi=fHigh-fLow,Ic=!1,Io=-1,Sk=null;function _c(){if(yAxis.height<=0||yAxis.width<=0)return;yctx.clearRect(15,0,25,yAxis.height),yctx.fillStyle="#333",yctx.fillRect(15,0,25,yAxis.height);let r=1e3;Xi<=500?r=100:Xi<=2e3?r=250:Xi<=5e3&&(r=500),yctx.fillStyle="#eee",yctx.font="10px sans-serif",yctx.textAlign="right",yctx.textBaseline="middle";let e=Math.max(40,yAxis.width-4),t=specHeight/parseInt(yAxis.style.height);function n(l){let c=specHeight,f=parseFloat(logScaleVal),h=l/(sampleRate/fftSize),p;if(f<=1.0000001)p=c-1-h;else{let y=f-1,b=Math.log(1+y*(c-1));p=(1-Math.log(1+y*h)/b)*(c-1)}let d=Math.max(0,Math.floor(c*(1-fHigh/(sampleRate/2)))),m=Math.min(c,Math.floor(c*(1-fLow/(sampleRate/2))))-d;return(p-d)/m*c/t/(fftSize/2048)}let a=yAxis.getBoundingClientRect();if(useHz){let l=9999999;for(let c=.859375;c<sampleRate/2;c*=Math.pow(2,1/12)){if(visY=n(c),Math.abs(visY-l)<100/fftSize*246||visY<0||visY>a.height)continue;let f=hzToNoteName(c);yctx.save(),yctx.scale(1,t/(fftSize/2048)),yctx.fillText(f,e,visY*(fftSize/2048)),yctx.restore(),l=visY}}else{let l=function(p,d){let v=(p/1e3).toFixed(1)+"k";p<1e3&&(v=p.toFixed(0)),yctx.save(),yctx.scale(1,t/(fftSize/2048)),yctx.fillText(v,e,d*(fftSize/2048)),yctx.restore()};var u=l;let c=0,f=9999999,h=0;for(;c<sampleRate/2;)if(Math.abs(h-f)>100/fftSize*4e3){let p=c+r;for(;c<p;)h=n(c),l(c,h),f=h,c+=r/8}else f=h,h=n(c),l(c,h),c+=r}let i=yAxis.height/(sampleRate/2);yctx.fillStyle="#222",yctx.fillRect(0,0,15,yAxis.height);let o=(fHigh-fLow)*i,s=Math.max(0,Math.min(yAxis.height,yAxis.height-o-fLow*i));yctx.fillStyle="#555",yctx.fillRect(0,s,15,Math.max(1,o)),yctx.strokeStyle="#777",yctx.strokeRect(0,s,15,Math.max(1,o))}function Iz(r,e){if(r.button!==0)return;let t=yAxis.getBoundingClientRect(),n=e?r.touches[0].clientX:r.clientX,a=e?r.touches[0].clientY:r.clientY;n-t.left<15&&(Ic=!0,Sk=a-t.top,Xi=fHigh-fLow)}yAxis.addEventListener("mousedown",r=>{Iz(r,!1)});yAxis.addEventListener("touchstart",r=>{Iz(r,!0)});function Nz(r,e){let t=yAxis.getBoundingClientRect(),n=(e?r.touches[0].clientY:r.clientY)-t.top;if((e?r.touches[0].clientX:r.clientX)-t.left<15){let i=fLow/(sampleRate/2)*t.height,o=fHigh/(sampleRate/2)*t.height;if(Xi=fHigh-fLow,Math.abs(n-(t.height-i))<15&&Io==-1||Io===0){if(yAxis.style.cursor="s-resize",!Ic)return;updateCanvasScroll(),Io=0,fLow=(1-n/t.height)*(sampleRate/2),fLow<0&&(fLow=0),fLow>fHigh&&(fLow=fHigh-1)}else if(Math.abs(n-(t.height-o))<15&&Io==-1||Io==1){if(yAxis.style.cursor="n-resize",!Ic)return;updateCanvasScroll(),Io=1,fHigh=(1-n/t.height)*(sampleRate/2),fHigh>sampleRate/2&&(fHigh=sampleRate/2),fHigh<fLow&&(fHigh=fLow+1)}else{if(yAxis.style.cursor="move",!Ic)return;updateCanvasScroll(),Io=2;let s=(Sk-n)/t.height*(sampleRate/2);fLow+=s,fLow<0&&(fLow=0),fHigh>sampleRate/2&&(fLow=sampleRate/2-Xi),fHigh=fLow+Xi,Sk=n}}else yAxis.style.cursor="default";Ac(),_c(),drawLogScale(),drawCursor(!0)}window.addEventListener("mousemove",r=>{Nz(r,!1)});window.addEventListener("touchmove",r=>{Nz(r,!0)});window.addEventListener("mouseup",r=>{Io=-1,Ic=!1});window.addEventListener("touchend",r=>{Io=-1,Ic=!1});var qm=document.getElementById("playPause"),MHe=document.getElementById("stop"),Cz='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="black" viewBox="9 8 16 16"><path d="M16 0 M14 22V10l8 6z"/></svg>',OHe='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="black" viewBox="0 0 20 20"><rect x="2" y="0" width="5" height="18" rx="2" ry="2"/><rect x="12" y="0" width="5" height="18" rx="2" ry="2"/></svg>';function Az(){if(ensureAudioCtx(),playing){let r=audioCtx.currentTime-sourceStartTime,e=Math.floor(r*sampleRate);sourceNode&&sourceNode.loop&&(e=e%pcm.length),pausedAtSample=Math.max(0,Math.min(pcm.length-1,e)),stopSource(!0),qm.innerHTML=Cz}else{let r=pausedAtSample!==null?Math.floor(pausedAtSample/hop):0;playPCM(!0,r),qm.innerHTML=OHe}}qm.addEventListener("click",()=>{Az()});document.addEventListener("keydown",function(r){r.key===" "&&!r.ctrlKey&&!r.metaKey&&(Az(),r.preventDefault())});MHe.addEventListener("click",()=>{stopSource(!1),recording&&(stopRecording(),recording=!1),ls=0,currentCursorX=0,Ac(),_c(),drawLogScale(),specCtx.putImageData(imageBuffer,0,0),renderView(),drawCursor(!0),qm.innerHTML=Cz});var PHe=.004,_z=2.5,Ek=!1;function Km(r,e,t){return Math.max(e,Math.min(t,r))}function Nc(r,e,t){let n=e.getBoundingClientRect(),a=Km((r-n.left)/n.width,0,1),i=iLow+a*Aa,o=Km(Aa/t,1,framesTotal),s=i-a*o;s<0&&(s=0),s+o>framesTotal&&(s=framesTotal-o),iLow=Math.floor(s),iHigh=Math.floor(iLow+o),Aa=iHigh-iLow,updateCanvasScroll(),Ac(),drawCursor(!0),renderView&&renderView()}function Cc(r,e,t){let n=e.getBoundingClientRect(),a=Km(r-n.top,0,n.height),i=getSineFreq(visibleToSpecY(a*(canvas.height/n.height))),o=fHigh-fLow,s=Km(o/t,.001,sampleRate/2),u=(i-fLow)/o,l=i-u*s;l<0&&(l=0),l+s>sampleRate/2&&(l=sampleRate/2-s),fLow=l,fHigh=l+s,Xi=fHigh-fLow,updateCanvasScroll(),_c(),drawLogScale&&drawLogScale(),drawCursor&&drawCursor(!0),renderView&&renderView()}function Tk(r,e){return function(t){if(!(t.ctrlKey||t.metaKey))return;t.preventDefault();let a=t.deltaY,o=Math.exp((Ek?1:-1)*a*PHe);(e.zoomTimeline&&r===canvas||e.zoomTimeline)&&Nc(t.clientX,Ft,o),(e.zoomYAxis&&r===canvas||e.zoomYAxis)&&Cc(t.clientY,yAxis,o)}}canvas&&canvas.addEventListener("wheel",Tk(canvas,{zoomTimeline:!0,zoomYAxis:!0}),{passive:!1});Ft&&Ft.addEventListener("wheel",Tk(Ft,{zoomTimeline:!0,zoomYAxis:!1}),{passive:!1});yAxis&&yAxis.addEventListener("wheel",Tk(yAxis,{zoomTimeline:!1,zoomYAxis:!0}),{passive:!1});function LHe(r){r.preventDefault();let e=Number(r.scale)||1,t=Math.pow(e,_z);Ek&&(t=1/t);let n=r.clientX||window.innerWidth/2,a=r.clientY||window.innerHeight/2,i=r.target;i===Ft||i.closest&&i.closest("#timeline")?Nc(n,Ft,t):(i===yAxis||i.closest&&i.closest("#yAxis")||Nc(n,Ft,t),Cc(a,yAxis,t))}["gesturestart","gesturechange"].forEach(r=>{document.addEventListener(r,LHe,{passive:!1})});var Wt={active:!1,startDist:0,startILow:0,startIHigh:0,startFLow:0,startFHigh:0,midX:0,midY:0,target:null};function Dz(r,e){let t=r.clientX-e.clientX,n=r.clientY-e.clientY;return Math.hypot(t,n)}function Fz(r,e){return{x:(r.clientX+e.clientX)/2,y:(r.clientY+e.clientY)/2}}function BHe(r){if(!r.touches||r.touches.length!==2)return;let[e,t]=[r.touches[0],r.touches[1]];Wt.active=!0,Wt.startDist=Dz(e,t),Wt.mid=Fz(e,t),Wt.startILow=iLow,Wt.startIHigh=iHigh,Wt.startFLow=fLow,Wt.startFHigh=fHigh;let n=document.elementFromPoint(Wt.mid.x,Wt.mid.y);n?n===Ft||n.closest&&n.closest("#timeline")?Wt.target="timeline":n===yAxis||n.closest&&n.closest("#yAxis")?Wt.target="yAxis":Wt.target="canvas":Wt.target="canvas",r.preventDefault()}function zHe(r){if(!Wt.active||!r.touches||r.touches.length!==2)return;let[e,t]=[r.touches[0],r.touches[1]],n=Dz(e,t);if(Wt.startDist<=0)return;let a=n/Wt.startDist,i=Math.pow(a,_z);Ek&&(i=1/i);let o=Fz(e,t);Wt.target==="canvas"?(iLow=Wt.startILow,iHigh=Wt.startIHigh,Aa=iHigh-iLow,Nc(o.x,Ft,i),fLow=Wt.startFLow,fHigh=Wt.startFHigh,Xi=fHigh-fLow,Cc(o.y,yAxis,i)):Wt.target==="timeline"?(iLow=Wt.startILow,iHigh=Wt.startIHigh,Aa=iHigh-iLow,Nc(o.x,Ft,i)):Wt.target==="yAxis"&&(fLow=Wt.startFLow,fHigh=Wt.startFHigh,Xi=fHigh-fLow,Cc(o.y,yAxis,i)),r.preventDefault()}function Rz(r){if(Wt.active){if(!r.touches||r.touches.length>=1){r.touches.length<2&&(Wt.active=!1);return}Wt.active=!1}}document.addEventListener("touchstart",BHe,{passive:!1});document.addEventListener("touchmove",zHe,{passive:!1});document.addEventListener("touchend",Rz,{passive:!1});document.addEventListener("touchcancel",Rz,{passive:!1});var Mz=Xm(np());window.BasicPitch=Mz.default;
/*! Bundled license information:

@tensorflow/tfjs-core/dist/tf-core.node.js:
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the 'License');
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an 'AS IS' BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)

@tensorflow/tfjs-layers/dist/tf-layers.node.js:
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the 'License');
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an 'AS IS' BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)

@tensorflow/tfjs-converter/dist/tf-converter.node.js:
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the 'License');
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an 'AS IS' BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)

@tensorflow/tfjs-data/dist/tf-data.node.js:
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)

@tensorflow/tfjs-backend-cpu/dist/tf-backend-cpu.node.js:
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the License);
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an AS IS BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)

@tensorflow/tfjs-backend-webgl/dist/tf-backend-webgl.node.js:
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the License);
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an AS IS BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)

@tensorflow/tfjs/dist/tf.node.js:
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the 'License');
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an 'AS IS' BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * https://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
*/
